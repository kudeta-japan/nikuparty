<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TEQUILA-BTIï½œãƒ†ã‚­ãƒ¼ãƒ©å—œå¥½è¨ºæ–­</title>
  <meta name="description" content="18å•ãƒ»1å•15ç§’ã€‚ãƒ†ã‚­ãƒ¼ãƒ©ã®å—œå¥½ã‹ã‚‰8ã‚¿ã‚¤ãƒ—ï¼‹ã‚¿ã‚°ã‚’åˆ¤å®šã€‚ç›¸æ€§No.1ã‚‚æç¤ºã€‚"/>
  <style>
    :root{
      --bg:#0b0c10; --panel:#101218; --ink:#f4f7fb; --muted:#b6c0cf;
      --accent:#00d0ff; --accent2:#ffd166; --border:#1c1f27; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
    .app{width:min(920px,100%);margin:0 auto;padding:24px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--accent),var(--accent2));display:grid;place-items:center;color:#111;font-weight:900}
    .title{font-weight:900}
    .wrap{padding:16px}

    /* ---- QUIZ minimal ---- */
    .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .q-index{font-weight:900}
    .timer{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent2);box-shadow:0 0 0 6px rgba(255,209,102,.1)}
    .sec{font-family:ui-monospace,Menlo,Consolas,monospace}
    .bar{height:6px;background:#141721;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .q-text{font-size:clamp(20px,3.6vw,26px);font-weight:900;text-align:center;margin:16px 0 10px;color:var(--ink)}
    .opt-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:6px}
    @media(min-width:640px){.opt-grid{grid-template-columns:1fr 1fr}}
    .opt{background:#151a27;border:1px solid #2a3140;border-radius:14px;padding:18px;text-align:center;cursor:pointer;
         transition:transform .05s ease,border-color .15s ease,background .15s ease;font-size:clamp(16px,2.6vw,18px);color:var(--ink)}
    .opt strong{color:var(--ink)}
    .opt:hover{transform:translateY(-1px);border-color:#364158;background:#182033}
    .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

    /* ---- RESULT ---- */
    .result{display:grid;gap:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .r-card{background:#0f1219;border:1px solid var(--border);border-radius:14px;padding:14px}
    .big{font-size:clamp(28px,6vw,36px);font-weight:900}
    .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--border);margin-right:6px}
    .desc{margin-top:10px;line-height:1.9}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .btn{appearance:none;border:1px solid var(--border);background:#141721;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#00b7ff);color:#111;border:none;box-shadow:0 10px 24px rgba(0,183,255,.35)}
    footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <main class="app">
    <div class="card">
      <header>
        <div class="brand"><div class="logo">ğŸª…</div><div class="title">TEQUILA-BTI</div></div>
        <button id="btn-start" class="btn primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      </header>
      <div class="wrap" id="stage">
        <!-- START -->
        <section id="screen-start">
          <h2 style="margin:0 0 6px">ã‚ãªãŸã¯ã©ã®â€œãƒ†ã‚­ãƒ¼ãƒ©ã‚¿ã‚¤ãƒ—â€ï¼Ÿ</h2>
          <p style="color:var(--muted);margin:0 0 12px">18å•ï¼1å•15ç§’ã€‚é¸ã¶ã ã‘ã§ã€ãƒ†ã‚­ãƒ¼ãƒ©ã®ã‚¿ã‚¤ãƒ—ã¨ç›¸æ€§ã‚¿ã‚°ï¼ˆãƒ©ã‚¤ãƒ /ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£/ãƒãƒ«ãƒ»ã‚¢ã‚¬ãƒ™/æ¨½é¦™ï¼‰ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
          <div><button class="btn primary" id="btn-start-2">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button></div>
        </section>

        <!-- QUIZ -->
        <section id="screen-quiz" hidden>
          <div class="q-head">
            <div class="q-index"><span id="q-counter">1</span>/<span id="q-total">18</span></div>
            <div class="timer"><div class="dot"></div><div class="sec"><span id="sec">15</span>s</div></div>
          </div>
          <div class="bar"><div id="bar"></div></div>
          <div class="q-text" id="q-text">ã©ã¡ã‚‰ãŒè¿‘ã„ï¼Ÿ</div>
          <div class="opt-grid">
            <button class="opt" id="btn-A"><strong id="label-A">A</strong></button>
            <button class="opt" id="btn-B"><strong id="label-B">B</strong></button>
          </div>
          <div class="progress-note">â€»æœªå›ç­”ã¯15ç§’ã§è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—</div>
        </section>

        <!-- RESULT -->
        <section id="screen-result" hidden>
          <div class="result">
            <div class="big" id="r-title">è¨ºæ–­çµæœ</div>
            <div class="grid">
              <div class="r-card">
                <div><strong>ã‚ãªãŸã®ãƒ†ã‚­ãƒ¼ãƒ©ã‚¿ã‚¤ãƒ—</strong></div>
                <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
                <div class="mono" id="r-type-code" style="opacity:.8">U-C-N</div>
                <div style="margin-top:10px"><span class="pill" id="tag-garnish">ãƒ©ã‚¤ãƒ æ´¾</span><span class="pill" id="tag-scene">ãƒ‘ãƒ¼ãƒ†ã‚£</span><span class="pill" id="tag-aroma">ã‚¢ã‚¬ãƒ™</span></div>
                <p class="desc" id="r-desc"></p>
              </div>
              <div class="r-card">
                <div><strong>ç›¸æ€§No.1</strong></div>
                <div id="r-best" class="mono" style="margin-top:6px"></div>
              </div>
            </div>
            <div class="r-card">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                <strong>è©³ç´°ï¼ˆé›†è¨ˆå€¤ï¼‰</strong>
                <button class="btn" id="btn-copy">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
              </div>
              <pre class="mono" id="r-detail" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
            </div>
            <div style="display:flex;justify-content:space-between;gap:10px">
              <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
              <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
            </div>
          </div>
        </section>
      </div>
      <footer>Â© KU-DETA / TEQUILA-BTI</footer>
    </div>
  </main>

<script>
/* --------------- Question Data (18) --------------- */
// Axes:
// UA: Unaged(U:ãƒ–ãƒ©ãƒ³ã‚³ç³») vs Aged(A:æ¨½ç†Ÿæˆç³»)
// CS: Citrus/Herbal(C) vs Sweet/Vanilla/Spice(S)
// NM: Neat(N) vs Mix(M)
// Extra tags (do not change FS/NM directly): Garnish Lime vs NeatOnly, Scene Party vs Chill, Aroma Agave vs Barrel

const QUESTIONS = [
  // UA (1-4) A=U B=A
  {id:1, axis:"UA", a:"æ¾„ã‚“ã ã‚¯ãƒªã‚¢ãªå‘³ã‚ã„ãŒå¥½ãï¼ˆãƒ–ãƒ©ãƒ³ã‚³å¯„ã‚Šï¼‰", b:"æ¨½ã®ä¸¸ã¿ã¨æ·±ã¿ãŒå¥½ãï¼ˆç†Ÿæˆå¯„ã‚Šï¼‰"},
  {id:2, axis:"UA", a:"è¦‹ãŸç›®ã¯é€æ˜ãŒå¥½ã¿", b:"ç¥ç€è‰²ã«æƒ¹ã‹ã‚Œã‚‹"},
  {id:3, axis:"UA", a:"ã‚¿ã‚³ã‚¹ã‚„ã‚»ãƒ“ãƒ¼ãƒã‚§ã«åˆã†ã®ãŒå¬‰ã—ã„", b:"ãƒãƒ§ã‚³ã‚„ãƒŠãƒƒãƒ„ã¨ã‚‚ç›¸æ€§ãŒè‰¯ã„ã¨å¬‰ã—ã„"},
  {id:4, axis:"UA", a:"å¥½ããªã®ã¯ãƒ–ãƒ©ãƒ³ã‚³", b:"å¥½ããªã®ã¯ã‚¢ãƒãƒ›"},
  // CS (5-7) A=C B=S
  {id:5, axis:"CS", a:"é’ã„ã‚¢ã‚¬ãƒ™ãƒ»ã‚·ãƒˆãƒ©ã‚¹ãƒ»ãƒãƒ¼ãƒ–ã®é¦™ã‚Š", b:"ãƒãƒ‹ãƒ©ãƒ»ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹ã®é¦™ã‚Š"},
  {id:6, axis:"CS", a:"ã‚­ãƒ¬ã®ã‚ã‚‹ãƒ‰ãƒ©ã‚¤", b:"ã¾ã‚ã‚„ã‹ã§ç”˜ã¿ã®ä½™éŸ»"},
  {id:7, axis:"CS", a:"ãƒ¬ãƒ¢ãƒ³/ãƒ©ã‚¤ãƒ ã«åˆã‚ã›ãŸã„", b:"æ¨½ç”±æ¥ã®ç”˜ã•ã‚’æ¥½ã—ã¿ãŸã„"},
  // NM (8-10) A=N B=M
  {id:8, axis:"NM", a:"ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆorãƒ­ãƒƒã‚¯ã§ã˜ã£ãã‚Š", b:"ãƒ†ã‚­ãƒ¼ãƒ©ã‚½ãƒ¼ãƒ€ã‚„ã‚«ã‚¯ãƒ†ãƒ«ãŒå¥½ã"},
  {id:9, axis:"NM", a:"å°ã•ã‚ã‚°ãƒ©ã‚¹ã§é¦™ã‚Šã‚’æ¥½ã—ã‚€", b:"ãƒ­ãƒ³ã‚°ã§ã‚´ã‚¯ã‚´ã‚¯æ¥½ã—ã‚€"},
  {id:10, axis:"NM", a:"ã˜ã£ãã‚Šå‘³ã‚ã„ãŸã„", b:"å ´ã‚’å›ã™ãƒ†ãƒ³ãƒé‡è¦–"},
  // Garnish Lime/NeatOnly (11-12) A=Lime B=NeatOnly
  {id:11, axis:"GA", a:"å¡©ï¼†ãƒ©ã‚¤ãƒ ã®ç‹é“ãŒå¥½ã", b:"ä½•ã‚‚è¶³ã•ãšã«æ¥½ã—ã¿ãŸã„"},
  {id:12, axis:"GA", a:"æŸ‘æ©˜ã‚’è»½ãçµã‚‹ã¨ä¸ŠãŒã‚‹", b:"é¦™ã‚ŠãŒå¤‰ã‚ã‚‹ã®ã§åŸºæœ¬ã¯ãã®ã¾ã¾"},
  // Scene Party/Chill (13-15) A=Party B=Chill
  {id:13, axis:"SC", a:"ã¿ã‚“ãªã§ãƒ¯ã‚¤ãƒ¯ã‚¤ä¹¾æ¯å‘ã", b:"é™ã‹ãªãƒãƒ¼ã§ã—ã£ã¨ã‚Š"},
  {id:14, axis:"SC", a:"ãƒ†ãƒ³ãƒè‰¯ãæ¥½ã—ã", b:"è½ã¡ç€ã„ã¦ä¼šè©±ã‚’æ¥½ã—ã‚€"},
  {id:15, axis:"SC", a:"BGMã¯ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ", b:"ã‚¸ãƒ£ã‚ºã‚„ãƒãƒ«ãŒå¿ƒåœ°ã‚ˆã„"},
  // Aroma Agave/Barrel (16-18) A=Agave B=Barrel
  {id:16, axis:"AR", a:"é’ã„ã‚¢ã‚¬ãƒ™ã®ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æ„Ÿ", b:"æ¨½é¦™ã®ãƒãƒ‹ãƒ©ã‚„ãƒˆãƒ•ã‚£ãƒ¼"},
  {id:17, axis:"AR", a:"ãƒŸãƒãƒ©ãƒ«æ„Ÿãƒ»ãƒãƒ¼ãƒ–æ„ŸãŒå¥½ã", b:"ãƒˆãƒ¼ã‚¹ãƒˆé¦™ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹æ„ŸãŒå¥½ã"},
  {id:18, axis:"AR", a:"ã‚¯ãƒªã‚¢ã§ã‚¯ãƒªãƒ¼ãƒ³", b:"åšã¿ã¨ä¸¸ã¿"},
];

const AXIS_LABEL = {
  UA: {A:"U", B:"A"},
  CS: {A:"C", B:"S"},
  NM: {A:"N", B:"M"},
  GA: {A:"Lime", B:"NeatOnly"},
  SC: {A:"Party", B:"Chill"},
  AR: {A:"Agave", B:"Barrel"},
};

/* --- 8 types (with rare) --- */
const TYPE_NAMES = {
  "U-C-N":"ãƒ–ãƒ©ãƒ³ã‚³ï¼ˆãƒã‚¤ãƒ©ãƒ³ãƒ‰å¿—å‘ï¼‰",
  "U-C-M":"ãƒ–ãƒ©ãƒ³ã‚³ãƒ»ã‚½ãƒ¼ãƒ€",
  "U-S-N":"ã‚¯ãƒªã‚¹ã‚¿ãƒªãƒ¼ãƒ",
  "U-S-M":"ãƒ›ãƒ¼ãƒ™ãƒ³ï¼ˆã‚´ãƒ¼ãƒ«ãƒ‰ï¼‰",
  "A-C-N":"ãƒ¬ãƒã‚µãƒ‰",
  "A-C-M":"ãƒ¬ãƒã‚µãƒ‰ãƒ»ãƒã‚¤ãƒœãƒ¼ãƒ«",
  "A-S-N":"ã‚¢ãƒãƒ›",
  "A-S-M":"ã‚¢ãƒãƒ›ãƒ»ã‚«ã‚¯ãƒ†ãƒ«"
};

const DESCRIPTIONS = {
  "ãƒ–ãƒ©ãƒ³ã‚³ï¼ˆãƒã‚¤ãƒ©ãƒ³ãƒ‰å¿—å‘ï¼‰":"ã‚¢ã‚¬ãƒ™æœ¬æ¥ã®é’ã•ã¨ãƒŸãƒãƒ©ãƒ«ã€ãƒ©ã‚¤ãƒ ã®ç›¸æ€§ã§å‹è² ã™ã‚‹ç´”åº¦é«˜ã‚ã‚¿ã‚¤ãƒ—ã€‚é¦™ã‚Šã¯ã‚·ãƒˆãƒ©ã‚¹ã‚„ãƒãƒ¼ãƒ–ã€å‘³ã‚ã„ã¯ã‚·ãƒ£ãƒ¼ãƒ—ã§å¾Œå£ã¯ã‚¯ãƒªãƒ¼ãƒ³ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã§ã‚‚ã„ã‘ã‚‹ãŒã€ä¸€å£ç›®ã¯å¡©ã‚„ãƒ©ã‚¤ãƒ ã§ç«‹ã¡ä¸ŠãŒã‚Šã‚’æ¥½ã—ã‚€ã®ãŒå¾—æ„ã€‚è»½ã‚„ã‹ãªæ–™ç†ã¨ã®ç›¸æ€§ãŒè‰¯ãã€ä¹¾æ¯ã‹ã‚‰ãƒ†ãƒ³ãƒã‚ˆãä¼šè©±ã‚’å›ã™ãƒ•ã‚¡ã‚·ãƒªå½¹ã«ã‚‚å‘ã„ã¦ã„ã¾ã™ã€‚",
  "ãƒ–ãƒ©ãƒ³ã‚³ãƒ»ã‚½ãƒ¼ãƒ€":"çˆ½å¿«æ„Ÿé‡è¦–ã€‚ãƒ¬ãƒ¢ãƒ³ã‚„ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’åˆã‚ã›ã€ã‚¯ãƒªã‚¢ãªã‚¢ã‚¬ãƒ™æ„Ÿã‚’ã‚½ãƒ¼ãƒ€ã§ä¼¸ã°ã—ã¦é£²ã¿ã‚„ã™ãã€‚å ´ã‚’æ¸©ã‚ã‚‹ã®ãŒä¸Šæ‰‹ã§ã€åˆå¯¾é¢ã§ã‚‚ã‚°ãƒ©ã‚¹ã‚’ç‰‡æ‰‹ã«è»½å¿«ã«ãƒ–ãƒªãƒƒã‚¸ã€‚å‘³ã®å¥½ã¿ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã€ç”˜ã•æ§ãˆã‚ãƒ»é¦™ã‚Šã¯ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŒãƒ™ãƒ¼ã‚¹ã€‚ãƒ•ãƒ¼ãƒ‰ã¯ã‚»ãƒ“ãƒ¼ãƒã‚§ã‚„ã‚µãƒ©ãƒ€ãªã©ãƒ©ã‚¤ãƒˆãªãƒšã‚¢ãƒªãƒ³ã‚°ãŒå¾—æ„ã§ã™ã€‚",
  "ã‚¯ãƒªã‚¹ã‚¿ãƒªãƒ¼ãƒ":"ç†Ÿæˆã®è§’ã‚’ä¸¸ãã—ã¤ã¤ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ã‚¯ãƒªã‚¢ã«ã—ãŸãƒ¢ãƒ€ãƒ³æ´¾ã€‚å¤–è¦³ã¯é€æ˜ã§ã‚‚ã€å†…å´ã«ã¯æ¨½ç”±æ¥ã®ã¾ã‚ã‚„ã‹ãªç”˜ã¿ã¨ä½™éŸ»ã€‚ä¸å¯§ãªæ‰€ä½œãŒå¥½å°è±¡ã§ã€ä¼šè©±ã¯è½ã¡ç€ã„ã¦çš„ç¢ºã€‚ãƒ©ã‚¤ãƒ ã«é ¼ã‚‰ãšé¦™ã‚Šã‚’æ¥½ã—ã¿ãŸã„æ™‚ã«çœŸä¾¡ã‚’ç™ºæ®ã—ã€ãƒãƒ¼ã§ã‚‚é£Ÿä¸­ã§ã‚‚æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ãƒãƒ©ãƒ³ã‚µãƒ¼ã§ã™ã€‚",
  "ãƒ›ãƒ¼ãƒ™ãƒ³ï¼ˆã‚´ãƒ¼ãƒ«ãƒ‰ï¼‰":"ã«ãã‚„ã‹ã§ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥æ—ºç››ãªãƒ‘ãƒ¼ãƒ†ã‚£ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚ç”˜å‘³ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚„è‰²å‘³ã®è¯ã‚„ã‹ã•ã§ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚’ä¸Šã’ã€ã‚«ã‚¯ãƒ†ãƒ«ã§ã‚‚çœŸä¾¡ã‚’ç™ºæ®ã€‚å‘³ã¯åˆ†ã‹ã‚Šã‚„ã™ãã€å†™çœŸæ˜ ãˆã‚‚å¤§åˆ‡ã€‚ãƒ†ãƒ³ãƒè‰¯ã„ä¼šè©±ã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§è¼ªã‚’åºƒã’ã‚‹ã®ãŒå¾—æ„ãªç¤¾äº¤ã‚¿ã‚¤ãƒ—ã§ã™ã€‚",
  "ãƒ¬ãƒã‚µãƒ‰":"çŸ­æœŸç†Ÿæˆã®ã‚„ã‚ã‚‰ã‹ãªæœ¨é¦™ã¨ã‚¢ã‚¬ãƒ™ã®ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ãŒåŒå±…ã€‚é£Ÿä¸­ã®ä¸‡èƒ½é¸æ‰‹ã§ã€è»½ã‚„ã‹ã•ã‚’ä¿ã¡ã¤ã¤å¥¥è¡Œãã‚’ãƒ—ãƒ©ã‚¹ã€‚èãä¸Šæ‰‹ã§ã€ç›¸æ‰‹ã®å¥½ã¿ã‚’ã»ã©ã‚ˆãæ‹¾ã£ã¦å¯„ã‚Šæ·»ãˆã‚‹ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã§ã‚‚ã‚«ã‚¯ãƒ†ãƒ«ã§ã‚‚ã„ã‘ã‚‹æ±ç”¨æ€§ãŒé­…åŠ›ã§ã™ã€‚",
  "ãƒ¬ãƒã‚µãƒ‰ãƒ»ãƒã‚¤ãƒœãƒ¼ãƒ«":"è»½å¿«ã•ã¨æ¨½ã®ä¸¸ã¿ã‚’ä¸¡ç«‹ã™ã‚‹ç¾ä»£æ´¾ã€‚ç‚­é…¸ã§é¦™ã‚Šã‚’é–‹ã‹ã›ã¤ã¤ã€ç”˜ã•ã¯æ§ãˆã‚ã€‚é£Ÿäº‹ã¨ä¸¦èµ°ã—ã‚„ã™ãã€ä¼šè©±ã‚‚ãƒ†ãƒ³ãƒã‚ˆãé€²è¡Œã€‚åˆå¯¾é¢ã§ã®â€œã‚‚ã†ä¸€æ¯ã„ã‘ã‚‹â€ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šãŒå…‰ã‚Šã¾ã™ã€‚",
  "ã‚¢ãƒãƒ›":"æ¨½ç”±æ¥ã®ãƒãƒ‹ãƒ©ã‚„ãƒˆãƒ•ã‚£ãƒ¼ã€ã‚¹ãƒ‘ã‚¤ã‚¹ã®åšã¿ã‚’ã—ã£ã‹ã‚Šæ¥½ã—ã‚€å¤§äººã‚¿ã‚¤ãƒ—ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã§ã‚°ãƒ©ã‚¹ã‚’å›ã—ãªãŒã‚‰ã€ã‚†ã£ãã‚Šä¼šè©±ã‚’æ·±ã‚ã‚‹ã®ãŒå¾—æ„ã€‚è½ã¡ç€ã„ãŸå ´ã§å­˜åœ¨æ„Ÿã‚’æ”¾ã¡ã€ãƒ‡ã‚¶ãƒ¼ãƒˆã‚„ãƒãƒ§ã‚³ã¨ã‚‚å¥½ç›¸æ€§ã§ã™ã€‚",
  "ã‚¢ãƒãƒ›ãƒ»ã‚«ã‚¯ãƒ†ãƒ«":"é‡åšã•ã‚’ã‚«ã‚¯ãƒ†ãƒ«ã§ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã«è§£ãä¸Šç´šè€…ã€‚ã‚ªãƒ¼ãƒ«ãƒ‰ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ‰é¢¨ãªã©ã€æ¨½é¦™ã‚’ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã¨ã—ã¦æ´»ã‹ã™ã‚»ãƒ³ã‚¹ãŒé­…åŠ›ã€‚ä¼šè©±ã¯ç‰©è…°æŸ”ã‚‰ã‹ã§ã€æ°—é…ã‚Šä¸Šæ‰‹ã€‚äºŒè»¸ä»¥ä¸Šã®åå¯¾æ€§ã‚’æŒã¤ç›¸æ‰‹ã¨ã‚‚å™›ã¿åˆã„ã‚„ã™ã„ç¤¾äº¤æ€§ã‚’å‚™ãˆã¾ã™ã€‚",
  "ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã‚¢ãƒãƒ›":"é•·æœŸç†Ÿæˆã®æ·±ã¿ã¨ã—ã£ã¨ã‚Šã—ãŸç”˜ã‚„ã‹ã•ã‚’ä¼´ã†å¸Œå°‘ã‚¿ã‚¤ãƒ—ã€‚é‡ã‚ˆã‚Šè³ªã€ã‚°ãƒ©ã‚¹ä¸€æ¯ã§ç‰©èªã‚‹ä½™éŸ»æ´¾ã€‚ãƒãƒ¼ã§ã®é™ã‹ãªæ™‚é–“ã‚„å°‘äººæ•°ã®ä¼šã«æœ€é©ã§ã€è¨€è‘‰å°‘ãªã§ã‚‚ä½™éŸ»ã§ä¼ãˆã‚‹è¡¨ç¾åŠ›ãŒé­…åŠ›ã€‚ä¸å¯§ã•ã¨èª å®Ÿã•ã‚’å¤§åˆ‡ã«ã™ã‚‹ç›¸æ‰‹ã¨ç›¸æ€§è‰¯å¥½ã§ã™ã€‚"
};

const OPP = { U:"A", A:"U", C:"S", S:"C", N:"M", M:"N" };

/* --------------- State --------------- */
let current = 0; let timer = null; let tLeft = 15; const total = QUESTIONS.length;
const counts = { U:0,A:0,C:0,S:0,N:0,M:0,Lime:0,NeatOnly:0,Party:0,Chill:0,Agave:0,Barrel:0 };
const answers = [];

const $ = id => document.getElementById(id);
const screenStart = $('screen-start');
const screenQuiz  = $('screen-quiz');
const screenResult= $('screen-result');

function showScreen(which){
  screenStart.hidden = which !== 'start';
  screenQuiz.hidden  = which !== 'quiz';
  screenResult.hidden= which !== 'result';
}
function resetAll(){
  stopTimer(); tLeft=15; $('sec').textContent='15'; $('bar').style.width='0%';
  Object.keys(counts).forEach(k=>counts[k]=0);
  answers.length=0; current=0; showScreen('start');
}
function start(){ resetAll(); showScreen('quiz'); $('q-total').textContent=total; current=0; renderQ(); startTimer(); }

function renderQ(){
  const q = QUESTIONS[current];
  $('q-counter').textContent = current+1;
  $('q-text').textContent = 'ã©ã¡ã‚‰ãŒè¿‘ã„ï¼Ÿ';
  $('label-A').textContent = q.a;
  $('label-B').textContent = q.b;
}

function startTimer(){
  stopTimer(); tLeft=15; const totalMs=15000; const startAt=performance.now();
  $('sec').textContent=String(tLeft);
  const tick=()=>{
    const elapsed=performance.now()-startAt; const remain=Math.max(0,totalMs-elapsed);
    const s=Math.ceil(remain/1000); if(s!==tLeft){ tLeft=s; $('sec').textContent=String(s); }
    const pct=(elapsed/totalMs)*100; $('bar').style.width=Math.min(100,pct)+'%';
    if(remain<=0){ stopTimer(); pick('skip'); } else { timer=requestAnimationFrame(tick); }
  };
  timer=requestAnimationFrame(tick);
}
function stopTimer(){ if(timer){ cancelAnimationFrame(timer); timer=null; } }

function pick(choice){
  const q = QUESTIONS[current]; answers.push({ id:q.id, axis:q.axis, choice });
  if(choice==='A'||choice==='B'){ const label=AXIS_LABEL[q.axis][choice]; counts[label]=(counts[label]||0)+1; }
  next();
}
function next(){ stopTimer(); if(current<total-1){ current++; renderQ(); startTimer(); } else { showResult(); } }

/* ---- result logic (UA adjustment & rare) ---- */
function computeResult(){
  const U_base=counts.U, A_base=counts.A; const C=counts.C, S=counts.S; const N=counts.N, M=counts.M;
  const Lime=counts.Lime, NeatOnly=counts.NeatOnly; const Party=counts.Party, Chill=counts.Chill; const Agave=counts.Agave, Barrel=counts.Barrel;

  // Adjust UA only: party/lime/agave -> Uã« +1ã€ chill/straight/barrel -> Aã« +1
  const U_adj = (Lime>=2?1:0) + (Party>=2?1:0) + (Agave>=2?1:0);
  const A_adj = (NeatOnly>=2?1:0) + (Chill>=2?1:0) + (Barrel>=2?1:0);

  const Uf = U_base + U_adj; const Af = A_base + A_adj;
  const UA = (Uf>=Af)?'U':'A';
  const CS = (C>=S)?'C':'S';
  const NM = (N>=M)?'N':'M';

  const code = `${UA}-${CS}-${NM}`;
  let name = TYPE_NAMES[code] || 'ä¸æ˜';

  // Rare: Extra AÃ±ejo â€” A-S-N base + (NeatOnly>=2 & Chill>=2 & Barrel>=2) and A_base>=3,S>=2,N>=2
  const isXA = (code==='A-S-N') && (NeatOnly>=2 && Chill>=2 && Barrel>=2) && (A_base>=3 && S>=2 && N>=2);
  if(isXA) name = 'ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã‚¢ãƒãƒ›';

  const tagGarnish = (Lime>=NeatOnly)?'ãƒ©ã‚¤ãƒ æ´¾':'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆæ´¾';
  const tagScene   = (Party>=Chill)?'ãƒ‘ãƒ¼ãƒ†ã‚£':'ãƒãƒ«';
  const tagAroma   = (Agave>=Barrel)?'ã‚¢ã‚¬ãƒ™':'æ¨½é¦™';

  return { code, name, U_base,A_base,C,S,N,M,Lime,NeatOnly,Party,Chill,Agave,Barrel, U_adj,A_adj,Uf,Af, tagGarnish,tagScene,tagAroma };
}

function allTypeCodes(){ return Object.keys(TYPE_NAMES); }
function parseCode(code){ const [a,b,c]=code.split('-'); return {UA:a,CS:b,NM:c}; }

/* ç›¸æ€§No.1 */
function bestMatch(code){
  const mine=parseCode(code); let best=null, bestScore=-1;
  for(const t of allTypeCodes()){
    if(t===code) continue; const other=parseCode(t);
    let opp=0, same=0;
    if(other.UA===OPP[mine.UA]) opp++;
    if(other.CS===OPP[mine.CS]) opp++;
    if(other.NM===OPP[mine.NM]) opp++;
    if(other.UA===mine.UA) same++;
    if(other.CS===mine.CS) same++;
    if(other.NM===mine.NM) same++;
    const score = (opp>=2) ? opp*10 : (opp*10 + same);
    if(score>bestScore){ bestScore=score; best=t; }
  }
  return best;
}

function showResult(){
  const r=computeResult(); showScreen('result');
  $('r-type-name').textContent=r.name;
  $('r-type-code').textContent=r.code;
  $('tag-garnish').textContent=r.tagGarnish;
  $('tag-scene').textContent=r.tagScene;
  $('tag-aroma').textContent=r.tagAroma;
  $('r-desc').textContent = DESCRIPTIONS[r.name] || '';

  const bm=bestMatch(r.code);
  $('r-best').textContent = bm ? `${TYPE_NAMES[bm]}ï¼ˆ${bm}ï¼‰` : 'â€”';

  const detail=[
    `U/A base: U=${r.U_base}, A=${r.A_base}  adj: U+${r.U_adj}, A+${r.A_adj}  â†’ Uf=${r.Uf}, Af=${r.Af}`,
    `C/S: C=${r.C}, S=${r.S}`,
    `N/M: N=${r.N}, M=${r.M}`,
    `Tags: Lime=${r.Lime}, NeatOnly=${r.NeatOnly} | Party=${r.Party}, Chill=${r.Chill} | Agave=${r.Agave}, Barrel=${r.Barrel}`,
    `${r.tagGarnish}ãƒ»${r.tagScene}ãƒ»${r.tagAroma}`,
  ].join('\n');
  $('r-detail').textContent=detail;

  const payload={
    type:{code:r.code,name:r.name},
    tags:{garnish:r.tagGarnish,scene:r.tagScene,aroma:r.tagAroma},
    counts:{U:r.U_base,A:r.A_base,C:r.C,S:r.S,N:r.N,M:r.M,Lime:r.Lime,NeatOnly:r.NeatOnly,Party:r.Party,Chill:r.Chill,Agave:r.Agave,Barrel:r.Barrel},
    adjusted:{Uf:r.Uf,Af:r.Af,U_adj:r.U_adj,A_adj:r.A_adj},
    answers, generatedAt:new Date().toISOString()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=$('btn-export'); a.href=url; a.download=`TEQUILA-BTI_${r.code}.json`;
}

async function copyResult(){
  const name=$('r-type-name').textContent; const code=$('r-type-code').textContent;
  const tags=[$('tag-garnish').textContent,$('tag-scene').textContent,$('tag-aroma').textContent].join('ãƒ»');
  const text=`TEQUILA-BTI\nã‚¿ã‚¤ãƒ—ï¼š${name}ï¼ˆ${code}ï¼‰\nã‚¿ã‚°ï¼š${tags}`;
  try{ await navigator.clipboard.writeText(text); $('btn-copy').textContent='ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'; setTimeout(()=>$('btn-copy').textContent='çµæœã‚’ã‚³ãƒ”ãƒ¼',1500); } catch{ alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
}

/* events */
['btn-start','btn-start-2'].forEach(id=>document.getElementById(id).addEventListener('click',start));
['btn-A','btn-B'].forEach((id,i)=>document.getElementById(id).addEventListener('click',()=>pick(i===0?'A':'B')));
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',resetAll);
const copy=document.getElementById('btn-copy'); if(copy) copy.addEventListener('click',copyResult);

/* keyboard shortcuts */
window.addEventListener('keydown',e=>{ if(screenQuiz.hidden) return; if(e.key==='1') pick('A'); else if(e.key==='2') pick('B'); else if(e.key.toLowerCase()==='s'){ pick('skip'); } else if(e.code==='Space'){ e.preventDefault(); pick('skip'); } });

/* init */
showScreen('start');
</script>
</body>
</html>
