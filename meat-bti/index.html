<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meat BTI｜肉診断（20問）</title>
  <meta name="description" content="二択20問に答えると、あなたに合う“肉のタイプ”を判定。ステップ式でサクサク進みます。" />
  <meta name="theme-color" content="#111111" />
  <style>
    :root{
      --bg:#0b0b0b; --text:#f7f7f7; --muted:#b8b8b8; --card:#141414; --border:#2a2a2a;
      --accent:#ff3b2f; --accent-2:#ffc400;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic","YuGothic","Helvetica Neue",Arial,sans-serif;
      line-height:1.6}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{width:min(960px,92vw);margin:0 auto}

    header{position:sticky;top:0;z-index:50;background:rgba(0,0,0,.55);
      border-bottom:1px solid var(--border);backdrop-filter:saturate(130%) blur(6px)}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px;padding:0 12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo{width:26px;height:26px;border-radius:8px;background:conic-gradient(from 15deg,var(--accent),var(--accent-2));box-shadow:0 0 0 2px #000 inset}
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,1,1);white-space:nowrap;border:0}

    .main{padding:0 0 60px}

    /* HERO */
    .hero{position:relative;min-height:62vh;display:flex;align-items:flex-end;overflow:hidden;border-bottom:1px solid var(--border);background:#000}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.05) 0%, rgba(0,0,0,.55) 70%, rgba(0,0,0,.85) 100%);z-index:1}
    .hero-link{position:absolute;inset:0;z-index:0;display:block}
    .hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .hero-inner{position:relative;z-index:3;padding:40px 0 28px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:999px;border:1px solid var(--border);background:#1b1b1b;color:#fff;font-weight:800}
    .btn-primary{background:linear-gradient(135deg,var(--accent),#ff6a50);border-color:#ff6a50}

    /* Cards */
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:grid;gap:16px;grid-template-columns:1fr}
    @media (min-width:860px){.row{grid-template-columns:1.1fr .9fr}}

    .progress-wrap{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .bar{position:relative;flex:1;height:8px;border-radius:999px;background:#1e1e1e;overflow:hidden}
    .bar>i{position:absolute;inset:0;width:0;background:linear-gradient(90deg,var(--accent-2),var(--accent))}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#111;font-size:12px}

    /* Quiz fieldsets (legacy preview area) */
    form{margin-top:10px}
    fieldset.q{margin:12px 0;border:1px solid var(--border);background:#151515;padding:16px;border-radius:16px}
    fieldset.q legend{padding:0 6px;font-weight:800;margin-bottom:8px}
    .choices{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:720px){.choices{grid-template-columns:1fr 1fr}}
    .choice{position:relative;border:1px solid var(--border);background:#131313;border-radius:14px;padding:14px 14px 14px 44px;cursor:pointer;min-height:48px;display:flex;align-items:center}
    .choice:hover{border-color:#3a3a3a;background:#171717}
    .choice input{position:absolute;left:12px;top:50%;transform:translateY(-50%);width:18px;height:18px}

    /* Wizard (full-screen overlay) */
    .no-scroll{overflow:hidden}
    .wizard{position:fixed;z-index:60;inset:64px 0 0 0;display:none;background:var(--bg)}
    .wizard.show{display:block}
    .wizard-header{position:absolute;top:0;left:0;right:0;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.75);backdrop-filter:saturate(130%) blur(6px)}
    .wizard-header .status{display:flex;gap:10px;align-items:center}
    .wizard-close{appearance:none;border:1px solid var(--border);background:#111;color:#fff;border-radius:999px;padding:8px 12px}
    .slides{position:absolute;top:56px;left:0;right:0;bottom:72px;display:flex;transition:transform .45s ease}
    .slide{flex:0 0 100%;padding:18px;overflow:auto;display:grid;place-items:start}
    .wizard-footer{position:absolute;left:0;right:0;bottom:0;height:72px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px;background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.45));backdrop-filter:saturate(130%) blur(6px)}
    .wizard-footer .right{display:flex;gap:8px;flex-wrap:wrap}
    .step-card{width:min(900px,92vw)}
    .step-title{font-weight:900;font-size:22px;margin:0 0 8px}
    .step-desc{color:var(--muted);margin:0 0 12px}

    /* Result blocks */
    .grid{display:grid;gap:12px}
    .grid-2{grid-template-columns:1fr}
    @media (min-width:860px){.grid-2{grid-template-columns:1fr 1fr}}
    .dim-item{display:flex;align-items:center;gap:10px}
    .dim-item .track{flex:1;height:8px;border-radius:999px;background:#1f1f1f;overflow:hidden}
    .dim-item .fill{height:100%;background:linear-gradient(90deg,var(--accent-2),var(--accent))}
    .type-grid{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (min-width:720px){.type-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    @media (min-width:1024px){.type-grid{grid-template-columns:repeat(6,minmax(0,1fr))}}
    .type-card{border:1px solid var(--border);background:#141414;border-radius:14px;padding:10px;text-align:center}
    .type-card.active{outline:2px solid var(--accent-2);box-shadow:0 0 0 4px rgba(255,196,0,.15)}

    footer{border-top:1px solid var(--border);color:var(--muted);padding:22px 0 40px;margin-top:40px}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="logo" aria-hidden="true"></span><span class="sr-only">Meat BTI</span></div>
      <nav style="display:flex;gap:10px;align-items:center">
        <a class="pill" href="../index.html">トップへ</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <!-- HERO -->
    <section class="hero" id="top" aria-label="Meat BTI Hero">
      <a class="hero-link" href="mbti.png" target="_blank" rel="noopener">
        <img class="hero-img" src="mbti.png" alt="">
      </a>
      <div class="container hero-inner">
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button id="startBtn" type="button" class="btn btn-primary">診断する</button>
          <a href="../index.html" class="btn">街コンTOPへ</a>
        </div>
      </div>
    </section>

    <!-- 説明＋（レガシーの見出しだけ残す） -->
    <div class="container" style="padding:28px 0">
      <div class="row">
        <section class="card">
          <h1 style="margin:6px 0 8px">肉診断（Meat BTI）</h1>
          <p class="lead">二択の<strong>全20問</strong>。直感でお答えください。<br>結果は6軸の傾向と12タイプのおすすめを表示します。</p>
          <div class="progress-wrap">
            <div class="pill" id="progressText">0/20 回答済み</div>
            <div class="pill" id="stepInfo">Step 1/4</div>
            <div class="bar" aria-hidden="true"><i id="progressBar"></i></div>
          </div>
          <!-- レガシーフォームの表示はウィザードに置換するので空置き -->
          <form id="quizLegacy"></form>
        </section>
        <aside class="card">
          <h2 style="margin:6px 0 8px;font-size:18px">診断の考え方</h2>
          <ol style="margin:0 0 10px 18px;padding:0">
            <li>6軸（SOC/RICH/PACE/NOV/TEXT/VALUE）の回答をA/Bで集計</li>
            <li>各タイプの重み（−3〜+3）と回答ベクトルの内積を算出</li>
            <li>スコア最大のタイプ＋次点2つを提示</li>
          </ol>
        </aside>
      </div>
    </div>

    <!-- Wizard overlay -->
    <section id="wizard" class="wizard" aria-hidden="true">
      <div class="wizard-header">
        <div class="status">
          <div class="pill" id="wProgressText">0/20 回答済み</div>
          <div class="pill" id="wStepInfo">Step 1/4</div>
        </div>
        <button id="wizardClose" class="wizard-close" type="button">閉じる</button>
      </div>
      <div id="slides" class="slides"><!-- steps will be injected --></div>
      <div class="wizard-footer">
        <div class="left">
          <button type="button" id="wReset" class="btn">リセット</button>
        </div>
        <div class="right">
          <button type="button" id="wPrev" class="btn" disabled>前の5問へ</button>
          <button type="button" id="wNext" class="btn">次の5問へ</button>
          <button type="button" id="wSubmit" class="btn btn-primary" disabled>結果を見る</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <small>© <span id="y"></span> KU-DETA / Meat BTI</small>
    </div>
  </footer>

  <script>
  (function(){
    const $ = (s)=>document.querySelector(s);

    // Year
    $('#y').textContent = new Date().getFullYear();

    // ===== 20 Questions =====
    const QUESTIONS = [
      {"id":1,"text":"焼き肉かステーキか","A":"ステーキでじっくり味わいたい","B":"焼き肉でワイワイ楽しみたい","dimension":"SOC"},
      {"id":2,"text":"焼き肉の一皿目は？","A":"タン塩で口を整える","B":"カルビで景気づけ","dimension":"RICH"},
      {"id":3,"text":"ステーキを食べるなら？","A":"赤身の旨み重視","B":"サーロインのコク重視","dimension":"RICH"},
      {"id":4,"text":"2回目のデート、どっちに行く？","A":"肉バルで落ち着いて会話","B":"焼き肉で距離を一気に縮める","dimension":"SOC"},
      {"id":5,"text":"3回目のデートで肉バル：注文は？","A":"コースで段取りよく","B":"アラカルトで直感的に選ぶ","dimension":"PACE"},
      {"id":6,"text":"最初の注文スタイル","A":"まず定番を人数分、様子見","B":"気になるものを少量ずつ早めに味見","dimension":"NOV"},
      {"id":7,"text":"火入れの好み","A":"低温/レアでしっとり","B":"強火で香ばしく","dimension":"TEXT"},
      {"id":8,"text":"味付けの第一選択","A":"塩・レモン・わさびなどシンプル","B":"甘辛ダレ・特製ソース","dimension":"RICH"},
      {"id":9,"text":"合わせ方の主役は？","A":"ワイン・お酒中心で単品を楽しむ","B":"白ごはん必須でがっつり","dimension":"VALUE"},
      {"id":10,"text":"注文ペース","A":"一皿ずつ小まめに様子を見て追加","B":"まとめてドンと頼んで回す","dimension":"PACE"},
      {"id":11,"text":"食感の好み","A":"とろける柔らかさ","B":"噛みごたえ・肉感","dimension":"TEXT"},
      {"id":12,"text":"お店選びの進め方","A":"早めにリサーチして予約","B":"当日のノリで行き先を決める","dimension":"PACE"},
      {"id":13,"text":"新メニューへの態度","A":"まずは“いつもの定番”から","B":"限定や創作も積極的に試す","dimension":"NOV"},
      {"id":14,"text":"予算の使い方","A":"量は控えめでも“質”に投資","B":"コスパ重視で満足量を確保","dimension":"VALUE"},
      {"id":15,"text":"人数の好み","A":"2〜3人でじっくり","B":"大人数でワイワイ","dimension":"SOC"},
      {"id":16,"text":"テーブルでの役割","A":"皆の好みを聞きながら調整（聞き役）","B":"テキパキ仕切って注文（号令役）","dimension":"PACE"},
      {"id":17,"text":"焼き台/環境の好み","A":"無煙＆清潔で快適に集中","B":"炭火の香りや煙もごちそう","dimension":"TEXT"},
      {"id":18,"text":"部位の選び方","A":"赤身中心で部位違いを味わう","B":"サシ入りを少量ずつ堪能","dimension":"RICH"},
      {"id":19,"text":"締めの一品","A":"冷麺やスープでさっぱり締める","B":"クッパやビビンバで満腹まで","dimension":"VALUE"},
      {"id":20,"text":"演出・体験に対する好み","A":"落ち着きと完成度を重視","B":"目の前で焼き上げ/フランベなど演出歓迎","dimension":"NOV"}
    ];

    // ===== 12 Types (weights) =====
    const TYPE_WEIGHTS = [
      { id:'HIRE',     name:'ヒレ',           desc:'最上級の赤身。雑味が少なくしっとり柔らか。',      w:{RICH:-2, NOV:-1, SOC:-2, PACE:-2, VALUE:-2, TEXT:-2} },
      { id:'CHATEAU',  name:'シャトーブリアン', desc:'ヒレ中心部。究極のやわらかさと上品さ。',          w:{RICH:-3, NOV:-1, SOC:-3, PACE:-2, VALUE:-3, TEXT:-2} },
      { id:'MISUJI',   name:'ミスジ',         desc:'細かなサシでとろける肩の希少部位。',               w:{RICH:-1, NOV:-1, SOC:-2, PACE:-1, VALUE:-2, TEXT:-2} },
      { id:'ICHIBO',   name:'イチボ',         desc:'赤身主体にほどよいサシ。香ばし派にも。',             w:{RICH:-1, NOV:0,  SOC:-1, PACE:-1, VALUE:-1, TEXT:1} },
      { id:'RUMP',     name:'ランプ',         desc:'赤身の旨みしっかり。軽やかで万能。',                 w:{RICH:-1, NOV:2,  SOC:-1, PACE:-1, VALUE:-1, TEXT:-1} },
      { id:'RIB',      name:'リブロース',     desc:'脂の甘みとジューシーさが魅力。',                     w:{RICH:2,  NOV:-1, SOC:1,  PACE:-1, VALUE:-1, TEXT:-1} },
      { id:'SIRLOIN',  name:'サーロイン',     desc:'王道のコクと香り。満足感高い。',                     w:{RICH:2,  NOV:0,  SOC:2,  PACE:1,  VALUE:0,  TEXT:-1} },
      { id:'ZABUTON',  name:'ザブトン',       desc:'肩ロース芯。濃厚な霜降りでリッチ。',                 w:{RICH:2,  NOV:-1, SOC:-2, PACE:-1, VALUE:-1, TEXT:-2} },
      { id:'KALBI',    name:'カルビ',         desc:'脂の旨さでがっつり満足。みんなで楽しい。',           w:{RICH:3,  NOV:0,  SOC:3,  PACE:2,  VALUE:1,  TEXT:0} },
      { id:'HARAMI',   name:'ハラミ',         desc:'赤身感とジューシーさの両立。',                       w:{RICH:1,  NOV:0,  SOC:2,  PACE:2,  VALUE:1,  TEXT:2} },
      { id:'KAINOMI',  name:'カイノミ',       desc:'赤身と脂のバランスに優れた隠れ人気。',               w:{RICH:1,  NOV:-1, SOC:1,  PACE:1,  VALUE:0,  TEXT:1} },
      { id:'TONGUE',   name:'タン',           desc:'コリコリ食感。レモン塩がよく合う。',                 w:{RICH:-2, NOV:1,  SOC:2,  PACE:2,  VALUE:0,  TEXT:2} }
    ];

    // ===== Wizard elements =====
    const wizard   = $('#wizard');
    const slides   = $('#slides');
    const startBtn = $('#startBtn');
    const closeBtn = $('#wizardClose');
    const wPrev    = $('#wPrev');
    const wNext    = $('#wNext');
    const wSubmit  = $('#wSubmit');
    const wReset   = $('#wReset');
    const wProgressText = $('#wProgressText');
    const wStepInfo     = $('#wStepInfo');
    const progText = $('#progressText');
    const progBar  = $('#progressBar');
    const stepInfo = $('#stepInfo');

    // ===== Build slides (5問×4 + 結果) =====
    function buildSlides(){
      slides.innerHTML = '';
      const form = document.createElement('form');
      form.id = 'quizW';
      slides.appendChild(form);

      for(let s=0;s<4;s++){
        const wrap = document.createElement('div');
        wrap.className = 'slide';
        const card = document.createElement('div');
        card.className = 'card step-card';
        card.innerHTML = `<h3 class="step-title">Step ${s+1}/4</h3><p class="step-desc">直感でA/Bを選んでください（この画面は5問）</p>`;
        const start = s*5, end = Math.min((s+1)*5, QUESTIONS.length);
        for(let i=start;i<end;i++){
          const q = QUESTIONS[i];
          const fs = document.createElement('fieldset');
          fs.className = 'q';
          fs.innerHTML = `
            <legend><strong>Q${i+1}.</strong> ${q.text}</legend>
            <div class="choices">
              <label class="choice"><input type="radio" name="q${q.id}" value="A" required> ${q.A}</label>
              <label class="choice"><input type="radio" name="q${q.id}" value="B"> ${q.B}</label>
            </div>`;
          card.appendChild(fs);
        }
        wrap.appendChild(card);
        form.appendChild(wrap);
      }
      const res = document.createElement('div');
      res.className = 'slide';
      res.innerHTML = `<div class="card step-card" id="result"><h3 class="step-title">診断結果</h3></div>`;
      slides.appendChild(res);

      // ラジオ変更で進捗更新
      slides.addEventListener('change', (e)=>{ if(e.target.matches('input[type="radio"]')) updateUI(); });
    }

    // ===== Stepper =====
    const STEP_SIZE=5; let step=0; // 0..3（4は結果画面）
    function dataCount(){
      const form = $('#quizW'); if(!form) return 0;
      let count = 0; QUESTIONS.forEach(q=>{ if(form.querySelector(`input[name="q${q.id}"]:checked`)) count++; });
      return count;
    }
    function stepFilled(s){
      const form = $('#quizW'); if(!form) return false;
      const start = s*STEP_SIZE, end = Math.min((s+1)*STEP_SIZE, QUESTIONS.length);
      for(let i=start;i<end;i++){
        if(!form.querySelector(`input[name="q${QUESTIONS[i].id}"]:checked`)) return false;
      }
      return true;
    }
    function updateUI(){
      const answered = dataCount();
      wProgressText.textContent = `${answered}/20 回答済み`;
      wStepInfo.textContent = step<=3 ? `Step ${step+1}/4` : '結果';
      if(progText) progText.textContent = `${answered}/20 回答済み`;
      if(progBar)  progBar.style.width = `${Math.round(answered/20*100)}%`;
      if(stepInfo) stepInfo.textContent = step<=3 ? `Step ${step+1}/4` : '結果';
      wPrev.disabled = step===0;
      wNext.disabled = (step>=3) || !stepFilled(step);
      wSubmit.disabled = (answered!==20);
      slides.style.transform = `translateX(-${step*100}%)`;
    }

    // ===== Scoring =====
    function collectScores(){
      const scores={}; const form=$('#quizW'); if(!form) return scores;
      QUESTIONS.forEach(q=>{
        const sel = form.querySelector(`input[name="q${q.id}"]:checked`);
        if(!sel) return; const v=sel.value; const d=q.dimension;
        if(!scores[d]) scores[d]={A:0,B:0}; scores[d][v]++;
      });
      return scores;
    }
    function scoreVector(scores){
      const dims=['RICH','NOV','SOC','PACE','VALUE','TEXT'];
      const vec={}; dims.forEach(d=>{ const s=scores[d]||{A:0,B:0}; vec[d]=(s.B-s.A); });
      return vec;
    }
    function rankTypes(scores){
      const v=scoreVector(scores);
      return TYPE_WEIGHTS.map(t=>{
        let s=0; for(const k in t.w){ s += (t.w[k]||0)*(v[k]||0); }
        return {...t, score:s};
      }).sort((a,b)=>b.score-a.score);
    }
    function calcConfidence(scores){
      const dims=['SOC','RICH','PACE','NOV','TEXT','VALUE'];
      let sum=0,n=0; dims.forEach(d=>{ const s=scores[d]; if(!s) return; const tot=s.A+s.B; if(!tot) return; sum+=Math.abs(s.A-s.B)/tot; n++; });
      const m=n?sum/n:.5; return Math.round(60+m*35);
    }
    function dimBars(scores){
      const INFO={SOC:{A:'少人数・会話',B:'大人数・にぎやか'},RICH:{A:'さっぱり赤身',B:'リッチ・サシ'},PACE:{A:'段取り・慎重',B:'テンポ・直感'},NOV:{A:'定番重視',B:'新しいもの好き'},TEXT:{A:'しっとり/レア',B:'香ばし/噛み応え'},VALUE:{A:'質重視',B:'量・コスパ'}};
      return Object.keys(INFO).map(k=>{
        const s=scores[k]||{A:0,B:0}; const tot=s.A+s.B; const pct=tot?Math.round(s.B*100/tot):50;
        const lean=s.A===s.B?'バランス':(s.A>s.B?INFO[k].A:INFO[k].B);
        return `<div class="dim-item"><div style="min-width:150px"><strong>${k}</strong>：${lean} <span class="pill" style="opacity:.8">${s.A}A/${s.B}B</span></div><div class="track"><div class="fill" style="width:${pct}%"></div></div></div>`;
      }).join('');
    }
    function typeGrid(selectedId){
      return `<div class="type-grid">${TYPE_WEIGHTS.map(t=>`<div class="type-card ${t.id===selectedId?'active':''}"><div class="lead" style="font-size:12px">${t.id}</div><div style="font-weight:900">${t.name}</div></div>`).join('')}</div>`;
    }
    function showResult(){
      const scores = collectScores();
      const ranked = rankTypes(scores);
      const primary = ranked[0], alt = ranked.slice(1,3);
      const confidence = calcConfidence(scores);
      const bars = dimBars(scores);
      const soc=scores.SOC||{A:0,B:0}, pace=scores.PACE||{A:0,B:0}, nov=scores.NOV||{A:0,B:0}, val=scores.VALUE||{A:0,B:0};
      const seat=(soc.B>soc.A)?'大テーブルでワイワイ':(soc.A>soc.B?'2〜3人で会話重視':'どちらもOK');
      const order=(pace.B>pace.A)?'アラカルト中心':(pace.A>pace.B?'コース中心':'両方OK');
      const creative=(nov.B>nov.A)?'限定・創作も積極的に':'定番中心で';
      const value=(val.B>val.A)?'ボリューム満足派':'質重視派';
      const neighbors = alt.map(n=>`<span class="pill">${n.name}</span>`).join(' ');

      const res = $('#result');
      res.innerHTML = `
        <div class="pill" style="margin-bottom:6px">信頼度 ${confidence}%</div>
        <div style="font-size:28px;font-weight:900;line-height:1.2">${primary.name} <span class="pill">${primary.id}</span></div>
        <div class="lead" style="margin:4px 0 8px">${primary.desc}</div>
        <div>近い候補：${neighbors || '-'}</div>
        <div style="margin-top:10px">${typeGrid(primary.id)}</div>
        <div class="spacer" style="height:12px"></div>
        <div class="card">
          <h4 style="margin:0 0 6px">あなたの傾向</h4>
          <div class="grid" style="gap:8px">${bars}</div>
          <div style="margin-top:12px">
            <h4 style="margin:0 0 6px">食べ方・席の提案</h4>
            <ul style="margin:0;padding-left:18px">
              <li><strong>席・流れ：</strong>${seat}／${order}</li>
              <li><strong>攻め方：</strong>${creative}</li>
              <li><strong>価値観：</strong>${value}</li>
            </ul>
          </div>
        </div>`;
      step = 4;
      slides.style.transform = `translateX(-400%)`;
      updateUI();
    }

    // ===== Open Wizard (確実に動くよう二重でハンドラ) =====
    function openWizard(){
      if(!slides.children.length) buildSlides();
      document.body.classList.add('no-scroll');
      wizard.classList.add('show');
      step = 0;
      updateUI();
    }
    if(startBtn) startBtn.addEventListener('click', (e)=>{ e.preventDefault(); openWizard(); });
    document.addEventListener('click', (e)=>{ if(e.target && (e.target.id==='startBtn' || e.target.closest('#startBtn'))) { e.preventDefault(); openWizard(); } });

    // Nav buttons
    if(closeBtn) closeBtn.addEventListener('click', ()=>{ wizard.classList.remove('show'); document.body.classList.remove('no-scroll'); });
    if(wPrev)    wPrev.addEventListener('click', ()=>{ if(step>0){ step--; updateUI(); } });
    if(wNext)    wNext.addEventListener('click', ()=>{ if(step<3 && stepFilled(step)){ step++; updateUI(); } });
    if(wSubmit)  wSubmit.addEventListener('click', ()=>{ if(dataCount()===20){ showResult(); } });

    // Reset
    if(wReset)   wReset.addEventListener('click', ()=>{
      const form = $('#quizW'); if(form) form.reset();
      step = 0; updateUI();
    });

    // Hash open
    if(location.hash==='#quiz'){ openWizard(); }
  })();
  </script>
</body>
</html>
