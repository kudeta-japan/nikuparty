<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEAT-BTI subï½œç›¸æ€§é‡è¦–ãƒ†ã‚¹ãƒˆç‰ˆ</title>
<meta name="description" content="20å•ãƒ»6æ®µéšã€‚MBTI/LOVE TYPEã®è‰¯ã•ã‚’å–ã‚Šå…¥ã‚ŒãŸâ€œéƒ¨ä½ã‚¿ã‚¤ãƒ—Ã—ç›¸æ€§â€è¨ºæ–­ã€‚é †ç•ªå›ºå®šã€6æ®µéšï¼ˆä¸­ç«‹ãªã—ï¼‰ã€‚">
<style>
  :root{
    --bg:#0b0f14; --panel:#0f141c; --ink:#f5f8ff; --muted:#b8c4d8; --bd:#1a2332;
    --acc:#ff705b; --acc2:#ffd166; --blue:#57a7ff; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
  .app{width:min(980px,94vw);margin:0 auto;padding:20px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--bd)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111;font-weight:900}
  .title{font-weight:900}
  .btn{appearance:none;border:1px solid var(--bd);background:#141a23;color:var(--ink);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4f37);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}
  footer{padding:10px 16px 18px;color:var(--muted);font-size:12px}

  /* ===== Top visual (mbti.jpg) ===== */
  .visual{border-bottom:1px solid var(--bd);background:#000}
  .visual img{display:block;width:100%;height:auto}

  /* Intro */
  .intro{padding:16px}
  .h1{font-size:clamp(22px,5.6vw,36px);line-height:1.2;margin:0 0 6px;font-weight:900}
  .muted{color:var(--muted)}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{background:#121827;border:1px solid #273248;border-radius:999px;padding:6px 10px;font-size:12px}

  /* Quiz */
  .section{padding:16px}
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:240px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#101622;border:1px solid #2a3346;border-radius:14px;padding:14px}
  .ctx{color:#e7ecf8;font-weight:700;font-size:clamp(14px,2.8vw,16px);margin:-2px 0 6px}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .side{background:#0f1522;border:1px solid #273045;border-radius:12px;padding:10px;min-height:60px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2778c9);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* Result */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:780px){.grid{grid-template-columns:1.1fr .9fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(24px,6vw,32px);font-weight:900}
  .tagline{color:var(--muted);margin-top:6px}
  .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--bd);margin-right:6px}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .tips{margin:8px 0 0;padding-left:18px}
  .tips li{margin:6px 0}
</style>
</head>
<body>
<main class="app">
  <div class="card">
    <header>
      <div class="brand"><div class="logo">ğŸ¥©</div><div class="title">MEAT-BTIï¼ˆç›¸æ€§é‡è¦–ãƒ†ã‚¹ãƒˆç‰ˆï¼‰</div></div>
      <button id="btn-start" class="btn primary" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
    </header>

    <!-- Top visual (å¸¸ã«ä¸Šéƒ¨ã«è¡¨ç¤ºãƒ»æ–‡å­—ã¯é‡ã­ãªã„) -->
    <div class="visual" aria-hidden="false">
      <img src="mbti.jpg" alt="MEAT-BTI">
    </div>

    <!-- INTRO -->
    <section class="intro" id="screen-start">
      <h1 class="h1">20å•ãƒ»6æ®µéšã§ â€œéƒ¨ä½ã‚¿ã‚¤ãƒ— Ã— ç›¸æ€§â€ ã‚’åˆ¤å®š</h1>
      <p class="muted">é †ç•ªå›ºå®šï¼ä¸­ç«‹ãªã—ï¼ˆ1ã€œ6ã‚­ãƒ¼ã§ã‚‚é¸æŠå¯ï¼‰ï¼<b>ç›¸æ€§6å‰²ãƒ»ãŠã™ã™ã‚éƒ¨ä½4å‰²</b>ã€‚</p>
      <div class="chips">
        <span class="chip">éƒ¨ä½12ã‚¿ã‚¤ãƒ—ï¼ˆã‚·ãƒ³ã‚·ãƒ³â†’ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ï¼‰</span>
        <span class="chip">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼†ä¸€è¨€ã‚­ãƒ£ãƒƒãƒ</span>
        <span class="chip">ç›¸æ€§No.1 ã¨å½“æ—¥Tips</span>
      </div>
      <div style="margin-top:12px">
        <button id="btn-start-2" class="btn primary" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="screen-quiz" class="section" hidden>
      <div class="q-head">
        <div class="q-index"><span id="page-now">1</span>/4ãƒšãƒ¼ã‚¸ï¼ˆ<span id="q-answered">0</span>/20ï¼‰</div>
        <div class="bar"><div id="bar"></div></div>
      </div>
      <div id="qgrid" class="qgrid"></div>
      <div class="q-foot">
        <div>å·¦ï¼ˆé’ï¼‰â‡”å³ï¼ˆèµ¤ï¼‰ã»ã©å¼·ã„ï¼š1=å·¦å¼·ã€œ6=å³å¼·</div>
        <button id="btn-next" class="btn primary disabled">æ¬¡ã®5å•ã¸</button>
      </div>
      <div class="progress-note">â€»ã‚¯ãƒªãƒƒã‚¯ or ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰1â€“6ã§é †æ¬¡å…¥åŠ›</div>
    </section>

    <!-- RESULT -->
    <section id="screen-result" class="section" hidden>
      <div class="result">
        <div class="grid">
          <div class="r-card">
            <div class="big">ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</div>
            <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
            <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
            <div class="tagline" id="r-nickname">â€œâ€”â€</div>
            <div style="margin-top:10px">
              <span class="pill" id="tag-tx">â€”</span>
              <span class="pill" id="tag-fl">â€”</span>
              <span class="pill" id="tag-af">â€”</span>
            </div>
            <p class="tagline" id="r-catch"></p>
            <ul class="tips" id="r-tips"></ul>
          </div>

          <div class="r-card">
            <div class="big">ç›¸æ€§No.1</div>
            <div id="r-compat1" class="mono" style="margin-top:8px;font-size:16px"></div>
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn" id="btn-copy">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
              <a class="btn primary" href="#" id="btn-export" download>JSONã§ä¿å­˜</a>
            </div>
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;gap:10px;margin-top:8px">
          <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
        </div>
      </div>
    </section>

    <footer>Â© ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” MEAT-BTI sub</footer>
  </div>
</main>

<script>
/* ===========================================================
   1) è³ªå•ï¼ˆé †ç•ªå›ºå®šãƒ»ã‚·ãƒ¼ãƒ³åˆ¥ã§åˆ†ã‹ã‚Šã‚„ã™ãï¼‰
   è»¸: RL(èµ¤èº«Leanâ†”ãƒªãƒƒãƒRich) / FS(ãƒ†ãƒ³ãƒFastâ†”ã˜ã£ãã‚ŠSlow) / KC(å®šç•ªKeepâ†”å¤‰åŒ–Change)
   è£œåŠ©: TX(å™›ã‚€chewâ†”ã¨ã‚ã‘melt) / FL(å¡©saltFâ†”ã‚½ãƒ¼ã‚¹sauceF) / AF(è»½ã„lightâ†”æº€è…¹hearty)
   facets ã¯ Aå´:+1, Bå´:-1ï¼ˆåŠ ç‚¹ã¯å›ç­”å¼·åº¦Ã—dirã€å†…éƒ¨ã¯Â±ã§ä¿æŒï¼‰
   â€» åœ°åŸŸåã¯ä½¿ã‚ãªã„ï¼ˆæ±ç”¨åŒ–ï¼‰
=========================================================== */
const BANK = [
  // ---- ã‚¹ã‚¿ãƒ¼ãƒˆå®šç•ª ----
  {id:1, axis:"RL", text:"æœ€åˆã®ä¸€çš¿ã€ã©ã¡ã‚‰ã«æƒ¹ã‹ã‚Œã‚‹ï¼Ÿ",
    A:"å¡©ã‚¿ãƒ³ã§ã‚­ãƒ¬è‰¯ãã‚¹ã‚¿ãƒ¼ãƒˆ", B:"ã‚µã‚·å…¥ã‚Šã‚«ãƒ«ãƒ“ã‚’ã‚¿ãƒ¬ã§ãŒã£ã¤ã‚Š",
    facets:{ fatTol:+1, afterPref:+1, saltF:+1, sauceF:-1, hearty:-1, light:+1 }},

  {id:2, axis:"RL", text:"åŒä¾¡æ ¼ã®â€œèµ¤èº«ã‚¹ãƒ†ãƒ¼ã‚­â€ã¨â€œã‚µã‚·å…¥ã‚Šã‚¹ãƒ†ãƒ¼ã‚­â€ã€ä»Šå¤œãªã‚‰ï¼Ÿ",
    A:"èµ¤èº«ï¼ˆæ­¯åˆ‡ã‚Œã‚ˆãè»½ã‚„ã‹ï¼‰", B:"ã‚µã‚·å…¥ã‚Šï¼ˆã‚³ã‚¯å„ªå…ˆã§æº€è¶³ï¼‰",
    facets:{ fatTol:+1, roastAroma:+1, chew:+1, melt:-1, light:+1, hearty:-1 }},

  // ---- ãƒ‡ãƒ¼ãƒˆ/ä¼šè©±ã‚·ãƒ¼ãƒ³ ----
  {id:3, axis:"KC", text:"åˆå¯¾é¢ã®ç›¸æ‰‹ã¨ã€‚æ³¨æ–‡ã®å…¥ã‚Šå£ã¯ï¼Ÿ",
    A:"ã¾ãšã¯â€œåç‰©â€ã§å…±é€šä½“é¨“ã‚’ä½œã‚‹", B:"â€œé™å®š/æ–°ä½œâ€ã§ä¼šè©±ã®ãƒã‚¿ã‚’ä½œã‚‹",
    facets:{ classic:+1, limited:-1, rule:+1, photo:-1, instinct:-1 }},

  {id:4, axis:"FS", text:"ä¼šè©±ã®ãƒ†ãƒ³ãƒã«åˆã‚ã›ã¦é£Ÿäº‹ã¯ï¼Ÿ",
    A:"å°‘é‡ãšã¤æ—©ã‚ã«å›ã™ï¼ˆå°ã¾ã‚è¿½åŠ ï¼‰", B:"ä¸€çš¿ã‚’ã‚†ã£ãã‚Šå‘³ã‚ã„ä¼šè©±ä¸­å¿ƒ",
    facets:{ pace:+1, course:-1, roam:+1, stay:-1 }},

  // ---- é‡ã¨æº€è¶³ãƒ©ã‚¤ãƒ³ ----
  {id:5, axis:"AF", text:"â€œä»Šæ—¥ã¯ã©ã“ã¾ã§é£Ÿã¹ãŸã„ï¼Ÿâ€",
    A:"è»½ã‚ã§OKï¼ˆä½™ç™½ã‚’æ®‹ã™ï¼‰", B:"æº€è…¹ã¾ã§ã—ã£ã‹ã‚Šï¼ˆç· ã‚ã¾ã§ï¼‰",
    facets:{ light:+1, hearty:-1 }},

  // ---- é£Ÿæ„Ÿã‚’å…·ä½“åŒ– ----
  {id:6, axis:"TX", text:"ã‚¹ãƒ†ãƒ¼ã‚­ãªã‚‰ã€ã©ã¡ã‚‰ã®å£å½“ãŸã‚ŠãŒå¥½ãï¼Ÿ",
    A:"å™›ã‚€ã»ã©æ—¨ã¿ï¼ˆæ­¯åˆ‡ã‚Œã®è‰¯ã•ï¼‰", B:"èˆŒã§ã»ã©ã‘ã‚‹ï¼ˆã¨ã‚ã‘æ„Ÿï¼‰",
    facets:{ chew:+1, melt:-1 }},

  // ---- ç„¼ãåŠ æ¸›ã‚’æ˜ç¤ºï¼ˆã‚¹ãƒ†ãƒ¼ã‚­ï¼‰----
  {id:7, axis:"FS", text:"â€œã‚¹ãƒ†ãƒ¼ã‚­â€ã®ç„¼ãåŠ æ¸›ã¯ï¼Ÿ",
    A:"ãƒ¬ã‚¢å¯„ã‚Šï¼ˆè»½ã‚ã®ç«å…¥ã‚Œï¼‰", B:"ãƒŸãƒ‡ã‚£ã‚¢ãƒ ä»¥ä¸Šï¼ˆã—ã£ã‹ã‚Šç«å…¥ã‚Œï¼‰",
    facets:{ pace:+1, plan:+1, course:-1 }},

  // ---- å‘³ä»˜ã‘ï¼ˆå¡©orã‚¿ãƒ¬ï¼‰----
  {id:8, axis:"FL", text:"å‘³ä»˜ã‘ã®ç¬¬ä¸€é¸æŠã¯ï¼Ÿ",
    A:"å¡©ãƒ»ãƒ¬ãƒ¢ãƒ³ãƒ»ã‚ã•ã³ãªã©ã‚·ãƒ³ãƒ—ãƒ«", B:"ç”˜è¾›ãƒ€ãƒ¬/ç‰¹è£½ã‚½ãƒ¼ã‚¹ã§",
    facets:{ saltF:+1, sauceF:-1 }},

  // ---- æ¼”å‡ºã¯å…·ä½“æ–™ç†ã§ ----
  {id:9, axis:"KC", text:"æ¼”å‡ºã‚ã‚Šã®ä¸€çš¿ã€ã©ã¡ã‚‰ãŒå¬‰ã—ã„ï¼Ÿ",
    A:"ç‚­ã®é¦™ã‚Šã‚„ãƒ¬ã‚¢ã®é¦™ã‚Šã‚’ç”Ÿã‹ã™ï¼ˆç´ ææ¨ã—ï¼‰", B:"ãƒ•ãƒ©ãƒ³ãƒ™ã‚„ã‚¬ãƒ¼ãƒªãƒƒã‚¯é¦™ã§ç››ã‚Šä¸Šã’",
    facets:{ classic:+1, limited:-1, roastAroma:+1, photo:-1, instinct:-1 }},

  // ---- äºŒå›ç›®ãƒ‡ãƒ¼ãƒˆ ----
  {id:10, axis:"FS", text:"2å›ç›®ãªã‚‰ã©ã£ã¡ï¼Ÿ",
    A:"ã‚¢ãƒ©ã‚«ãƒ«ãƒˆã§ãƒ†ãƒ³ãƒã‚ˆãå®Ÿé¨“çš„ã«", B:"ã‚³ãƒ¼ã‚¹ã§æµã‚Œã‚’æ¥½ã—ã‚€",
    facets:{ pace:+1, course:-1, roam:+1, stay:-1 }},

  // ---- å½¹å‰² ----
  {id:11, axis:"KC", text:"ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã®å½¹å‰²ã¯ï¼Ÿ",
    A:"çš†ã®å¥½ã¿ã‚’èãã¤ã¤â€œå®šç•ªä¸­å¿ƒâ€ã§èª¿æ•´", B:"â€œæ°—ã«ãªã£ãŸç‰©â€ã‚’å°‘é‡ãšã¤å›ã™å·ä»¤å½¹",
    facets:{ classic:+1, limited:-1, rule:+1, instinct:-1 }},

  // ---- SNSæ˜ ãˆã¨æœ¬è³ª ----
  {id:12, axis:"KC", text:"â€œæ˜ ãˆã‚‹ä¸€çš¿â€ã¨â€œæ¸‹ã„åç‰©â€ã€ä»Šæ—¥ã¯ï¼Ÿ",
    A:"å‘³å„ªå…ˆã®åç‰©ï¼ˆæ¸‹ãã¦å¼·ã„ï¼‰", B:"æ˜ ãˆã‚‚æ¥½ã—ã‚ã‚‹é™å®šç³»",
    facets:{ classic:+1, limited:-1, photo:-1 }},

  // ---- ç§»å‹•/ç²˜åº¦ï¼ˆæ±ç”¨åŒ–ï¼‰----
  {id:13, axis:"FS", text:"é€±æœ«ã®ç¹è¯è¡—ã€‚æ°—ã«å…¥ã£ãŸã‚‰ï¼Ÿ",
    A:"å›éŠã—ã¤ã¤2è»’ç›®ã‚‚æ¤œè¨", B:"è…°ã‚’æ®ãˆã¦ã‚†ã£ãã‚Š",
    facets:{ roam:+1, stay:-1, pace:+1 }},

  // ---- ã”é£¯å•é¡Œ ----
  {id:14, axis:"AF", text:"ç™½ã”ã¯ã‚“ã¯ï¼Ÿ",
    A:"ãªãã¦ã‚‚OKï¼ˆãŠé…’ä¸­å¿ƒï¼‰", B:"å¿…é ˆï¼ˆãŒã£ã¤ã‚Šï¼‰",
    facets:{ light:+1, hearty:-1, fatTol:+1 }},

  // ---- ç· ã‚ ----
  {id:15, axis:"AF", text:"ç· ã‚ã®ä¸€å“ã¯ï¼Ÿ",
    A:"å†·éºº/ã‚¹ãƒ¼ãƒ—ã§ã•ã£ã±ã‚Š", B:"ã‚¯ãƒƒãƒ‘/ãƒ“ãƒ“ãƒ³ãƒã§æº€è…¹ã¾ã§",
    facets:{ light:+1, hearty:-1 }},

  // ---- æ”»ã‚/å®ˆã‚Š ----
  {id:16, axis:"KC", text:"ã¯ã˜ã‚ã¾ã—ã¦ã®å ´ã€æ”»ã‚ã‚‹ï¼Ÿå®ˆã‚‹ï¼Ÿ",
    A:"ã¾ãšã¯â€œç‹é“â€ã§å®‰å¿ƒæ„Ÿã‚’ä½œã‚‹", B:"â€œé™å®š/æ–°ä½œâ€ã‚’ãã£ã‹ã‘ã«è©±é¡Œã¥ãã‚Š",
    facets:{ classic:+1, limited:-1, rule:+1, photo:-1 }},

  // ---- ã‚¿ãƒ³ vs ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ ----
  {id:17, axis:"RL", text:"ä¸€çš¿ã ã‘é¸ã¶ãªã‚‰ï¼Ÿ",
    A:"â€œã‚¿ãƒ³å¡©â€ã§ã‚­ãƒ¬è‰¯ã", B:"â€œã‚µãƒ¼ãƒ­ã‚¤ãƒ³â€ã§ã‚³ã‚¯ã‚’å ªèƒ½",
    facets:{ fatTol:+1, saltF:+1, sauceF:-1 }},

  // ---- é‡ã®ã•ã˜åŠ æ¸› ----
  {id:18, axis:"RL", text:"é‡ã‚’é£Ÿã¹ã‚‹ãªã‚‰ã€ã©ã¡ã‚‰ãŒå¹¸ã›ï¼Ÿ",
    A:"èµ¤èº«ä¸­å¿ƒã§è»½ã‚„ã‹ã«ç¶šã‘ãŸã„", B:"ã‚µã‚·ã®æ—¨ã¿ã‚’å°‘é‡ãšã¤",
    facets:{ fatTol:+1, light:+1, hearty:-1 }},

  // ---- 3å›ç›®ã®æ®µå–ã‚Š ----
  {id:19, axis:"FS", text:"3å›ç›®ã¯ï¼Ÿ",
    A:"æ§˜å­ã‚’è¦‹ã¦å°ã¾ã‚ã«è¿½åŠ ï¼ˆãƒ†ãƒ³ãƒï¼‰", B:"äº‹å‰ã«äºˆç´„ã—ã¦æ®µå–ã‚Šè‰¯ãï¼ˆã˜ã£ãã‚Šï¼‰",
    facets:{ pace:+1, plan:+1, course:-1 }},

  // ---- æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸ã®æ…‹åº¦ ----
  {id:20, axis:"KC", text:"æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒæ¥ãŸã‚‰ï¼Ÿ",
    A:"ã¾ãšã¯â€œã„ã¤ã‚‚ã®å®šç•ªâ€ã§æ¯”è¼ƒã™ã‚‹", B:"å‰µä½œ/é™å®šã‚‚ç©æ¥µçš„ã«è©¦ã™",
    facets:{ classic:+1, limited:-1, instinct:-1 }}
];

/* ===========================================================
   2) ã‚¿ã‚¤ãƒ— & ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  & Tips
=========================================================== */
const TYPE_PICKER = {
  pick(code, C){ // C: {chew,melt,saltF,sauceF,light,hearty}
    const s=(x)=>x||0;
    switch(code){
      case 'R-F-K': return (s(C.chew)-s(C.melt) >= 0 ? 'ãƒ’ãƒ¬' : 'ãƒŸã‚¹ã‚¸');
      case 'R-F-C': return (s(C.sauceF)-s(C.saltF) > 0 ? 'ãƒãƒ©ãƒŸ' : 'ã‚¿ãƒ³');
      case 'R-S-K': return (s(C.melt)-s(C.chew) > 0 ? 'ãƒŸã‚¹ã‚¸' : 'ã‚¤ãƒãƒœ');
      case 'R-S-C': return 'ãƒ©ãƒ³ãƒ—';
      case 'L-F-K': return (s(C.melt)+s(C.saltF)+s(C.light) > s(C.chew)+s(C.sauceF) ? 'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³' : 'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹');
      case 'L-F-C': return 'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³';
      case 'L-S-K': return 'ã‚¶ãƒ–ãƒˆãƒ³';
      case 'L-S-C': return (s(C.chew)+s(C.saltF) > s(C.melt)+s(C.sauceF) ? 'ã‚«ã‚¤ãƒãƒŸ' : 'ã‚«ãƒ«ãƒ“');
      default: return 'ãƒ’ãƒ¬';
    }
  }
};

const TYPE_META = {
  "ãƒ’ãƒ¬":{ nick:"é™ã‹ãªä¸»å½¹", catch:"ç„¡é§„ãªãä¸Šå“ã€èŠ¯ãŒå¼·ã„èµ¤èº«æ´¾ã€‚",
    tips:["æœ€åˆã¯â€œåç‰©ã®å¡©â€ææ¡ˆã§ä¼šè©±ã‚’æ•´ãˆã‚‹","ç›¸æ‰‹ã®å¥½ã¿ã‚’1ã¤æ‹¾ã£ã¦æ¬¡ã®ä¸€çš¿ã«åæ˜ ","ä¹¾æ¯ã¯ãƒã‚¤ãƒœãƒ¼ãƒ«/ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°ã§è»½ã‚„ã‹ã«"]},
  "ã‚¿ãƒ³":{ nick:"ç©ºæ°—ã»ãã—ã®å·ä»¤å½¹", catch:"ã‚­ãƒ¬é‡è¦–ã€‚ãƒ†ãƒ³ãƒã‚ˆãæ˜ã‚‹ãå›ã™ã€‚",
    tips:["â€œã‚¿ãƒ³å¡©â†’èµ¤èº«â€ã®é»„é‡‘ãƒ«ãƒ¼ãƒˆã‚’ææ¡ˆ","å°çš¿ã‚·ã‚§ã‚¢ã§ä¼šè©±ã‚’å›ã™","å†™çœŸã‚ˆã‚Šä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆã§ç››ã‚Šä¸Šã’ã‚‹"]},
  "ã‚¤ãƒãƒœ":{ nick:"é€šå¥½ã¿ã®èª¿å’Œæ´¾", catch:"æ§ãˆã‚ã§ã‚‚èŠ¯ã‚ã‚Šã€‚ä½™éŸ»ã‚’é‡ã‚“ã˜ã‚‹ã€‚",
    tips:["ä¼¼ãŸå¥½ã¿ã§â€œæ¯”è¼ƒé£Ÿã¹â€ã‚’ææ¡ˆ","ç›¸æ‰‹ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ã¦ç«å…¥ã‚Œã‚’èª¿æ•´","ç· ã‚ã¯è»½ã‚ã§æ¬¡ã®ç´„æŸã®ä½™ç™½ã‚’æ®‹ã™"]},
  "ãƒ©ãƒ³ãƒ—":{ nick:"å®Ÿé¨“å¥½ãã®ç ”ç©¶è€…", catch:"å®šç•ªã‚’æ›´æ–°ã™ã‚‹å·¥å¤«ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã€‚",
    tips:["â€œå°‘é‡Ã—å¤šçš¿â€ã§ãƒŸãƒ‹å®Ÿé¨“","å‰µä½œç³»ã‚’ä¸€çš¿æ··ãœã¦ä¼šè©±ãƒã‚¿ã«","ç„¼ãæ‹…å½“ã‚’å¼•ãå—ã‘ã¦è¦³å¯Ÿï¼†è©±é¡Œ"]},
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":{ nick:"å®‰å¿ƒæ„Ÿã®ãƒªãƒ¼ãƒ€ãƒ¼", catch:"ç‹é“ãƒªãƒƒãƒã§æº€è¶³åº¦é‡è¦–ã€‚",
    tips:["â€œåç‰©â†’åç‰©â€ã§æ®µå–ã‚Šè‰¯ã","ä¼šè¨ˆ/å¸­æ›¿ãˆãªã©æ®µå–ã‚Šã‚’æ‹…ã†","å†™çœŸã¯å°‘ãªã‚ã€ä½“é¨“ã‚’æ¿ƒã"]},
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":{ nick:"è¯ã‚„ãã®æ¼”å‡ºå®¶", catch:"æ¿ƒåšã¨æ˜ ãˆã§å ´ã‚’ç››ã‚Šä¸Šã’ã‚‹ã€‚",
    tips:["ãƒ•ãƒ©ãƒ³ãƒ™ã‚„ã‚¬ãƒªãƒã‚¿ç³»ã§æ‹æ‰‹ã‚’èµ·ã“ã™","ä¹¾æ¯ã®éŸ³é ­ã§æ˜ã‚‹ãé–‹å§‹","éš£å¸­ã¨ã‚‚è»½ãä¹¾æ¯ã—ã¦è¼ªã‚’åºƒã’ã‚‹"]},
  "ã‚¶ãƒ–ãƒˆãƒ³":{ nick:"ã—ã£ã¨ã‚Šæ¿ƒåšæ´¾", catch:"ä¸å¯§ãªè¨€è‘‰é¸ã³ã€‚å°‘äººæ•°ã§ã˜ã£ãã‚Šã€‚",
    tips:["â€œå°‘é‡é«˜æº€è¶³â€ã®ææ¡ˆã§å…±æ„Ÿã‚’å–ã‚‹","ä¼‘ã¾ã›æ™‚é–“ã‚’å¤§åˆ‡ã«","ä¼šè©±ã¯æ·±ã‚ã®è³ªå•ã‚’1ã¤ã ã‘"]},
  "ã‚«ãƒ«ãƒ“":{ nick:"ã”è¤’ç¾ã‚¨ãƒ³ã‚¿ãƒ¡", catch:"ç”˜è¾›ã¨æ¿ƒåšã§å·»ãè¾¼ã‚€ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚",
    tips:["åºç›¤ã§â€œã¿ã‚“ãªã®ä¸€å£ã‚«ãƒ«ãƒ“â€ã‚’æ‰‹é…","å†™çœŸ/å‹•ç”»ã¯è‡ªåˆ†ãŒæ’®ã£ã¦ã‚·ã‚§ã‚¢","æº€è¶³æ´¾ã®å¸Œæœ›ã‚’æ‹¾ã£ã¦ãƒªãƒ¼ãƒ‰"]},
  "ãƒãƒ©ãƒŸ":{ nick:"å®Ÿåˆ©æ´¾ã‚¹ãƒ—ãƒªãƒ³ã‚¿ãƒ¼", catch:"èºå‹•æ„Ÿã‚ã‚‹èµ¤èº«ã€ãƒ†ãƒ³ãƒã§å‹è² ã€‚",
    tips:["å›è»¢ã‚’ä¸Šã’ã¦â€œä¼šè©±ã®é–“â€ã‚’ä½œã‚‰ãªã„","ç„¼ãå°ã®ç®¡ç†å½¹ã§æ´»èº","é£²ã¿éãæ³¨æ„ã§ç¬‘é¡”ã‚­ãƒ¼ãƒ—"]},
  "ã‚«ã‚¤ãƒãƒŸ":{ nick:"è»½ã‚„ã‹æ´¾ã®æ©‹æ¸¡ã—", catch:"ã‚«ãƒ«ãƒ“ç³»ã§ã‚‚ã‚­ãƒ¬è‰¯ãã€‚å¡©ã‚‚æ˜ ãˆã‚‹ã€‚",
    tips:["â€œå¡©â†’ã‚¿ãƒ¬â€ã®é †åºã§ãƒ¡ãƒªãƒãƒª","è»½ã„ç· ã‚ã§ä½™ç™½ã‚’æ®‹ã™","ç›¸æ‰‹ã®å¾—æ„ãƒˆãƒ¼ã‚¯ã‚’æŒ¯ã‚‹"]},
  "ãƒŸã‚¹ã‚¸":{ nick:"ç¹Šç´°ã•ã®è·äºº", catch:"å£ã©ã‘ä¸Šå“ã€‚ä¸å¯§ãªæ‰€ä½œãŒé­…åŠ›ã€‚",
    tips:["ç«å…¥ã‚Œã¯æ§ãˆã‚ã€æ¸©åº¦ã¨é¦™ã‚Šã‚’å…±æœ‰","å°å£°ã®ãƒ„ãƒƒã‚³ãƒŸã§è·é›¢ã‚’ç¸®ã‚ã‚‹","ç”˜ã‚ã¯é‡ã‚’çµã£ã¦ææ¡ˆ"]},
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":{ nick:"ç‰¹é¸ã®ä¸€ç‚¹é›†ä¸­", catch:"è³ªã«å¼·ã„ã“ã ã‚ã‚Šã€‚é™ã‹ã«æ·±ãã€‚",
    tips:["â€œé‡ã‚ˆã‚Šè³ªâ€ã®ææ¡ˆã§è»¸ã‚’è¦‹ã›ã‚‹","é™ã‹ãªå´ã®å¸­ã‚’é¸ã¶","ãƒ‡ã‚¶ãƒ¼ãƒˆå‰ã«æ¬¡å›ã®ç´„æŸã‚’è»½ã"]},
};

/* ===========================================================
   3) ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆè»¸Ã—ãƒ•ã‚¡ã‚»ãƒƒãƒˆï¼‰
=========================================================== */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let page=0, answeredCount=0, pageStartAt=0;
let responses={}, answers=[];
const el=(id)=>document.getElementById(id);
const screenStart=el('screen-start'), screenQuiz=el('screen-quiz'), screenResult=el('screen-result');

function showScreen(which){
  screenStart.hidden = which!=='start';
  screenQuiz.hidden  = which!=='quiz';
  screenResult.hidden= which!=='result';
}
function resetState(){ page=0; answeredCount=0; responses={}; answers=[]; }
function start(){ resetState(); showScreen('quiz'); renderPage(); }

function renderPage(){
  el('page-now').textContent=page+1;
  el('q-answered').textContent=answeredCount;
  el('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el('qgrid'); grid.innerHTML='';
  slice.forEach(q=>{
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx">${q.text}</div>
      <div class="lr">
        <div class="side"><b>${q.A}</b></div>
        <div class="side"><b>${q.B}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6æ®µéšé¸æŠ">
        ${renderDots(q.id).join('')}
      </div>
    `;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));

  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val); // +3..-3ï¼ˆAå´=ï¼‹ï¼‰
      selectDot(qid, uiVal, e.currentTarget);
    });
  });

  // ã‚­ãƒ¼å…¥åŠ› 1..6 ã‚’ã“ã®ãƒšãƒ¼ã‚¸ã®æœªå›ç­”ã«é †æ¬¡
  window.onkeydown = (e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };

  pageStartAt=performance.now();
}
function renderDots(qid){
  const tipsL=["å·¦ï¼šã¨ã¦ã‚‚è¿‘ã„","å·¦ï¼šã‹ãªã‚Šè¿‘ã„","å·¦ï¼šã‚„ã‚„è¿‘ã„"];
  const tipsR=["å³ï¼šã‚„ã‚„è¿‘ã„","å³ï¼šã‹ãªã‚Šè¿‘ã„","å³ï¼šã¨ã¦ã‚‚è¿‘ã„"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;

  const left=valsL.map((v,i)=>`
    <button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}"></button>
  `);
  const right=valsR.map((v,i)=>`
    <button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}"></button>
  `);
  return [...left, ...right];
}
function selectDot(qid, uiVal, btn){
  const firstTime = !responses[qid];
  responses[qid] = { uiVal, ms: performance.now()-pageStartAt };
  if(firstTime){ answeredCount++; el('q-answered').textContent = answeredCount; }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');
  const startIdx=page*PAGE_SIZE; const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}
function setNextEnabled(ok){ el('btn-next').classList.toggle('disabled', !ok); }

document.getElementById('btn-next').addEventListener('click', ()=>{
  const btn = document.getElementById('btn-next');
  if(btn.classList.contains('disabled')) return;
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});

/* é›†è¨ˆï¼šè»¸Ã—ãƒ•ã‚¡ã‚»ãƒƒãƒˆ */
function computeProfile(){
  const AX = { RL:{R:0,L:0}, FS:{F:0,S:0}, KC:{K:0,C:0} };
  const FAC = {
    RL:{ fatTol:0, afterPref:0, roastAroma:0 },
    FS:{ pace:0, course:0, stay:0, roam:0, plan:0 },
    KC:{ classic:0, limited:0, photo:0, rule:0, instinct:0 },
    TX:{ chew:0, melt:0 }, FL:{ saltF:0, sauceF:0 }, AF:{ light:0, hearty:0 }
  };

  // ã‚¦ã‚§ã‚¤ãƒˆï¼šÂ±1=0.4, Â±2=0.7, Â±3=1.0
  const wOf=(ui)=>{ const a=Math.abs(ui); return (a===3?1:a===2?0.7:0.4)*Math.sign(ui); };

  for(const q of BANK){
    const r = responses[q.id]; if(!r) continue;
    const w = wOf(r.uiVal); // Aå´=ï¼‹ / Bå´=âˆ’

    // ä¸»è»¸åŠ ç‚¹
    if(q.axis==='RL'){ if(w>0) AX.RL.R+=Math.abs(w); else AX.RL.L+=Math.abs(w); }
    if(q.axis==='FS'){ if(w>0) AX.FS.F+=Math.abs(w); else AX.FS.S+=Math.abs(w); }
    if(q.axis==='KC'){ if(w>0) AX.KC.K+=Math.abs(w); else AX.KC.C+=Math.abs(w); }

    // ãƒ•ã‚¡ã‚»ãƒƒãƒˆåŠ ç‚¹
    for(const [k,dir] of Object.entries(q.facets||{})){
      const add = Math.abs(w) * dir;
      if(k in FAC.RL) FAC.RL[k]+=add;
      else if(k in FAC.FS) FAC.FS[k]+=add;
      else if(k in FAC.KC) FAC.KC[k]+=add;
      else if(k in FAC.TX) FAC.TX[k]+=add;
      else if(k in FAC.FL) FAC.FL[k]+=add;
      else if(k in FAC.AF) FAC.AF[k]+=add;
    }
  }

  // è»¸æ±ºå®šï¼ˆè£œåŠ©ãƒ–ãƒ¼ã‚¹ãƒˆï¼‰
  const pos=(x)=>Math.max(0,x), neg=(x)=>Math.max(0,-x);
  const decide=(A,B,boostA,boostB,labA,labB)=>{
    const diff=(A+boostA)-(B+boostB);
    return { side: diff>=0?labA:labB, clarity: Math.abs(diff) };
  };

  const rlBoostR = 0.6*pos(FAC.TX.chew) + 0.4*pos(FAC.FL.saltF) + 0.3*pos(FAC.AF.light);
  const rlBoostL = 0.6*pos(FAC.TX.melt) + 0.4*pos(FAC.FL.sauceF) + 0.3*pos(FAC.AF.hearty);
  const fsBoostF = 0.5*pos(FAC.FS.pace) + 0.3*pos(FAC.FL.saltF) + 0.2*pos(FAC.AF.light);
  const fsBoostS = 0.5*pos(FAC.FS.stay) + 0.3*pos(FAC.FS.course) + 0.2*pos(FAC.AF.hearty);
  const kcBoostK = 0.45*pos(FAC.KC.classic) + 0.25*pos(FAC.AF.light);
  const kcBoostC = 0.45*pos(FAC.KC.limited) + 0.25*pos(FAC.KC.photo) + 0.15*pos(FAC.KC.instinct);

  const RL = decide(AX.RL.R, AX.RL.L, rlBoostR, rlBoostL, 'R','L');
  const FS = decide(AX.FS.F, AX.FS.S, fsBoostF, fsBoostS, 'F','S');
  const KC = decide(AX.KC.K, AX.KC.C, kcBoostK, kcBoostC, 'K','C');

  const code = `${RL.side}-${FS.side}-${KC.side}`;

  // ãƒ¡ã‚¤ãƒ³éƒ¨ä½ï¼ˆ12ã‚¿ã‚¤ãƒ—ï¼‰
  const C = { ...FAC.TX, ...FAC.FL, ...FAC.AF };
  const typeName = TYPE_PICKER.pick(code, C);

  // ã‚¿ã‚°
  const tagTX = (pos(FAC.TX.chew) >= pos(FAC.TX.melt)) ? 'å™›ã¿å¿œãˆ' : 'ã¨ã‚ã‘';
  const tagFL = (pos(FAC.FL.saltF) >= pos(FAC.FL.sauceF)) ? 'å¡©æ´¾' : 'ã‚½ãƒ¼ã‚¹æ´¾';
  const tagAF = (pos(FAC.AF.light) >= pos(FAC.AF.hearty)) ? 'è»½ã‚„ã‹' : 'æº€è¶³';

  return {
    code, typeName, tagTX, tagFL, tagAF,
    clarity: { RL:RL.clarity, FS:FS.clarity, KC:KC.clarity },
    facets: FAC
  };
}

/* ç›¸æ€§ï¼šNo.1 ã®ã¿è¡¨ç¤º */
const OPP={R:'L',L:'R',F:'S',S:'F',K:'C',C:'K'};
function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
const ALL_CODES = ['R-F-K','R-F-C','R-S-K','R-S-C','L-F-K','L-F-C','L-S-K','L-S-C'];
const CODE_REPR = {
  'R-F-K':'ãƒ’ãƒ¬','R-F-C':'ã‚¿ãƒ³','R-S-K':'ã‚¤ãƒãƒœ','R-S-C':'ãƒ©ãƒ³ãƒ—',
  'L-F-K':'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹','L-F-C':'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³','L-S-K':'ã‚¶ãƒ–ãƒˆãƒ³','L-S-C':'ã‚«ãƒ«ãƒ“'
};

function compatScore(me, other, pref){
  // è»¸ãƒ™ãƒ¼ã‚¹ï¼šè£œå®Œã‚’é«˜è©•ä¾¡
  let base=0;
  base += (me.RL!==other.RL)? 10:3;
  base += (me.FS!==other.FS)? 8 :3;
  base += (me.KC!==other.KC)? 10:2;

  // æ©‹æ¸¡ã—ï¼ˆFL/AF/TX ã®ä¸€è‡´ï¼‰
  const bridge = 4*(pref.FL.same?1:0) + 3*(pref.AF.same?1:0) + 2*(pref.TX.same?1:0);

  // å¼·ã™ãå·®ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼ˆæ¼”å‡ºï¼‰
  const pen = Math.max(0, pref.clarity.RL + pref.oClarity.RL - 3)
            + Math.max(0, pref.clarity.FS + pref.oClarity.FS - 3)
            + Math.max(0, pref.clarity.KC + pref.oClarity.KC - 3);

  return Math.max(0, Math.min(100, 50 + base + bridge - 2*pen));
}

function bestCompat(my){
  const mine = parseCode(my.code);
  const myTX = my.tagTX, myFL = my.tagFL, myAF = my.tagAF;
  const myCl = my.clarity;
  const avgCl = {RL:1.0,FS:1.0,KC:1.0}; // å¹³å‡çš„å¼·ã•ã‚’ä»®å®š

  let best=null;
  for(const code of ALL_CODES){
    if(code===my.code) continue;
    const other=parseCode(code);
    const pref={
      FL:{same: myFL === (['R-F-K','R-S-K','L-F-K','L-S-K'].includes(code)? 'å¡©æ´¾':'ã‚½ãƒ¼ã‚¹æ´¾') },
      AF:{same: myAF === (['R-F-K','R-F-C','R-S-K'].includes(code)? 'è»½ã‚„ã‹':'æº€è¶³') },
      TX:{same: myTX === (['R-F-K','R-S-K','L-S-C','L-S-K'].includes(code)? 'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘') },
      clarity: myCl, oClarity: avgCl
    };
    const score = compatScore(mine, other, pref);
    const item = { code, name: CODE_REPR[code]||code, score };
    if(!best || score>best.score) best=item;
  }
  return best;
}

function showResult(){
  el('bar').style.width='100%';
  const r = computeProfile();
  showScreen('result');

  const meta = TYPE_META[r.typeName] || {nick:'â€”', catch:''};
  el('r-type-name').textContent = r.typeName;
  el('r-type-code').textContent = r.code;
  el('r-nickname').textContent = `â€œ${meta.nick}â€`;
  el('tag-tx').textContent = r.tagTX;
  el('tag-fl').textContent = r.tagFL;
  el('tag-af').textContent = r.tagAF;
  el('r-catch').textContent = meta.catch;

  const tips = meta.tips || [];
  const tipsUl = el('r-tips'); tipsUl.innerHTML='';
  tips.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; tipsUl.appendChild(li); });

  const best = bestCompat(r);
  const target = document.getElementById('r-compat1');
  target.textContent = best ? `${best.name}ï¼ˆ${best.code}ï¼‰ï¼š${best.score}/100` : 'â€”';

  // JSONå‡ºåŠ›
  const payload = {
    type:{ code:r.code, name:r.typeName, nickname:meta.nick },
    tags:{ tx:r.tagTX, fl:r.tagFL, af:r.tagAF },
    clarity:r.clarity, facets:r.facets,
    compat1: best,
    generatedAt: new Date().toISOString()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=el('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;

  // ã‚³ãƒ”ãƒ¼
  el('btn-copy').onclick = async ()=>{
    const text = [
      `MEAT-BTIï¼ˆç›¸æ€§é‡è¦–ï¼‰`,
      `ã‚¿ã‚¤ãƒ—ï¼š${r.typeName}ï¼ˆ${r.code}ï¼‰ â€œ${meta.nick}â€`,
      `ã‚¿ã‚°ï¼š${r.tagTX}ãƒ»${r.tagFL}ãƒ»${r.tagAF}`,
      `ç›¸æ€§No.1ï¼š${best ? `${best.name}(${best.code})` : 'â€”'}`,
      `#MeatBTI #ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£`
    ].join('\n');
    try{ await navigator.clipboard.writeText(text); el('btn-copy').textContent='ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'; setTimeout(()=>el('btn-copy').textContent='çµæœã‚’ã‚³ãƒ”ãƒ¼',1400); }catch{}
  };

  // ãƒªãƒˆãƒ©ã‚¤
  const retry = document.getElementById('btn-retry');
  retry.onclick = ()=>{ showScreen('start'); };
}

/* ã‚¤ãƒ™ãƒ³ãƒˆ */
addEventListener('click',(ev)=>{ const t=ev.target.closest('#btn-start,#btn-start-2'); if(!t) return; ev.preventDefault(); start(); });
</script>
</body>
</html>
