<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEAT-BTI v2｜ニクパーティ診断</title>
  <meta name="description" content="ニクパーティ用 MEAT-BTI v2（18問）— 1問15秒、部位タイプ＆相性タグを判定。"/>
  <style>
    :root{
      --bg:#0b0c10; --panel:#101218; --ink:#f4f7fb; --muted:#b6c0cf;
      --accent:#ff6b57; --accent2:#ffd166; --border:#1c1f27; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
    .app{width:min(920px,100%);margin:0 auto;padding:24px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--accent),var(--accent2));display:grid;place-items:center;color:#111;font-weight:900}
    .title{font-weight:900}
    .wrap{padding:16px}

    /* ---- QUIZ minimal ---- */
    .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .q-index{font-weight:900}
    .timer{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent2);box-shadow:0 0 0 6px rgba(255,209,102,.1)}
    .sec{font-family:ui-monospace,Menlo,Consolas,monospace}
    .bar{height:6px;background:#141721;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .q-text{font-size:clamp(20px,3.6vw,26px);font-weight:900;text-align:center;margin:16px 0 10px;color:var(--ink)}
    .opt-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:6px}
    @media(min-width:640px){.opt-grid{grid-template-columns:1fr 1fr}}
    .opt{background:#151a27;border:1px solid #2a3140;border-radius:14px;padding:18px;text-align:center;cursor:pointer;
         transition:transform .05s ease,border-color .15s ease,background .15s ease;font-size:clamp(16px,2.6vw,18px);color:var(--ink)}
    .opt strong{color:var(--ink)}
    .opt:hover{transform:translateY(-1px);border-color:#364158;background:#182033}
    .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

    /* ---- RESULT ---- */
    .result{display:grid;gap:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .r-card{background:#0f1219;border:1px solid var(--border);border-radius:14px;padding:14px}
    .big{font-size:clamp(28px,6vw,36px);font-weight:900}
    .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--border);margin-right:6px}
    .desc{margin-top:10px;line-height:1.9}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .btn{appearance:none;border:1px solid var(--border);background:#141721;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#ff4e36);color:#111;border:none;box-shadow:0 10px 24px rgba(255,107,87,.35)}
    footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <main class="app">
    <div class="card">
      <header>
        <div class="brand"><div class="logo">🥩</div><div class="title">MEAT-BTI v2</div></div>
        <button id="btn-start" class="btn primary">スタート</button>
      </header>
      <div class="wrap" id="stage">
        <!-- START -->
        <section id="screen-start">
          <h2 style="margin:0 0 6px">あなたはどの“部位タイプ”？</h2>
          <p style="color:var(--muted);margin:0 0 12px">18問／1問15秒。選ぶだけで、部位タイプと相性タグ（噛み応え/とろけ・塩/ソース・軽やか/満足）が分かります。</p>
          <div><button class="btn primary" id="btn-start-2">診断をはじめる</button></div>
        </section>

        <!-- QUIZ -->
        <section id="screen-quiz" hidden>
          <div class="q-head">
            <div class="q-index"><span id="q-counter">1</span>/<span id="q-total">18</span></div>
            <div class="timer"><div class="dot"></div><div class="sec"><span id="sec">15</span>s</div></div>
          </div>
          <div class="bar"><div id="bar"></div></div>
          <div class="q-text" id="q-text">どちらが近い？</div>
          <div class="opt-grid">
            <button class="opt" id="btn-A"><strong id="label-A">A</strong></button>
            <button class="opt" id="btn-B"><strong id="label-B">B</strong></button>
          </div>
          <div class="progress-note">※未回答は15秒で自動スキップ</div>
        </section>

        <!-- RESULT -->
        <section id="screen-result" hidden>
          <div class="result">
            <div class="big" id="r-title">診断結果</div>
            <div class="grid">
              <div class="r-card">
                <div><strong>あなたの部位タイプ</strong></div>
                <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">—</div>
                <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
                <div style="margin-top:10px"><span class="pill" id="tag-texture">噛み応え</span><span class="pill" id="tag-flavor">塩派</span><span class="pill" id="tag-after">軽やか</span></div>
                <p class="desc" id="r-desc"></p>
              </div>
              <div class="r-card">
                <div><strong>相性No.1</strong></div>
                <div id="r-best" class="mono" style="margin-top:6px"></div>
              </div>
            </div>
            <div class="r-card">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                <strong>詳細（集計値）</strong>
                <button class="btn" id="btn-copy">結果をコピー</button>
              </div>
              <pre class="mono" id="r-detail" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
            </div>
            <div style="display:flex;justify-content:space-between;gap:10px">
              <button class="btn" id="btn-retry">最初から</button>
              <a class="btn primary" href="#" id="btn-export" download>結果をJSONで保存</a>
            </div>
          </div>
        </section>
      </div>
      <footer>© KU-DETA / ニクパーティ — MEAT-BTI v2</footer>
    </div>
  </main>

<script>
/* --------------- Question Data (18) --------------- */
const QUESTIONS = [
  // RL (1-4) A=R B=L
  {id:1, axis:"RL", a:"赤身の旨みを噛みしめたい", b:"脂の甘みとコクで満たされたい"},
  {id:2, axis:"RL", a:"食後は軽やかが理想", b:"多少こってりでも満足感が大事"},
  {id:3, axis:"RL", a:"量より質で赤身中心に選ぶ", b:"サシの入った部位に惹かれる"},
  {id:4, axis:"RL", a:"好きな部位はヒレ", b:"好きな部位はサーロイン"},
  // FS (5-7) A=F B=S
  {id:5, axis:"FS", a:"強火でサッと香ばしく", b:"低温や余熱でじっくり"},
  {id:6, axis:"FS", a:"炭火・鉄板の直火感", b:"ローストや煮込みの奥行き"},
  {id:7, axis:"FS", a:"薄めでキレ良く", b:"厚めで中までしっとり"},
  // KC (8-10) A=K B=C
  {id:8, axis:"KC", a:"まずは定番から", b:"新作・限定に惹かれる"},
  {id:9, axis:"KC", a:"塩・胡椒・わさびで簡潔に", b:"特製ソースやスパイスでアレンジ"},
  {id:10, axis:"KC", a:"“いつものベスト”重視", b:"相手のおすすめにも乗る"},
  // Texture Q/M (11-13) A=Q B=M
  {id:11, axis:"TX", a:"しっかり噛んで旨みを感じたい", b:"ほろほろ・とろけ食感が好き"},
  {id:12, axis:"TX", a:"歯切れ良いレア寄り", b:"口どけ重視のミディアム〜ウェル"},
  {id:13, axis:"TX", a:"噛むほど味が出る赤身派", b:"やわらかジューシー最優先"},
  // Flavor Salt/Sauce (14-15) A=Salt B=Sauce
  {id:14, axis:"FL", a:"まずは塩で素材感", b:"バター・ガーリック等のソースが決め手"},
  {id:15, axis:"FL", a:"胡椒や燻香で香りを足す", b:"甘辛・クリーミー系も歓迎"},
  // After Light/Hearty (16-18) A=Light B=Hearty
  {id:16, axis:"AF", a:"明日も軽快に動きたい", b:"今夜はご褒美にしっかり"},
  {id:17, axis:"AF", a:"付け合わせはサラダ派", b:"マッシュやチーズトッピングも欲しい"},
  {id:18, axis:"AF", a:"もう一軒行ける余力が大事", b:"1軒で完結できる満足感が大事"},
];

const AXIS_LABEL = {
  RL: {A:"R", B:"L"},
  FS: {A:"F", B:"S"},
  KC: {A:"K", B:"C"},
  TX: {A:"Q", B:"M"},
  FL: {A:"Salt", B:"Sauce"},
  AF: {A:"Light", B:"Hearty"},
};

/* --- 8 types (with rare) --- */
const TYPE_NAMES = {
  "R-F-K":"ヒレ",
  "R-F-C":"タン",
  "R-S-K":"イチボ",
  "R-S-C":"ランプ",
  "L-F-K":"リブロース",
  "L-F-C":"サーロイン",
  "L-S-K":"ザブトン",
  "L-S-C":"リブロース"
};

const DESCRIPTIONS = {
  "ヒレ":"無駄のない上品さと芯の強さが共存するタイプ。情報を整理し、結論をすっきり出すのが得意。味わいはストレートに、素材勝負の一皿を好みます。会話でも相手の話を丁寧に拾い、余白を活かして深めるのが上手。場を騒がせるより、静かに質を上げる貢献が得意です。初対面では質問を一つずつ投げ、共通点が見つかると一気に距離が縮みます。",
  "サーロイン":"華やぎとサービス精神で場を盛り上げるムードメーカー。写真映えや“特製ソース”のようなアクセントに心が躍ります。人の良さに敏感で、相手の好みを素早くキャッチして合わせられる器用さも。会話はテンポ良く、リアクションも大きめ。初対面の輪を広げるのが得意で、二次会の幹事役にも向いています。",
  "リブロース":"王道リッチ派。厚みのある旨みと安心感を愛する、頼れる軸の持ち主です。決断が早く、段取りを整えてみんなを導くのが得意。派手さよりも満足度を重視し、会話は落ち着いたトーンで聞き役にも回れます。初対面では共通の“好き”を見つけてから深掘りするのがコツ。長く付き合える関係を築きやすいタイプ。",
  "ザブトン":"しっとり濃厚、噛むほどに広がるコクを愛する審美眼の持ち主。こだわりは強いが押し付けず、丁寧に言葉を選びます。大人数より少人数でじっくり話すのが好き。相手の良さを見つけて静かに引き出す聞き上手です。会話のコツは“なぜそれが好きか”の理由交換。丁寧さや誠実さに惹かれる大人の相性が生まれます。",
  "ランプ":"探究心と柔軟さを兼ね備えた実験好き。低温や創作のように、定番を一歩更新する工夫にワクワクします。物静かでも中身は熱い職人気質で、話し出すと深い知識がこぼれます。初対面では試食や小さな体験を共有すると会話が弾みやすい。相手の“新しい発見”を喜べる人と相性良好です。",
  "イチボ":"赤身の旨みを丁寧に味わう、調和型の通好み。控えめながら芯があり、空気を読みつつも要所でしっかり意見を言えます。派手さはないが、あとから効いてくる余韻タイプ。会話は相手の話を受けて一歩深めるのが得意で、価値観の近い相手と長期的な関係を築きやすい。気づけば“もっと話したい人”になっています。",
  "タン":"さっぱり塩でキレ良く。テンポの良さと明るさで周囲をほぐすムードメイクが得意。直感が利き、判断もスピーディ。会話は短いキャッチボールを重ねるのが上手で、乾杯の号令や場のスイッチ役に向いています。深掘りは二巡目にゆっくり。“まずはやってみる”精神で、新しい人ともすぐ距離を縮められます。",
  "シャトーブリアン":"繊細さと集中力、そして質への強いこだわりを備えた“特選ヒレ”気質。量より質、派手さより完成度を重んじ、相手にも誠実さと丁寧さを求めます。会話は落ち着いていて、的確な一言で印象を残すタイプ。急がず深く、少人数でじっくり向き合うと相性が花開きます。希少ゆえに出会えたら大切にしたい存在。"
};

const OPP = { R:"L", L:"R", F:"S", S:"F", K:"C", C:"K" };

/* --------------- State --------------- */
let current = 0; let timer = null; let tLeft = 15; const total = QUESTIONS.length;
const counts = { R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0 };
const answers = [];

const el = id => document.getElementById(id);
const screenStart = el('screen-start');
const screenQuiz  = el('screen-quiz');
const screenResult= el('screen-result');

function showScreen(which){
  screenStart.hidden = which !== 'start';
  screenQuiz.hidden  = which !== 'quiz';
  screenResult.hidden= which !== 'result';
}
function resetAll(){
  stopTimer(); tLeft=15; el('sec').textContent='15'; el('bar').style.width='0%';
  Object.keys(counts).forEach(k=>counts[k]=0);
  answers.length=0; current=0; showScreen('start');
}
function start(){ resetAll(); showScreen('quiz'); el('q-total').textContent=total; current=0; renderQ(); startTimer(); }

function renderQ(){
  const q = QUESTIONS[current];
  el('q-counter').textContent = current+1;
  el('q-text').textContent = 'どちらが近い？';
  el('label-A').textContent = q.a;
  el('label-B').textContent = q.b;
}

function startTimer(){
  stopTimer(); tLeft=15; const totalMs=15000; const startAt=performance.now();
  el('sec').textContent=String(tLeft);
  const tick=()=>{
    const elapsed=performance.now()-startAt; const remain=Math.max(0,totalMs-elapsed);
    const s=Math.ceil(remain/1000); if(s!==tLeft){ tLeft=s; el('sec').textContent=String(s); }
    const pct=(elapsed/totalMs)*100; el('bar').style.width=Math.min(100,pct)+'%';
    if(remain<=0){ stopTimer(); pick('skip'); } else { timer=requestAnimationFrame(tick); }
  };
  timer=requestAnimationFrame(tick);
}
function stopTimer(){ if(timer){ cancelAnimationFrame(timer); timer=null; } }

function pick(choice){
  const q = QUESTIONS[current]; answers.push({ id:q.id, axis:q.axis, choice });
  if(choice==='A'||choice==='B'){ const label=AXIS_LABEL[q.axis][choice]; counts[label]=(counts[label]||0)+1; }
  next();
}
function next(){ stopTimer(); if(current<total-1){ current++; renderQ(); startTimer(); } else { showResult(); } }

/* ---- result logic (RL adjustment & rare) ---- */
function computeResult(){
  const R_base=counts.R, L_base=counts.L; const F=counts.F, S=counts.S; const K=counts.K, C=counts.C;
  const Q=counts.Q, M=counts.M; const Salt=counts.Salt, Sauce=counts.Sauce; const Light=counts.Light, Hearty=counts.Hearty;
  const R_adj=(Q>=2?1:0)+(Salt>=2?1:0)+(Light>=2?1:0);
  const L_adj=(M>=2?1:0)+(Sauce>=2?1:0)+(Hearty>=2?1:0);
  const Rf=R_base+R_adj, Lf=L_base+L_adj;
  const RL=(Rf>=Lf)?'R':'L'; const FS=(F>=S)?'F':'S'; const KC=(K>=C)?'K':'C';
  const code = `${RL}-${FS}-${KC}`;
  let name = TYPE_NAMES[code] || '不明';
  // Rare: Chateaubriand (Fillet special)
  const isCB = (code==='R-F-K') && (Q>=2 && Salt>=2 && Light>=2) && (R_base>=3 && F>=2 && K>=2);
  if(isCB) name='シャトーブリアン';
  const tagTexture=(Q>=M)?'噛み応え':'とろけ';
  const tagFlavor =(Salt>=Sauce)?'塩派':'ソース派';
  const tagAfter  =(Light>=Hearty)?'軽やか':'満足';
  return { code,name,R_base,L_base,F,S,K,C,Q,M,Salt,Sauce,Light,Hearty,R_adj,L_adj,Rf,Lf,tagTexture,tagFlavor,tagAfter };
}

function allTypeCodes(){ return Object.keys(TYPE_NAMES); }
function parseCode(code){ const [a,b,c]=code.split('-'); return {RL:a,FS:b,KC:c}; }

/* 相性No.1 を1つだけ算出 */
function bestMatch(code){
  const mine=parseCode(code); let best=null, bestScore=-1;
  for(const t of allTypeCodes()){
    if(t===code) continue; const other=parseCode(t);
    let opp=0, same=0;
    if(other.RL===OPP[mine.RL]) opp++;
    if(other.FS===OPP[mine.FS]) opp++;
    if(other.KC===OPP[mine.KC]) opp++;
    if(other.RL===mine.RL) same++;
    if(other.FS===mine.FS) same++;
    if(other.KC===mine.KC) same++;
    const score = (opp>=2) ? opp*10 : (opp*10 + same); // 補完を優先
    if(score>bestScore){ bestScore=score; best=t; }
  }
  return best; // 例: "L-F-C"
}

function showResult(){
  const r=computeResult(); showScreen('result');
  el('r-type-name').textContent=r.name;
  el('r-type-code').textContent=r.code;
  el('tag-texture').textContent=r.tagTexture;
  el('tag-flavor').textContent=r.tagFlavor;
  el('tag-after').textContent=r.tagAfter;
  el('r-desc').textContent = DESCRIPTIONS[r.name] || '';

  const bm=bestMatch(r.code);
  el('r-best').textContent = bm ? `${TYPE_NAMES[bm]}（${bm}）` : '—';

  const detail=[
    `R/L base: R=${r.R_base}, L=${r.L_base}  adj: R+${r.R_adj}, L+${r.L_adj}  → Rf=${r.Rf}, Lf=${r.Lf}`,
    `F/S: F=${r.F}, S=${r.S}`,
    `K/C: K=${r.K}, C=${r.C}`,
    `Texture: Q=${r.Q}, M=${r.M}  Flavor: Salt=${r.Salt}, Sauce=${r.Sauce}  After: Light=${r.Light}, Hearty=${r.Hearty}`,
    `Tags: ${r.tagTexture}・${r.tagFlavor}・${r.tagAfter}`,
  ].join('\n');
  el('r-detail').textContent=detail;

  const payload={
    type:{code:r.code,name:r.name},
    tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},
    counts:{R:r.R_base,L:r.L_base,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M,Salt:r.Salt,Sauce:r.Sauce,Light:r.Light,Hearty:r.Hearty},
    adjusted:{Rf:r.Rf,Lf:r.Lf,R_adj:r.R_adj,L_adj:r.L_adj},
    answers, generatedAt:new Date().toISOString()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=el('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

async function copyResult(){
  const name=el('r-type-name').textContent; const code=el('r-type-code').textContent;
  const tags=[el('tag-texture').textContent,el('tag-flavor').textContent,el('tag-after').textContent].join('・');
  const text=`MEAT-BTI v2\n部位タイプ：${name}（${code}）\nタグ：${tags}`;
  try{ await navigator.clipboard.writeText(text); el('btn-copy').textContent='コピーしました！';
       setTimeout(()=>el('btn-copy').textContent='結果をコピー',1500); } catch{ alert('コピーに失敗しました'); }
}

/* events */
['btn-start','btn-start-2'].forEach(id=>document.getElementById(id).addEventListener('click',start));
['btn-A','btn-B'].forEach((id,i)=>document.getElementById(id).addEventListener('click',()=>pick(i===0?'A':'B')));
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',resetAll);
const copy=document.getElementById('btn-copy'); if(copy) copy.addEventListener('click',copyResult);

/* keyboard shortcuts */
window.addEventListener('keydown',e=>{ if(screenQuiz.hidden) return; if(e.key==='1') pick('A'); else if(e.key==='2') pick('B'); else if(e.key.toLowerCase()==='s'){ pick('skip'); } else if(e.code==='Space'){ e.preventDefault(); pick('skip'); } });

/* init */
showScreen('start');
</script>
</body>
</html>
