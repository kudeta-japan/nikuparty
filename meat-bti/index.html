<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEAT-BTI v7.5ï½œ20å•ãƒ»6æŠï¼ˆå²é˜œãƒ­ãƒ¼ã‚«ãƒ« & ç°¡æ½”å‰æï¼‰</title>
<meta name="description" content="5å•Ã—4ãƒšãƒ¼ã‚¸ï¼å…¨20å•ã€‚å²é˜œãƒ­ãƒ¼ã‚«ãƒ«ã®ç°¡æ½”ãªå‰æã¤ãã€‚6æ®µéšï¼ˆä¸­ç«‹ãªã—ï¼‰ãƒ»ç„¡ä½œç‚ºé †/å·¦å³å…¥æ›¿ãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã€‚åŸºæœ¬12ã‚¿ã‚¤ãƒ—ï¼‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ã€ã€‚"/>

<!-- GA4ï¼ˆã‚µã‚¤ãƒˆå…±é€šï¼šG-V39MNGQD5Hï¼‰ -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V39MNGQD5H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-V39MNGQD5H');
</script>

<style>
  :root{
    --bg:#090b10; --panel:#0f1219; --ink:#f5f8ff; --muted:#b7c3d6;
    --acc:#ff715b; --acc2:#ffd166; --bd:#1b2030; --shadow:0 10px 30px rgba(0,0,0,.35);
    --good:#35d19d; --warn:#ffd166; --blue:#59b3ff;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
  .app{width:min(960px,100%);margin:0 auto;padding:24px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--bd)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111;font-weight:900}
  .title{font-weight:900}
  .wrap{padding:0}

  /* HEROï¼ˆLPã¨åŒã˜æ§‹æˆï¼šèƒŒæ™¯å†™çœŸï¼‹æš—å¹•ï¼‰ */
  .hero{position:relative;min-height:56vh;padding:40px 28px 26px;background:#000;overflow:hidden;border-bottom:1px solid var(--bd)}
  .hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.78) contrast(1.05)}
  .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.1) 0%, rgba(0,0,0,.55) 60%, rgba(0,0,0,.85) 100%)}
  .hero-inner{position:relative;z-index:1;display:grid;gap:18px}
  .eyebrow{display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.08);border:1px solid #222a3a;color:#dfe7f5;padding:6px 10px;border-radius:999px;font-size:12px}
  .h1{font-size:clamp(26px,5.6vw,40px);line-height:1.2;font-weight:900;margin:0}
  .lead{color:var(--muted);margin:0}
  .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}
  .badge{background:#121829;border:1px solid #2a3245;color:#dfe7f5;border-radius:999px;padding:6px 10px;font-size:12px}
  .cta-row{display:flex;align-items:center;gap:12px;margin-top:8px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--bd);background:#151a23;color:var(--ink);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease, box-shadow .15s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}
  .subnote{color:var(--muted);font-size:12px}
  .types{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
  @media(min-width:720px){.types{grid-template-columns:repeat(6,1fr)}}
  .type-chip{background:#121726;border:1px solid #2a3140;border-radius:12px;padding:10px 10px;text-align:center;font-weight:700;white-space:nowrap}

  /* QUIZ */
  .section{padding:16px}
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:220px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#111522;border:1px solid #2a3140;border-radius:14px;padding:14px}
  .ctx{color:#e7ecf8;font-weight:700;font-size:clamp(14px,2.8vw,16px);margin:-2px 0 8px 0}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:stretch;pointer-events:none}
  .side{background:#0f1522;border:1px solid #272f41;border-radius:12px;padding:10px;min-height:66px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2677c8);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .dot:hover{transform:translateY(-1px)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--bd);margin-right:6px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* RESULT */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(26px,6vw,34px);font-weight:900}
  .desc{margin-top:10px;line-height:1.9}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<main class="app">
  <div class="card">
    <header>
      <div class="brand"><div class="logo">ğŸ¥©</div><div class="title">MEAT-BTI v7.5ï¼ˆ20å•ãƒ»å²é˜œãƒ­ãƒ¼ã‚«ãƒ«å‰æï¼‰</div></div>
      <button id="btn-start" class="btn primary" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
    </header>

    <!-- START -->
    <section id="screen-start" class="hero">
      <!-- è¿½åŠ ï¼šãƒ’ãƒ¼ãƒ­ãƒ¼èƒŒæ™¯ç”»åƒ -->
      <img src="mbti.jpg" alt="" class="hero-img" />
      <div class="hero-inner">
        <span class="eyebrow">âœ¨ KU-DETA é™å®š ãƒ» 11/15</span>
        <h1 class="h1">è‚‰å¥½ãã®ãŸã‚ã®æ€§æ ¼è¨ºæ–­ã€‚<br>ã‚ãªãŸã¯ã©ã® <span style="color:#ffd166">â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€</span>ï¼Ÿ</h1>
        <p class="lead">å…¨20å•ã€‚å²é˜œãƒ­ãƒ¼ã‚«ãƒ«ã®<b>çŸ­ã„å‰æ</b>ä»˜ãï¼6æ®µéšã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆä¸­ç«‹ãªã—ï¼‰ã€‚å‘³è¦šã¨é£Ÿäº‹ã‚·ãƒ¼ãƒ³ã®ã‚¯ã‚»ã‹ã‚‰åˆ¤å®šã—ã¾ã™ã€‚</p>
        <div class="badges">
          <span class="badge">6æŠ Ã— 20å•</span>
          <span class="badge">ç„¡ä½œç‚ºé †ãƒ»å·¦å³å…¥æ›¿</span>
          <span class="badge">ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯</span>
        </div>
        <div class="cta-row">
          <button class="btn primary" id="btn-start-2" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
          <span class="subnote">â€»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ <b>1â€“6</b> ã§ã‚‚é¸ã¹ã¾ã™</span>
        </div>
        <div class="types" aria-label="12ã‚¿ã‚¤ãƒ—">
          <div class="type-chip">ãƒ’ãƒ¬</div><div class="type-chip">ã‚¿ãƒ³</div><div class="type-chip">ã‚¤ãƒãƒœ</div><div class="type-chip">ãƒ©ãƒ³ãƒ—</div>
          <div class="type-chip">ãƒªãƒ–ãƒ­ãƒ¼ã‚¹</div><div class="type-chip">ã‚µãƒ¼ãƒ­ã‚¤ãƒ³</div><div class="type-chip">ã‚¶ãƒ–ãƒˆãƒ³</div><div class="type-chip">ã‚«ãƒ«ãƒ“</div>
          <div class="type-chip">ãƒãƒ©ãƒŸ</div><div class="type-chip">ã‚·ãƒ³ã‚·ãƒ³</div><div class="type-chip">ã‚«ã‚¤ãƒãƒŸ</div><div class="type-chip">ãƒŸã‚¹ã‚¸</div>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <div class="wrap">
      <section id="screen-quiz" class="section" hidden>
        <div class="q-head">
          <div class="q-index"><span id="page-now">1</span>/4ãƒšãƒ¼ã‚¸ï¼ˆ<span id="q-answered">0</span>/20ï¼‰</div>
          <div class="bar"><div id="bar"></div></div>
        </div>

        <div id="qgrid" class="qgrid"><!-- 5å•ãŒã“ã“ã«å‡ºã‚‹ --></div>

        <div class="q-foot">
          <div>â€»å·¦å³ã‚«ãƒ¼ãƒ‰ã¯èª¬æ˜ã®ã¿ï¼ˆã‚¯ãƒªãƒƒã‚¯ä¸å¯ï¼‰</div>
          <div style="display:flex;gap:10px">
            <button id="btn-next" class="btn primary disabled">æ¬¡ã®5å•ã¸</button>
          </div>
        </div>
        <div class="progress-note">ä¸¸ã„ãƒ‰ãƒƒãƒˆã§é¸æŠã€‚å·¦ï¼ˆé’ï¼‰â‡”å³ï¼ˆèµ¤ï¼‰ã»ã©å¼·ã„ã€‚</div>
      </section>

      <!-- RESULT -->
      <section id="screen-result" class="section" hidden>
        <div class="result">
          <div class="big">è¨ºæ–­çµæœ</div>
          <div class="grid">
            <div class="r-card">
              <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
              <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
              <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
              <div style="margin-top:10px"><span class="pill" id="tag-texture">å™›ã¿å¿œãˆ</span><span class="pill" id="tag-flavor">å¡©æ´¾</span><span class="pill" id="tag-after">è»½ã‚„ã‹</span></div>
              <p class="desc" id="r-desc"></p>
            </div>
            <div class="r-card">
              <div><strong>ç›¸æ€§No.1</strong></div>
              <div id="r-best" class="mono" style="margin-top:6px"></div>
            </div>
          </div>

          <div style="display:flex;justify-content:space-between;gap:10px">
            <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
            <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
          </div>
        </div>
      </section>
    </div>

    <footer>Â© KU-DETA / ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” MEAT-BTI v7.5</footer>
  </div>
</main>

<script>
/* ==== Question Bankï¼ˆå²é˜œãƒ­ãƒ¼ã‚«ãƒ« & ç°¡æ½”å‰æï¼‰20å• ==== */
const BANK = [
  {id:1,axis:"RL",ctx:"KU-DETAã§æœ€åˆã®ä¸€çš¿ã€‚",a:"è„‚å°‘ãªã‚ã§èµ¤èº«ã‚’å‘³ã‚ã†",b:"ã‚µã‚·ã®ã‚³ã‚¯ã§æº€è¶³ã—ãŸã„"},
  {id:2,axis:"RL",ctx:"å¹³æ—¥å¤œã€å²é˜œé§…è¿‘ã§ã‚µã‚¯ãƒƒã¨ã€‚",a:"è»½ãçµ‚ãˆã‚‹",b:"ã—ã£ã‹ã‚Šæº€è…¹ã¾ã§"},
  {id:3,axis:"RL",ctx:"åŒä¾¡æ ¼ã®èµ¤èº«ã¨éœœé™ã‚Šã€‚",a:"ã‚­ãƒ¬é‡è¦–ï¼ˆã•ã£ã±ã‚Šï¼‰",b:"ã‚³ã‚¯é‡è¦–ï¼ˆæ¿ƒåšï¼‰"},
  {id:19,axis:"RL",ctx:"åç‰©ã‚«ãƒ«ãƒ“ vs èµ¤èº«åç‰©ã‚’1çš¿ã€‚",a:"èµ¤èº«ã‚’é¸ã¶",b:"åç‰©ã‚«ãƒ«ãƒ“ã‚’é¸ã¶"},
  {id:4,axis:"RL",ctx:"åº—é•·ã®æ¨ã—ï¼šãƒ’ãƒ¬/ã‚¿ãƒ³ or ã‚µãƒ¼ãƒ­ã‚¤ãƒ³/ã‚«ãƒ«ãƒ“ã€‚",a:"ãƒ’ãƒ¬ãƒ»ã‚¿ãƒ³ã«æƒ¹ã‹ã‚Œã‚‹",b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ãƒ»ã‚«ãƒ«ãƒ“ã«æƒ¹ã‹ã‚Œã‚‹"},
  {id:5,axis:"TX",ctx:"ã‚«ãƒƒãƒˆæŒ‡å®šOKã®ãŠåº—ã€‚",a:"æ­¯åˆ‡ã‚Œè‰¯ã„å™›ã¿å¿œãˆ",b:"ã¨ã‚ã‘ã‚‹æŸ”ã‚‰ã‹ã•"},
  {id:6,axis:"TX",ctx:"ç„¼ãåŠ æ¸›ã®å¸Œæœ›ã¯ï¼Ÿ",a:"è–„åˆ‡ã‚Šãƒ»ãƒ¬ã‚¢å¯„ã‚Š",b:"åšåˆ‡ã‚Šãƒ»ãƒŸãƒ‡ã‚£ã‚¢ãƒ ä»¥ä¸Š"},
  {id:7,axis:"TX",ctx:"ã‚ãªãŸãŒç„¼ãæ‹…å½“ã€‚",a:"ã‚µãƒƒã¨ç«å…¥ã‚Œ",b:"ã—ã£ã‹ã‚Šç«å…¥ã‚Œ"},
  {id:8,axis:"FL",ctx:"å“ä¸Šã¯å¡©ã¨ç‰¹è£½ãƒ€ãƒ¬ã€‚",a:"ã‚·ãƒ³ãƒ—ãƒ«æ´¾ï¼ˆå¡©ãƒ»ãƒ¬ãƒ¢ãƒ³ï¼‰",b:"ã‚½ãƒ¼ã‚¹æ´¾ï¼ˆç”˜è¾›ãƒ»ã‚¬ãƒªãƒã‚¿ç­‰ï¼‰"},
  {id:9,axis:"FL",ctx:"é¦™ã‚Šã®æ¼”å‡ºã‚‚é¸ã¹ã‚‹ã€‚",a:"è‚‰ã®é¦™ã‚Šã‚’æ´»ã‹ã™",b:"ã‚½ãƒ¼ã‚¹é¦™ã§ç››ã‚Šä¸Šã’ã‚‹"},
  {id:10,axis:"FS",ctx:"ä¸ƒè¼ª1å°ã®å°‘äººæ•°ã€‚",a:"å¼·ç«ã§å›è»¢è‰¯ã",b:"å¼±ã€œä¸­ç«ã§ã˜ã£ãã‚Š"},
  {id:11,axis:"FS",ctx:"â€œã‚³ãƒ¼ã‚¹ or ã‚¢ãƒ©ã‚«ãƒ«ãƒˆâ€ã€‚",a:"ãƒ†ãƒ³ãƒè‰¯ãæ¬¡ã€…",b:"ã‚†ã£ãã‚Šã‚³ãƒ¼ã‚¹"},
  {id:12,axis:"FS",ctx:"ç‰å®®ãŒæ··ã‚€é‡‘æ›œã€‚",a:"ä»–åº—ã¸ç§»å‹•ã™ã‚‹",b:"æ°—ã«å…¥ã‚Œã°è…°ã‚’æ®ãˆã‚‹"},
  {id:13,axis:"KC",ctx:"æœ€åˆã®ä¸€çš¿ã€‚",a:"å¡©ã‚¿ãƒ³ãƒ»ç‹é“ã‹ã‚‰",b:"é™å®šãƒ»å¤‰ã‚ã‚Šç¨®ã‹ã‚‰"},
  {id:14,axis:"KC",ctx:"4äººã§ã‚·ã‚§ã‚¢æ³¨æ–‡ã€‚",a:"æœ€åˆã«ã¾ã¨ã‚ã¦æ®µå–ã‚Š",b:"æ§˜å­è¦‹ã§éƒ½åº¦è¿½åŠ "},
  {id:20,axis:"KC",ctx:"ä»Šæ—¥ã¯SNSã«ã‚‚ä¸Šã’ã‚‹å¤œã€‚",a:"å‘³å„ªå…ˆã§é¸ã¶",b:"æ˜ ãˆå„ªå…ˆã§é¸ã¶"},
  {id:15,axis:"KC",ctx:"ä¼šç¤¾ãƒ¡ãƒ³ãƒãƒ¼ã‚‚å‚åŠ ã€‚",a:"ãƒãƒŠãƒ¼é‡è¦–ã§é£Ÿã¹ã‚‹",b:"å‹ã«ç¸›ã‚‰ã‚Œãšæ¥½ã—ã‚€"},
  {id:16,axis:"AF",ctx:"ç· ã‚ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚",a:"ã€†ãªã—/è»½ã‚ã§OK",b:"ã”é£¯ãƒ»å†·éººãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆã¾ã§"},
  {id:17,axis:"AF",ctx:"æœ€åˆã®ä¸€æ¯ã€‚",a:"ãƒã‚¤ãƒœãƒ¼ãƒ«/ã™ã£ãã‚Šç³»",b:"ç”˜ã‚/æ¿ƒã„ç³»ã‚‚æ¬²ã—ã„"},
  {id:18,axis:"AF",ctx:"21æ™‚ã€ç‰å®®ã§äºŒè»’ç›®ã‚ã‚‹ã‹ã‚‚ã€‚",a:"è»½ãç¶šã‘ãŸã„",b:"ã“ã“ã§å®Œçµã—ãŸã„"},
];

function decorateBankRandomly(bank){return bank.map(q=>({...q,flip:Math.random()<0.5}))}
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};

/* ä»£è¡¨ï¼ˆç›¸æ€§è¨ˆç®—ï¼‰ */
const CODE_REPR={
  "R-F-K":"ãƒ’ãƒ¬","R-F-C":"ã‚¿ãƒ³","R-S-K":"ã‚¤ãƒãƒœ","R-S-C":"ãƒ©ãƒ³ãƒ—",
  "L-F-K":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹","L-F-C":"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³","L-S-K":"ã‚¶ãƒ–ãƒˆãƒ³","L-S-C":"ã‚«ãƒ«ãƒ“"
};
/* èª¬æ˜æ–‡ï¼ˆ12ï¼‹CBï¼‰ */
const DESCRIPTIONS={
  "ãƒ’ãƒ¬":"ç„¡é§„ã®ãªã„ä¸Šå“ã•ã¨èŠ¯ã®å¼·ã•ãŒå…±å­˜ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚æƒ…å ±ã‚’æ•´ç†ã—ã€çµè«–ã‚’ã™ã£ãã‚Šå‡ºã™ã®ãŒå¾—æ„ã€‚å‘³ã‚ã„ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ã€ç´ æå‹è² ã®ä¸€çš¿ã‚’å¥½ã¿ã¾ã™ã€‚",
  "ã‚¿ãƒ³":"ã•ã£ã±ã‚Šå¡©ã§ã‚­ãƒ¬è‰¯ãã€‚ãƒ†ãƒ³ãƒã®è‰¯ã•ã¨æ˜ã‚‹ã•ã§å‘¨å›²ã‚’ã»ãã™ãƒ ãƒ¼ãƒ‰ãƒ¡ã‚¤ã‚¯ãŒå¾—æ„ã€‚ç›´æ„ŸãŒåˆ©ãã€åˆ¤æ–­ã‚‚ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ã€‚",
  "ã‚¤ãƒãƒœ":"èµ¤èº«ã®æ—¨ã¿ã‚’ä¸å¯§ã«å‘³ã‚ã†ã€èª¿å’Œå‹ã®é€šå¥½ã¿ã€‚æ§ãˆã‚ãªãŒã‚‰èŠ¯ãŒã‚ã‚Šã€ç©ºæ°—ã‚’èª­ã¿ã¤ã¤ã‚‚è¦æ‰€ã§æ„è¦‹ã‚’è¨€ãˆã‚‹äººã€‚",
  "ãƒ©ãƒ³ãƒ—":"æ¢ç©¶å¿ƒã¨æŸ”è»Ÿã•ã‚’å…¼ã­å‚™ãˆãŸå®Ÿé¨“å¥½ãã€‚ä½æ¸©ã‚„å‰µä½œã®ã‚ˆã†ã«å®šç•ªã‚’ä¸€æ­©æ›´æ–°ã™ã‚‹å·¥å¤«ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¾ã™ã€‚",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"ç‹é“ãƒªãƒƒãƒæ´¾ã€‚åšã¿ã®ã‚ã‚‹æ—¨ã¿ã¨å®‰å¿ƒæ„Ÿã‚’é‡è¦–ã—ã€æ®µå–ã‚Šã‚ˆãçš†ã‚’å°ã‘ã‚‹é ¼ã‚Œã‚‹äººã€‚",
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"è¯ã‚„ãã¨ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ã§å ´ã‚’ç››ã‚Šä¸Šã’ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚å†™çœŸæ˜ ãˆã‚„â€œç‰¹è£½ã‚½ãƒ¼ã‚¹â€ã«å¿ƒãŒèºã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
  "ã‚¶ãƒ–ãƒˆãƒ³":"ã—ã£ã¨ã‚Šæ¿ƒåšã€å™›ã‚€ã»ã©ã«åºƒãŒã‚‹ã‚³ã‚¯ã€‚ã“ã ã‚ã‚Šã¯å¼·ã„ãŒæŠ¼ã—ä»˜ã‘ãšã€ä¸å¯§ã«è¨€è‘‰ã‚’é¸ã³ã¾ã™ã€‚",
  "ã‚«ãƒ«ãƒ“":"æ¿ƒåšã§ç”˜è¾›ã®æ—¨ã¿ã‚’æ„›ã™ã‚‹ãƒªãƒƒãƒæ´¾ã€‚ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ãŒã‚ã‚Šã€äººã‚’å·»ãè¾¼ã‚€ã®ãŒä¸Šæ‰‹ã€‚",
  "ãƒãƒ©ãƒŸ":"ç‚­ç«ã¨ç”˜è¾›ãƒ€ãƒ¬ãŒä¼¼åˆã†ã€èºå‹•æ„Ÿã®ã‚ã‚‹èµ¤èº«æ´¾ã€‚æ­¯ã”ãŸãˆã¨ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ã•ã®ãƒãƒ©ãƒ³ã‚¹æ´¾ã€‚",
  "ã‚·ãƒ³ã‚·ãƒ³":"ä¸Šå“ãªèµ¤èº«ã®ã‚³ã‚¯ã¨ã‚­ãƒ¬ã‚’ä¸¡ç«‹ã€‚ç„¡é§„ã®ãªã„å‘³è¨­è¨ˆã‚’å¥½ã‚€å …å®Ÿæ´¾ã€‚",
  "ã‚«ã‚¤ãƒãƒŸ":"è»½ã‚„ã‹ã§ç¹Šç¶­æ„ŸãŒå¿ƒåœ°ã‚ˆã„ã€‚è„‚ã®æ—¨ã¿ã¯å¥½ãã ãŒé‡ã•ã¯æŠ‘ãˆãŸã„ã‚¿ã‚¤ãƒ—ã€‚",
  "ãƒŸã‚¹ã‚¸":"ç¹Šç´°ãªã‚µã‚·ãŒå…¥ã‚Šã¤ã¤è»½ã‚„ã‹ã€‚ã‚„ã•ã—ã„å£ã©ã‘ã¨ä¸Šå“ãªé¦™ã‚Šã‚’å¥½ã‚€ä¸å¯§ã•ã®äººã€‚",
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"è³ªã¸ã®å¼·ã„ã“ã ã‚ã‚Šã‚’å‚™ãˆãŸâ€œç‰¹é¸ãƒ’ãƒ¬â€ã€‚é‡ã‚ˆã‚Šè³ªã€å®Œæˆåº¦é‡è¦–ã®å¸Œå°‘ã‚¿ã‚¤ãƒ—ã€‚"
};

/* ==== State ==== */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let QUESTIONS=[], page=0, responses={}, answeredCount=0, pageStartAt=0;
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0};
const answers=[], rtimes=[], rl_items=[], fs_items=[], kc_items=[];
const el=id=>document.getElementById(id);
const screenStart=el('screen-start'), screenQuiz=el('screen-quiz'), screenResult=el('screen-result');
function showScreen(which){screenStart.hidden=which!=='start';screenQuiz.hidden=which!=='quiz';screenResult.hidden=which!=='result';}

/* ==== Flow ==== */
function start(){
  Object.keys(counts).forEach(k=>counts[k]=0);
  responses={}; answeredCount=0; page=0;
  answers.length=0; rtimes.length=0; rl_items.length=0; fs_items.length=0; kc_items.length=0;

  QUESTIONS=decorateBankRandomly([...BANK]).sort(()=>Math.random()-0.5);
  showScreen('quiz'); renderPage();
}
function renderPage(){
  el('page-now').textContent=page+1;
  el('q-answered').textContent=answeredCount;
  el('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el('qgrid'); grid.innerHTML='';
  slice.forEach((q)=>{
    const left=q.flip?q.b:q.a; const right=q.flip?q.a:q.b;
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx">${q.ctx}</div>
      <div class="lr" aria-label="å·¦å³ã®æ¯”è¼ƒæ–‡">
        <div class="side"><b>${left}</b></div>
        <div class="side"><b>${right}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6æ®µéšé¸æŠ">
        ${renderDots(q.id).join('')}
      </div>
    `;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));

  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val); // +3..-3
      selectDot(qid, uiVal, e.currentTarget);
    })
  });

  // 1..6 ã®ã‚­ãƒ¼å‰²å½“ï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®â€œæœªå›ç­”â€ã«é †æ¬¡å…¥åŠ›ï¼‰
  window.onkeydown=(e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };

  pageStartAt=performance.now();
}
function renderDots(qid){
  const tipsL=["å·¦ï¼šã¨ã¦ã‚‚è¿‘ã„","å·¦ï¼šã‹ãªã‚Šè¿‘ã„","å·¦ï¼šã‚„ã‚„è¿‘ã„"];
  const tipsR=["å³ï¼šã‚„ã‚„è¿‘ã„","å³ï¼šã‹ãªã‚Šè¿‘ã„","å³ï¼šã¨ã¦ã‚‚è¿‘ã„"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;

  const left=valsL.map((v,i)=>`
    <button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}" aria-label="${tipsL[i]}"></button>
  `);
  const right=valsR.map((v,i)=>`
    <button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}" aria-label="${tipsR[i]}"></button>
  `);
  return [...left, ...right];
}
function selectDot(qid, uiVal, btn){
  responses[qid] = responses[qid] || {};
  const firstTime = (responses[qid].uiVal === undefined);
  responses[qid].uiVal = uiVal;
  if(firstTime){
    responses[qid].ts = performance.now() - pageStartAt;
    answeredCount++; el('q-answered').textContent = answeredCount;
  }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');

  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}
function setNextEnabled(ok){el('btn-next').classList.toggle('disabled', !ok);}

/* ==== é›†è¨ˆï¼ˆãƒšãƒ¼ã‚¸ç¢ºå®šï¼‰==== */
function applyPage(){
  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  for(const q of slice){
    const r=responses[q.id]; if(!r) continue;
    const valForA=(q.flip?-r.uiVal:r.uiVal);  // +3..-3
    const towardA=Math.sign(valForA);
    const abs=Math.abs(valForA);
    const w=abs>=3?1.0:abs===2?0.7:0.4;

    answers.push({id:q.id,axis:q.axis,uiVal:r.uiVal,valForA,flipped:q.flip,ms:r.ts,ctx:q.ctx});
    rtimes.push(r.ts);

    const add=k=>counts[k]=(counts[k]||0)+w;
    if(q.axis==='RL'){ towardA>0 ? (add('R'), rl_items.push(1)) : (add('L'), rl_items.push(0)); }
    if(q.axis==='FS'){ towardA>0 ? (add('F'), fs_items.push(1)) : (add('S'), fs_items.push(0)); }
    if(q.axis==='KC'){ towardA>0 ? (add('K'), kc_items.push(1)) : (add('C'), kc_items.push(0)); }
    if(q.axis==='TX'){ towardA>0 ? add('Q') : add('M'); }
    if(q.axis==='FL'){ towardA>0 ? add('Salt') : add('Sauce'); }
    if(q.axis==='AF'){ towardA>0 ? add('Light') : add('Hearty'); }
  }
}

/* ==== ãƒšãƒ¼ã‚¸é·ç§» ==== */
document.getElementById('btn-next').addEventListener('click', ()=>{
  const btn = document.getElementById('btn-next');
  if(btn.classList.contains('disabled')) return;
  applyPage();
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});

/* ==== åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ ==== */
function strongEdge(axis){let e=0;for(const a of answers){if(a.axis!==axis)continue;if(a.valForA>=3)e++; else if(a.valForA<=-3)e--;}return e;}
function axisSeed(axis){let s=0;for(const a of answers){if(axis!=='ALL'&&a.axis!==axis)continue;s+=(a.id*31)+((a.uiVal+3)*13);}return s & 1;}
function decideAxis(A,B,AL,BL,relA,relB,strongAxis,seed){if(A>B)return AL;if(B>A)return BL;const wA=A+relA,wB=B+relB;if(wA>wB)return AL;if(wB>wA)return BL;const edge=strongEdge(strongAxis);if(edge>0)return AL;if(edge<0)return BL;return seed?BL:AL;}

function scoreHarami(c){ return 0.60*c.Sauce - 0.60*c.Salt + 0.30*c.Hearty - 0.30*c.Light + 0.20*c.M - 0.20*c.Q; }
function scoreMisuji(c){ return 0.70*c.M - 0.70*c.Q + 0.20*c.Salt - 0.20*c.Sauce + 0.10*c.Light - 0.10*c.Hearty; }
function scoreShinshin(c){ return 0.55*c.Q - 0.55*c.M + 0.25*c.Light - 0.25*c.Hearty + 0.20*c.Salt - 0.20*c.Sauce; }
function scoreKainomi(c){ return 0.60*c.Q - 0.60*c.M + 0.30*c.Salt - 0.30*c.Sauce + 0.10*c.Light - 0.10*c.Hearty; }
function pickSubtype(code,c){
  switch(code){
    case 'R-F-K': return 'ãƒ’ãƒ¬';
    case 'R-F-C': return (scoreHarami(c)>0 ? 'ãƒãƒ©ãƒŸ':'ã‚¿ãƒ³');
    case 'R-S-K': return (scoreMisuji(c)>0 ? 'ãƒŸã‚¹ã‚¸':'ã‚¤ãƒãƒœ');
    case 'R-S-C': return 'ãƒ©ãƒ³ãƒ—';
    case 'L-F-K': return (scoreShinshin(c)>0 ? 'ã‚·ãƒ³ã‚·ãƒ³':'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹');
    case 'L-F-C': return 'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³';
    case 'L-S-K': return 'ã‚¶ãƒ–ãƒˆãƒ³';
    case 'L-S-C': return (scoreKainomi(c)>0 ? 'ã‚«ã‚¤ãƒãƒŸ':'ã‚«ãƒ«ãƒ“');
    default: return 'ãƒ’ãƒ¬';
  }
}
function computeResult(){
  const R=counts.R,L=counts.L,F=counts.F,S=counts.S,K=counts.K,C=counts.C,Q=counts.Q,M=counts.M,Salt=counts.Salt,Sauce=counts.Sauce,Light=counts.Light,Hearty=counts.Hearty;
  const R_adj=(Q>=2?1:0)+(Salt>=2?1:0)+(Light>=2?1:0);
  const L_adj=(M>=2?1:0)+(Sauce>=2?1:0)+(Hearty>=2?1:0);
  const Rf=R+R_adj, Lf=L+L_adj;

  const RL=decideAxis(Rf,Lf,'R','L',0.60*Q+0.25*Salt+0.15*Light,0.60*M+0.25*Sauce+0.15*Hearty,'RL',axisSeed('RL'));
  const FS=decideAxis(F,S,'F','S',0.50*Light+0.30*Salt+0.20*Q,0.50*Hearty+0.30*Sauce+0.20*M,'FS',axisSeed('FS'));
  const KC=decideAxis(K,C,'K','C',0.45*Salt+0.25*Light+0.15*Q,0.45*Sauce+0.25*Hearty+0.15*M,'KC',axisSeed('KC'));

  const code=`${RL}-${FS}-${KC}`;
  let baseName=pickSubtype(code,{Q,M,Salt,Sauce,Light,Hearty});
  let name=baseName;

  // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼šã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ï¼ˆ2%å‰å¾Œï¼‰
  const dRL=Math.max(0,(RL==='R'?Rf-Lf:Lf-Rf));
  const dFS=Math.max(0,(FS==='F'?F-S:S-F));
  const dKC=Math.max(0,(KC==='K'?K-C:C-K));
  const isCB=(code==='R-F-K')&&(baseName==='ãƒ’ãƒ¬')&&(M>=2 && Salt>=2 && Light>=2)&&(dRL>=1.3 && dFS>=1.1 && dKC>=1.0)&&(strongEdge('RL')>0)&&(axisSeed('ALL')===1);
  if(isCB) name='ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³';

  const tagTexture=(Q>=M)?'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘';
  const tagFlavor =(Salt>=Sauce)?'å¡©æ´¾':'ã‚½ãƒ¼ã‚¹æ´¾';
  const tagAfter  =(Light>=Hearty)?'è»½ã‚„ã‹':'æº€è¶³';

  return {code,baseName,name,R_base:R,L_base:L,F,S,K,C,Q,M,Salt,Sauce,Light,Hearty,R_adj,L_adj,Rf,Lf,tagTexture,tagFlavor,tagAfter};
}

/* ç›¸æ€§å€™è£œç”Ÿæˆ */
function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allTypeCodes(){return Object.keys(CODE_REPR);}
function bestMatch(code){
  const mine=parseCode(code);let best=null,bestScore=-1;
  for(const t of allTypeCodes()){
    if(t===code) continue;
    const other=parseCode(t);
    let opp=0,same=0;
    if(other.RL===OPP[mine.RL])opp++;
    if(other.FS===OPP[mine.FS])opp++;
    if(other.KC===OPP[mine.KC])opp++;
    if(other.RL===mine.RL)same++;
    if(other.FS===mine.FS)same++;
    if(other.KC===mine.KC)same++;
    const score=(opp>=2)?opp*10:(opp*10+same);
    if(score>bestScore){bestScore=score;best=t;}
  }
  return best;
}

/* ==== çµæœè¡¨ç¤º ==== */
function showResult(){
  el('bar').style.width='100%';
  const r=computeResult(); showScreen('result');
  el('r-type-name').textContent=r.name;
  el('r-type-code').textContent=r.code;
  el('tag-texture').textContent=r.tagTexture;
  el('tag-flavor').textContent=r.tagFlavor;
  el('tag-after').textContent=r.tagAfter;
  el('r-desc').textContent=DESCRIPTIONS[r.name]||'';
  const bm=bestMatch(r.code); const repr=CODE_REPR[bm]||bm;
  el('r-best').textContent=bm?`${repr}ï¼ˆ${bm}ï¼‰`:'â€”';

  // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  const payload={type:{baseCode:r.code,baseName:r.baseName,displayName:r.name},tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},counts:{R:r.R_base,L:r.L_base,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M,Salt:r.Salt,Sauce:r.Sauce,Light:r.Light,Hearty:r.Hearty},answers,generatedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=el('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

/* Start / Retry */
addEventListener('click',(ev)=>{ const t=ev.target.closest('#btn-start,#btn-start-2'); if(!t) return; ev.preventDefault(); start(); });
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',()=>{showScreen('start')});
</script>
</body>
</html>
