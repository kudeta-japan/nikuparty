<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEAT-BTI v6.3ï½œ5æŠÃ—12ã‚¿ã‚¤ãƒ—è¨ºæ–­ï¼ˆå‘³9ï¼‹ã‚·ãƒ¼ãƒ³9ï¼‰</title>
  <meta name="description" content="18å•Ã—15ç§’ã€‚5æ®µéšãƒªãƒƒã‚«ãƒ¼ãƒˆï¼‹ç„¡ä½œç‚ºé †ãƒ»å·¦å³å…¥æ›¿ãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã€‚12ã‚¿ã‚¤ãƒ—åˆ¤å®šï¼ˆãƒ’ãƒ¬/ã‚µãƒ¼ãƒ­ã‚¤ãƒ³/ãƒªãƒ–ãƒ­ãƒ¼ã‚¹/ã‚¶ãƒ–ãƒˆãƒ³/ãƒ©ãƒ³ãƒ—/ã‚¤ãƒãƒœ/ã‚¿ãƒ³/ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³/ãƒãƒ©ãƒŸ/ã‚«ãƒ«ãƒ“/è‚©ãƒ­ãƒ¼ã‚¹/ãƒŸã‚¹ã‚¸ï¼‰ã¨ç›¸æ€§No.1ã‚’è¡¨ç¤ºã€‚å‘³ã®å—œå¥½9å•ï¼‹é£Ÿã¹ã‚‹ã‚·ãƒ¼ãƒ³9å•ã€‚"/>

  <!-- GA4ï¼ˆã‚µã‚¤ãƒˆå…±é€šï¼šG-V39MNGQD5Hï¼‰ -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V39MNGQD5H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-V39MNGQD5H');
  </script>

  <style>
    :root{
      --bg:#0b0c10; --panel:#101218; --ink:#f4f7fb; --muted:#b6c0cf;
      --acc:#ff6b57; --acc2:#ffd166; --bd:#1c1f27; --shadow:0 10px 30px rgba(0,0,0,.35);
      --good:#35d19d; --warn:#ffd166; --bad:#ff476f; --blue:#59b3ff;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
    .app{width:min(960px,100%);margin:0 auto;padding:24px}
    .card{background:var(--panel);border:1px solid var(--bd);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--bd)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111;font-weight:900}
    .title{font-weight:900}
    .wrap{padding:16px}

    /* ---- QUIZ ---- */
    .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .q-index{font-weight:900}
    .timer{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--acc2);box-shadow:0 0 0 6px rgba(255,209,102,.1)}
    .sec{font-family:ui-monospace,Menlo,Consolas,monospace}
    .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}

    /* Readability-up */
    .q-main{margin-top:12px}
    .q-title{font-size:clamp(18px,3.6vw,24px);font-weight:900;text-align:center;margin:0;color:var(--ink)}
    .ab{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px;align-items:stretch}
    .side{background:#121726;border:1px solid #2a3140;border-radius:16px;padding:14px;min-height:84px;display:flex;align-items:center;justify-content:center;text-align:center}
    .side b{font-size:clamp(15px,2.8vw,18px)}
    .side small{display:block;color:var(--muted);margin-top:6px}
    .ab.glow-left .left{border-color:var(--blue);box-shadow:0 0 0 3px rgba(89,179,255,.15) inset}
    .ab.glow-right .right{border-color:var(--acc);box-shadow:0 0 0 3px rgba(255,107,87,.12) inset}

    .opt5{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:10px}
    .opt5 .opt{background:#151a27;border:1px solid #2a3140;border-radius:12px;padding:14px 10px;font-size:clamp(13px,2.2vw,15px);line-height:1.3;cursor:pointer;transition:transform .05s ease,border-color .12s ease,background .12s ease;color:var(--ink)}
    .opt5 .opt:hover{transform:translateY(-1px);border-color:#364158;background:#182033}
    .opt5 .opt.l{border-left:3px solid var(--blue)}
    .opt5 .opt.r{border-right:3px solid var(--acc)}
    @media (max-width:560px){.opt5{grid-template-columns:1fr 1fr;grid-auto-rows:minmax(46px,auto)}}
    .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

    /* ---- RESULT ---- */
    .result{display:grid;gap:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
    .big{font-size:clamp(26px,6vw,34px);font-weight:900}
    .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--bd);margin-right:6px}
    .desc{margin-top:10px;line-height:1.9}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .btn{appearance:none;border:1px solid var(--bd);background:#141721;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 10px 24px rgba(255,107,87,.35)}
    footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}

    .meter{height:10px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden}
    .meter>div{height:100%;width:0%;background:linear-gradient(90deg,var(--good),var(--warn))}
    .hint{color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <main class="app">
    <div class="card">
      <header>
        <div class="brand"><div class="logo">ğŸ¥©</div><div class="title">MEAT-BTI v6.3ï¼ˆèª­ã¿ã‚„ã™ã•UPï¼‹Startä¿®æ­£ï¼‰</div></div>
        <button id="btn-start" class="btn primary" data-action="start">è¨ºæ–­ã™ã‚‹</button>
      </header>
      <div class="wrap" id="stage">
        <!-- START -->
        <section id="screen-start">
          <h2 style="margin:0 0 6px">ã‚ãªãŸã¯ã©ã®â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ï¼Ÿ</h2>
          <p style="color:var(--muted);margin:0 0 12px">18å•ï¼1å•15ç§’ã€‚<strong>5æ®µéš</strong>ã§å›ç­”ã€‚<strong>ç„¡ä½œç‚ºé †ãƒ»å·¦å³å…¥æ›¿</strong>ã§ãƒã‚¤ã‚¢ã‚¹ã‚’ä½æ¸›ã€‚å·¦å³ã®æ–‡ç« ã‚’<strong>å¤§ããªã‚«ãƒ¼ãƒ‰</strong>ã§è¡¨ç¤ºã—ã€åˆ¤æ–­ã—ã‚„ã™ãã—ã¾ã—ãŸã€‚</p>
          <div><button class="btn primary" id="btn-start-2" data-action="start">è¨ºæ–­ã™ã‚‹</button></div>
        </section>

        <!-- QUIZ -->
        <section id="screen-quiz" hidden>
          <div class="q-head">
            <div class="q-index"><span id="q-counter">1</span>/<span id="q-total">18</span></div>
            <div class="timer"><div class="dot"></div><div class="sec"><span id="sec">15</span>s</div></div>
          </div>
          <div class="bar"><div id="bar"></div></div>

          <div class="q-main">
            <p class="q-title" id="q-title">ã‚ãªãŸã¯ã©ã¡ã‚‰ã«è¿‘ã„ï¼Ÿ</p>
            <div class="ab" id="ab">
              <div class="side left" id="ab-left"><b>â€”</b><small>â† å·¦å¯„ã‚Š</small></div>
              <div class="side right" id="ab-right"><b>â€”</b><small>å³å¯„ã‚Š â†’</small></div>
            </div>
            <div class="opt5">
              <button class="opt l" id="btn-1" data-val="2">â¬… å¼·ãå·¦</button>
              <button class="opt l" id="btn-2" data-val="1">â¬… ã‚„ã‚„å·¦</button>
              <button class="opt" id="btn-3" data-val="0">ã©ã¡ã‚‰ã§ã‚‚ãªã„</button>
              <button class="opt r" id="btn-4" data-val="-1">ã‚„ã‚„å³ â¡</button>
              <button class="opt r" id="btn-5" data-val="-2">å¼·ãå³ â¡</button>
            </div>
          </div>
          <div class="progress-note">â€»æœªå›ç­”ã¯15ç§’ã§è‡ªå‹•ã€Œã©ã¡ã‚‰ã§ã‚‚ãªã„ã€ã€‚ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ <b>1â€“5</b> ã§ã‚‚é¸ã¹ã¾ã™ã€‚</div>
        </section>

        <!-- RESULT -->
        <section id="screen-result" hidden>
          <div class="result">
            <div class="big" id="r-title">è¨ºæ–­çµæœ</div>
            <div class="grid">
              <div class="r-card">
                <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
                <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
                <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
                <div style="margin-top:10px"><span class="pill" id="tag-texture">å™›ã¿å¿œãˆ</span><span class="pill" id="tag-flavor">å¡©æ´¾</span><span class="pill" id="tag-after">è»½ã‚„ã‹</span></div>
                <p class="desc" id="r-desc"></p>
              </div>
              <div class="r-card">
                <div><strong>ç›¸æ€§No.1</strong></div>
                <div id="r-best" class="mono" style="margin-top:6px"></div>
              </div>
            </div>

            <div class="r-card">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                <strong>ä¿¡é ¼åº¦</strong>
                <button class="btn" id="btn-copy">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
              </div>
              <div style="display:grid;gap:8px;margin-top:8px">
                <div>ç·åˆï¼š<span id="conf-overall-text">â€”</span>
                  <div class="meter"><div id="conf-overall" style="width:0%"></div></div>
                </div>
                <div>R/Lï¼š<span id="conf-rl-text">â€”</span>
                  <div class="meter"><div id="conf-rl" style="width:0%"></div></div>
                </div>
                <div>F/Sï¼š<span id="conf-fs-text">â€”</span>
                  <div class="meter"><div id="conf-fs" style="width:0%"></div></div>
                </div>
                <div>K/Cï¼š<span id="conf-kc-text">â€”</span>
                  <div class="meter"><div id="conf-kc" style="width:0%"></div></div>
                </div>
                <div class="hint" id="quality-hints"></div>
              </div>
            </div>

            <div class="r-card">
              <strong>è©³ç´°ï¼ˆé›†è¨ˆå€¤ï¼‰</strong>
              <pre class="mono" id="r-detail" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
            </div>
            <div style="display:flex;justify-content:space-between;gap:10px">
              <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
              <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
            </div>
          </div>
        </section>
      </div>
      <footer>Â© KU-DETA / ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” MEAT-BTI v6.3</footer>
    </div>
  </main>

<script>
/* --------------- Question Bankï¼ˆå‘³9ï¼‹ã‚·ãƒ¼ãƒ³9ï¼‰ --------------- */
const BANK = [
  // â”€â”€ å‘³ã®å—œå¥½ï¼ˆ9å•ï¼‰â”€â”€
  // RLï¼ˆA=R=è»½ã‚/ã•ã£ã±ã‚Šã€B=L=ã‚³ã‚¯/æº€è¶³ï¼‰
  {id:1,  axis:"RL", a:"è„‚å°‘ãªã‚ã§èµ¤èº«ã®æ—¨ã¿ã‚’å‘³ã‚ã„ãŸã„", b:"ã‚µã‚·ã®å…¥ã£ãŸã‚³ã‚¯ã§æº€è¶³ã—ãŸã„"},
  {id:2,  axis:"RL", a:"é£Ÿå¾Œã¯è»½ã‚„ã‹ã«çµ‚ãˆãŸã„",           b:"ã—ã£ã‹ã‚Šæº€è…¹ãƒ»ä½™éŸ»ã‚’æ¥½ã—ã¿ãŸã„"},
  {id:3,  axis:"RL", a:"å‘³ã¯ã‚­ãƒ¬é‡è¦–ï¼ˆã•ã£ã±ã‚Šï¼‰",         b:"å‘³ã¯ã‚³ã‚¯é‡è¦–ï¼ˆæ¿ƒåšï¼‰"},
  {id:4,  axis:"RL", a:"ãƒ’ãƒ¬ã‚„ã‚¿ãƒ³ã«æƒ¹ã‹ã‚Œã‚‹",             b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ã‚„ã‚«ãƒ«ãƒ“ã«æƒ¹ã‹ã‚Œã‚‹"},
  // TXï¼ˆA=Q=å™›ã¿å¿œãˆã€B=M=ã¨ã‚ã‘ï¼‰
  {id:5,  axis:"TX", a:"æ­¯åˆ‡ã‚Œã‚ˆãå™›ã‚€ã»ã©æ—¨ã„é£Ÿæ„ŸãŒå¥½ã", b:"ã¨ã‚ã‘ã‚‹æŸ”ã‚‰ã‹ã•ãŒå¥½ã"},
  {id:6,  axis:"TX", a:"è–„åˆ‡ã‚Šãƒ»ãƒ¬ã‚¢å¯„ã‚ŠãŒå¥½ã¿",           b:"åšåˆ‡ã‚Šãƒ»ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã€œã‚¦ã‚§ãƒ«ãŒå®‰å¿ƒ"},
  {id:7,  axis:"TX", a:"ç«ã¯é€šã—ã™ããšã‚µãƒƒã¨",             b:"ã—ã£ã‹ã‚Šç«å…¥ã‚Œã—ã¦è½ã¡ç€ã‹ã›ãŸã„"},
  // FLï¼ˆA=Saltã€B=Sauceï¼‰
  {id:8,  axis:"FL", a:"ãƒ¬ãƒ¢ãƒ³ãƒ»å¡©ãƒ»ã‚ã•ã³ãªã©ã‚·ãƒ³ãƒ—ãƒ«æ´¾", b:"ç”˜è¾›ãƒ€ãƒ¬/ã‚¬ãƒªãƒã‚¿/ãƒãƒ¼ã‚ºãªã©ã‚½ãƒ¼ã‚¹æ´¾"},
  {id:9,  axis:"FL", a:"è‚‰æœ¬æ¥ã®é¦™ã‚Šã‚’æ´»ã‹ã—ãŸã„",         b:"ã‚½ãƒ¼ã‚¹ã®é¦™ã‚Šã‚„æ¼”å‡ºã§ç››ã‚Šä¸Šã’ãŸã„"},

  // â”€â”€ é£Ÿã¹ã‚‹â€œã‚·ãƒ¼ãƒ³â€ã®æŒ¯ã‚‹èˆã„ï¼ˆ9å•ï¼‰â”€â”€
  // FSï¼ˆA=F=ãƒ†ãƒ³ãƒè‰¯ãã€B=S=ã˜ã£ãã‚Šï¼‰
  {id:10, axis:"FS", a:"å¼·ç«ã§ã‚µãƒƒã¨ç„¼ã„ã¦å›è»¢è‰¯ãé£Ÿã¹ãŸã„", b:"å¼±ã€œä¸­ç«ã§ã˜ã£ãã‚Šè‚²ã¦ã¦é£Ÿã¹ãŸã„"},
  {id:11, axis:"FS", a:"æ–™ç†ã¯ãƒ†ãƒ³ãƒè‰¯ãæ¬¡ã€…å‡ºã¦ãã‚‹ã¨å¬‰ã—ã„", b:"ã‚³ãƒ¼ã‚¹ã§ã‚†ã£ãã‚Šå‡ºã¦ãã‚‹æ–¹ãŒå¬‰ã—ã„"},
  {id:12, axis:"FS", a:"æ··ã‚“ã§ã„ãŸã‚‰æ¬¡ã®åº—ã¸ç§»ã‚‹ã‚¿ã‚¤ãƒ—",     b:"å¸­ãŒæ°—ã«å…¥ã‚Œã°ä¸€è»’ã§è…°ã‚’æ®ãˆã‚‹"},
  // KCï¼ˆA=K=å®šç•ª/è¦ç¯„ã€B=C=æ–°å¥‡/æ¼”å‡ºï¼‰
  {id:13, axis:"KC", a:"ã¾ãšã¯å®šç•ªã®å¡©ã‚¿ãƒ³ãƒ»ç‹é“ã‚«ãƒƒãƒˆã‹ã‚‰",   b:"ãã®åº—ã®é™å®š/å¤‰ã‚ã‚Šç¨®ã‚’å…ˆã«è©¦ã—ãŸã„"},
  {id:14, axis:"KC", a:"æ³¨æ–‡ã¯æœ€åˆã«ã¾ã¨ã‚ã¦æ®µå–ã‚Šè‰¯ã",       b:"æ§˜å­ã‚’è¦‹ãªãŒã‚‰ãã®éƒ½åº¦è¿½åŠ ã—ãŸã„"},
  {id:15, axis:"KC", a:"é£Ÿã¹æ–¹ã‚„ãƒãƒŠãƒ¼ã¯ãã£ã¡ã‚Šå®ˆã‚ŠãŸã„",     b:"å‹ã«ç¸›ã‚‰ã‚Œãšæ¥½ã—ãé£Ÿã¹ã‚‰ã‚Œã‚Œã°OK"},
  // AFï¼ˆA=Light=ä½™ç™½ã€B=Hearty=å®Œçµï¼‰
  {id:16, axis:"AF", a:"ã€†ã¯ãªã—/ã‚¹ãƒ¼ãƒ—ç¨‹åº¦ã§ååˆ†",            b:"ã€†ã¯ã”é£¯ãƒ»å†·éººãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆã¾ã§ã—ã£ã‹ã‚Š"},
  {id:17, axis:"AF", a:"ãƒ‰ãƒªãƒ³ã‚¯ã¯ãƒã‚¤ãƒœãƒ¼ãƒ«/ã™ã£ãã‚Šç³»",      b:"ç”˜ã‚ã‚«ã‚¯ãƒ†ãƒ«ã‚„æ¿ƒã„ãƒ‰ãƒªãƒ³ã‚¯ã‚‚æ¬²ã—ã„"},
  {id:18, axis:"AF", a:"é£Ÿå¾Œã¯äºŒè»’ç›®ã§è»½ãç¶šã‘ãŸã„",            b:"ã“ã®åº—ã§å®Œçµã—ã¦æº€è…¹ã§ç· ã‚ãŸã„"}
];

function decorateBankRandomly(bank){return bank.map(q=>({...q,flip:Math.random()<0.5}));}
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};

/* --- 12 types --- */
const TYPE_NAMES={
  "R-F-K":"ãƒ’ãƒ¬",
  "R-F-C":"ã‚¿ãƒ³",
  "R-S-K":"ã‚¤ãƒãƒœ",
  "R-S-C":"ãƒ©ãƒ³ãƒ—",
  "L-F-K":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹",
  "L-F-C":"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³",
  "L-S-K":"ã‚¶ãƒ–ãƒˆãƒ³",
  "L-S-C":"ã‚«ãƒ«ãƒ“"
};

const DESCRIPTIONS={
  "ãƒ’ãƒ¬":"ç„¡é§„ã®ãªã„ä¸Šå“ã•ã¨èŠ¯ã®å¼·ã•ãŒå…±å­˜ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚æƒ…å ±ã‚’æ•´ç†ã—ã€çµè«–ã‚’ã™ã£ãã‚Šå‡ºã™ã®ãŒå¾—æ„ã€‚å‘³ã‚ã„ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ã€ç´ æå‹è² ã®ä¸€çš¿ã‚’å¥½ã¿ã¾ã™ã€‚ä¼šè©±ã§ã‚‚ç›¸æ‰‹ã®è©±ã‚’ä¸å¯§ã«æ‹¾ã„ã€ä½™ç™½ã‚’æ´»ã‹ã—ã¦æ·±ã‚ã‚‹ã®ãŒä¸Šæ‰‹ã€‚å ´ã‚’é¨’ãŒã›ã‚‹ã‚ˆã‚Šã€é™ã‹ã«è³ªã‚’ä¸Šã’ã‚‹è²¢çŒ®ãŒå¾—æ„ã§ã™ã€‚åˆå¯¾é¢ã§ã¯è³ªå•ã‚’ä¸€ã¤ãšã¤æŠ•ã’ã€å…±é€šç‚¹ãŒè¦‹ã¤ã‹ã‚‹ã¨ä¸€æ°—ã«è·é›¢ãŒç¸®ã¿ã¾ã™ã€‚",
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"è¯ã‚„ãã¨ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ã§å ´ã‚’ç››ã‚Šä¸Šã’ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚å†™çœŸæ˜ ãˆã‚„â€œç‰¹è£½ã‚½ãƒ¼ã‚¹â€ã®ã‚ˆã†ãªã‚¢ã‚¯ã‚»ãƒ³ãƒˆã«å¿ƒãŒèºã‚Šã¾ã™ã€‚äººã®è‰¯ã•ã«æ•æ„Ÿã§ã€ç›¸æ‰‹ã®å¥½ã¿ã‚’ç´ æ—©ãã‚­ãƒ£ãƒƒãƒã—ã¦åˆã‚ã›ã‚‰ã‚Œã‚‹å™¨ç”¨ã•ã‚‚ã€‚ä¼šè©±ã¯ãƒ†ãƒ³ãƒè‰¯ãã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å¤§ãã‚ã€‚åˆå¯¾é¢ã®è¼ªã‚’åºƒã’ã‚‹ã®ãŒå¾—æ„ã§ã€äºŒæ¬¡ä¼šã®å¹¹äº‹å½¹ã«ã‚‚å‘ã„ã¦ã„ã¾ã™ã€‚",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"ç‹é“ãƒªãƒƒãƒæ´¾ã€‚åšã¿ã®ã‚ã‚‹æ—¨ã¿ã¨å®‰å¿ƒæ„Ÿã‚’æ„›ã™ã‚‹ã€é ¼ã‚Œã‚‹è»¸ã®æŒã¡ä¸»ã§ã™ã€‚æ±ºæ–­ãŒæ—©ãã€æ®µå–ã‚Šã‚’æ•´ãˆã¦ã¿ã‚“ãªã‚’å°ãã®ãŒå¾—æ„ã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šã‚‚æº€è¶³åº¦ã‚’é‡è¦–ã—ã€ä¼šè©±ã¯è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã§èãå½¹ã«ã‚‚å›ã‚Œã¾ã™ã€‚åˆå¯¾é¢ã§ã¯å…±é€šã®â€œå¥½ãâ€ã‚’è¦‹ã¤ã‘ã¦ã‹ã‚‰æ·±æ˜ã‚Šã™ã‚‹ã®ãŒã‚³ãƒ„ã€‚é•·ãä»˜ãåˆãˆã‚‹é–¢ä¿‚ã‚’ç¯‰ãã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã€‚",
  "ã‚¶ãƒ–ãƒˆãƒ³":"ã—ã£ã¨ã‚Šæ¿ƒåšã€å™›ã‚€ã»ã©ã«åºƒãŒã‚‹ã‚³ã‚¯ã‚’æ„›ã™ã‚‹å¯©ç¾çœ¼ã®æŒã¡ä¸»ã€‚ã“ã ã‚ã‚Šã¯å¼·ã„ãŒæŠ¼ã—ä»˜ã‘ãšã€ä¸å¯§ã«è¨€è‘‰ã‚’é¸ã³ã¾ã™ã€‚å¤§äººæ•°ã‚ˆã‚Šå°‘äººæ•°ã§ã˜ã£ãã‚Šè©±ã™ã®ãŒå¥½ãã€‚ç›¸æ‰‹ã®è‰¯ã•ã‚’è¦‹ã¤ã‘ã¦é™ã‹ã«å¼•ãå‡ºã™èãä¸Šæ‰‹ã§ã™ã€‚ä¼šè©±ã®ã‚³ãƒ„ã¯â€œãªãœãã‚ŒãŒå¥½ãã‹â€ã®ç†ç”±äº¤æ›ã€‚ä¸å¯§ã•ã‚„èª å®Ÿã•ã«æƒ¹ã‹ã‚Œã‚‹å¤§äººã®ç›¸æ€§ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚",
  "ãƒ©ãƒ³ãƒ—":"æ¢ç©¶å¿ƒã¨æŸ”è»Ÿã•ã‚’å…¼ã­å‚™ãˆãŸå®Ÿé¨“å¥½ãã€‚ä½æ¸©ã‚„å‰µä½œã®ã‚ˆã†ã«ã€å®šç•ªã‚’ä¸€æ­©æ›´æ–°ã™ã‚‹å·¥å¤«ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¾ã™ã€‚ç‰©é™ã‹ã§ã‚‚ä¸­èº«ã¯ç†±ã„è·äººæ°—è³ªã§ã€è©±ã—å‡ºã™ã¨æ·±ã„çŸ¥è­˜ãŒã“ã¼ã‚Œã¾ã™ã€‚åˆå¯¾é¢ã§ã¯è©¦é£Ÿã‚„å°ã•ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹ã¨ä¼šè©±ãŒå¼¾ã¿ã‚„ã™ã„ã€‚ç›¸æ‰‹ã®â€œæ–°ã—ã„ç™ºè¦‹â€ã‚’å–œã¹ã‚‹äººã¨ç›¸æ€§è‰¯å¥½ã§ã™ã€‚",
  "ã‚¤ãƒãƒœ":"èµ¤èº«ã®æ—¨ã¿ã‚’ä¸å¯§ã«å‘³ã‚ã†ã€èª¿å’Œå‹ã®é€šå¥½ã¿ã€‚æ§ãˆã‚ãªãŒã‚‰èŠ¯ãŒã‚ã‚Šã€ç©ºæ°—ã‚’èª­ã¿ã¤ã¤ã‚‚è¦æ‰€ã§ã—ã£ã‹ã‚Šæ„è¦‹ã‚’è¨€ãˆã¾ã™ã€‚æ´¾æ‰‹ã•ã¯ãªã„ãŒã€ã‚ã¨ã‹ã‚‰åŠ¹ã„ã¦ãã‚‹ä½™éŸ»ã‚¿ã‚¤ãƒ—ã€‚ä¼šè©±ã¯ç›¸æ‰‹ã®è©±ã‚’å—ã‘ã¦ä¸€æ­©æ·±ã‚ã‚‹ã®ãŒå¾—æ„ã§ã€ä¾¡å€¤è¦³ã®è¿‘ã„ç›¸æ‰‹ã¨é•·æœŸçš„ãªé–¢ä¿‚ã‚’ç¯‰ãã‚„ã™ã„ã€‚æ°—ã¥ã‘ã°â€œã‚‚ã£ã¨è©±ã—ãŸã„äººâ€ã«ãªã£ã¦ã„ã¾ã™ã€‚",
  "ã‚¿ãƒ³":"ã•ã£ã±ã‚Šå¡©ã§ã‚­ãƒ¬è‰¯ãã€‚ãƒ†ãƒ³ãƒã®è‰¯ã•ã¨æ˜ã‚‹ã•ã§å‘¨å›²ã‚’ã»ãã™ãƒ ãƒ¼ãƒ‰ãƒ¡ã‚¤ã‚¯ãŒå¾—æ„ã€‚ç›´æ„ŸãŒåˆ©ãã€åˆ¤æ–­ã‚‚ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ã€‚ä¼šè©±ã¯çŸ­ã„ã‚­ãƒ£ãƒƒãƒãƒœãƒ¼ãƒ«ã‚’é‡ã­ã‚‹ã®ãŒä¸Šæ‰‹ã§ã€ä¹¾æ¯ã®å·ä»¤ã‚„å ´ã®ã‚¹ã‚¤ãƒƒãƒå½¹ã«å‘ã„ã¦ã„ã¾ã™ã€‚æ·±æ˜ã‚Šã¯äºŒå·¡ç›®ã«ã‚†ã£ãã‚Šã€‚â€œã¾ãšã¯ã‚„ã£ã¦ã¿ã‚‹â€ç²¾ç¥ã§ã€æ–°ã—ã„äººã¨ã‚‚ã™ãè·é›¢ã‚’ç¸®ã‚ã‚‰ã‚Œã¾ã™ã€‚",
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"ç¹Šç´°ã•ã¨é›†ä¸­åŠ›ã€ãã—ã¦è³ªã¸ã®å¼·ã„ã“ã ã‚ã‚Šã‚’å‚™ãˆãŸâ€œç‰¹é¸ãƒ’ãƒ¬â€æ°—è³ªã€‚é‡ã‚ˆã‚Šè³ªã€æ´¾æ‰‹ã•ã‚ˆã‚Šå®Œæˆåº¦ã‚’é‡ã‚“ã˜ã€ç›¸æ‰‹ã«ã‚‚èª å®Ÿã•ã¨ä¸å¯§ã•ã‚’æ±‚ã‚ã¾ã™ã€‚ä¼šè©±ã¯è½ã¡ç€ã„ã¦ã„ã¦ã€çš„ç¢ºãªä¸€è¨€ã§å°è±¡ã‚’æ®‹ã™ã‚¿ã‚¤ãƒ—ã€‚æ€¥ãŒãšæ·±ãã€å°‘äººæ•°ã§ã˜ã£ãã‚Šå‘ãåˆã†ã¨ç›¸æ€§ãŒèŠ±é–‹ãã¾ã™ã€‚å¸Œå°‘ã‚†ãˆã«å‡ºä¼šãˆãŸã‚‰å¤§åˆ‡ã«ã—ãŸã„å­˜åœ¨ã€‚",
  "ãƒãƒ©ãƒŸ":"é¦™ã°ã—ã„ç‚­ç«ã¨ç”˜è¾›ãƒ€ãƒ¬ãŒä¼¼åˆã†ã€èºå‹•æ„Ÿã®ã‚ã‚‹èµ¤èº«æ´¾ã€‚æ­¯ã”ãŸãˆã‚’æ¥½ã—ã¿ã¤ã¤ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ã•ã‚‚è­²ã‚‰ãªã„å®Ÿåˆ©ã‚¿ã‚¤ãƒ—ã§ã™ã€‚ä¼šè©±ã‚‚ãƒ†ãƒ³ãƒè‰¯ãã€ç›¸æ‰‹ã®ãƒãƒªã«åˆã‚ã›ã¦å ´ã‚’ã‚ãŸãŸã‚ã‚‹ã®ãŒå¾—æ„ã€‚é›£ã—ã„ç†å±ˆã‚ˆã‚Šâ€œã†ã¾ã„ãƒ»ãŸã®ã—ã„â€ã‚’å…±æœ‰ã—ãŸã„äººã€‚æ´»æ°—ã®ã‚ã‚‹åº—ã§è‡ªç„¶ã¨è·é›¢ãŒç¸®ã‚€ã€‚ç›´çƒã«ãªã‚Šéãã‚‹æ™‚ã¯ä¸€å‘¼å¸ç½®ãã¨ã•ã‚‰ã«å¥½å°è±¡ã€‚",
  "ã‚«ãƒ«ãƒ“":"æ¿ƒåšã§ç”˜è¾›ã®æ—¨ã¿ã‚’æ„›ã™ã‚‹ãƒªãƒƒãƒæ´¾ã€‚ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ãŒã‚ã‚Šã€äººã‚’å·»ãè¾¼ã‚€ã®ãŒä¸Šæ‰‹ã€‚å†™çœŸæ˜ ãˆã‚„ã”è¤’ç¾æ„Ÿã®ã‚ã‚‹ä½“é¨“ã«å¼±ãã€ã¿ã‚“ãªã§ãƒ¯ã‚¤ãƒ¯ã‚¤ç››ã‚Šä¸ŠãŒã‚‹å¤œãŒä¼¼åˆã„ã¾ã™ã€‚ä¼šè©±ã¯æ˜ã‚‹ããƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚è±Šã‹ã€‚ç›¸æ‰‹ã®â€œå¥½ãâ€ã‚’è¦‹ã¤ã‘ã¦è¤’ã‚ã‚‹ã®ãŒå¾—æ„ã§ã™ã€‚é‡ããªã‚Šéããªã„ã‚ˆã†ã€æ™‚ã«èŒ¶ç›®ã£æ°—ã‚„å°ä¼‘æ­¢ã‚’æŒŸã‚ã‚‹ã¨ãƒãƒ©ãƒ³ã‚¹è‰¯å¥½ã€‚",
  "è‚©ãƒ­ãƒ¼ã‚¹":"ã»ã©ã‚ˆã„è„‚ã¨ã—ã£ã‹ã‚Šã—ãŸç¹Šç¶­æ„Ÿã€‚ãƒãƒ©ãƒ³ã‚¹é‡è¦–ã§ã€æ™®æ®µä½¿ã„ã‹ã‚‰å°‘ã—ç‰¹åˆ¥ã¾ã§å®ˆå‚™ç¯„å›²ãŒåºƒã„å …å®Ÿæ´¾ã§ã™ã€‚æ®µå–ã‚ŠãŒå¾—æ„ã§ã€åˆå¯¾é¢ã§ã‚‚è½ã¡ç€ã„ã¦ç›¸æ‰‹ã‚’æ°—é£ãˆã‚‹äººã€‚ä¼šè©±ã¯ä¸å¯§ã«èãã€å¿…è¦ãªæ™‚ã«è¦ç‚¹ã‚’ã¾ã¨ã‚ã‚‰ã‚Œã¾ã™ã€‚èƒŒä¼¸ã³ã—éããšâ€œã¡ã‚‡ã†ã©ã„ã„è´…æ²¢â€ã‚’é¸ã¹ã‚‹ã‚»ãƒ³ã‚¹ãŒé­…åŠ›ã€‚æŠ¼ã—ä»˜ã‘ãšã«ææ¡ˆã§ãã‚‹ã¨ç›¸æ‰‹ã‹ã‚‰ã®ä¿¡é ¼ãŒé«˜ã¾ã‚Šã¾ã™ã€‚",
  "ãƒŸã‚¹ã‚¸":"ç¹Šç´°ãªã‚µã‚·ãŒå…¥ã‚Šã¤ã¤è»½ã‚„ã‹ã€‚ã‚„ã•ã—ã„å£ã©ã‘ã¨ä¸Šå“ãªé¦™ã‚Šã‚’å¥½ã‚€ã€å¯©ç¾çœ¼ã¨ä¸å¯§ã•ã®äººã€‚éŸ³ã‚„æ¸©åº¦ã€è¡¨æƒ…ãªã©ç´°éƒ¨ã«æ°—ã¥ã‘ã‚‹ã‚¿ã‚¤ãƒ—ã§ã€å°‘äººæ•°ã§ã˜ã£ãã‚Šè©±ã™ã¨é­…åŠ›ãŒèŠ±é–‹ãã¾ã™ã€‚ä¼šè©±ã¯ç©ã‚„ã‹ã ãŒèŠ¯ãŒã‚ã‚Šã€çš„ç¢ºãªä¸€è¨€ã§å°è±¡ã‚’æ®‹ã™ã“ã¨ã‚‚ã€‚éåº¦ãªåˆºæ¿€ã‚ˆã‚Šè³ªã®è‰¯ã„ä½“é¨“ã‚’å¤§åˆ‡ã«ã€‚èª å®Ÿã§ç¤¼å„€æ­£ã—ã„ç›¸æ‰‹ã¨ç›¸æ€§è‰¯å¥½ã§ã™ã€‚"
};

/* --------------- State --------------- */
let current=0; let timer=null; let tLeft=15; let qStartAt=0; const total=BANK.length;
let QUESTIONS=[];
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0};
const answers=[]; const rtimes=[]; const rl_items=[]; const fs_items=[]; const kc_items=[];
const el=id=>document.getElementById(id);
const screenStart=el('screen-start'), screenQuiz=el('screen-quiz'), screenResult=el('screen-result');

function showScreen(which){screenStart.hidden=which!=='start';screenQuiz.hidden=which!=='quiz';screenResult.hidden=which!=='result';}
function resetAll(){stopTimer();tLeft=15;el('sec').textContent='15';el('bar').style.width='0%';Object.keys(counts).forEach(k=>counts[k]=0);answers.length=0;rtimes.length=0;rl_items.length=0;fs_items.length=0;kc_items.length=0;current=0;showScreen('start');}
function start(){
  resetAll();
  // GA: è¨ºæ–­é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆ
  window.gtag && gtag('event','diagnostic_start',{from:'meat-bti'});
  QUESTIONS=decorateBankRandomly([...BANK]).sort(()=>Math.random()-0.5);
  showScreen('quiz');
  el('q-total').textContent=QUESTIONS.length;
  current=0;renderQ();startTimer();}

function renderQ(){
  const q=QUESTIONS[current];
  el('q-counter').textContent=current+1;
  el('q-title').textContent='ã‚ãªãŸã¯ã©ã¡ã‚‰ã«è¿‘ã„ï¼Ÿ';
  const left=q.flip?q.b:q.a; const right=q.flip?q.a:q.b;
  el('ab-left').querySelector('b').textContent=left;
  el('ab-right').querySelector('b').textContent=right;
  el('ab').classList.remove('glow-left','glow-right');
}

function setHover(dir){ const ab=el('ab'); ab.classList.remove('glow-left','glow-right'); if(dir==='L') ab.classList.add('glow-left'); if(dir==='R') ab.classList.add('glow-right'); }

function startTimer(){stopTimer();tLeft=15;qStartAt=performance.now();const totalMs=15000;el('sec').textContent=String(tLeft);const tick=()=>{const elapsed=performance.now()-qStartAt;const remain=Math.max(0,totalMs-elapsed);const s=Math.ceil(remain/1000);if(s!==tLeft){tLeft=s;el('sec').textContent=String(s);}const pct=(elapsed/totalMs)*100;el('bar').style.width=Math.min(100,pct)+'%';if(remain<=0){stopTimer();pickLikert(0);}else{timer=requestAnimationFrame(tick);}};timer=requestAnimationFrame(tick);}function stopTimer(){if(timer){cancelAnimationFrame(timer);timer=null;}}

// 5æŠï¼šå¼·ã„å·¦=+2 / ã‚„ã‚„å·¦=+1 / ä¸­ç«‹=0 / ã‚„ã‚„å³=-1 / å¼·ã„å³=-2
function pickLikert(uiVal){const q=QUESTIONS[current];const elapsed=performance.now()-qStartAt;rtimes.push(elapsed);const valForA=(q.flip?-uiVal:uiVal);const weight=v=>v===0?0:(Math.abs(v)===2?1.0:0.5);answers.push({id:q.id,axis:q.axis,uiVal,valForA,flipped:q.flip,ms:elapsed});const w=weight(valForA);const towardA=Math.sign(valForA);const push=(label,w)=>counts[label]=(counts[label]||0)+w; if(q.axis==='RL'){if(towardA>0){push('R',w);rl_items.push(1);}else if(towardA<0){push('L',w);rl_items.push(0);} } if(q.axis==='FS'){if(towardA>0){push('F',w);fs_items.push(1);}else if(towardA<0){push('S',w);fs_items.push(0);} } if(q.axis==='KC'){if(towardA>0){push('K',w);kc_items.push(1);}else if(towardA<0){push('C',w);kc_items.push(0);} } if(q.axis==='TX'){if(towardA>0){push('Q',w);}else if(towardA<0){push('M',w);} } if(q.axis==='FL'){if(towardA>0){push('Salt',w);}else if(towardA<0){push('Sauce',w);} } if(q.axis==='AF'){if(towardA>0){push('Light',w);}else if(towardA<0){push('Hearty',w);} } next();}

function next(){stopTimer();if(current<QUESTIONS.length-1){current++;renderQ();startTimer();}else{showResult();}}

/* ---- åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆRLèª¿æ•´ & 12ã‚¿ã‚¤ãƒ—ä¸Šæ›¸ãï¼‰ ---- */
function computeResult(){
  const R_base=counts.R, L_base=counts.L; const F=counts.F, S=counts.S; const K=counts.K, C=counts.C;
  const Q=counts.Q, M=counts.M; const Salt=counts.Salt, Sauce=counts.Sauce; const Light=counts.Light, Hearty=counts.Hearty;
  const R_adj=(Q>=2?1:0)+(Salt>=2?1:0)+(Light>=2?1:0);
  const L_adj=(M>=2?1:0)+(Sauce>=2?1:0)+(Hearty>=2?1:0);
  const Rf=R_base+R_adj, Lf=L_base+L_adj;
  const RL=(Rf>=Lf)?'R':'L'; const FS=(F>=S)?'F':'S'; const KC=(K>=C)?'K':'C';
  const code=`${RL}-${FS}-${KC}`;
  let name=TYPE_NAMES[code]||'ä¸æ˜';
  const isCB=(code==='R-F-K') && (M>=2 && Salt>=2 && Light>=2) && (R_base>=2.5 && F>=2 && K>=2);
  if(isCB) name='ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³';
  if(!isCB && code==='R-F-C' && (Q>=2 || Hearty>=2) && Sauce>=2){ name='ãƒãƒ©ãƒŸ'; }
  if(code==='L-S-C'){ name='ã‚«ãƒ«ãƒ“'; }
  if(!isCB && code==='L-F-K' && Q>=2 && Hearty<=1){ name='è‚©ãƒ­ãƒ¼ã‚¹'; }
  if(!isCB && (code==='R-S-K' || code==='R-F-K') && M>=2 && Salt>=2 && Light>=1){ name='ãƒŸã‚¹ã‚¸'; }

  const tagTexture=(Q>=M)?'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘';
  const tagFlavor =(Salt>=Sauce)?'å¡©æ´¾':'ã‚½ãƒ¼ã‚¹æ´¾';
  const tagAfter  =(Light>=Hearty)?'è»½ã‚„ã‹':'æº€è¶³';
  return { code,name,R_base,L_base,F,S,K,C,Q,M,Salt,Sauce,Light,Hearty,R_adj,L_adj,Rf,Lf,tagTexture,tagFlavor,tagAfter };
}

function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allTypeCodes(){return Object.keys(TYPE_NAMES);} // 8ã‚³ãƒ¼ãƒ‰ã§ç›¸æ€§è¨ˆç®—
function bestMatch(code){const mine=parseCode(code);let best=null,bestScore=-1;for(const t of allTypeCodes()){if(t===code) continue;const other=parseCode(t);let opp=0,same=0;if(other.RL===OPP[mine.RL])opp++;if(other.FS===OPP[mine.FS])opp++;if(other.KC===OPP[mine.KC])opp++;if(other.RL===mine.RL)same++;if(other.FS===mine.FS)same++;if(other.KC===mine.KC)same++;const score=(opp>=2)?opp*10:(opp*10+same);if(score>bestScore){bestScore=score;best=t;}}return best;}

/* ---- ä¿¡é ¼åº¦ãƒ­ã‚¸ãƒƒã‚¯ ---- */
function smoothedRatio(a,b,prior=1.2){const p=(a+prior)/(a+b+2*prior);return p;} 
function axisConfidence(a,b){const p=smoothedRatio(a,b);return Math.max(p,1-p);} 
function kr20(items){const k=items.length;if(k<2)return null;const mean=items.reduce((s,x)=>s+x,0)/k;const vari=items.reduce((s,x)=>s+(x-mean)**2,0)/k;const totalVar=k*mean*(1-mean);if(totalVar===0)return null;return (k/(k-1))*(1-(k*vari)/totalVar);} 
function percentile(arr,p){const a=[...arr].sort((x,y)=>x-y);const i=Math.floor((a.length-1)*p);return a[i]??0;}

function qualityAssess(r){
  const confRL=axisConfidence(r.R_base,r.L_base); const confFS=axisConfidence(r.F,r.S); const confKC=axisConfidence(r.K,r.C);
  const overall=Math.round(((confRL+confFS+confKC)/3)*100);
  const alphaRL=kr20(rl_items), alphaFS=kr20(fs_items), alphaKC=kr20(kc_items);
  const medRT=percentile(rtimes,0.5); const tooFast=rtimes.filter(ms=>ms<400).length>=4; const posBias=Math.max(answers.filter(a=>a.uiVal>0).length,answers.filter(a=>a.uiVal<0).length)/answers.length;
  let notes=[]; if(alphaRL!==null && alphaRL<0.4) notes.push('R/Lã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚'); if(alphaFS!==null && alphaFS<0.4) notes.push('F/Sã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚'); if(alphaKC!==null && alphaKC<0.4) notes.push('K/Cã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚'); if(tooFast) notes.push('éå¸¸ã«é€Ÿã„å›ç­”ãŒå¤šã„ï¼ˆé€£æ‰“ã®å¯èƒ½æ€§ï¼‰'); if(posBias>0.8) notes.push('å·¦/å³ã©ã¡ã‚‰ã‹ã«åã£ãŸé¸æŠ');
  return {confRL,confFS,confKC,overall,alphaRL,alphaFS,alphaKC,medRT,tooFast,posBias,notes};
}

function setMeter(id,pct){el(id).style.width=pct+'%';const tId=id+'-text';if(el(tId)) el(tId).textContent=Math.round(pct)+'%';}

function showResult(){const r=computeResult();showScreen('result');el('r-type-name').textContent=r.name;el('r-type-code').textContent=r.code;el('tag-texture').textContent=r.tagTexture;el('tag-flavor').textContent=r.tagFlavor;el('tag-after').textContent=r.tagAfter;el('r-desc').textContent=DESCRIPTIONS[r.name]||'';const bm=bestMatch(r.code);el('r-best').textContent=bm?`${TYPE_NAMES[bm]}ï¼ˆ${bm}ï¼‰`:'â€”';const qa=qualityAssess(r);setMeter('conf-overall',qa.overall);el('conf-overall-text').textContent=`${qa.overall}% ${qa.overall>=75?'ï¼ˆé«˜ï¼‰':qa.overall>=60?'ï¼ˆä¸­ï¼‰':'ï¼ˆä½ï¼‰'}`;setMeter('conf-rl',qa.confRL*100);el('conf-rl-text').textContent=`${Math.round(qa.confRL*100)}%`;setMeter('conf-fs',qa.confFS*100);el('conf-fs-text').textContent=`${Math.round(qa.confFS*100)}%`;setMeter('conf-kc',qa.confKC*100);el('conf-kc-text').textContent=`${Math.round(qa.confKC*100)}%`;let hint=[];if(qa.alphaRL!==null) hint.push(`R/L ä¸€è²«æ€§ Î±=${qa.alphaRL.toFixed(2)}`);if(qa.alphaFS!==null) hint.push(`F/S ä¸€è²«æ€§ Î±=${qa.alphaFS.toFixed(2)}`);if(qa.alphaKC!==null) hint.push(`K/C ä¸€è²«æ€§ Î±=${qa.alphaKC.toFixed(2)}`);hint.push(`ä¸­å¤®å€¤ã®å›ç­”æ™‚é–“ ${Math.round(qa.medRT)}ms`);if(qa.notes.length){hint.push('æ³¨æ„: '+qa.notes.join(' / '));}el('quality-hints').textContent=hint.join('ã€€');const detail=[`R/L base: R=${r.R_base.toFixed(1)}, L=${r.L_base.toFixed(1)}  adj: R+${r.R_adj}, L+${r.L_adj}  â†’ Rf=${r.Rf.toFixed(1)}, Lf=${r.Lf.toFixed(1)}`,`F/S: F=${r.F.toFixed(1)}, S=${r.S.toFixed(1)}`,`K/C: K=${r.K.toFixed(1)}, C=${r.C.toFixed(1)}`,`Texture: Q=${r.Q.toFixed(1)}, M=${r.M.toFixed(1)}  Flavor: Salt=${r.Salt.toFixed(1)}, Sauce=${r.Sauce.toFixed(1)}  After: Light=${r.Light.toFixed(1)}, Hearty=${r.Hearty.toFixed(1)}`,`Tags: ${r.tagTexture}ãƒ»${r.tagFlavor}ãƒ»${r.tagAfter}`].join('\n');el('r-detail').textContent=detail;const payload={type:{code:r.code,name:r.name},tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},counts:{R:r.R_base,L:r.L_base,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M,Salt:r.Salt,Sauce:r.Sauce,Light:r.Light,Hearty:r.Hearty},adjusted:{Rf:r.Rf,Lf:r.Lf,R_adj:r.R_adj,L_adj:r.L_adj},quality:qa,answers,generatedAt:new Date().toISOString()};const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=el('btn-export');a.href=url;a.download=`MEAT-BTI_${r.code}.json`;}

async function copyResult(){const name=el('r-type-name').textContent;const code=el('r-type-code').textContent;const tags=[el('tag-texture').textContent,el('tag-flavor').textContent,el('tag-after').textContent].join('ãƒ»');const text=`MEAT-BTI v6.3\néƒ¨ä½ã‚¿ã‚¤ãƒ—ï¼š${name}ï¼ˆ${code}ï¼‰\nã‚¿ã‚°ï¼š${tags}`;try{await navigator.clipboard.writeText(text);el('btn-copy').textContent='ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';setTimeout(()=>el('btn-copy').textContent='çµæœã‚’ã‚³ãƒ”ãƒ¼',1500);}catch{alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');}}

// ã‚¯ãƒªãƒƒã‚¯å§”ä»»ï¼šStartãƒœã‚¿ãƒ³ï¼ˆ#btn-start / #btn-start-2 / data-action="start"ï¼‰ã‚’ã¾ã¨ã‚ã¦æ‹¾ã†
addEventListener('click',(ev)=>{ const t=ev.target.closest('#btn-start, #btn-start-2, [data-action="start"]'); if(!t) return; ev.preventDefault(); start(); });

['1','2','3','4','5'].forEach(i=>document.getElementById('btn-'+i).addEventListener('mouseenter',()=>{if(i==='1'||i==='2')setHover('L'); else if(i==='4'||i==='5')setHover('R'); else setHover();}));
['1','2','3','4','5'].forEach(i=>document.getElementById('btn-'+i).addEventListener('mouseleave',()=>setHover()));
['1','2','3','4','5'].forEach(i=>document.getElementById('btn-'+i).addEventListener('click',e=>pickLikert(Number(e.currentTarget.dataset.val))));

// å·¦å³ã®å¤§ããªã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯â†’ã€Œã‚„ã‚„å·¦/ã‚„ã‚„å³ã€ã‚’ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ
el('ab-left').addEventListener('click',()=>pickLikert(1));
el('ab-right').addEventListener('click',()=>pickLikert(-1));

const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',resetAll);
const copy=document.getElementById('btn-copy'); if(copy) copy.addEventListener('click',copyResult);

// keyboard shortcuts 1..5
window.addEventListener('keydown',e=>{ if(screenQuiz.hidden) return; const map={'1':2,'2':1,'3':0,'4':-1,'5':-2}; if(map[e.key]!==undefined) pickLikert(map[e.key]); });

showScreen('start');
</script>
</body>
</html>
