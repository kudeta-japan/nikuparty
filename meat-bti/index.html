<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MEAT-BTI｜テスト版（20問・6段階）</title>
<meta name="description" content="20問×6段階、並び固定。あなたの“部位タイプ”と相性No.1を判定。"/>

<style>
  :root{
    --bg:#0a0b10; --panel:#0f1219; --ink:#f7f9ff; --muted:#b9c6db; --bd:#1c2333;
    --acc:#ff715b; --acc2:#ffd166; --shadow:0 12px 30px rgba(0,0,0,.35);
  }
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;
    letter-spacing:.02em; line-height:1.65;
  }
  .app{width:min(980px,94vw);margin:0 auto;padding:16px 0 24px}

  /* ==== HERO IMAGE（本文幅に合わせて、診断中も常時表示） ==== */
  .hero-wrap{position:sticky;top:0;z-index:5;padding:10px 0 0; /* 余白で影を切らない */}
  .hero{
    width:min(980px,94vw); margin:0 auto;
    border-radius:18px; overflow:hidden; border:1px solid var(--bd); background:#000;
    box-shadow:0 16px 36px rgba(0,0,0,.35);
  }
  .hero img{
    display:block; width:100%; height:auto; object-fit:cover; object-position:center;
  }
  /* スマホは横幅いっぱい（＝本文幅いっぱい）・やや縦長に */
  @media (max-width: 600px){
    .hero img{ aspect-ratio: 16 / 9; }
  }

  /* ==== Header（開始ボタンはここにも） ==== */
  .headbar{
    width:min(980px,94vw); margin:10px auto 14px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:900}
  .logo{width:32px;height:32px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111}

  .btn{
    appearance:none;border:1px solid var(--bd);background:#151a23;color:var(--ink);
    padding:11px 14px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease
  }
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}

  /* ==== Card & Sections ==== */
  .card{
    width:min(980px,94vw); margin:0 auto; background:var(--panel);border:1px solid var(--bd);
    border-radius:20px;box-shadow:var(--shadow);overflow:hidden
  }
  .section{padding:16px}

  /* ==== Intro（テキストは画像の下に配置/重ねない） ==== */
  .intro{padding:16px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{background:#121829;border:1px solid #2a3245;color:#dfe7f5;border-radius:999px;padding:6px 10px;font-size:12px}
  .muted{color:var(--muted);font-size:14px}

  /* ==== Quiz ==== */
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:240px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#101528;border:1px solid #27314a;border-radius:14px;padding:14px}
  .ctx{color:#e7ecf8;font-weight:700;font-size:clamp(14px,2.8vw,16px);margin:-2px 0 8px}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:stretch;pointer-events:none}
  .side{background:#0f1524;border:1px solid #2a334e;border-radius:12px;padding:10px;min-height:66px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2677c8);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* ==== Result ==== */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(26px,6vw,34px);font-weight:900}
  .desc{margin-top:10px;line-height:1.9}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  footer{padding:10px 16px 16px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>

<!-- 常時表示のヒーロー（テキスト重ねなし） -->
<div class="hero-wrap">
  <figure class="hero">
    <img src="mbti.jpg" alt="MEAT-BTI ヒーロー画像">
  </figure>
</div>

<!-- ヘッダー（開始ボタンあり） -->
<div class="headbar">
  <div class="brand"><div class="logo">🥩</div><div>MEAT-BTI テスト</div></div>
  <button class="btn primary" data-action="start">診断をはじめる</button>
</div>

<main class="app">
  <div class="card">
    <!-- Intro（ヒーローの下に説明だけ） -->
    <section class="intro">
      <h1 style="margin:0 0 6px;font-size:clamp(22px,5.4vw,30px);font-weight:900">肉好きのための “部位タイプ” 診断</h1>
      <p class="muted" style="margin:0 0 8px">20問・6段階（中立なし）。直感でOK。回答後は「あなたのタイプ」と「相性No.1」を表示します。</p>
      <div class="badges" style="margin-bottom:6px">
        <span class="badge">並び固定</span>
        <span class="badge">6択 × 20問</span>
        <span class="badge">相性No.1のみ表示</span>
      </div>
      <button class="btn primary" data-action="start">診断をはじめる</button>
    </section>

    <!-- QUIZ -->
    <section id="screen-quiz" class="section" hidden>
      <div class="q-head">
        <div class="q-index"><span id="page-now">1</span>/4ページ（<span id="q-answered">0</span>/20）</div>
        <div class="bar"><div id="bar"></div></div>
      </div>

      <div id="qgrid" class="qgrid"><!-- 5問がここに出る --></div>

      <div class="q-foot">
        <div>左右の説明を読んで、中央の丸で“どちら寄りか”を選択</div>
        <div><button id="btn-next" class="btn primary disabled">次の5問へ</button></div>
      </div>
      <div class="progress-note">左（青）⇔右（赤）ほど強い。 キーボード <b>1–6</b> でも選べます。</div>
    </section>

    <!-- RESULT -->
    <section id="screen-result" class="section" hidden>
      <div class="result">
        <div class="big">診断結果</div>
        <div class="grid">
          <div class="r-card">
            <div><strong>あなたの部位タイプ</strong></div>
            <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">—</div>
            <div class="mono" id="r-type-code" style="opacity:.8">—</div>
            <p class="desc" id="r-desc"></p>
          </div>
          <div class="r-card">
            <div><strong>相性No.1</strong></div>
            <div id="r-best" class="mono" style="margin-top:6px"></div>
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;gap:10px;margin-top:6px">
          <button class="btn" id="btn-retry">最初から</button>
          <a class="btn primary" href="#" id="btn-export" download>結果をJSONで保存</a>
        </div>
      </div>
    </section>

    <footer>© KU-DETA / ニクパーティ — Test Build</footer>
  </div>
</main>

<script>
/* ========= タイプ表示（MBTI/LoveTypeトーン） ========= */
const MEAT_TYPE_TEXT = {
  "ヒレ":{ nick:"静かな主役", catch:"無駄なく上品、芯が強い赤身派。" },
  "タン":{ nick:"場をほぐすムードメーカー", catch:"キレよく軽快、会話をほどく。" },
  "イチボ":{ nick:"寄り添う仲介役", catch:"穏やかに合わせ、赤身を丁寧に。" },
  "ランプ":{ nick:"一歩先を照らす案内役", catch:"王道に“ひと匙の新しさ”を添える。" },
  "リブロース":{ nick:"安心感のリーダー", catch:"王道と段取りで、満足を約束。" },
  "サーロイン":{ nick:"主役感のある演出家", catch:"コクと見せ場で“華やか”に牽引。" },
  "ザブトン":{ nick:"じっくり語る相棒", catch:"濃厚を少し、静かにゆっくり。" },
  "カルビ":{ nick:"親しみ満点の盛り上げ役", catch:"甘めの満足感で“みんなを一つに”。" },
  "ハラミ":{ nick:"回転上手の進行役", catch:"赤身でテンポよく、気持ちよく回す。" },
  "カイノミ":{ nick:"軽め贅沢のまとめ役", catch:"重すぎない満足。塩でも映える。" },
  "ミスジ":{ nick:"繊細な職人", catch:"口どけ上品、所作と気配り。" },
  "シャトーブリアン":{ nick:"静かにこだわる達人", catch:"量より質。落ち着いて深く味わう。" }
};

/* ========= 質問（20問・並び固定） ========= */
const BANK = [
  // RL（5）
  {id:1, axis:"RL", text:"最初の一皿、どちらに惹かれる？",
    A:"脂少なめで赤身の旨みを味わう", B:"サシのコクと満足感を重視"},
  {id:2, axis:"RL", text:"同じ価格の赤身と霜降り、今の気分は？",
    A:"キレ重視（さっぱり）", B:"コク重視（濃厚）"},
  {id:3, axis:"RL", text:"“量をしっかり”食べるなら？",
    A:"軽めの赤身中心で進めたい", B:"満足感の高い部位で押したい"},
  {id:4, axis:"RL", text:"名物から選ぶなら？",
    A:"ヒレ／タンなど“赤身寄り”", B:"サーロイン／カルビなど“コク寄り”"},
  {id:5, axis:"RL", text:"1皿だけ追加。迷ったらどっち？",
    A:"赤身系でもう一皿", B:"リッチ系でもう一皿"},

  // TX（3）
  {id:6, axis:"TX", text:"ステーキの食感、どちらが好き？",
    A:"噛んだ時の歯切れ・肉感を楽しむ", B:"口の中でとろける柔らかさ"},
  {id:7, axis:"TX", text:"焼き加減の希望は？（ステーキ想定）",
    A:"レア〜ミディアムレア寄り", B:"ミディアム〜ウェルダン寄り"},
  {id:8, axis:"TX", text:"焼き担当になったら？",
    A:"短時間でサッと仕上げる", B:"火入れを入念にして柔らかく"},

  // FL（1）
  {id:9, axis:"FL", text:"味付けの第一選択は？",
    A:"塩・レモンなどシンプル", B:"特製ソースで仕上げたい"},

  // KC（3）
  {id:10, axis:"KC", text:"演出ありの一皿なら、どっちがうれしい？",
    A:"シンプルに焼いて“素材そのまま”で味わう",
    B:"フランベや“特製ソースのかけ仕上げ”など見せ場がある方が良い"},
  {id:11, axis:"KC", text:"最初の注文の組み立ては？",
    A:"定番から入り、様子を見て変化を足す", B:"限定や創作を早めに混ぜる"},
  {id:12, axis:"KC", text:"初めての店。未知の部位や仕上げは？",
    A:"まずは定番・名物を優先", B:"気になる新顔を試してみたい"},

  // FS（3）
  {id:13, axis:"FS", text:"注文は？",
    A:"一皿ずつ様子を見て追加", B:"まとめて頼んでテンポよく回す"},
  {id:14, axis:"FS", text:"コースかアラカルトか",
    A:"テンポよくアラカルトで色々", B:"ゆっくりコースで流れに乗る"},
  {id:15, axis:"FS", text:"週末。気に入ったお店だったら？",
    A:"次のお店にも行って“軽くはしご”", B:"そのお店に“とどまってゆっくり”"},

  // AF（3）
  {id:16, axis:"AF", text:"締めの考え方",
    A:"軽めでOK／締めなしでも良い", B:"ご飯・麺・デザートまで満足したい"},
  {id:17, axis:"AF", text:"最初の一杯",
    A:"ハイボールやすっきり寄り", B:"甘めや濃い系もいきたい"},
  {id:18, axis:"AF", text:"今日はここで終える？",
    A:"余白を残して軽めに締める", B:"ここで完結。しっかり食べ切る"},

  // 予備（KC/RL）
  {id:19, axis:"KC", text:"写真や見せ場について",
    A:"見た目はほどほど、中身重視", B:"“仕上げ”や映える見せ場が好き"},
  {id:20, axis:"RL", text:"赤身vsコク、最後にもう一度。直感で。",
    A:"赤身寄り", B:"コク寄り"}
];

/* ========= 内部集計 ========= */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let page=0, responses={}, answeredCount=0, pageStartAt=0;
let answers=[], rtimes=[];
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0};

const el=id=>document.getElementById(id);
const screenQuiz=el('screen-quiz'), screenResult=el('screen-result');
function showScreen(which){
  screenQuiz.hidden  = which!=='quiz';
  screenResult.hidden= which!=='result';
}

/* ========= フロー ========= */
function start(){
  // reset
  for(const k of Object.keys(counts)) counts[k]=0;
  responses={}; answeredCount=0; page=0; answers=[]; rtimes=[];
  showScreen('quiz'); renderPage();
  // ヒーローが隠れないよう上部へ軽くスクロール
  window.scrollTo({top:0, behavior:'smooth'});
}

function renderPage(){
  el('page-now').textContent=page+1;
  el('q-answered').textContent=answeredCount;
  el('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el('qgrid'); grid.innerHTML='';
  slice.forEach(q=>{
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx">${q.text}</div>
      <div class="lr" aria-label="左右の比較文">
        <div class="side"><b>${q.A}</b></div>
        <div class="side"><b>${q.B}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6段階選択">
        ${renderDots(q.id).join('')}
      </div>
    `;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));

  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val); // +3..-3（左強→右強）
      selectDot(qid, uiVal, e.currentTarget);
    });
  });

  // 1..6 のキー割り当て（このページの未回答に順次入力）
  window.onkeydown=(e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };

  pageStartAt=performance.now();
}

function renderDots(qid){
  const tipsL=["左：とても近い","左：かなり近い","左：やや近い"];
  const tipsR=["右：やや近い","右：かなり近い","右：とても近い"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;

  const left=valsL.map((v,i)=>`
    <button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}" aria-label="${tipsL[i]}"></button>
  `);
  const right=valsR.map((v,i)=>`
    <button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}" aria-label="${tipsR[i]}"></button>
  `);
  return [...left, ...right];
}

function selectDot(qid, uiVal, btn){
  responses[qid] = responses[qid] || {};
  const firstTime = (responses[qid].uiVal === undefined);
  responses[qid].uiVal = uiVal;
  if(firstTime){
    responses[qid].ts = performance.now() - pageStartAt;
    answeredCount++; el('q-answered').textContent = answeredCount;
  }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');

  const startIdx=page*PAGE_SIZE; const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}
function setNextEnabled(ok){ el('btn-next').classList.toggle('disabled', !ok); }

function applyPage(){
  const startIdx=page*PAGE_SIZE; const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);
  for(const q of slice){
    const r=responses[q.id]; if(!r) continue;
    const valForA=r.uiVal; // 左Aが正（+3..-3）
    const towardA=Math.sign(valForA);
    const abs=Math.abs(valForA);
    const w=abs>=3?1.0:abs===2?0.7:0.4;

    answers.push({id:q.id,axis:q.axis,uiVal:r.uiVal,valForA,ms:r.ts,text:q.text});
    rtimes.push(r.ts);

    const add=k=>counts[k]=(counts[k]||0)+w;
    if(q.axis==='RL'){ towardA>0 ? add('R') : add('L'); }
    if(q.axis==='FS'){ towardA>0 ? add('F') : add('S'); }
    if(q.axis==='KC'){ towardA>0 ? add('K') : add('C'); }
    if(q.axis==='TX'){ towardA>0 ? add('Q') : add('M'); }
    if(q.axis==='FL'){ towardA>0 ? add('Salt') : add('Sauce'); }
    if(q.axis==='AF'){ towardA>0 ? add('Light') : add('Hearty'); }
  }
}

/* ========= 判定 ========= */
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};
function decideAxis(A,B,AL,BL,relA=0,relB=0){
  if(A>B) return AL;
  if(B>A) return BL;
  const wA=A+relA, wB=B+relB;
  if(wA>wB) return AL;
  if(wB>wA) return BL;
  return AL; // 完全同点は左優先
}
// 12タイプ（※シンシン→シャトーブリアン）
function pickSubtype(code,c){
  switch(code){
    case 'R-F-K': // ヒレ系／条件が揃えばCB
      return (c.Q>=2 && c.Salt>=2 && c.Light>=2) ? 'シャトーブリアン' : 'ヒレ';
    case 'R-F-C': return (c.Sauce>=c.Salt || c.Hearty>c.Light) ? 'ハラミ' : 'タン';
    case 'R-S-K': return (c.M>c.Q) ? 'ミスジ' : 'イチボ';
    case 'R-S-C': return 'ランプ';
    case 'L-F-K': return 'リブロース';
    case 'L-F-C': return 'サーロイン';
    case 'L-S-K': return 'ザブトン';
    case 'L-S-C': return (c.Light>c.Hearty && c.Salt>=c.Sauce) ? 'カイノミ' : 'カルビ';
    default: return 'ヒレ';
  }
}
function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allBaseCodes(){ return ['R-F-K','R-F-C','R-S-K','R-S-C','L-F-K','L-F-C','L-S-K','L-S-C']; }
function bestMatch(code){
  const mine=parseCode(code);let best=null,bestScore=-1;
  for(const t of allBaseCodes()){
    if(t===code) continue;
    const other=parseCode(t);
    let opp=0,same=0;
    if(other.RL===OPP[mine.RL])opp++;
    if(other.FS===OPP[mine.FS])opp++;
    if(other.KC===OPP[mine.KC])opp++;
    if(other.RL===mine.RL)same++;
    if(other.FS===mine.FS)same++;
    if(other.KC===mine.KC)same++;
    const score=(opp>=2)?opp*10:(opp*10+same);
    if(score>bestScore){bestScore=score;best=t;}
  }
  return best;
}
function computeResult(){
  const c=counts;
  const RL = decideAxis(c.R,c.L,'R','L', 0.60*c.Q + 0.25*c.Salt + 0.15*c.Light,
                                   0.60*c.M + 0.25*c.Sauce + 0.15*c.Hearty);
  const FS = decideAxis(c.F,c.S,'F','S', 0.50*c.Light + 0.25*c.Salt,
                                   0.50*c.Hearty + 0.25*c.Sauce);
  const KC = decideAxis(c.K,c.C,'K','C', 0.30*c.Salt + 0.20*c.Light,
                                   0.30*c.Sauce + 0.20*c.Hearty);
  const code=`${RL}-${FS}-${KC}`;
  const name=pickSubtype(code, c);
  return {code,name};
}

/* ========= 表示 ========= */
function showResult(){
  document.getElementById('bar').style.width='100%';
  const r=computeResult(); showScreen('result');

  const meta=MEAT_TYPE_TEXT[r.name]||{nick:r.name,catch:''};
  document.getElementById('r-type-name').textContent = `${r.name}（${meta.nick}）`;
  document.getElementById('r-type-code').textContent = r.code;
  document.getElementById('r-desc').textContent = meta.catch;

  const bm=bestMatch(r.code);
  const bmName = pickSubtype(bm, counts);
  const bmMeta = MEAT_TYPE_TEXT[bmName] || {nick:bmName};
  document.getElementById('r-best').textContent = `${bmName}（${bmMeta.nick}）`;

  // JSONエクスポート
  const payload={ type:{code:r.code,name:r.name,nick:meta.nick,catch:meta.catch},
                  counts, answers, generatedAt:new Date().toISOString() };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.getElementById('btn-export');
  a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

/* ========= イベント ========= */
document.addEventListener('click',(ev)=>{
  const t=ev.target.closest('[data-action="start"]');
  if(t){ ev.preventDefault(); start(); }
});
document.getElementById('btn-next').addEventListener('click', ()=>{
  const btn = document.getElementById('btn-next');
  if(btn.classList.contains('disabled')) return;
  applyPage();
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',()=>{
  // 初期状態へ（Introに戻す）
  screenResult.hidden = true;
  screenQuiz.hidden = true;
  window.scrollTo({top:0, behavior:'smooth'});
});
</script>
</body>
</html>
