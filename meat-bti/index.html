<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEAT-BTI v7.4ï½œ20å•ãƒ»6æŠï¼ˆå‰æã¤ãï¼‰</title>
<meta name="description" content="5å•Ã—4ãƒšãƒ¼ã‚¸ï¼å…¨20å•ã€‚å„è¨­å•ã«å‰æï¼ˆçŠ¶æ³ï¼‰ã‚’æ˜ç¤ºã€‚6æ®µéšãƒªãƒƒã‚«ãƒ¼ãƒˆï¼ˆä¸­ç«‹ãªã—ï¼‰ãƒ»ç„¡ä½œç‚ºé †/å·¦å³å…¥æ›¿ãƒ»ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ã€‚åŸºæœ¬12ã‚¿ã‚¤ãƒ—ï¼‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ã€ã€‚"/>

<!-- GA4ï¼ˆã‚µã‚¤ãƒˆå…±é€šï¼šG-V39MNGQD5Hï¼‰ -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V39MNGQD5H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-V39MNGQD5H');
</script>

<style>
  :root{
    --bg:#090b10; --panel:#0f1219; --ink:#f5f8ff; --muted:#b7c3d6;
    --acc:#ff715b; --acc2:#ffd166; --bd:#1b2030; --shadow:0 10px 30px rgba(0,0,0,.35);
    --good:#35d19d; --warn:#ffd166; --blue:#59b3ff;
    --grad: radial-gradient(1200px 600px at 10% -10%, rgba(255,113,91,.25), transparent 40%),
            radial-gradient(1200px 600px at 110% 110%, rgba(255,209,102,.2), transparent 40%),
            linear-gradient(180deg,#0a0d14,#0b0e15 50%, #0d111a);
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
  .app{width:min(960px,100%);margin:0 auto;padding:24px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--bd)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111;font-weight:900}
  .title{font-weight:900}
  .wrap{padding:0}

  /* HERO */
  .hero{position:relative;background:var(--grad);padding:40px 28px 26px}
  .hero-inner{display:grid;gap:18px}
  .eyebrow{display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.08);border:1px solid #222a3a;color:#dfe7f5;padding:6px 10px;border-radius:999px;font-size:12px}
  .h1{font-size:clamp(26px,5.6vw,40px);line-height:1.2;font-weight:900;margin:0}
  .lead{color:var(--muted);margin:0}
  .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}
  .badge{background:#121829;border:1px solid #2a3245;color:#dfe7f5;border-radius:999px;padding:6px 10px;font-size:12px}
  .cta-row{display:flex;align-items:center;gap:12px;margin-top:8px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--bd);background:#151a23;color:var(--ink);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease, box-shadow .15s ease}
  .btn:hover{transform:translateY{-1px}}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}
  .subnote{color:var(--muted);font-size:12px}
  .types{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
  @media(min-width:720px){.types{grid-template-columns:repeat(6,1fr)}}
  .type-chip{background:#121726;border:1px solid #2a3140;border-radius:12px;padding:10px 10px;text-align:center;font-weight:700;white-space:nowrap}

  /* QUIZ */
  .section{padding:16px}
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:220px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#111522;border:1px solid #2a3140;border-radius:14px;padding:12px}
  .ctx{display:flex;gap:8px;align-items:center;color:#aeb8ce;font-size:12px;margin-bottom:8px}
  .ctx span{display:inline-grid;place-items:center;width:18px;height:18px;border-radius:6px;background:#1a2133;border:1px solid #2b3650;color:#dfe7f5;font-size:11px}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:stretch;pointer-events:none}
  .side{background:#0f1522;border:1px solid #272f41;border-radius:12px;padding:10px;min-height:66px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2677c8);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .dot:hover{transform:translateY(-1px)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--bd);margin-right:6px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* RESULT */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(26px,6vw,34px);font-weight:900}
  .desc{margin-top:10px;line-height:1.9}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .meter{height:10px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden}
  .meter>div{height:100%;width:0%;background:linear-gradient(90deg,var(--good),var(--warn))}
  footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<main class="app">
  <div class="card">
    <header>
      <div class="brand"><div class="logo">ğŸ¥©</div><div class="title">MEAT-BTI v7.4ï¼ˆ20å•ãƒ»å‰æã¤ãï¼‰</div></div>
      <button id="btn-start" class="btn primary" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
    </header>

    <!-- START -->
    <section id="screen-start" class="hero">
      <div class="hero-inner">
        <span class="eyebrow">âœ¨ KU-DETA é™å®š ãƒ» 11/15</span>
        <h1 class="h1">è‚‰å¥½ãã®ãŸã‚ã®æ€§æ ¼è¨ºæ–­ã€‚<br>ã‚ãªãŸã¯ã©ã® <span style="color:var(--acc2)">â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€</span>ï¼Ÿ</h1>
        <p class="lead">å…¨20å•ã€å„è¨­å•ã«<b>å…·ä½“çš„ãªå‰æï¼ˆçŠ¶æ³ï¼‰</b>ã‚’è¨˜è¼‰ã€‚6æ®µéšã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆä¸­ç«‹ãªã—ï¼‰ã€‚å‘³è¦šã¨é£Ÿäº‹ã‚·ãƒ¼ãƒ³ã®ã‚¯ã‚»ã‹ã‚‰åˆ¤å®šã—ã¾ã™ã€‚</p>
        <div class="badges">
          <span class="badge">6æŠ Ã— 20å•</span>
          <span class="badge">ç„¡ä½œç‚ºé †ãƒ»å·¦å³å…¥æ›¿</span>
          <span class="badge">ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯</span>
        </div>
        <div class="cta-row">
          <button class="btn primary" id="btn-start-2" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
          <span class="subnote">â€»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ <b>1â€“6</b> ã§ã‚‚é¸ã¹ã¾ã™</span>
        </div>
        <div class="types" aria-label="12ã‚¿ã‚¤ãƒ—">
          <div class="type-chip">ãƒ’ãƒ¬</div><div class="type-chip">ã‚¿ãƒ³</div><div class="type-chip">ã‚¤ãƒãƒœ</div><div class="type-chip">ãƒ©ãƒ³ãƒ—</div>
          <div class="type-chip">ãƒªãƒ–ãƒ­ãƒ¼ã‚¹</div><div class="type-chip">ã‚µãƒ¼ãƒ­ã‚¤ãƒ³</div><div class="type-chip">ã‚¶ãƒ–ãƒˆãƒ³</div><div class="type-chip">ã‚«ãƒ«ãƒ“</div>
          <div class="type-chip">ãƒãƒ©ãƒŸ</div><div class="type-chip">ã‚·ãƒ³ã‚·ãƒ³</div><div class="type-chip">ã‚«ã‚¤ãƒãƒŸ</div><div class="type-chip">ãƒŸã‚¹ã‚¸</div>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <div class="wrap">
      <section id="screen-quiz" class="section" hidden>
        <div class="q-head">
          <div class="q-index"><span id="page-now">1</span>/4ãƒšãƒ¼ã‚¸ï¼ˆ<span id="q-answered">0</span>/20ï¼‰</div>
          <div class="bar"><div id="bar"></div></div>
        </div>

        <div id="qgrid" class="qgrid"><!-- 5å•ãŒã“ã“ã«å‡ºã‚‹ --></div>

        <div class="q-foot">
          <div>â€»å·¦å³ã®ã‚«ãƒ¼ãƒ‰ã¯èª¬æ˜ã®ã¿ï¼ˆã‚¯ãƒªãƒƒã‚¯ä¸å¯ï¼‰</div>
          <div style="display:flex;gap:10px">
            <button id="btn-next" class="btn primary disabled">æ¬¡ã®5å•ã¸</button>
          </div>
        </div>
        <div class="progress-note">å„å•ã®ä¸¸ã„ãƒ‰ãƒƒãƒˆã§é¸æŠã€‚å·¦ï¼ˆé’ï¼‰â‡”å³ï¼ˆèµ¤ï¼‰ã«è¡Œãã»ã©å¼·ã„é¸å¥½ã€‚</div>
      </section>

      <!-- RESULT -->
      <section id="screen-result" class="section" hidden>
        <div class="result">
          <div class="big">è¨ºæ–­çµæœ</div>
          <div class="grid">
            <div class="r-card">
              <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
              <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
              <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
              <div style="margin-top:10px"><span class="pill" id="tag-texture">å™›ã¿å¿œãˆ</span><span class="pill" id="tag-flavor">å¡©æ´¾</span><span class="pill" id="tag-after">è»½ã‚„ã‹</span></div>
              <p class="desc" id="r-desc"></p>
            </div>
            <div class="r-card">
              <div><strong>ç›¸æ€§No.1</strong></div>
              <div id="r-best" class="mono" style="margin-top:6px"></div>
            </div>
          </div>

          <div class="r-card">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
              <strong>ä¿¡é ¼åº¦</strong>
              <button class="btn" id="btn-copy">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
            </div>
            <div style="display:grid;gap:8px;margin-top:8px">
              <div>ç·åˆï¼š<span id="conf-overall-text">â€”</span>
                <div class="meter"><div id="conf-overall" style="width:0%"></div></div>
              </div>
              <div>R/Lï¼š<span id="conf-rl-text">â€”</span>
                <div class="meter"><div id="conf-rl" style="width:0%"></div></div>
              </div>
              <div>F/Sï¼š<span id="conf-fs-text">â€”</span>
                <div class="meter"><div id="conf-fs" style="width:0%"></div></div>
              </div>
              <div>K/Cï¼š<span id="conf-kc-text">â€”</span>
                <div class="meter"><div id="conf-kc" style="width:0%"></div></div>
              </div>
              <div class="hint" id="quality-hints"></div>
            </div>
          </div>

          <div class="r-card">
            <strong>è©³ç´°ï¼ˆé›†è¨ˆå€¤ï¼‰</strong>
            <pre class="mono" id="r-detail" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
          </div>
          <div style="display:flex;justify-content:space-between;gap:10px">
            <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
            <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
          </div>
        </div>
      </section>
    </div>

    <footer>Â© KU-DETA / ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” MEAT-BTI v7.4</footer>
  </div>
</main>

<script>
/* ==== Question Bankï¼ˆå„å•ã« ctx=å‰æï¼‰20å• ==== */
const BANK = [
  // â”€â”€ RLï¼ˆèµ¤èº«R vs ã‚³ã‚¯Lï¼‰5å• â”€â”€
  {id:1,  axis:"RL",
    ctx:"ç„¼è‚‰åº—ã§æœ€åˆã®ä¸€çš¿ã‚’æ³¨æ–‡ã€‚ã©ã¡ã‚‰ã«æƒ¹ã‹ã‚Œã‚‹ï¼Ÿ",
    a:"è„‚å°‘ãªã‚ã§èµ¤èº«ã®æ—¨ã¿ã‚’å‘³ã‚ã„ãŸã„", b:"ã‚µã‚·ã®å…¥ã£ãŸã‚³ã‚¯ã§æº€è¶³ã—ãŸã„"},
  {id:2,  axis:"RL",
    ctx:"å¹³æ—¥ã®å¤œã€‚æ˜æ—¥ã‚‚æ—©ã„ã‹ã‚‚â€¦é£Ÿå¾Œã®æ„Ÿã˜ã¯ï¼Ÿ",
    a:"é£Ÿå¾Œã¯è»½ã‚„ã‹ã«çµ‚ãˆãŸã„", b:"ã—ã£ã‹ã‚Šæº€è…¹ãƒ»ä½™éŸ»ã‚’æ¥½ã—ã¿ãŸã„"},
  {id:3,  axis:"RL",
    ctx:"åŒã˜ä¾¡æ ¼ã®èµ¤èº«/éœœé™ã‚Šã‚’å‹§ã‚ã‚‰ã‚ŒãŸã‚‰ï¼Ÿ",
    a:"å‘³ã¯ã‚­ãƒ¬é‡è¦–ï¼ˆã•ã£ã±ã‚Šï¼‰", b:"å‘³ã¯ã‚³ã‚¯é‡è¦–ï¼ˆæ¿ƒåšï¼‰"},
  {id:19, axis:"RL",
    ctx:"çœ‹æ¿ã‚«ãƒ«ãƒ“ã¨èµ¤èº«ã®åç‰©ã€ãƒ¡ã‚¤ãƒ³ã§ä¸€çš¿ã ã‘é¸ã¶ãªã‚‰ï¼Ÿ",
    a:"èµ¤èº«ä¸­å¿ƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸ã³ãŸã„", b:"è„‚ã®ã®ã£ãŸåç‰©ã‚’å‘³ã‚ã„ãŸã„"},
  {id:4,  axis:"RL",
    ctx:"åº—é•·ãŒâ€œãƒ’ãƒ¬/ã‚¿ãƒ³â€ã¨â€œã‚µãƒ¼ãƒ­ã‚¤ãƒ³/ã‚«ãƒ«ãƒ“â€ã‚’æ¨ã—ã¦ã„ã‚‹å ´é¢ã€‚",
    a:"ãƒ’ãƒ¬ã‚„ã‚¿ãƒ³ã«æƒ¹ã‹ã‚Œã‚‹", b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ã‚„ã‚«ãƒ«ãƒ“ã«æƒ¹ã‹ã‚Œã‚‹"},

  // â”€â”€ TXï¼ˆå™›ã¿å¿œãˆQ vs ã¨ã‚ã‘Mï¼‰3å• â”€â”€
  {id:5,  axis:"TX",
    ctx:"ã‚«ãƒƒãƒˆã‚’é¸ã¹ã‚‹ãŠåº—ã€‚é£Ÿã¹å£ã¯ã©ã¡ã‚‰ãŒç†æƒ³ï¼Ÿ",
    a:"æ­¯åˆ‡ã‚Œã‚ˆãå™›ã‚€ã»ã©æ—¨ã„é£Ÿæ„ŸãŒå¥½ã", b:"ã¨ã‚ã‘ã‚‹æŸ”ã‚‰ã‹ã•ãŒå¥½ã"},
  {id:6,  axis:"TX",
    ctx:"ç„¼ãåŠ æ¸›ã‚’ä¼ãˆã‚‹ã¨ã—ãŸã‚‰ï¼Ÿ",
    a:"è–„åˆ‡ã‚Šãƒ»ãƒ¬ã‚¢å¯„ã‚ŠãŒå¥½ã¿", b:"åšåˆ‡ã‚Šãƒ»ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã€œã‚¦ã‚§ãƒ«ãŒå®‰å¿ƒ"},
  {id:7,  axis:"TX",
    ctx:"ã‚ãªãŸãŒç„¼ãæ‹…å½“ã€‚ç«å…¥ã‚Œã®æ–¹é‡ã¯ï¼Ÿ",
    a:"ç«ã¯é€šã—ã™ããšã‚µãƒƒã¨", b:"ã—ã£ã‹ã‚Šç«å…¥ã‚Œã—ã¦è½ã¡ç€ã‹ã›ãŸã„"},

  // â”€â”€ FLï¼ˆå¡© Salt vs ã‚½ãƒ¼ã‚¹ Sauceï¼‰2å• â”€â”€
  {id:8,  axis:"FL",
    ctx:"å‘³ä»˜ã‘ã‚’é¸ã¶ã¨ã—ãŸã‚‰ï¼Ÿãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯å¡©ãƒ»ãƒ¬ãƒ¢ãƒ³ã¨ç‰¹è£½ãƒ€ãƒ¬ãŒã‚ã‚‹ã€‚",
    a:"ãƒ¬ãƒ¢ãƒ³ãƒ»å¡©ãƒ»ã‚ã•ã³ãªã©ã‚·ãƒ³ãƒ—ãƒ«æ´¾", b:"ç”˜è¾›ãƒ€ãƒ¬/ã‚¬ãƒªãƒã‚¿/ãƒãƒ¼ã‚ºãªã©ã‚½ãƒ¼ã‚¹æ´¾"},
  {id:9,  axis:"FL",
    ctx:"é¦™ã‚Šã®æ¼”å‡ºã‚‚é¸ã¹ã‚‹åº—ã€‚ã‚ãªãŸã¯ï¼Ÿ",
    a:"è‚‰æœ¬æ¥ã®é¦™ã‚Šã‚’æ´»ã‹ã—ãŸã„", b:"ã‚½ãƒ¼ã‚¹ã®é¦™ã‚Šã‚„æ¼”å‡ºã§ç››ã‚Šä¸Šã’ãŸã„"},

  // â”€â”€ FSï¼ˆãƒ†ãƒ³ãƒ F vs ã˜ã£ãã‚Š Sï¼‰3å• â”€â”€
  {id:10, axis:"FS",
    ctx:"ä¸ƒè¼ªã‚’å›²ã‚€å°‘äººæ•°ã®ä¼šã€‚ç¶²ã¯1æšã ã‘ã€‚ç„¼ãã®å›ã—æ–¹ã¯ï¼Ÿ",
    a:"å¼·ç«ã§ã‚µãƒƒã¨ç„¼ã„ã¦å›è»¢è‰¯ãé£Ÿã¹ãŸã„", b:"å¼±ã€œä¸­ç«ã§ã˜ã£ãã‚Šè‚²ã¦ã¦é£Ÿã¹ãŸã„"},
  {id:11, axis:"FS",
    ctx:"â€œã‚³ãƒ¼ã‚¹ or ã‚¢ãƒ©ã‚«ãƒ«ãƒˆâ€ã‚’é¸ã¹ã‚‹åº—ã€‚",
    a:"æ–™ç†ã¯ãƒ†ãƒ³ãƒè‰¯ãæ¬¡ã€…å‡ºã¦ãã‚‹ã¨å¬‰ã—ã„", b:"ã‚³ãƒ¼ã‚¹ã§ã‚†ã£ãã‚Šå‡ºã¦ãã‚‹æ–¹ãŒå¬‰ã—ã„"},
  {id:12, axis:"FS",
    ctx:"ç›®å½“ã¦ã®åº—ãŒæ··ã‚“ã§ã„ã‚‹å¤œã€‚ã‚ãªãŸã¯ï¼Ÿ",
    a:"æ··ã‚“ã§ã„ãŸã‚‰æ¬¡ã®åº—ã¸ç§»ã‚‹ã‚¿ã‚¤ãƒ—", b:"å¸­ãŒæ°—ã«å…¥ã‚Œã°ä¸€è»’ã§è…°ã‚’æ®ãˆã‚‹"},

  // â”€â”€ KCï¼ˆå®šç•ª K vs å¤‰åŒ– Cï¼‰4å• â”€â”€
  {id:13, axis:"KC",
    ctx:"æœ€åˆã®ä¸€çš¿ã€ã©ã¡ã‚‰ã‹ã‚‰å§‹ã‚ã‚‹ï¼Ÿ",
    a:"ã¾ãšã¯å®šç•ªã®å¡©ã‚¿ãƒ³ãƒ»ç‹é“ã‚«ãƒƒãƒˆã‹ã‚‰", b:"ãã®åº—ã®é™å®š/å¤‰ã‚ã‚Šç¨®ã‚’å…ˆã«è©¦ã—ãŸã„"},
  {id:14, axis:"KC",
    ctx:"4äººã§ã‚·ã‚§ã‚¢æ³¨æ–‡ã€‚ã‚ªãƒ¼ãƒ€ãƒ¼ã®ä»•æ–¹ã¯ï¼Ÿ",
    a:"æ³¨æ–‡ã¯æœ€åˆã«ã¾ã¨ã‚ã¦æ®µå–ã‚Šè‰¯ã", b:"æ§˜å­ã‚’è¦‹ãªãŒã‚‰ãã®éƒ½åº¦è¿½åŠ ã—ãŸã„"},
  {id:20, axis:"KC",
    ctx:"SNSã«ã‚‚ä¸Šã’ã‚‹ã‹ã‚‚ã—ã‚Œãªã„å¤œã€‚é¸ã¶åŸºæº–ã¯ï¼Ÿ",
    a:"å†™çœŸã‚ˆã‚Šå‘³ã‚’æœ€å„ªå…ˆã—ãŸã„", b:"â€œæ˜ ãˆâ€ã®ç››ã‚Šä»˜ã‘ãŒå¥½ã"},
  {id:15, axis:"KC",
    ctx:"åˆå‚åŠ ã®äººã‚‚ã„ã‚‹ä¼šç¤¾é£²ã¿ã€‚é£Ÿã¹æ–¹ã¯ï¼Ÿ",
    a:"é£Ÿã¹æ–¹ã‚„ãƒãƒŠãƒ¼ã¯ãã£ã¡ã‚Šå®ˆã‚ŠãŸã„", b:"å‹ã«ç¸›ã‚‰ã‚Œãšæ¥½ã—ãé£Ÿã¹ã‚‰ã‚Œã‚Œã°OK"},

  // â”€â”€ AFï¼ˆä½™ç™½ Light vs å®Œçµ Heartyï¼‰3å• â”€â”€
  {id:16, axis:"AF",
    ctx:"ç· ã‚ã®æ³¨æ–‡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚ã‚ãªãŸã¯ï¼Ÿ",
    a:"ã€†ã¯ãªã—/ã‚¹ãƒ¼ãƒ—ç¨‹åº¦ã§ååˆ†", b:"ã€†ã¯ã”é£¯ãƒ»å†·éººãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆã¾ã§ã—ã£ã‹ã‚Š"},
  {id:17, axis:"AF",
    ctx:"æœ€åˆã®ãƒ‰ãƒªãƒ³ã‚¯ã‚’é¸ã¶ãªã‚‰ï¼Ÿ",
    a:"ãƒã‚¤ãƒœãƒ¼ãƒ«/ã™ã£ãã‚Šç³»", b:"ç”˜ã‚ã‚«ã‚¯ãƒ†ãƒ«ã‚„æ¿ƒã„ãƒ‰ãƒªãƒ³ã‚¯ã‚‚æ¬²ã—ã„"},
  {id:18, axis:"AF",
    ctx:"21æ™‚ã€‚äºŒè»’ç›®ã®äºˆå®šãŒã‚ã‚‹ã‹ã‚‚ï¼Ÿ",
    a:"é£Ÿå¾Œã¯äºŒè»’ç›®ã§è»½ãç¶šã‘ãŸã„", b:"ã“ã®åº—ã§å®Œçµã—ã¦æº€è…¹ã§ç· ã‚ãŸã„"},
];

function decorateBankRandomly(bank){return bank.map(q=>({...q,flip:Math.random()<0.5}))}
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};

/* ä»£è¡¨ï¼ˆç›¸æ€§è¨ˆç®—ç”¨ 8ã‚³ãƒ¼ãƒ‰â†’åå‰ï¼‰ */
const CODE_REPR={
  "R-F-K":"ãƒ’ãƒ¬","R-F-C":"ã‚¿ãƒ³","R-S-K":"ã‚¤ãƒãƒœ","R-S-C":"ãƒ©ãƒ³ãƒ—",
  "L-F-K":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹","L-F-C":"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³","L-S-K":"ã‚¶ãƒ–ãƒˆãƒ³","L-S-C":"ã‚«ãƒ«ãƒ“"
};
/* èª¬æ˜æ–‡ï¼ˆ12ï¼‹CBï¼‰ */
const DESCRIPTIONS={
  "ãƒ’ãƒ¬":"ç„¡é§„ã®ãªã„ä¸Šå“ã•ã¨èŠ¯ã®å¼·ã•ãŒå…±å­˜ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚æƒ…å ±ã‚’æ•´ç†ã—ã€çµè«–ã‚’ã™ã£ãã‚Šå‡ºã™ã®ãŒå¾—æ„ã€‚å‘³ã‚ã„ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ã€ç´ æå‹è² ã®ä¸€çš¿ã‚’å¥½ã¿ã¾ã™ã€‚ä¼šè©±ã§ã‚‚ç›¸æ‰‹ã®è©±ã‚’ä¸å¯§ã«æ‹¾ã„ã€ä½™ç™½ã‚’æ´»ã‹ã—ã¦æ·±ã‚ã‚‹ã®ãŒä¸Šæ‰‹ã€‚åˆå¯¾é¢ã§ã¯è³ªå•ã‚’ä¸€ã¤ãšã¤æŠ•ã’ã€å…±é€šç‚¹ãŒè¦‹ã¤ã‹ã‚‹ã¨ä¸€æ°—ã«è·é›¢ãŒç¸®ã¿ã¾ã™ã€‚",
  "ã‚¿ãƒ³":"ã•ã£ã±ã‚Šå¡©ã§ã‚­ãƒ¬è‰¯ãã€‚ãƒ†ãƒ³ãƒã®è‰¯ã•ã¨æ˜ã‚‹ã•ã§å‘¨å›²ã‚’ã»ãã™ãƒ ãƒ¼ãƒ‰ãƒ¡ã‚¤ã‚¯ãŒå¾—æ„ã€‚ç›´æ„ŸãŒåˆ©ãã€åˆ¤æ–­ã‚‚ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ã€‚çŸ­ã„ã‚­ãƒ£ãƒƒãƒãƒœãƒ¼ãƒ«ã§ä¼šè©±ã‚’å›ã—ã€ä¹¾æ¯ã®å·ä»¤å½¹ã«ã‚‚å‘ã„ã¦ã„ã¾ã™ã€‚ã¾ãšã¯ã‚„ã£ã¦ã¿ã‚‹ç²¾ç¥ã§ã€æ–°ã—ã„äººã¨ã‚‚ã™ãè·é›¢ã‚’ç¸®ã‚ã‚‰ã‚Œã¾ã™ã€‚",
  "ã‚¤ãƒãƒœ":"èµ¤èº«ã®æ—¨ã¿ã‚’ä¸å¯§ã«å‘³ã‚ã†ã€èª¿å’Œå‹ã®é€šå¥½ã¿ã€‚æ§ãˆã‚ãªãŒã‚‰èŠ¯ãŒã‚ã‚Šã€ç©ºæ°—ã‚’èª­ã¿ã¤ã¤ã‚‚è¦æ‰€ã§æ„è¦‹ã‚’è¨€ãˆã‚‹äººã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šä½™éŸ»ãŒæ®‹ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ä¾¡å€¤è¦³ã®è¿‘ã„ç›¸æ‰‹ã¨é•·æœŸçš„ãªé–¢ä¿‚ã‚’ç¯‰ãã‚„ã™ã„ã€‚",
  "ãƒ©ãƒ³ãƒ—":"æ¢ç©¶å¿ƒã¨æŸ”è»Ÿã•ã‚’å…¼ã­å‚™ãˆãŸå®Ÿé¨“å¥½ãã€‚ä½æ¸©ã‚„å‰µä½œã®ã‚ˆã†ã«å®šç•ªã‚’ä¸€æ­©æ›´æ–°ã™ã‚‹å·¥å¤«ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¾ã™ã€‚ç‰©é™ã‹ã§ã‚‚ä¸­èº«ã¯ç†±ã„è·äººæ°—è³ªã§ã€è©¦é£Ÿã‚„å°ã•ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹ã¨ä¼šè©±ãŒå¼¾ã¿ã¾ã™ã€‚",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"ç‹é“ãƒªãƒƒãƒæ´¾ã€‚åšã¿ã®ã‚ã‚‹æ—¨ã¿ã¨å®‰å¿ƒæ„Ÿã‚’é‡è¦–ã—ã€æ®µå–ã‚Šã‚ˆãçš†ã‚’å°ã‘ã‚‹é ¼ã‚Œã‚‹äººã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šæº€è¶³åº¦ã§è©•ä¾¡ã€‚ä¼šè©±ã¯è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã§èãå½¹ã«ã‚‚å›ã‚Œã¾ã™ã€‚",
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"è¯ã‚„ãã¨ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ã§å ´ã‚’ç››ã‚Šä¸Šã’ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚å†™çœŸæ˜ ãˆã‚„â€œç‰¹è£½ã‚½ãƒ¼ã‚¹â€ã«å¿ƒãŒèºã‚Šã€äººã®è‰¯ã•ã‚’ç´ æ—©ãæ‹¾ã£ã¦åˆã‚ã›ã‚‰ã‚Œã‚‹å™¨ç”¨ã•ã‚‚ã€‚ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¤§ãã‚ã§è¼ªã‚’åºƒã’ã¾ã™ã€‚",
  "ã‚¶ãƒ–ãƒˆãƒ³":"ã—ã£ã¨ã‚Šæ¿ƒåšã€å™›ã‚€ã»ã©ã«åºƒãŒã‚‹ã‚³ã‚¯ã‚’æ„›ã™ã‚‹å¯©ç¾çœ¼ã®æŒã¡ä¸»ã€‚ã“ã ã‚ã‚Šã¯å¼·ã„ãŒæŠ¼ã—ä»˜ã‘ãšã€ä¸å¯§ã«è¨€è‘‰ã‚’é¸ã³ã¾ã™ã€‚å°‘äººæ•°ã§ã˜ã£ãã‚Šè©±ã™ã®ãŒå¥½ãã€‚",
  "ã‚«ãƒ«ãƒ“":"æ¿ƒåšã§ç”˜è¾›ã®æ—¨ã¿ã‚’æ„›ã™ã‚‹ãƒªãƒƒãƒæ´¾ã€‚ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ãŒã‚ã‚Šã€äººã‚’å·»ãè¾¼ã‚€ã®ãŒä¸Šæ‰‹ã€‚ã”è¤’ç¾æ„Ÿã®ã‚ã‚‹ä½“é¨“ã«å¼±ãã€ã¿ã‚“ãªã§ãƒ¯ã‚¤ãƒ¯ã‚¤ç››ã‚Šä¸ŠãŒã‚‹å¤œãŒä¼¼åˆã„ã¾ã™ã€‚",
  "ãƒãƒ©ãƒŸ":"ç‚­ç«ã¨ç”˜è¾›ãƒ€ãƒ¬ãŒä¼¼åˆã†ã€èºå‹•æ„Ÿã®ã‚ã‚‹èµ¤èº«æ´¾ã€‚æ­¯ã”ãŸãˆã‚’æ¥½ã—ã¿ã¤ã¤ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ã•ã‚‚è­²ã‚‰ãªã„å®Ÿåˆ©ã‚¿ã‚¤ãƒ—ã€‚é›£ã—ã„ç†å±ˆã‚ˆã‚Šâ€œã†ã¾ã„ãƒ»ãŸã®ã—ã„â€ã‚’å…±æœ‰ã—ãŸã„äººã€‚",
  "ã‚·ãƒ³ã‚·ãƒ³":"ä¸Šå“ãªèµ¤èº«ã®ã‚³ã‚¯ã¨ã‚­ãƒ¬ã‚’ä¸¡ç«‹ã€‚ç„¡é§„ã®ãªã„å‘³è¨­è¨ˆã‚’å¥½ã¿ã€æ®µå–ã‚Šè‰¯ãå ´ã‚’æ•´ãˆã‚‹å …å®Ÿæ´¾ã€‚é™ã‹ãªé ¼ã‚‚ã—ã•ã§ã€èƒŒä¼¸ã³ã—ãªã„â€œã¡ã‚‡ã†ã©ã„ã„è´…æ²¢â€ã«ã‚»ãƒ³ã‚¹ãŒå…‰ã‚Šã¾ã™ã€‚",
  "ã‚«ã‚¤ãƒãƒŸ":"ã‚«ãƒ«ãƒ“ç³»ã®ä¸­ã§ã‚‚è»½ã‚„ã‹ã§ç¹Šç¶­æ„ŸãŒå¿ƒåœ°ã‚ˆã„éƒ¨ä½ã€‚è„‚ã®æ—¨ã¿ã¯å¥½ãã ãŒé‡ã•ã¯æŠ‘ãˆãŸã„äººã«ãƒ•ã‚£ãƒƒãƒˆã€‚å¡©ã‚„ãƒ¬ãƒ¢ãƒ³ã§ã‚­ãƒ¬è‰¯ãä»•ä¸Šã’ã‚‹é¸æŠçœ¼ãŒé­…åŠ›ã€‚",
  "ãƒŸã‚¹ã‚¸":"ç¹Šç´°ãªã‚µã‚·ãŒå…¥ã‚Šã¤ã¤è»½ã‚„ã‹ã€‚ã‚„ã•ã—ã„å£ã©ã‘ã¨ä¸Šå“ãªé¦™ã‚Šã‚’å¥½ã‚€ä¸å¯§ã•ã®äººã€‚éŸ³ã‚„æ¸©åº¦ãªã©ç´°éƒ¨ã«æ°—ã¥ã‘ã€å°‘äººæ•°ã§ã˜ã£ãã‚Šè©±ã™ã¨é­…åŠ›ãŒèŠ±é–‹ãã¾ã™ã€‚",
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"ç¹Šç´°ã•ã¨é›†ä¸­åŠ›ã€ãã—ã¦è³ªã¸ã®å¼·ã„ã“ã ã‚ã‚Šã‚’å‚™ãˆãŸâ€œç‰¹é¸ãƒ’ãƒ¬â€ã€‚é‡ã‚ˆã‚Šè³ªã€æ´¾æ‰‹ã•ã‚ˆã‚Šå®Œæˆåº¦ã‚’é‡ã‚“ã˜ã¾ã™ã€‚æ€¥ãŒãšæ·±ãã€å°‘äººæ•°ã§ã˜ã£ãã‚Šå‘ãåˆã†ã¨ç›¸æ€§ãŒèŠ±é–‹ãå¸Œå°‘ã‚¿ã‚¤ãƒ—ã€‚"
};

/* ==== State ==== */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let QUESTIONS=[], page=0, responses={}, answeredCount=0, pageStartAt=0;
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0};
const answers=[], rtimes=[], rl_items=[], fs_items=[], kc_items=[];
const el=id=>document.getElementById(id);
const screenStart=el('screen-start'), screenQuiz=el('screen-quiz'), screenResult=el('screen-result');
function showScreen(which){screenStart.hidden=which!=='start';screenQuiz.hidden=which!=='quiz';screenResult.hidden=which!=='result';}

/* ==== Flow ==== */
function start(){
  Object.keys(counts).forEach(k=>counts[k]=0);
  responses={}; answeredCount=0; page=0;
  answers.length=0; rtimes.length=0; rl_items.length=0; fs_items.length=0; kc_items.length=0;

  QUESTIONS=decorateBankRandomly([...BANK]).sort(()=>Math.random()-0.5);
  showScreen('quiz'); renderPage();
}
function renderPage(){
  el('page-now').textContent=page+1;
  el('q-answered').textContent=answeredCount;
  el('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el('qgrid'); grid.innerHTML='';
  slice.forEach((q)=>{
    const left=q.flip?q.b:q.a; const right=q.flip?q.a:q.b;
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx"><span>çŠ¶æ³</span>${q.ctx}</div>
      <div class="lr" aria-label="å·¦å³ã®æ¯”è¼ƒæ–‡">
        <div class="side"><b>${left}</b></div>
        <div class="side"><b>${right}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6æ®µéšé¸æŠ">
        ${renderDots(q.id).join('')}
      </div>
    `;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));

  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val); // +3..-3
      selectDot(qid, uiVal, e.currentTarget);
    })
  });

  // 1..6 ã®ã‚­ãƒ¼å‰²å½“ï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®â€œæœªå›ç­”â€ã«é †æ¬¡å…¥åŠ›ï¼‰
  window.onkeydown=(e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };

  pageStartAt=performance.now();
}
function renderDots(qid){
  const tipsL=["å·¦ï¼šã¨ã¦ã‚‚è¿‘ã„","å·¦ï¼šã‹ãªã‚Šè¿‘ã„","å·¦ï¼šã‚„ã‚„è¿‘ã„"];
  const tipsR=["å³ï¼šã‚„ã‚„è¿‘ã„","å³ï¼šã‹ãªã‚Šè¿‘ã„","å³ï¼šã¨ã¦ã‚‚è¿‘ã„"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;

  const left=valsL.map((v,i)=>`
    <button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}" aria-label="${tipsL[i]}"></button>
  `);
  const right=valsR.map((v,i)=>`
    <button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}" aria-label="${tipsR[i]}"></button>
  `);
  return [...left, ...right];
}
function selectDot(qid, uiVal, btn){
  responses[qid] = responses[qid] || {};
  const firstTime = (responses[qid].uiVal === undefined);
  responses[qid].uiVal = uiVal;
  if(firstTime){
    responses[qid].ts = performance.now() - pageStartAt;
    answeredCount++; el('q-answered').textContent = answeredCount;
  }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');

  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}
function setNextEnabled(ok){el('btn-next').classList.toggle('disabled', !ok);}

/* ==== é›†è¨ˆï¼ˆãƒšãƒ¼ã‚¸ç¢ºå®šï¼‰==== */
function applyPage(){
  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  for(const q of slice){
    const r=responses[q.id]; if(!r) continue;
    const valForA=(q.flip?-r.uiVal:r.uiVal);  // +3..-3
    const towardA=Math.sign(valForA);
    const abs=Math.abs(valForA);
    const w=abs>=3?1.0:abs===2?0.7:0.4;

    answers.push({id:q.id,axis:q.axis,uiVal:r.uiVal,valForA,flipped:q.flip,ms:r.ts,ctx:q.ctx});
    rtimes.push(r.ts);

    const add=k=>counts[k]=(counts[k]||0)+w;
    if(q.axis==='RL'){ towardA>0 ? (add('R'), rl_items.push(1)) : (add('L'), rl_items.push(0)); }
    if(q.axis==='FS'){ towardA>0 ? (add('F'), fs_items.push(1)) : (add('S'), fs_items.push(0)); }
    if(q.axis==='KC'){ towardA>0 ? (add('K'), kc_items.push(1)) : (add('C'), kc_items.push(0)); }
    if(q.axis==='TX'){ towardA>0 ? add('Q') : add('M'); }
    if(q.axis==='FL'){ towardA>0 ? add('Salt') : add('Sauce'); }
    if(q.axis==='AF'){ towardA>0 ? add('Light') : add('Hearty'); }
  }
}

/* ==== ãƒšãƒ¼ã‚¸é·ç§» ==== */
el('btn-next').addEventListener('click', ()=>{
  if(el('btn-next').classList.contains('disabled')) return;
  applyPage();
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});

/* ==== åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¸è¥²ï¼‰==== */
function strongEdge(axis){let e=0;for(const a of answers){if(a.axis!==axis)continue;if(a.valForA>=3)e++; else if(a.valForA<=-3)e--;}return e;}
function axisSeed(axis){let s=0;for(const a of answers){if(axis!=='ALL'&&a.axis!==axis)continue;s+=(a.id*31)+((a.uiVal+3)*13);}return s & 1;}
function decideAxis(A,B,AL,BL,relA,relB,strongAxis,seed){if(A>B)return AL;if(B>A)return BL;const wA=A+relA,wB=B+relB;if(wA>wB)return AL;if(wB>wA)return BL;const edge=strongEdge(strongAxis);if(edge>0)return AL;if(edge<0)return BL;return seed?BL:AL;}

function scoreHarami(c){ return 0.60*c.Sauce - 0.60*c.Salt + 0.30*c.Hearty - 0.30*c.Light + 0.20*c.M - 0.20*c.Q; }
function scoreMisuji(c){ return 0.70*c.M - 0.70*c.Q + 0.20*c.Salt - 0.20*c.Sauce + 0.10*c.Light - 0.10*c.Hearty; }
function scoreShinshin(c){ return 0.55*c.Q - 0.55*c.M + 0.25*c.Light - 0.25*c.Hearty + 0.20*c.Salt - 0.20*c.Sauce; }
function scoreKainomi(c){ return 0.60*c.Q - 0.60*c.M + 0.30*c.Salt - 0.30*c.Sauce + 0.10*c.Light - 0.10*c.Hearty; }
function pickSubtype(code,c){
  switch(code){
    case 'R-F-K': return 'ãƒ’ãƒ¬';
    case 'R-F-C': return (scoreHarami(c)>0 ? 'ãƒãƒ©ãƒŸ':'ã‚¿ãƒ³');
    case 'R-S-K': return (scoreMisuji(c)>0 ? 'ãƒŸã‚¹ã‚¸':'ã‚¤ãƒãƒœ');
    case 'R-S-C': return 'ãƒ©ãƒ³ãƒ—';
    case 'L-F-K': return (scoreShinshin(c)>0 ? 'ã‚·ãƒ³ã‚·ãƒ³':'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹');
    case 'L-F-C': return 'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³';
    case 'L-S-K': return 'ã‚¶ãƒ–ãƒˆãƒ³';
    case 'L-S-C': return (scoreKainomi(c)>0 ? 'ã‚«ã‚¤ãƒãƒŸ':'ã‚«ãƒ«ãƒ“');
    default: return 'ãƒ’ãƒ¬';
  }
}
function computeResult(){
  const R=counts.R,L=counts.L,F=counts.F,S=counts.S,K=counts.K,C=counts.C,Q=counts.Q,M=counts.M,Salt=counts.Salt,Sauce=counts.Sauce,Light=counts.Light,Hearty=counts.Hearty;
  const R_adj=(Q>=2?1:0)+(Salt>=2?1:0)+(Light>=2?1:0);
  const L_adj=(M>=2?1:0)+(Sauce>=2?1:0)+(Hearty>=2?1:0);
  const Rf=R+R_adj, Lf=L+L_adj;

  const RL=decideAxis(Rf,Lf,'R','L',0.60*Q+0.25*Salt+0.15*Light,0.60*M+0.25*Sauce+0.15*Hearty,'RL',axisSeed('RL'));
  const FS=decideAxis(F,S,'F','S',0.50*Light+0.30*Salt+0.20*Q,0.50*Hearty+0.30*Sauce+0.20*M,'FS',axisSeed('FS'));
  const KC=decideAxis(K,C,'K','C',0.45*Salt+0.25*Light+0.15*Q,0.45*Sauce+0.25*Hearty+0.15*M,'KC',axisSeed('KC'));

  const code=`${RL}-${FS}-${KC}`;
  let baseName=pickSubtype(code,{Q,M,Salt,Sauce,Light,Hearty});
  let name=baseName;

  // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼šã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ï¼ˆç´„2%ç‹™ã„ã®å³ã—ã‚æ¡ä»¶ï¼‰
  const dRL=Math.max(0,(RL==='R'?Rf-Lf:Lf-Rf));
  const dFS=Math.max(0,(FS==='F'?F-S:S-F));
  const dKC=Math.max(0,(KC==='K'?K-C:C-K));
  const isCB=(code==='R-F-K')&&(baseName==='ãƒ’ãƒ¬')&&(M>=2 && Salt>=2 && Light>=2)&&(dRL>=1.3 && dFS>=1.1 && dKC>=1.0)&&(strongEdge('RL')>0)&&(axisSeed('ALL')===1);
  if(isCB) name='ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³';

  const tagTexture=(Q>=M)?'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘';
  const tagFlavor =(Salt>=Sauce)?'å¡©æ´¾':'ã‚½ãƒ¼ã‚¹æ´¾';
  const tagAfter  =(Light>=Hearty)?'è»½ã‚„ã‹':'æº€è¶³';

  return {code,baseName,name,R_base:R,L_base:L,F,S,K,C,Q,M,Salt,Sauce,Light,Hearty,R_adj,L_adj,Rf,Lf,tagTexture,tagFlavor,tagAfter};
}

function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allTypeCodes(){return Object.keys(CODE_REPR);}
function bestMatch(code){
  const mine=parseCode(code);let best=null,bestScore=-1;
  for(const t of allTypeCodes()){
    if(t===code) continue;
    const other=parseCode(t);
    let opp=0,same=0;
    if(other.RL===OPP[mine.RL])opp++;
    if(other.FS===OPP[mine.FS])opp++;
    if(other.KC===OPP[mine.KC])opp++;
    if(other.RL===mine.RL)same++;
    if(other.FS===mine.FS)same++;
    if(other.KC===mine.KC)same++;
    const score=(opp>=2)?opp*10:(opp*10+same);
    if(score>bestScore){bestScore=score;best=t;}
  }
  return best;
}

/* ==== ä¿¡é ¼åº¦ ==== */
function smoothedRatio(a,b,prior=1.2){const p=(a+prior)/(a+b+2*prior);return p;}
function axisConfidence(a,b){const p=smoothedRatio(a,b);return Math.max(p,1-p);}
function kr20(items){const k=items.length;if(k<2)return null;const mean=items.reduce((s,x)=>s+x,0)/k;const vari=items.reduce((s,x)=>s+(x-mean)**2,0)/k;const totalVar=k*mean*(1-mean);if(totalVar===0)return null;return (k/(k-1))*(1-(k*vari)/totalVar);}
function percentile(arr,p){const a=[...arr].sort((x,y)=>x-y);const i=Math.floor((a.length-1)*p);return a[i]??0;}
function qualityAssess(r){
  const confRL=axisConfidence(r.R_base,r.L_base), confFS=axisConfidence(r.F,r.S), confKC=axisConfidence(r.K,r.C);
  const overall=Math.round(((confRL+confFS+confKC)/3)*100);
  const alphaRL=kr20(rl_items), alphaFS=kr20(fs_items), alphaKC=kr20(kc_items);
  const medRT=percentile(rtimes,0.5);
  const tooFast=rtimes.filter(ms=>ms<300).length>=5;
  const posBias=Math.max(answers.filter(a=>a.uiVal>0).length,answers.filter(a=>a.uiVal<0).length)/answers.length;
  let notes=[]; if(alphaRL!==null && alphaRL<0.4) notes.push('R/Lã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚');
  if(alphaFS!==null && alphaFS<0.4) notes.push('F/Sã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚');
  if(alphaKC!==null && alphaKC<0.4) notes.push('K/Cã®å›ç­”ä¸€è²«æ€§ãŒã‚„ã‚„ä½ã„ã‹ã‚‚');
  if(tooFast) notes.push('éå¸¸ã«é€Ÿã„å›ç­”ãŒå¤šã„ï¼ˆé€£æ‰“ã®å¯èƒ½æ€§ï¼‰');
  if(posBias>0.9) notes.push('å·¦/å³ã©ã¡ã‚‰ã‹ã«æ¥µç«¯ã«åã£ãŸé¸æŠ');
  return {confRL,confFS,confKC,overall,alphaRL,alphaFS,alphaKC,medRT,tooFast,posBias,notes};
}
function setMeter(id,pct){el(id).style.width=pct+'%';const tId=id+'-text';if(el(tId)) el(tId).textContent=Math.round(pct)+'%';}

/* ==== çµæœè¡¨ç¤º ==== */
function showResult(){
  el('bar').style.width='100%';
  const r=computeResult(); showScreen('result');
  el('r-type-name').textContent=r.name;
  el('r-type-code').textContent=r.code;
  el('tag-texture').textContent=r.tagTexture;
  el('tag-flavor').textContent=r.tagFlavor;
  el('tag-after').textContent=r.tagAfter;
  el('r-desc').textContent=DESCRIPTIONS[r.name]||'';
  const bm=bestMatch(r.code); const repr=CODE_REPR[bm]||bm;
  el('r-best').textContent=bm?`${repr}ï¼ˆ${bm}ï¼‰`:'â€”';

  const qa=qualityAssess(r);
  setMeter('conf-overall',qa.overall); el('conf-overall-text').textContent=`${qa.overall}% ${qa.overall>=75?'ï¼ˆé«˜ï¼‰':qa.overall>=60?'ï¼ˆä¸­ï¼‰':'ï¼ˆä½ï¼‰'}`;
  setMeter('conf-rl',qa.confRL*100); el('conf-rl-text').textContent=`${Math.round(qa.confRL*100)}%`;
  setMeter('conf-fs',qa.confFS*100); el('conf-fs-text').textContent=`${Math.round(qa.confFS*100)}%`;
  setMeter('conf-kc',qa.confKC*100); el('conf-kc-text').textContent=`${Math.round(qa.confKC*100)}%`;

  const detail=[
    `Code: ${r.code} / Base: ${r.baseName} / Display: ${r.name}`,
    `R/L base: R=${r.R_base.toFixed(1)}, L=${r.L_base.toFixed(1)}  adj: R+${r.R_adj}, L+${r.L_adj}  â†’ Rf=${r.Rf.toFixed(1)}, Lf=${r.Lf.toFixed(1)}`,
    `F/S: F=${r.F.toFixed(1)}, S=${r.S.toFixed(1)}`,
    `K/C: K=${r.K.toFixed(1)}, C=${r.C.toFixed(1)}`,
    `Texture: Q=${r.Q.toFixed(1)}, M=${r.M.toFixed(1)}  Flavor: Salt=${r.Salt.toFixed(1)}, Sauce=${r.Sauce.toFixed(1)}  After: Light=${r.Light.toFixed(1)}, Hearty=${r.Hearty.toFixed(1)}`
  ].join('\n');
  el('r-detail').textContent=detail;

  const payload={type:{baseCode:r.code,baseName:r.baseName,displayName:r.name},tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},counts:{R:r.R_base,L:r.L_base,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M,Salt:r.Salt,Sauce:r.Sauce,Light:r.Light,Hearty:r.Hearty},answers,generatedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=el('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

/* Start / Retry / Copy */
addEventListener('click',(ev)=>{ const t=ev.target.closest('#btn-start,#btn-start-2'); if(!t) return; ev.preventDefault(); start(); });
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',()=>{showScreen('start')});
const copy=document.getElementById('btn-copy'); if(copy) copy.addEventListener('click',async()=>{
  const name=el('r-type-name').textContent, code=el('r-type-code').textContent;
  const tags=[el('tag-texture').textContent,el('tag-flavor').textContent,el('tag-after').textContent].join('ãƒ»');
  const text=`MEAT-BTI v7.4\néƒ¨ä½ã‚¿ã‚¤ãƒ—ï¼š${name}ï¼ˆ${code}ï¼‰\nã‚¿ã‚°ï¼š${tags}`;
  try{await navigator.clipboard.writeText(text); el('btn-copy').textContent='ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'; setTimeout(()=>el('btn-copy').textContent='çµæœã‚’ã‚³ãƒ”ãƒ¼',1500);}catch{alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');}
});
</script>
</body>
</html>
