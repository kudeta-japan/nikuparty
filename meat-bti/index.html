<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MEAT-BTIï½œãƒ†ã‚¹ãƒˆç‰ˆï¼ˆ20å•ãƒ»6æ®µéšï¼‰</title>
<meta name="description" content="20å•Ã—6æ®µéšã€ä¸¦ã³å›ºå®šã€‚ã‚ãªãŸã®â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ã¨ç›¸æ€§No.1ã‚’åˆ¤å®šã€‚"/>

<style>
  :root{
    --bg:#0a0b10; --panel:#0f1219; --ink:#f7f9ff; --muted:#b9c6db; --bd:#1c2333;
    --acc:#ff715b; --acc2:#ffd166; --shadow:0 12px 30px rgba(0,0,0,.35);
  }
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;
    letter-spacing:.02em; line-height:1.65;
  }
  .app{width:min(980px,94vw);margin:0 auto;padding:16px 0 24px}

  /* ==== HERO IMAGEï¼ˆæœ¬æ–‡å¹…ã«åˆã‚ã›ã¦ã€è¨ºæ–­ä¸­ã‚‚å¸¸æ™‚è¡¨ç¤ºï¼‰ ==== */
  .hero-wrap{position:sticky;top:0;z-index:5;padding:10px 0 0;}
  .hero{
    width:min(980px,94vw); margin:0 auto;
    border-radius:18px; overflow:hidden; border:1px solid var(--bd); background:#000;
    box-shadow:0 16px 36px rgba(0,0,0,.35);
  }
  .hero img{display:block; width:100%; height:auto; object-fit:cover; object-position:center;}
  @media (max-width: 600px){ .hero img{ aspect-ratio: 16 / 9; } }

  /* ==== Header ==== */
  .headbar{
    width:min(980px,94vw); margin:10px auto 14px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:900}
  .logo{width:32px;height:32px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111}

  .btn{
    appearance:none;border:1px solid var(--bd);background:#151a23;color:var(--ink);
    padding:11px 14px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease
  }
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}
  .btn.ghost{background:#121722;border-color:#2a3446}

  /* ==== Card & Sections ==== */
  .card{
    width:min(980px,94vw); margin:0 auto; background:var(--panel);border:1px solid var(--bd);
    border-radius:20px;box-shadow:var(--shadow);overflow:hidden
  }
  .section{padding:16px}

  /* ==== Intro ==== */
  .intro{padding:16px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{background:#121829;border:1px solid #2a3245;color:#dfe7f5;border-radius:999px;padding:6px 10px;font-size:12px}
  .muted{color:var(--muted);font-size:14px}

  /* ==== Type Galleryï¼ˆæ–°è¦è¿½åŠ ï¼‰ ==== */
  .gallery{padding:14px}
  .g-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .grid12{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(min-width:700px){.grid12{grid-template-columns:repeat(4,1fr)}}
  .tcard{display:flex;gap:10px;align-items:center;background:#101528;border:1px solid #27314a;border-radius:12px;padding:10px}
  .tcard img{width:56px;height:56px;border-radius:12px;object-fit:contain;background:#0c1325;border:1px solid #2a334e}
  .tcard b{display:block}
  .t-small{font-size:12px;color:var(--muted)}

  /* ==== Quiz ==== */
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:240px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#101528;border:1px solid #27314a;border-radius:14px;padding:14px}
  .ctx{color:#e7ecf8;font-weight:700;font-size:clamp(14px,2.8vw,16px);margin:-2px 0 8px}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:stretch;pointer-events:none}
  .side{background:#0f1524;border:1px solid #2a334e;border-radius:12px;padding:10px;min-height:66px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2677c8);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* ==== Result ==== */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(26px,6vw,34px);font-weight:900}
  .desc{margin-top:10px;line-height:1.9}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  footer{padding:10px 16px 16px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>

<!-- å¸¸æ™‚è¡¨ç¤ºã®ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆé‡ã­ãªã—ï¼‰ -->
<div class="hero-wrap">
  <figure class="hero">
    <img src="mbti.jpg" alt="MEAT-BTI ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ">
  </figure>
</div>

<!-- 12ã‚¿ã‚¤ãƒ— ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆâ˜…æ–°è¦ã€‚ãƒ’ãƒ¼ãƒ­ãƒ¼ç›´ä¸‹ï¼‰ -->
<div class="card" style="margin-top:12px">
  <section class="gallery">
    <div class="g-head">
      <h2 style="margin:0;font-size:clamp(18px,4.6vw,24px);font-weight:900">12ã‚¿ã‚¤ãƒ—ä¸€è¦§</h2>
      <button class="btn primary" data-action="start">è¨ºæ–­ã™ã‚‹</button>
    </div>
    <div id="typeGrid" class="grid12"><!-- JSã§æŒ¿å…¥ --></div>
  </section>
</div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆé–‹å§‹ãƒœã‚¿ãƒ³ã‚ã‚Šï¼‰ -->
<div class="headbar">
  <div class="brand"><div class="logo">ğŸ¥©</div><div>MEAT-BTI ãƒ†ã‚¹ãƒˆ</div></div>
  <button class="btn primary" data-action="start">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
</div>

<main class="app">
  <div class="card">
    <!-- Intro -->
    <section class="intro">
      <h1 style="margin:0 0 6px;font-size:clamp(22px,5.4vw,30px);font-weight:900">è‚‰å¥½ãã®ãŸã‚ã® â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ è¨ºæ–­</h1>
      <p class="muted" style="margin:0 0 8px">20å•ãƒ»6æ®µéšï¼ˆä¸­ç«‹ãªã—ï¼‰ã€‚ç›´æ„Ÿã§OKã€‚å›ç­”å¾Œã¯ã€Œã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ã€ã¨ã€Œç›¸æ€§No.1ã€ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
      <div class="badges" style="margin-bottom:6px">
        <span class="badge">ä¸¦ã³å›ºå®š</span>
        <span class="badge">6æŠ Ã— 20å•</span>
        <span class="badge">ç›¸æ€§No.1ã®ã¿è¡¨ç¤º</span>
      </div>
      <button class="btn ghost" data-action="start">è¨ºæ–­ã™ã‚‹</button>
    </section>

    <!-- QUIZ -->
    <section id="screen-quiz" class="section" hidden>
      <div class="q-head">
        <div class="q-index"><span id="page-now">1</span>/4ãƒšãƒ¼ã‚¸ï¼ˆ<span id="q-answered">0</span>/20ï¼‰</div>
        <div class="bar"><div id="bar"></div></div>
      </div>

      <div id="qgrid" class="qgrid"><!-- 5å•ãŒã“ã“ã«å‡ºã‚‹ --></div>

      <div class="q-foot">
        <div>å·¦å³ã®èª¬æ˜ã‚’èª­ã‚“ã§ã€ä¸­å¤®ã®ä¸¸ã§â€œã©ã¡ã‚‰å¯„ã‚Šã‹â€ã‚’é¸æŠ</div>
        <div><button id="btn-next" class="btn primary disabled">æ¬¡ã®5å•ã¸</button></div>
      </div>
      <div class="progress-note">å·¦ï¼ˆé’ï¼‰â‡”å³ï¼ˆèµ¤ï¼‰ã»ã©å¼·ã„ã€‚ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ <b>1â€“6</b> ã§ã‚‚é¸ã¹ã¾ã™ã€‚</div>
    </section>

    <!-- RESULT -->
    <section id="screen-result" class="section" hidden>
      <div class="result">
        <div class="big">è¨ºæ–­çµæœ</div>
        <div class="grid">
          <div class="r-card">
            <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
            <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
            <div class="mono" id="r-type-code" style="opacity:.8">â€”</div>
            <p class="desc" id="r-desc"></p>
          </div>
          <div class="r-card">
            <div><strong>ç›¸æ€§No.1</strong></div>
            <div id="r-best" class="mono" style="margin-top:6px"></div>
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;gap:10px;margin-top:6px">
          <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
          <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
        </div>
      </div>
    </section>

    <footer>Â© KU-DETA / ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” Test Build</footer>
  </div>
</main>

<script>
/* ========= ã‚¿ã‚¤ãƒ—è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ ========= */
const MEAT_TYPE_TEXT = {
  "ãƒ’ãƒ¬":{ nick:"é™ã‹ãªä¸»å½¹", catch:"ç„¡é§„ãªãä¸Šå“ã€èŠ¯ãŒå¼·ã„èµ¤èº«æ´¾ã€‚" },
  "ã‚¿ãƒ³":{ nick:"å ´ã‚’ã»ãã™ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼", catch:"ã‚­ãƒ¬ã‚ˆãè»½å¿«ã€ä¼šè©±ã‚’ã»ã©ãã€‚" },
  "ã‚¤ãƒãƒœ":{ nick:"å¯„ã‚Šæ·»ã†ä»²ä»‹å½¹", catch:"ç©ã‚„ã‹ã«åˆã‚ã›ã€èµ¤èº«ã‚’ä¸å¯§ã«ã€‚" },
  "ãƒ©ãƒ³ãƒ—":{ nick:"ä¸€æ­©å…ˆã‚’ç…§ã‚‰ã™æ¡ˆå†…å½¹", catch:"ç‹é“ã«â€œã²ã¨åŒ™ã®æ–°ã—ã•â€ã‚’æ·»ãˆã‚‹ã€‚" },
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":{ nick:"å®‰å¿ƒæ„Ÿã®ãƒªãƒ¼ãƒ€ãƒ¼", catch:"ç‹é“ã¨æ®µå–ã‚Šã§ã€æº€è¶³ã‚’ç´„æŸã€‚" },
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":{ nick:"ä¸»å½¹æ„Ÿã®ã‚ã‚‹æ¼”å‡ºå®¶", catch:"ã‚³ã‚¯ã¨è¦‹ã›å ´ã§â€œè¯ã‚„ã‹â€ã«ç‰½å¼•ã€‚" },
  "ã‚¶ãƒ–ãƒˆãƒ³":{ nick:"ã˜ã£ãã‚Šèªã‚‹ç›¸æ£’", catch:"æ¿ƒåšã‚’å°‘ã—ã€é™ã‹ã«ã‚†ã£ãã‚Šã€‚" },
  "ã‚«ãƒ«ãƒ“":{ nick:"è¦ªã—ã¿æº€ç‚¹ã®ç››ã‚Šä¸Šã’å½¹", catch:"ç”˜ã‚ã®æº€è¶³æ„Ÿã§â€œã¿ã‚“ãªã‚’ä¸€ã¤ã«â€ã€‚" },
  "ãƒãƒ©ãƒŸ":{ nick:"å›è»¢ä¸Šæ‰‹ã®é€²è¡Œå½¹", catch:"èµ¤èº«ã§ãƒ†ãƒ³ãƒã‚ˆãã€æ°—æŒã¡ã‚ˆãå›ã™ã€‚" },
  "ã‚«ã‚¤ãƒãƒŸ":{ nick:"è»½ã‚è´…æ²¢ã®ã¾ã¨ã‚å½¹", catch:"é‡ã™ããªã„æº€è¶³ã€‚å¡©ã§ã‚‚æ˜ ãˆã‚‹ã€‚" },
  "ãƒŸã‚¹ã‚¸":{ nick:"ç¹Šç´°ãªè·äºº", catch:"å£ã©ã‘ä¸Šå“ã€æ‰€ä½œã¨æ°—é…ã‚Šã€‚" },
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":{ nick:"é™ã‹ã«ã“ã ã‚ã‚‹é”äºº", catch:"é‡ã‚ˆã‚Šè³ªã€‚è½ã¡ç€ã„ã¦æ·±ãå‘³ã‚ã†ã€‚" }
};

/* ========= 12ã‚¿ã‚¤ãƒ—ç”»åƒï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åå¯¾å¿œï¼‰ ========= */
const TYPE_IMAGES = {
  "ãƒ’ãƒ¬":"hire.png","ã‚¿ãƒ³":"tan.png","ã‚¤ãƒãƒœ":"ichibo.png","ãƒ©ãƒ³ãƒ—":"ranpu.png",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"riburo-su.png","ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"sa-roin.png","ã‚¶ãƒ–ãƒˆãƒ³":"zabuton.png",
  "ã‚«ãƒ«ãƒ“":"karubi.png","ãƒãƒ©ãƒŸ":"harami.png","ã‚«ã‚¤ãƒãƒŸ":"kainomi.png",
  "ãƒŸã‚¹ã‚¸":"misuji.png","ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"shato-.png"
};

/* ========= ã‚®ãƒ£ãƒ©ãƒªãƒ¼æç”» ========= */
(function renderGallery(){
  const grid=document.getElementById('typeGrid');
  const order=["ãƒ’ãƒ¬","ã‚¿ãƒ³","ã‚¤ãƒãƒœ","ãƒ©ãƒ³ãƒ—","ãƒªãƒ–ãƒ­ãƒ¼ã‚¹","ã‚µãƒ¼ãƒ­ã‚¤ãƒ³","ã‚¶ãƒ–ãƒˆãƒ³","ã‚«ãƒ«ãƒ“","ãƒãƒ©ãƒŸ","ã‚«ã‚¤ãƒãƒŸ","ãƒŸã‚¹ã‚¸","ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³"];
  grid.innerHTML = order.map(name=>{
    const meta=MEAT_TYPE_TEXT[name]; const img=TYPE_IMAGES[name]||"";
    return `
      <div class="tcard">
        <img src="${img}" alt="${name}">
        <div><b>${name}</b><div class="t-small">${meta?.nick||""}</div></div>
      </div>`;
  }).join('');
})();

/* ========= ä»¥é™ã¯å…ƒã®è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ ========= */
/* ========= è³ªå•ï¼ˆ20å•ãƒ»ä¸¦ã³å›ºå®šï¼‰ ========= */
const BANK = [
  {id:1, axis:"RL", text:"æœ€åˆã®ä¸€çš¿ã€ã©ã¡ã‚‰ã«æƒ¹ã‹ã‚Œã‚‹ï¼Ÿ", A:"è„‚å°‘ãªã‚ã§èµ¤èº«ã®æ—¨ã¿ã‚’å‘³ã‚ã†", B:"ã‚µã‚·ã®ã‚³ã‚¯ã¨æº€è¶³æ„Ÿã‚’é‡è¦–"},
  {id:2, axis:"RL", text:"åŒã˜ä¾¡æ ¼ã®èµ¤èº«ã¨éœœé™ã‚Šã€ä»Šã®æ°—åˆ†ã¯ï¼Ÿ", A:"ã‚­ãƒ¬é‡è¦–ï¼ˆã•ã£ã±ã‚Šï¼‰", B:"ã‚³ã‚¯é‡è¦–ï¼ˆæ¿ƒåšï¼‰"},
  {id:3, axis:"RL", text:"â€œé‡ã‚’ã—ã£ã‹ã‚Šâ€é£Ÿã¹ã‚‹ãªã‚‰ï¼Ÿ", A:"è»½ã‚ã®èµ¤èº«ä¸­å¿ƒã§é€²ã‚ãŸã„", B:"æº€è¶³æ„Ÿã®é«˜ã„éƒ¨ä½ã§æŠ¼ã—ãŸã„"},
  {id:4, axis:"RL", text:"åç‰©ã‹ã‚‰é¸ã¶ãªã‚‰ï¼Ÿ", A:"ãƒ’ãƒ¬ï¼ã‚¿ãƒ³ãªã©â€œèµ¤èº«å¯„ã‚Šâ€", B:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ï¼ã‚«ãƒ«ãƒ“ãªã©â€œã‚³ã‚¯å¯„ã‚Šâ€"},
  {id:5, axis:"RL", text:"1çš¿ã ã‘è¿½åŠ ã€‚è¿·ã£ãŸã‚‰ã©ã£ã¡ï¼Ÿ", A:"èµ¤èº«ç³»ã§ã‚‚ã†ä¸€çš¿", B:"ãƒªãƒƒãƒç³»ã§ã‚‚ã†ä¸€çš¿"},
  {id:6, axis:"TX", text:"ã‚¹ãƒ†ãƒ¼ã‚­ã®é£Ÿæ„Ÿã€ã©ã¡ã‚‰ãŒå¥½ãï¼Ÿ", A:"å™›ã‚“ã æ™‚ã®æ­¯åˆ‡ã‚Œãƒ»è‚‰æ„Ÿã‚’æ¥½ã—ã‚€", B:"å£ã®ä¸­ã§ã¨ã‚ã‘ã‚‹æŸ”ã‚‰ã‹ã•"},
  {id:7, axis:"TX", text:"ç„¼ãåŠ æ¸›ã®å¸Œæœ›ã¯ï¼Ÿï¼ˆã‚¹ãƒ†ãƒ¼ã‚­æƒ³å®šï¼‰", A:"ãƒ¬ã‚¢ã€œãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ¬ã‚¢å¯„ã‚Š", B:"ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã€œã‚¦ã‚§ãƒ«ãƒ€ãƒ³å¯„ã‚Š"},
  {id:8, axis:"TX", text:"ç„¼ãæ‹…å½“ã«ãªã£ãŸã‚‰ï¼Ÿ", A:"çŸ­æ™‚é–“ã§ã‚µãƒƒã¨ä»•ä¸Šã’ã‚‹", B:"ç«å…¥ã‚Œã‚’å…¥å¿µã«ã—ã¦æŸ”ã‚‰ã‹ã"},
  {id:9, axis:"FL", text:"å‘³ä»˜ã‘ã®ç¬¬ä¸€é¸æŠã¯ï¼Ÿ", A:"å¡©ãƒ»ãƒ¬ãƒ¢ãƒ³ãªã©ã‚·ãƒ³ãƒ—ãƒ«", B:"ç‰¹è£½ã‚½ãƒ¼ã‚¹ã§ä»•ä¸Šã’ãŸã„"},
  {id:10, axis:"KC", text:"æ¼”å‡ºã‚ã‚Šã®ä¸€çš¿ãªã‚‰ã€ã©ã£ã¡ãŒã†ã‚Œã—ã„ï¼Ÿ", A:"ã‚·ãƒ³ãƒ—ãƒ«ã«ç„¼ã„ã¦â€œç´ æãã®ã¾ã¾â€ã§å‘³ã‚ã†", B:"ãƒ•ãƒ©ãƒ³ãƒ™ã‚„â€œç‰¹è£½ã‚½ãƒ¼ã‚¹ã®ã‹ã‘ä»•ä¸Šã’â€ãªã©è¦‹ã›å ´"},
  {id:11, axis:"KC", text:"æœ€åˆã®æ³¨æ–‡ã®çµ„ã¿ç«‹ã¦ã¯ï¼Ÿ", A:"å®šç•ªã‹ã‚‰å…¥ã‚Šã€æ§˜å­ã‚’è¦‹ã¦å¤‰åŒ–ã‚’è¶³ã™", B:"é™å®šã‚„å‰µä½œã‚’æ—©ã‚ã«æ··ãœã‚‹"},
  {id:12, axis:"KC", text:"åˆã‚ã¦ã®åº—ã€‚æœªçŸ¥ã®éƒ¨ä½ã‚„ä»•ä¸Šã’ã¯ï¼Ÿ", A:"ã¾ãšã¯å®šç•ªãƒ»åç‰©ã‚’å„ªå…ˆ", B:"æ°—ã«ãªã‚‹æ–°é¡”ã‚’è©¦ã—ã¦ã¿ãŸã„"},
  {id:13, axis:"FS", text:"æ³¨æ–‡ã¯ï¼Ÿ", A:"ä¸€çš¿ãšã¤æ§˜å­ã‚’è¦‹ã¦è¿½åŠ ", B:"ã¾ã¨ã‚ã¦é ¼ã‚“ã§ãƒ†ãƒ³ãƒã‚ˆãå›ã™"},
  {id:14, axis:"FS", text:"ã‚³ãƒ¼ã‚¹ã‹ã‚¢ãƒ©ã‚«ãƒ«ãƒˆã‹", A:"ãƒ†ãƒ³ãƒã‚ˆãã‚¢ãƒ©ã‚«ãƒ«ãƒˆã§è‰²ã€…", B:"ã‚†ã£ãã‚Šã‚³ãƒ¼ã‚¹ã§æµã‚Œã«ä¹—ã‚‹"},
  {id:15, axis:"FS", text:"é€±æœ«ã€‚æ°—ã«å…¥ã£ãŸãŠåº—ã ã£ãŸã‚‰ï¼Ÿ", A:"æ¬¡ã®ãŠåº—ã«ã‚‚è¡Œã£ã¦â€œè»½ãã¯ã—ã”â€", B:"ãã®ãŠåº—ã«â€œã¨ã©ã¾ã£ã¦ã‚†ã£ãã‚Šâ€"},
  {id:16, axis:"AF", text:"ç· ã‚ã®è€ƒãˆæ–¹", A:"è»½ã‚ã§OKï¼ç· ã‚ãªã—ã§ã‚‚è‰¯ã„", B:"ã”é£¯ãƒ»éººãƒ»ãƒ‡ã‚¶ãƒ¼ãƒˆã¾ã§æº€è¶³ã—ãŸã„"},
  {id:17, axis:"AF", text:"æœ€åˆã®ä¸€æ¯", A:"ãƒã‚¤ãƒœãƒ¼ãƒ«ã‚„ã™ã£ãã‚Šå¯„ã‚Š", B:"ç”˜ã‚ã‚„æ¿ƒã„ç³»ã‚‚ã„ããŸã„"},
  {id:18, axis:"AF", text:"ä»Šæ—¥ã¯ã“ã“ã§çµ‚ãˆã‚‹ï¼Ÿ", A:"ä½™ç™½ã‚’æ®‹ã—ã¦è»½ã‚ã«ç· ã‚ã‚‹", B:"ã“ã“ã§å®Œçµã€‚ã—ã£ã‹ã‚Šé£Ÿã¹åˆ‡ã‚‹"},
  {id:19, axis:"KC", text:"å†™çœŸã‚„è¦‹ã›å ´ã«ã¤ã„ã¦", A:"è¦‹ãŸç›®ã¯ã»ã©ã»ã©ã€ä¸­èº«é‡è¦–", B:"â€œä»•ä¸Šã’â€ã‚„æ˜ ãˆã‚‹è¦‹ã›å ´ãŒå¥½ã"},
  {id:20, axis:"RL", text:"èµ¤èº«vsã‚³ã‚¯ã€æœ€å¾Œã«ã‚‚ã†ä¸€åº¦ã€‚ç›´æ„Ÿã§ã€‚", A:"èµ¤èº«å¯„ã‚Š", B:"ã‚³ã‚¯å¯„ã‚Š"}
];

/* ========= å†…éƒ¨é›†è¨ˆï¼ˆå…ƒã®å‡¦ç†ï¼‰ ========= */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let page=0, responses={}, answeredCount=0, pageStartAt=0;
let answers=[], rtimes=[];
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0};

const el2=id=>document.getElementById(id);
const screenQuiz=el2('screen-quiz'), screenResult=el2('screen-result');
function showScreen(which){ screenQuiz.hidden = which!=='quiz'; screenResult.hidden = which!=='result'; }

/* ========= ãƒ•ãƒ­ãƒ¼ ========= */
function start(){
  for(const k of Object.keys(counts)) counts[k]=0;
  responses={}; answeredCount=0; page=0; answers=[]; rtimes=[];
  showScreen('quiz'); renderPage(); window.scrollTo({top:0, behavior:'smooth'});
}
function renderPage(){
  el2('page-now').textContent=page+1;
  el2('q-answered').textContent=answeredCount;
  el2('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el2('qgrid'); grid.innerHTML='';
  slice.forEach(q=>{
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx">${q.text}</div>
      <div class="lr" aria-label="å·¦å³ã®æ¯”è¼ƒæ–‡">
        <div class="side"><b>${q.A}</b></div>
        <div class="side"><b>${q.B}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6æ®µéšé¸æŠ">
        ${renderDots(q.id).join('')}
      </div>`;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));
  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val);
      selectDot(qid, uiVal, e.currentTarget);
    });
  });

  window.onkeydown=(e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };
  pageStartAt=performance.now();
}
function renderDots(qid){
  const tipsL=["å·¦ï¼šã¨ã¦ã‚‚è¿‘ã„","å·¦ï¼šã‹ãªã‚Šè¿‘ã„","å·¦ï¼šã‚„ã‚„è¿‘ã„"];
  const tipsR=["å³ï¼šã‚„ã‚„è¿‘ã„","å³ï¼šã‹ãªã‚Šè¿‘ã„","å³ï¼šã¨ã¦ã‚‚è¿‘ã„"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;
  const left=valsL.map((v,i)=>`<button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}"></button>`);
  const right=valsR.map((v,i)=>`<button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}"></button>`);
  return [...left, ...right];
}
function selectDot(qid, uiVal, btn){
  responses[qid] = responses[qid] || {};
  const firstTime = (responses[qid].uiVal === undefined);
  responses[qid].uiVal = uiVal;
  if(firstTime){
    responses[qid].ts = performance.now() - pageStartAt;
    answeredCount++; el2('q-answered').textContent = answeredCount;
  }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');

  const startIdx=page*PAGE_SIZE; const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}
function setNextEnabled(ok){ el2('btn-next').classList.toggle('disabled', !ok); }
function applyPage(){
  const startIdx=page*PAGE_SIZE; const slice=BANK.slice(startIdx, startIdx+PAGE_SIZE);
  for(const q of slice){
    const r=responses[q.id]; if(!r) continue;
    const valForA=r.uiVal; const towardA=Math.sign(valForA);
    const abs=Math.abs(valForA); const w=abs>=3?1.0:abs===2?0.7:0.4;
    answers.push({id:q.id,axis:q.axis,uiVal:r.uiVal,valForA,ms:r.ts,text:q.text}); rtimes.push(r.ts);
    const add=k=>counts[k]=(counts[k]||0)+w;
    if(q.axis==='RL'){ towardA>0 ? add('R') : add('L'); }
    if(q.axis==='FS'){ towardA>0 ? add('F') : add('S'); }
    if(q.axis==='KC'){ towardA>0 ? add('K') : add('C'); }
    if(q.axis==='TX'){ towardA>0 ? add('Q') : add('M'); }
    if(q.axis==='FL'){ towardA>0 ? add('Salt') : add('Sauce'); }
    if(q.axis==='AF'){ towardA>0 ? add('Light') : add('Hearty'); }
  }
}

/* ========= åˆ¤å®š ========= */
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};
function decideAxis(A,B,AL,BL,relA=0,relB=0){
  if(A>B) return AL;
  if(B>A) return BL;
  const wA=A+relA, wB=B+relB;
  if(wA>wB) return AL;
  if(wB>wA) return BL;
  return AL;
}
function pickSubtype(code,c){
  switch(code){
    case 'R-F-K': return (c.Q>=2 && c.Salt>=2 && c.Light>=2) ? 'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³' : 'ãƒ’ãƒ¬';
    case 'R-F-C': return (c.Sauce>=c.Salt || c.Hearty>c.Light) ? 'ãƒãƒ©ãƒŸ' : 'ã‚¿ãƒ³';
    case 'R-S-K': return (c.M>c.Q) ? 'ãƒŸã‚¹ã‚¸' : 'ã‚¤ãƒãƒœ';
    case 'R-S-C': return 'ãƒ©ãƒ³ãƒ—';
    case 'L-F-K': return 'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹';
    case 'L-F-C': return 'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³';
    case 'L-S-K': return 'ã‚¶ãƒ–ãƒˆãƒ³';
    case 'L-S-C': return (c.Light>c.Hearty && c.Salt>=c.Sauce) ? 'ã‚«ã‚¤ãƒãƒŸ' : 'ã‚«ãƒ«ãƒ“';
    default: return 'ãƒ’ãƒ¬';
  }
}
function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allBaseCodes(){ return ['R-F-K','R-F-C','R-S-K','R-S-C','L-F-K','L-F-C','L-S-K','L-S-C']; }
function bestMatch(code){
  const mine=parseCode(code);let best=null,bestScore=-1;
  for(const t of allBaseCodes()){
    if(t===code) continue;
    const other=parseCode(t);
    let opp=0,same=0;
    if(other.RL===OPP[mine.RL])opp++;
    if(other.FS===OPP[mine.FS])opp++;
    if(other.KC===OPP[mine.KC])opp++;
    if(other.RL===mine.RL)same++;
    if(other.FS===mine.FS)same++;
    if(other.KC===mine.KC)same++;
    const score=(opp>=2)?opp*10:(opp*10+same);
    if(score>bestScore){bestScore=score;best=t;}
  }
  return best;
}
function computeResult(){
  const c=counts;
  const RL = decideAxis(c.R,c.L,'R','L', 0.60*c.Q + 0.25*c.Salt + 0.15*c.Light,
                                   0.60*c.M + 0.25*c.Sauce + 0.15*c.Hearty);
  const FS = decideAxis(c.F,c.S,'F','S', 0.50*c.Light + 0.25*c.Salt,
                                   0.50*c.Hearty + 0.25*c.Sauce);
  const KC = decideAxis(c.K,c.C,'K','C', 0.30*c.Salt + 0.20*c.Light,
                                   0.30*c.Sauce + 0.20*c.Hearty);
  const code=`${RL}-${FS}-${KC}`;
  const name=pickSubtype(code, c);
  return {code,name};
}
function showResult(){
  document.getElementById('bar').style.width='100%';
  const r=computeResult(); showScreen('result');
  const meta=MEAT_TYPE_TEXT[r.name]||{nick:r.name,catch:''};
  document.getElementById('r-type-name').textContent = `${r.name}ï¼ˆ${meta.nick}ï¼‰`;
  document.getElementById('r-type-code').textContent = r.code;
  document.getElementById('r-desc').textContent = meta.catch;
  const bm=bestMatch(r.code);
  const bmName = pickSubtype(bm, counts);
  const bmMeta = MEAT_TYPE_TEXT[bmName] || {nick:b mName};
  document.getElementById('r-best').textContent = `${bmName}ï¼ˆ${bmMeta.nick}ï¼‰`;
  const payload={ type:{code:r.code,name:r.name,nick:meta.nick,catch:meta.catch},
                  counts, answers, generatedAt:new Date().toISOString() };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.getElementById('btn-export');
  a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

/* ========= ã‚¤ãƒ™ãƒ³ãƒˆ ========= */
document.addEventListener('click',(ev)=>{
  const t=ev.target.closest('[data-action="start"]');
  if(t){ ev.preventDefault(); start(); }
});
document.getElementById('btn-next').addEventListener('click', ()=>{
  const btn = document.getElementById('btn-next');
  if(btn.classList.contains('disabled')) return;
  applyPage();
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});
document.getElementById('btn-retry').addEventListener('click',()=>{
  screenResult.hidden = true;
  screenQuiz.hidden = true;
  window.scrollTo({top:0, behavior:'smooth'});
});
</script>
</body>
</html>
