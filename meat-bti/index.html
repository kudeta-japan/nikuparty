<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEAT-BTI v2ï½œãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£è¨ºæ–­</title>
  <meta name="description" content="ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ç”¨ MEAT-BTI v2ï¼ˆ18å•ï¼‰â€” 1å•15ç§’ã€éƒ¨ä½ã‚¿ã‚¤ãƒ—ï¼†ç›¸æ€§ã‚¿ã‚°ã‚’åˆ¤å®šã€‚"/>
  <style>
    :root{
      --bg:#0b0c10; --panel:#101218; --ink:#f4f7fb; --muted:#b6c0cf;
      --accent:#ff6b57; --accent2:#ffd166; --border:#1c1f27; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em}
    .app{width:min(920px,100%);margin:0 auto;padding:24px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--accent),var(--accent2));display:grid;place-items:center;color:#111;font-weight:900}
    .title{font-weight:900}
    .wrap{padding:16px}

    /* ---- QUIZ minimal ---- */
    .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .q-index{font-weight:900}
    .timer{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent2);box-shadow:0 0 0 6px rgba(255,209,102,.1)}
    .sec{font-family:ui-monospace,Menlo,Consolas,monospace}
    .bar{height:6px;background:#141721;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
    .q-text{font-size:clamp(20px,3.6vw,26px);font-weight:900;text-align:center;margin:16px 0 10px;color:var(--ink)}
    .opt-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:6px}
    @media(min-width:640px){.opt-grid{grid-template-columns:1fr 1fr}}
    .opt{background:#151a27;border:1px solid #2a3140;border-radius:14px;padding:18px;text-align:center;cursor:pointer;
         transition:transform .05s ease,border-color .15s ease,background .15s ease;font-size:clamp(16px,2.6vw,18px);color:var(--ink)}
    .opt strong{color:var(--ink)}
    .opt:hover{transform:translateY(-1px);border-color:#364158;background:#182033}
    .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

    /* ---- RESULT ---- */
    .result{display:grid;gap:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .r-card{background:#0f1219;border:1px solid var(--border);border-radius:14px;padding:14px}
    .big{font-size:clamp(28px,6vw,36px);font-weight:900}
    .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--border);margin-right:6px}
    .desc{margin-top:10px;line-height:1.9}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .btn{appearance:none;border:1px solid var(--border);background:#141721;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#ff4e36);color:#111;border:none;box-shadow:0 10px 24px rgba(255,107,87,.35)}
    footer{padding:10px 16px 16px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <main class="app">
    <div class="card">
      <header>
        <div class="brand"><div class="logo">ğŸ¥©</div><div class="title">MEAT-BTI v2</div></div>
        <button id="btn-start" class="btn primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      </header>
      <div class="wrap" id="stage">
        <!-- START -->
        <section id="screen-start">
          <h2 style="margin:0 0 6px">ã‚ãªãŸã¯ã©ã®â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ï¼Ÿ</h2>
          <p style="color:var(--muted);margin:0 0 12px">18å•ï¼1å•15ç§’ã€‚é¸ã¶ã ã‘ã§ã€éƒ¨ä½ã‚¿ã‚¤ãƒ—ã¨ç›¸æ€§ã‚¿ã‚°ï¼ˆå™›ã¿å¿œãˆ/ã¨ã‚ã‘ãƒ»å¡©/ã‚½ãƒ¼ã‚¹ãƒ»è»½ã‚„ã‹/æº€è¶³ï¼‰ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
          <div><button class="btn primary" id="btn-start-2">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button></div>
        </section>

        <!-- QUIZ -->
        <section id="screen-quiz" hidden>
          <div class="q-head">
            <div class="q-index"><span id="q-counter">1</span>/<span id="q-total">18</span></div>
            <div class="timer"><div class="dot"></div><div class="sec"><span id="sec">15</span>s</div></div>
          </div>
          <div class="bar"><div id="bar"></div></div>
          <div class="q-text" id="q-text">ã©ã¡ã‚‰ãŒè¿‘ã„ï¼Ÿ</div>
          <div class="opt-grid">
            <button class="opt" id="btn-A"><strong id="label-A">A</strong></button>
            <button class="opt" id="btn-B"><strong id="label-B">B</strong></button>
          </div>
          <div class="progress-note">â€»æœªå›ç­”ã¯15ç§’ã§è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—</div>
        </section>

        <!-- RESULT -->
        <section id="screen-result" hidden>
          <div class="result">
            <div class="big" id="r-title">è¨ºæ–­çµæœ</div>
            <div class="grid">
              <div class="r-card">
                <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
                <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
                <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
                <div style="margin-top:10px"><span class="pill" id="tag-texture">å™›ã¿å¿œãˆ</span><span class="pill" id="tag-flavor">å¡©æ´¾</span><span class="pill" id="tag-after">è»½ã‚„ã‹</span></div>
                <p class="desc" id="r-desc"></p>
              </div>
              <div class="r-card">
                <div><strong>ç›¸æ€§No.1</strong></div>
                <div id="r-best" class="mono" style="margin-top:6px"></div>
              </div>
            </div>
            <div class="r-card">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                <strong>è©³ç´°ï¼ˆé›†è¨ˆå€¤ï¼‰</strong>
                <button class="btn" id="btn-copy">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
              </div>
              <pre class="mono" id="r-detail" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></pre>
            </div>
            <div style="display:flex;justify-content:space-between;gap:10px">
              <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
              <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
            </div>
          </div>
        </section>
      </div>
      <footer>Â© KU-DETA / ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ â€” MEAT-BTI v2</footer>
    </div>
  </main>

<script>
/* --------------- Question Data (18) --------------- */
const QUESTIONS = [
  // RL (1-4) A=R B=L
  {id:1, axis:"RL", a:"èµ¤èº«ã®æ—¨ã¿ã‚’å™›ã¿ã—ã‚ãŸã„", b:"è„‚ã®ç”˜ã¿ã¨ã‚³ã‚¯ã§æº€ãŸã•ã‚ŒãŸã„"},
  {id:2, axis:"RL", a:"é£Ÿå¾Œã¯è»½ã‚„ã‹ãŒç†æƒ³", b:"å¤šå°‘ã“ã£ã¦ã‚Šã§ã‚‚æº€è¶³æ„ŸãŒå¤§äº‹"},
  {id:3, axis:"RL", a:"é‡ã‚ˆã‚Šè³ªã§èµ¤èº«ä¸­å¿ƒã«é¸ã¶", b:"ã‚µã‚·ã®å…¥ã£ãŸéƒ¨ä½ã«æƒ¹ã‹ã‚Œã‚‹"},
  {id:4, axis:"RL", a:"å¥½ããªéƒ¨ä½ã¯ãƒ’ãƒ¬", b:"å¥½ããªéƒ¨ä½ã¯ã‚µãƒ¼ãƒ­ã‚¤ãƒ³"},
  // FS (5-7) A=F B=S
  {id:5, axis:"FS", a:"å¼·ç«ã§ã‚µãƒƒã¨é¦™ã°ã—ã", b:"ä½æ¸©ã‚„ä½™ç†±ã§ã˜ã£ãã‚Š"},
  {id:6, axis:"FS", a:"ç‚­ç«ãƒ»é‰„æ¿ã®ç›´ç«æ„Ÿ", b:"ãƒ­ãƒ¼ã‚¹ãƒˆã‚„ç…®è¾¼ã¿ã®å¥¥è¡Œã"},
  {id:7, axis:"FS", a:"è–„ã‚ã§ã‚­ãƒ¬è‰¯ã", b:"åšã‚ã§ä¸­ã¾ã§ã—ã£ã¨ã‚Š"},
  // KC (8-10) A=K B=C
  {id:8, axis:"KC", a:"ã¾ãšã¯å®šç•ªã‹ã‚‰", b:"æ–°ä½œãƒ»é™å®šã«æƒ¹ã‹ã‚Œã‚‹"},
  {id:9, axis:"KC", a:"å¡©ãƒ»èƒ¡æ¤’ãƒ»ã‚ã•ã³ã§ç°¡æ½”ã«", b:"ç‰¹è£½ã‚½ãƒ¼ã‚¹ã‚„ã‚¹ãƒ‘ã‚¤ã‚¹ã§ã‚¢ãƒ¬ãƒ³ã‚¸"},
  {id:10, axis:"KC", a:"â€œã„ã¤ã‚‚ã®ãƒ™ã‚¹ãƒˆâ€é‡è¦–", b:"ç›¸æ‰‹ã®ãŠã™ã™ã‚ã«ã‚‚ä¹—ã‚‹"},
  // Texture Q/M (11-13) A=Q B=M
  {id:11, axis:"TX", a:"ã—ã£ã‹ã‚Šå™›ã‚“ã§æ—¨ã¿ã‚’æ„Ÿã˜ãŸã„", b:"ã»ã‚ã»ã‚ãƒ»ã¨ã‚ã‘é£Ÿæ„ŸãŒå¥½ã"},
  {id:12, axis:"TX", a:"æ­¯åˆ‡ã‚Œè‰¯ã„ãƒ¬ã‚¢å¯„ã‚Š", b:"å£ã©ã‘é‡è¦–ã®ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã€œã‚¦ã‚§ãƒ«"},
  {id:13, axis:"TX", a:"å™›ã‚€ã»ã©å‘³ãŒå‡ºã‚‹èµ¤èº«æ´¾", b:"ã‚„ã‚ã‚‰ã‹ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼æœ€å„ªå…ˆ"},
  // Flavor Salt/Sauce (14-15) A=Salt B=Sauce
  {id:14, axis:"FL", a:"ã¾ãšã¯å¡©ã§ç´ ææ„Ÿ", b:"ãƒã‚¿ãƒ¼ãƒ»ã‚¬ãƒ¼ãƒªãƒƒã‚¯ç­‰ã®ã‚½ãƒ¼ã‚¹ãŒæ±ºã‚æ‰‹"},
  {id:15, axis:"FL", a:"èƒ¡æ¤’ã‚„ç‡»é¦™ã§é¦™ã‚Šã‚’è¶³ã™", b:"ç”˜è¾›ãƒ»ã‚¯ãƒªãƒ¼ãƒŸãƒ¼ç³»ã‚‚æ­“è¿"},
  // After Light/Hearty (16-18) A=Light B=Hearty
  {id:16, axis:"AF", a:"æ˜æ—¥ã‚‚è»½å¿«ã«å‹•ããŸã„", b:"ä»Šå¤œã¯ã”è¤’ç¾ã«ã—ã£ã‹ã‚Š"},
  {id:17, axis:"AF", a:"ä»˜ã‘åˆã‚ã›ã¯ã‚µãƒ©ãƒ€æ´¾", b:"ãƒãƒƒã‚·ãƒ¥ã‚„ãƒãƒ¼ã‚ºãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚‚æ¬²ã—ã„"},
  {id:18, axis:"AF", a:"ã‚‚ã†ä¸€è»’è¡Œã‘ã‚‹ä½™åŠ›ãŒå¤§äº‹", b:"1è»’ã§å®Œçµã§ãã‚‹æº€è¶³æ„ŸãŒå¤§äº‹"},
];

const AXIS_LABEL = {
  RL: {A:"R", B:"L"},
  FS: {A:"F", B:"S"},
  KC: {A:"K", B:"C"},
  TX: {A:"Q", B:"M"},
  FL: {A:"Salt", B:"Sauce"},
  AF: {A:"Light", B:"Hearty"},
};

/* --- 8 types (with rare) --- */
const TYPE_NAMES = {
  "R-F-K":"ãƒ’ãƒ¬",
  "R-F-C":"ã‚¿ãƒ³",
  "R-S-K":"ã‚¤ãƒãƒœ",
  "R-S-C":"ãƒ©ãƒ³ãƒ—",
  "L-F-K":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹",
  "L-F-C":"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³",
  "L-S-K":"ã‚¶ãƒ–ãƒˆãƒ³",
  "L-S-C":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹"
};

const DESCRIPTIONS = {
  "ãƒ’ãƒ¬":"ç„¡é§„ã®ãªã„ä¸Šå“ã•ã¨èŠ¯ã®å¼·ã•ãŒå…±å­˜ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚æƒ…å ±ã‚’æ•´ç†ã—ã€çµè«–ã‚’ã™ã£ãã‚Šå‡ºã™ã®ãŒå¾—æ„ã€‚å‘³ã‚ã„ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ã€ç´ æå‹è² ã®ä¸€çš¿ã‚’å¥½ã¿ã¾ã™ã€‚ä¼šè©±ã§ã‚‚ç›¸æ‰‹ã®è©±ã‚’ä¸å¯§ã«æ‹¾ã„ã€ä½™ç™½ã‚’æ´»ã‹ã—ã¦æ·±ã‚ã‚‹ã®ãŒä¸Šæ‰‹ã€‚å ´ã‚’é¨’ãŒã›ã‚‹ã‚ˆã‚Šã€é™ã‹ã«è³ªã‚’ä¸Šã’ã‚‹è²¢çŒ®ãŒå¾—æ„ã§ã™ã€‚åˆå¯¾é¢ã§ã¯è³ªå•ã‚’ä¸€ã¤ãšã¤æŠ•ã’ã€å…±é€šç‚¹ãŒè¦‹ã¤ã‹ã‚‹ã¨ä¸€æ°—ã«è·é›¢ãŒç¸®ã¿ã¾ã™ã€‚",
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"è¯ã‚„ãã¨ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ã§å ´ã‚’ç››ã‚Šä¸Šã’ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚å†™çœŸæ˜ ãˆã‚„â€œç‰¹è£½ã‚½ãƒ¼ã‚¹â€ã®ã‚ˆã†ãªã‚¢ã‚¯ã‚»ãƒ³ãƒˆã«å¿ƒãŒèºã‚Šã¾ã™ã€‚äººã®è‰¯ã•ã«æ•æ„Ÿã§ã€ç›¸æ‰‹ã®å¥½ã¿ã‚’ç´ æ—©ãã‚­ãƒ£ãƒƒãƒã—ã¦åˆã‚ã›ã‚‰ã‚Œã‚‹å™¨ç”¨ã•ã‚‚ã€‚ä¼šè©±ã¯ãƒ†ãƒ³ãƒè‰¯ãã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å¤§ãã‚ã€‚åˆå¯¾é¢ã®è¼ªã‚’åºƒã’ã‚‹ã®ãŒå¾—æ„ã§ã€äºŒæ¬¡ä¼šã®å¹¹äº‹å½¹ã«ã‚‚å‘ã„ã¦ã„ã¾ã™ã€‚",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"ç‹é“ãƒªãƒƒãƒæ´¾ã€‚åšã¿ã®ã‚ã‚‹æ—¨ã¿ã¨å®‰å¿ƒæ„Ÿã‚’æ„›ã™ã‚‹ã€é ¼ã‚Œã‚‹è»¸ã®æŒã¡ä¸»ã§ã™ã€‚æ±ºæ–­ãŒæ—©ãã€æ®µå–ã‚Šã‚’æ•´ãˆã¦ã¿ã‚“ãªã‚’å°ãã®ãŒå¾—æ„ã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šã‚‚æº€è¶³åº¦ã‚’é‡è¦–ã—ã€ä¼šè©±ã¯è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³ã§èãå½¹ã«ã‚‚å›ã‚Œã¾ã™ã€‚åˆå¯¾é¢ã§ã¯å…±é€šã®â€œå¥½ãâ€ã‚’è¦‹ã¤ã‘ã¦ã‹ã‚‰æ·±æ˜ã‚Šã™ã‚‹ã®ãŒã‚³ãƒ„ã€‚é•·ãä»˜ãåˆãˆã‚‹é–¢ä¿‚ã‚’ç¯‰ãã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã€‚",
  "ã‚¶ãƒ–ãƒˆãƒ³":"ã—ã£ã¨ã‚Šæ¿ƒåšã€å™›ã‚€ã»ã©ã«åºƒãŒã‚‹ã‚³ã‚¯ã‚’æ„›ã™ã‚‹å¯©ç¾çœ¼ã®æŒã¡ä¸»ã€‚ã“ã ã‚ã‚Šã¯å¼·ã„ãŒæŠ¼ã—ä»˜ã‘ãšã€ä¸å¯§ã«è¨€è‘‰ã‚’é¸ã³ã¾ã™ã€‚å¤§äººæ•°ã‚ˆã‚Šå°‘äººæ•°ã§ã˜ã£ãã‚Šè©±ã™ã®ãŒå¥½ãã€‚ç›¸æ‰‹ã®è‰¯ã•ã‚’è¦‹ã¤ã‘ã¦é™ã‹ã«å¼•ãå‡ºã™èãä¸Šæ‰‹ã§ã™ã€‚ä¼šè©±ã®ã‚³ãƒ„ã¯â€œãªãœãã‚ŒãŒå¥½ãã‹â€ã®ç†ç”±äº¤æ›ã€‚ä¸å¯§ã•ã‚„èª å®Ÿã•ã«æƒ¹ã‹ã‚Œã‚‹å¤§äººã®ç›¸æ€§ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚",
  "ãƒ©ãƒ³ãƒ—":"æ¢ç©¶å¿ƒã¨æŸ”è»Ÿã•ã‚’å…¼ã­å‚™ãˆãŸå®Ÿé¨“å¥½ãã€‚ä½æ¸©ã‚„å‰µä½œã®ã‚ˆã†ã«ã€å®šç•ªã‚’ä¸€æ­©æ›´æ–°ã™ã‚‹å·¥å¤«ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¾ã™ã€‚ç‰©é™ã‹ã§ã‚‚ä¸­èº«ã¯ç†±ã„è·äººæ°—è³ªã§ã€è©±ã—å‡ºã™ã¨æ·±ã„çŸ¥è­˜ãŒã“ã¼ã‚Œã¾ã™ã€‚åˆå¯¾é¢ã§ã¯è©¦é£Ÿã‚„å°ã•ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹ã¨ä¼šè©±ãŒå¼¾ã¿ã‚„ã™ã„ã€‚ç›¸æ‰‹ã®â€œæ–°ã—ã„ç™ºè¦‹â€ã‚’å–œã¹ã‚‹äººã¨ç›¸æ€§è‰¯å¥½ã§ã™ã€‚",
  "ã‚¤ãƒãƒœ":"èµ¤èº«ã®æ—¨ã¿ã‚’ä¸å¯§ã«å‘³ã‚ã†ã€èª¿å’Œå‹ã®é€šå¥½ã¿ã€‚æ§ãˆã‚ãªãŒã‚‰èŠ¯ãŒã‚ã‚Šã€ç©ºæ°—ã‚’èª­ã¿ã¤ã¤ã‚‚è¦æ‰€ã§ã—ã£ã‹ã‚Šæ„è¦‹ã‚’è¨€ãˆã¾ã™ã€‚æ´¾æ‰‹ã•ã¯ãªã„ãŒã€ã‚ã¨ã‹ã‚‰åŠ¹ã„ã¦ãã‚‹ä½™éŸ»ã‚¿ã‚¤ãƒ—ã€‚ä¼šè©±ã¯ç›¸æ‰‹ã®è©±ã‚’å—ã‘ã¦ä¸€æ­©æ·±ã‚ã‚‹ã®ãŒå¾—æ„ã§ã€ä¾¡å€¤è¦³ã®è¿‘ã„ç›¸æ‰‹ã¨é•·æœŸçš„ãªé–¢ä¿‚ã‚’ç¯‰ãã‚„ã™ã„ã€‚æ°—ã¥ã‘ã°â€œã‚‚ã£ã¨è©±ã—ãŸã„äººâ€ã«ãªã£ã¦ã„ã¾ã™ã€‚",
  "ã‚¿ãƒ³":"ã•ã£ã±ã‚Šå¡©ã§ã‚­ãƒ¬è‰¯ãã€‚ãƒ†ãƒ³ãƒã®è‰¯ã•ã¨æ˜ã‚‹ã•ã§å‘¨å›²ã‚’ã»ãã™ãƒ ãƒ¼ãƒ‰ãƒ¡ã‚¤ã‚¯ãŒå¾—æ„ã€‚ç›´æ„ŸãŒåˆ©ãã€åˆ¤æ–­ã‚‚ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ã€‚ä¼šè©±ã¯çŸ­ã„ã‚­ãƒ£ãƒƒãƒãƒœãƒ¼ãƒ«ã‚’é‡ã­ã‚‹ã®ãŒä¸Šæ‰‹ã§ã€ä¹¾æ¯ã®å·ä»¤ã‚„å ´ã®ã‚¹ã‚¤ãƒƒãƒå½¹ã«å‘ã„ã¦ã„ã¾ã™ã€‚æ·±æ˜ã‚Šã¯äºŒå·¡ç›®ã«ã‚†ã£ãã‚Šã€‚â€œã¾ãšã¯ã‚„ã£ã¦ã¿ã‚‹â€ç²¾ç¥ã§ã€æ–°ã—ã„äººã¨ã‚‚ã™ãè·é›¢ã‚’ç¸®ã‚ã‚‰ã‚Œã¾ã™ã€‚",
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"ç¹Šç´°ã•ã¨é›†ä¸­åŠ›ã€ãã—ã¦è³ªã¸ã®å¼·ã„ã“ã ã‚ã‚Šã‚’å‚™ãˆãŸâ€œç‰¹é¸ãƒ’ãƒ¬â€æ°—è³ªã€‚é‡ã‚ˆã‚Šè³ªã€æ´¾æ‰‹ã•ã‚ˆã‚Šå®Œæˆåº¦ã‚’é‡ã‚“ã˜ã€ç›¸æ‰‹ã«ã‚‚èª å®Ÿã•ã¨ä¸å¯§ã•ã‚’æ±‚ã‚ã¾ã™ã€‚ä¼šè©±ã¯è½ã¡ç€ã„ã¦ã„ã¦ã€çš„ç¢ºãªä¸€è¨€ã§å°è±¡ã‚’æ®‹ã™ã‚¿ã‚¤ãƒ—ã€‚æ€¥ãŒãšæ·±ãã€å°‘äººæ•°ã§ã˜ã£ãã‚Šå‘ãåˆã†ã¨ç›¸æ€§ãŒèŠ±é–‹ãã¾ã™ã€‚å¸Œå°‘ã‚†ãˆã«å‡ºä¼šãˆãŸã‚‰å¤§åˆ‡ã«ã—ãŸã„å­˜åœ¨ã€‚"
};

const OPP = { R:"L", L:"R", F:"S", S:"F", K:"C", C:"K" };

/* --------------- State --------------- */
let current = 0; let timer = null; let tLeft = 15; const total = QUESTIONS.length;
const counts = { R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0,Salt:0,Sauce:0,Light:0,Hearty:0 };
const answers = [];

const el = id => document.getElementById(id);
const screenStart = el('screen-start');
const screenQuiz  = el('screen-quiz');
const screenResult= el('screen-result');

function showScreen(which){
  screenStart.hidden = which !== 'start';
  screenQuiz.hidden  = which !== 'quiz';
  screenResult.hidden= which !== 'result';
}
function resetAll(){
  stopTimer(); tLeft=15; el('sec').textContent='15'; el('bar').style.width='0%';
  Object.keys(counts).forEach(k=>counts[k]=0);
  answers.length=0; current=0; showScreen('start');
}
function start(){ resetAll(); showScreen('quiz'); el('q-total').textContent=total; current=0; renderQ(); startTimer(); }

function renderQ(){
  const q = QUESTIONS[current];
  el('q-counter').textContent = current+1;
  el('q-text').textContent = 'ã©ã¡ã‚‰ãŒè¿‘ã„ï¼Ÿ';
  el('label-A').textContent = q.a;
  el('label-B').textContent = q.b;
}

function startTimer(){
  stopTimer(); tLeft=15; const totalMs=15000; const startAt=performance.now();
  el('sec').textContent=String(tLeft);
  const tick=()=>{
    const elapsed=performance.now()-startAt; const remain=Math.max(0,totalMs-elapsed);
    const s=Math.ceil(remain/1000); if(s!==tLeft){ tLeft=s; el('sec').textContent=String(s); }
    const pct=(elapsed/totalMs)*100; el('bar').style.width=Math.min(100,pct)+'%';
    if(remain<=0){ stopTimer(); pick('skip'); } else { timer=requestAnimationFrame(tick); }
  };
  timer=requestAnimationFrame(tick);
}
function stopTimer(){ if(timer){ cancelAnimationFrame(timer); timer=null; } }

function pick(choice){
  const q = QUESTIONS[current]; answers.push({ id:q.id, axis:q.axis, choice });
  if(choice==='A'||choice==='B'){ const label=AXIS_LABEL[q.axis][choice]; counts[label]=(counts[label]||0)+1; }
  next();
}
function next(){ stopTimer(); if(current<total-1){ current++; renderQ(); startTimer(); } else { showResult(); } }

/* ---- result logic (RL adjustment & rare) ---- */
function computeResult(){
  const R_base=counts.R, L_base=counts.L; const F=counts.F, S=counts.S; const K=counts.K, C=counts.C;
  const Q=counts.Q, M=counts.M; const Salt=counts.Salt, Sauce=counts.Sauce; const Light=counts.Light, Hearty=counts.Hearty;
  const R_adj=(Q>=2?1:0)+(Salt>=2?1:0)+(Light>=2?1:0);
  const L_adj=(M>=2?1:0)+(Sauce>=2?1:0)+(Hearty>=2?1:0);
  const Rf=R_base+R_adj, Lf=L_base+L_adj;
  const RL=(Rf>=Lf)?'R':'L'; const FS=(F>=S)?'F':'S'; const KC=(K>=C)?'K':'C';
  const code = `${RL}-${FS}-${KC}`;
  let name = TYPE_NAMES[code] || 'ä¸æ˜';
  // Rare: Chateaubriand (Fillet special)
  const isCB = (code==='R-F-K') && (Q>=2 && Salt>=2 && Light>=2) && (R_base>=3 && F>=2 && K>=2);
  if(isCB) name='ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³';
  const tagTexture=(Q>=M)?'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘';
  const tagFlavor =(Salt>=Sauce)?'å¡©æ´¾':'ã‚½ãƒ¼ã‚¹æ´¾';
  const tagAfter  =(Light>=Hearty)?'è»½ã‚„ã‹':'æº€è¶³';
  return { code,name,R_base,L_base,F,S,K,C,Q,M,Salt,Sauce,Light,Hearty,R_adj,L_adj,Rf,Lf,tagTexture,tagFlavor,tagAfter };
}

function allTypeCodes(){ return Object.keys(TYPE_NAMES); }
function parseCode(code){ const [a,b,c]=code.split('-'); return {RL:a,FS:b,KC:c}; }

/* ç›¸æ€§No.1 ã‚’1ã¤ã ã‘ç®—å‡º */
function bestMatch(code){
  const mine=parseCode(code); let best=null, bestScore=-1;
  for(const t of allTypeCodes()){
    if(t===code) continue; const other=parseCode(t);
    let opp=0, same=0;
    if(other.RL===OPP[mine.RL]) opp++;
    if(other.FS===OPP[mine.FS]) opp++;
    if(other.KC===OPP[mine.KC]) opp++;
    if(other.RL===mine.RL) same++;
    if(other.FS===mine.FS) same++;
    if(other.KC===mine.KC) same++;
    const score = (opp>=2) ? opp*10 : (opp*10 + same); // è£œå®Œã‚’å„ªå…ˆ
    if(score>bestScore){ bestScore=score; best=t; }
  }
  return best; // ä¾‹: "L-F-C"
}

function showResult(){
  const r=computeResult(); showScreen('result');
  el('r-type-name').textContent=r.name;
  el('r-type-code').textContent=r.code;
  el('tag-texture').textContent=r.tagTexture;
  el('tag-flavor').textContent=r.tagFlavor;
  el('tag-after').textContent=r.tagAfter;
  el('r-desc').textContent = DESCRIPTIONS[r.name] || '';

  const bm=bestMatch(r.code);
  el('r-best').textContent = bm ? `${TYPE_NAMES[bm]}ï¼ˆ${bm}ï¼‰` : 'â€”';

  const detail=[
    `R/L base: R=${r.R_base}, L=${r.L_base}  adj: R+${r.R_adj}, L+${r.L_adj}  â†’ Rf=${r.Rf}, Lf=${r.Lf}`,
    `F/S: F=${r.F}, S=${r.S}`,
    `K/C: K=${r.K}, C=${r.C}`,
    `Texture: Q=${r.Q}, M=${r.M}  Flavor: Salt=${r.Salt}, Sauce=${r.Sauce}  After: Light=${r.Light}, Hearty=${r.Hearty}`,
    `Tags: ${r.tagTexture}ãƒ»${r.tagFlavor}ãƒ»${r.tagAfter}`,
  ].join('\n');
  el('r-detail').textContent=detail;

  const payload={
    type:{code:r.code,name:r.name},
    tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},
    counts:{R:r.R_base,L:r.L_base,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M,Salt:r.Salt,Sauce:r.Sauce,Light:r.Light,Hearty:r.Hearty},
    adjusted:{Rf:r.Rf,Lf:r.Lf,R_adj:r.R_adj,L_adj:r.L_adj},
    answers, generatedAt:new Date().toISOString()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=el('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

async function copyResult(){
  const name=el('r-type-name').textContent; const code=el('r-type-code').textContent;
  const tags=[el('tag-texture').textContent,el('tag-flavor').textContent,el('tag-after').textContent].join('ãƒ»');
  const text=`MEAT-BTI v2\néƒ¨ä½ã‚¿ã‚¤ãƒ—ï¼š${name}ï¼ˆ${code}ï¼‰\nã‚¿ã‚°ï¼š${tags}`;
  try{ await navigator.clipboard.writeText(text); el('btn-copy').textContent='ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
       setTimeout(()=>el('btn-copy').textContent='çµæœã‚’ã‚³ãƒ”ãƒ¼',1500); } catch{ alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
}

/* events */
['btn-start','btn-start-2'].forEach(id=>document.getElementById(id).addEventListener('click',start));
['btn-A','btn-B'].forEach((id,i)=>document.getElementById(id).addEventListener('click',()=>pick(i===0?'A':'B')));
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',resetAll);
const copy=document.getElementById('btn-copy'); if(copy) copy.addEventListener('click',copyResult);

/* keyboard shortcuts */
window.addEventListener('keydown',e=>{ if(screenQuiz.hidden) return; if(e.key==='1') pick('A'); else if(e.key==='2') pick('B'); else if(e.key.toLowerCase()==='s'){ pick('skip'); } else if(e.code==='Space'){ e.preventDefault(); pick('skip'); } });

/* init */
showScreen('start');
</script>
</body>
</html>
