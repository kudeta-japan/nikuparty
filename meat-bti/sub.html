<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEAT-BTI v8ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆãƒ»sub.htmlï¼‰ï½œ20å•ãƒ»6æŠï¼å¤šè»¸åŠ ç‚¹</title>
<meta name="description" content="20å•ãƒ»6æ®µéšã§â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ã‚’åˆ¤å®šã€‚é †ç•ªå›ºå®šï¼†å¤šè»¸åŠ ç‚¹ï¼ˆR/Lãƒ»Q/Mãƒ»F/Sãƒ»K/Cï¼‰ã€‚ãŠã™ã™ã‚4å‰²ï¼ç›¸æ€§6å‰²ã§çµæœè¡¨ç¤ºã€‚12ã‚¿ã‚¤ãƒ—ï¼šã‚·ãƒ³ã‚·ãƒ³ã‚’å»ƒæ­¢ã—ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³æ¡ç”¨ã€‚">
<meta name="theme-color" content="#0a0d14">

<style>
  :root{
    --bg:#090b10; --panel:#0f1219; --ink:#f5f8ff; --muted:#b7c3d6;
    --acc:#ff715b; --acc2:#ffd166; --bd:#1b2030; --shadow:0 10px 30px rgba(0,0,0,.35);
    --grad: radial-gradient(1200px 600px at 10% -10%, rgba(255,113,91,.25), transparent 40%),
            radial-gradient(1200px 600px at 110% 110%, rgba(255,209,102,.2), transparent 40%),
            linear-gradient(180deg,#0a0d14,#0b0e15 50%, #0d111a);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em;line-height:1.65}
  .app{width:min(980px,96vw);margin:0 auto;padding:20px}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
  header.appbar{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border:1px solid var(--bd);border-radius:16px;background:#0c1019;margin-top:14px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:900}
  .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 140deg,var(--acc),var(--acc2));display:grid;place-items:center;color:#111}
  .btn{appearance:none;border:1px solid var(--bd);background:#151a23;color:var(--ink);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;transition:transform .06s ease, box-shadow .15s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(180deg,var(--acc),#ff4e36);color:#111;border:none;box-shadow:0 12px 26px rgba(255,113,91,.35)}

  /* HEROï¼šå¸¸æ™‚è¡¨ç¤ºã€‚ãƒ†ã‚­ã‚¹ãƒˆã¯ä¸‹éƒ¨ã«å¯„ã›ã€ç”»åƒã®ä¸‹å´ã‚’è¦‹ã›ã‚‹ */
  .hero{position:relative;margin-top:16px;border-radius:20px;overflow:hidden;border:1px solid var(--bd)}
  .hero-img{width:100%;height:clamp(320px,56vh,520px);object-fit:cover;object-position:center 82%;display:block;filter:brightness(.86) contrast(1.05)}
  .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,transparent 40%, rgba(0,0,0,.65) 100%)}
  .hero-copy{position:absolute;left:0;right:0;bottom:0;padding:20px 18px 16px 18px}
  .eyebrow{display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.08);border:1px solid #222a3a;color:#dfe7f5;padding:6px 10px;border-radius:999px;font-size:12px}
  .h1{font-size:clamp(24px,5.2vw,38px);line-height:1.25;font-weight:900;margin:8px 0 0}
  .lead{color:var(--muted);margin:6px 0 0}
  .cta-row{display:flex;align-items:center;gap:12px;margin-top:10px;flex-wrap:wrap}
  .types{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
  @media(min-width:720px){.types{grid-template-columns:repeat(6,1fr)}}
  .type-chip{background:#121726;border:1px solid #2a3140;border-radius:12px;padding:8px 10px;text-align:center;font-weight:700;white-space:nowrap}

  /* QUIZ */
  .wrap{margin-top:16px}
  .section{padding:16px}
  .q-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .q-index{font-weight:900}
  .bar{height:6px;background:#141721;border:1px solid var(--bd);border-radius:999px;overflow:hidden;width:220px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--acc),var(--acc2))}
  .qgrid{display:grid;gap:12px}
  .qitem{background:#111522;border:1px solid #2a3140;border-radius:14px;padding:14px}
  .ctx{color:#e7ecf8;font-weight:700;font-size:clamp(14px,2.8vw,16px);margin:-2px 0 8px 0}
  .lr{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:stretch;pointer-events:none}
  .side{background:#0f1522;border:1px solid #272f41;border-radius:12px;padding:10px;min-height:66px;display:flex;align-items:center;justify-content:center;text-align:center}
  .side b{font-size:clamp(14px,2.6vw,17px)}
  .scale{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
  .dot{width:28px;height:28px;border-radius:999px;border:2px solid #39435a;background:#161b27;cursor:pointer;display:grid;place-items:center}
  .dot.small{width:22px;height:22px}
  .dot.big{width:32px;height:32px}
  .dot[data-side="L"].active{background:linear-gradient(180deg,#3aa1ff,#2677c8);border-color:#2b6fb6;box-shadow:0 0 0 4px rgba(63,155,255,.18)}
  .dot[data-side="R"].active{background:linear-gradient(180deg,#ff7a63,#ff5039);border-color:#e6422e;box-shadow:0 0 0 4px rgba(255,104,84,.18)}
  .dot:hover{transform:translateY(-1px)}
  .q-foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:12px}
  .disabled{opacity:.55;pointer-events:none}
  .progress-note{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}

  /* RESULTï¼ˆç›¸æ€§6å‰²ï¼šãŠã™ã™ã‚4å‰²ï¼‰ */
  .result{display:grid;gap:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  @media(min-width:720px){.grid-compat-heavy{grid-template-columns:1fr 1.4fr}}
  .r-card{background:#0f1219;border:1px solid var(--bd);border-radius:14px;padding:14px}
  .big{font-size:clamp(26px,6vw,34px);font-weight:900}
  .desc{margin-top:10px;line-height:1.9}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .pill{display:inline-block;padding:6px 12px;border-radius:999px;background:#131726;border:1px solid var(--bd);margin-right:6px}
  footer{padding:10px 0 30px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
<main class="app">
  <header class="appbar">
    <div class="brand"><div class="logo">ğŸ¥©</div><div>MEAT-BTI v8ï¼ˆãƒ†ã‚¹ãƒˆï¼‰</div></div>
    <button id="btn-start" class="btn primary">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
  </header>

  <!-- HEROï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ -->
  <section class="hero" aria-label="hero">
    <img src="mbti.jpg" alt="MEAT-BTI" class="hero-img">
    <div class="hero-copy">
      <span class="eyebrow">20å•ãƒ»6æ®µéšï¼é †ç•ªå›ºå®šãƒ»å¤šè»¸åŠ ç‚¹</span>
      <h1 class="h1">è‚‰å¥½ãã®ãŸã‚ã®æ€§æ ¼è¨ºæ–­ã€‚ã‚ãªãŸã¯ã©ã®â€œéƒ¨ä½ã‚¿ã‚¤ãƒ—â€ï¼Ÿ</h1>
      <p class="lead">A/Bã®é¸æŠã§ã‚‚ã€è¤‡æ•°è¦ç´ ï¼ˆR/Lãƒ»Q/Mãƒ»F/Sãƒ»K/Cï¼‰ã«åŒæ™‚åŠ ç‚¹ã€‚</p>
      <div class="cta-row">
        <button id="btn-start-2" class="btn primary">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
        <span style="color:var(--muted);font-size:12px">â€»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ <b>1â€“6</b> ã§ã‚‚é¸æŠå¯èƒ½</span>
      </div>
      <div class="types" aria-label="12ã‚¿ã‚¤ãƒ—">
        <div class="type-chip">ãƒ’ãƒ¬</div><div class="type-chip">ã‚¿ãƒ³</div><div class="type-chip">ã‚¤ãƒãƒœ</div><div class="type-chip">ãƒ©ãƒ³ãƒ—</div>
        <div class="type-chip">ãƒªãƒ–ãƒ­ãƒ¼ã‚¹</div><div class="type-chip">ã‚µãƒ¼ãƒ­ã‚¤ãƒ³</div><div class="type-chip">ã‚¶ãƒ–ãƒˆãƒ³</div><div class="type-chip">ã‚«ãƒ«ãƒ“</div>
        <div class="type-chip">ãƒãƒ©ãƒŸ</div><div class="type-chip">ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³</div><div class="type-chip">ã‚«ã‚¤ãƒãƒŸ</div><div class="type-chip">ãƒŸã‚¹ã‚¸</div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="screen-quiz" class="section card" hidden>
    <div class="q-head">
      <div class="q-index"><span id="page-now">1</span>/4ãƒšãƒ¼ã‚¸ï¼ˆ<span id="q-answered">0</span>/20ï¼‰</div>
      <div class="bar"><div id="bar"></div></div>
    </div>

    <div id="qgrid" class="qgrid"><!-- 5å•ã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ --></div>

    <div class="q-foot">
      <div>ä¸¸ã„ãƒ‰ãƒƒãƒˆã§é¸æŠã€‚å·¦ï¼ˆé’ï¼‰â‡”å³ï¼ˆèµ¤ï¼‰ã»ã©å¼·ã„ã€‚</div>
      <div><button id="btn-next" class="btn primary disabled">æ¬¡ã®5å•ã¸</button></div>
    </div>
    <div class="progress-note">â€» 1ï½6ã‚­ãƒ¼ã§ã‚‚å…¥åŠ›ã§ãã¾ã™ï¼ˆ1=å·¦å¼·ãƒ»6=å³å¼·ï¼‰</div>
  </section>

  <!-- RESULTï¼ˆç›¸æ€§6å‰²ï¼ãŠã™ã™ã‚4å‰²ï¼‰ -->
  <section id="screen-result" class="section" hidden>
    <div class="result">
      <div class="big">è¨ºæ–­çµæœ</div>
      <div class="grid grid-compat-heavy">
        <!-- å·¦ï¼šã‚ãªãŸã®ã‚¿ã‚¤ãƒ— & ãŠã™ã™ã‚ï¼ˆç´„4å‰²ï¼‰ -->
        <div class="r-card">
          <div><strong>ã‚ãªãŸã®éƒ¨ä½ã‚¿ã‚¤ãƒ—</strong></div>
          <div style="margin-top:6px;font-size:22px;font-weight:900" id="r-type-name">â€”</div>
          <div class="mono" id="r-type-code" style="opacity:.8">R-F-K</div>
          <div style="margin-top:10px">
            <span class="pill" id="tag-texture">å™›ã¿å¿œãˆ</span>
            <span class="pill" id="tag-flavor">å¡©å¯„ã‚Š</span>
            <span class="pill" id="tag-after">ãƒ†ãƒ³ãƒé‡è¦–</span>
          </div>
          <p class="desc" id="r-desc"></p>

          <div style="margin-top:10px">
            <strong>ãŠã™ã™ã‚ã®ä¸€çš¿</strong>
            <ul id="r-recs" style="margin:6px 0 0 18px; padding:0"></ul>
          </div>
        </div>

        <!-- å³ï¼šç›¸æ€§ã‚¬ã‚¤ãƒ‰ï¼ˆç´„6å‰²ï¼‰ -->
        <div class="r-card">
          <div><strong>ç›¸æ€§ã‚¬ã‚¤ãƒ‰ï¼ˆãƒˆãƒƒãƒ—3ï¼‰</strong></div>
          <ol id="compat-list" style="margin:8px 0 0 18px; padding:0"></ol>
          <div id="compat-notes" style="margin-top:10px;color:#cfd7e6;opacity:.9;font-size:12px"></div>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;gap:10px;margin-top:8px">
        <button class="btn" id="btn-retry">æœ€åˆã‹ã‚‰</button>
        <a class="btn primary" href="#" id="btn-export" download>çµæœã‚’JSONã§ä¿å­˜</a>
      </div>
    </div>
  </section>

  <footer>Â© ãƒ‹ã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ / MEAT-BTI v8ï¼ˆãƒ†ã‚¹ãƒˆï¼‰</footer>
</main>

<script>
/* =========================================================
   v8 ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆsub.htmlï¼‰
   - é †ç•ªå›ºå®šãƒ»å·¦å³å›ºå®š
   - å¤šè»¸åŠ ç‚¹ï¼ˆR/Lãƒ»Q/Mãƒ»F/Sãƒ»K/Cï¼‰â€¦1å›ç­”ã§è¤‡æ•°è¦ç´ ã«å¯„ä¸
   - 12ã‚¿ã‚¤ãƒ—ï¼šã‚·ãƒ³ã‚·ãƒ³â†’ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³
   - çµæœè¡¨ç¤ºï¼šãŠã™ã™ã‚4å‰²ï¼ç›¸æ€§6å‰²ï¼ˆç›¸æ€§ãƒˆãƒƒãƒ—3ï¼‰
   ========================================================= */

/* ===== 20å•ï¼šä½•ã®è©±ã‹æ˜è¨˜ã€é †ç•ªå›ºå®š ===== */
const BANK = [
  /* Lean vs Richï¼ˆ4å•ï¼‰ */
  {id:1,  ctx:"ç„¼è‚‰ã®æœ€åˆã®ä¸€çš¿ã¯ï¼Ÿ", a:"å¡©ã‚¿ãƒ³ã§ã‚¹ã‚¿ãƒ¼ãƒˆ", b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³/ã‚«ãƒ«ãƒ“ãªã©â€œã‚³ã‚¯ç³»â€",
    wA:{R:1.0,F:0.5,K:0.4,Q:0.3}, wB:{L:1.0,S:0.4,C:0.4,M:0.2}},
  {id:2,  ctx:"åŒã˜ä¾¡æ ¼ãªã‚‰ã©ã£ã¡ï¼Ÿ", a:"èµ¤èº«ã®æ—¨ã¿", b:"éœœé™ã‚Šã®ã‚³ã‚¯",
    wA:{R:1.0}, wB:{L:1.0}},
  {id:3,  ctx:"ãƒ‡ãƒ¼ãƒˆã®å¤œã€‚è‚‰ã®æ–¹å‘æ€§ã¯ï¼Ÿ", a:"è»½ã‚„ã‹ã«â€œèµ¤èº«ä¸­å¿ƒâ€ã§", b:"æº€è¶³æ„Ÿé‡è¦–ã§â€œéœœé™ã‚Šä¸­å¿ƒâ€ã§",
    wA:{R:1.0,F:0.3,K:0.3}, wB:{L:1.0,S:0.3,C:0.3}},
  {id:4,  ctx:"ã¿ã‚“ãªã§ã‚·ã‚§ã‚¢ã™ã‚‹ãªã‚‰ï¼Ÿ", a:"èµ¤èº«ã®ç››ã‚Šåˆã‚ã›", b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³/éœœé™ã‚Šã®ç››ã‚Šåˆã‚ã›",
    wA:{R:1.0,F:0.2}, wB:{L:1.0,S:0.2}},

  /* Textureï¼ˆ4å•ï¼‰ */
  {id:5,  ctx:"â€œæŸ”ã‚‰ã‹ã•â€ã®ç†æƒ³ã¯ï¼Ÿ", a:"å™›ã‚€ã¨å¿ƒåœ°ã‚ˆã„å¼¾åŠ›ï¼ˆæ­¯åˆ‡ã‚Œï¼‰", b:"å£ã®ä¸­ã§ã¨ã‚ã‘ã‚‹å£ã©ã‘",
    wA:{Q:1.0}, wB:{M:1.0}},
  {id:6,  ctx:"ã‚¹ãƒ†ãƒ¼ã‚­ã®ç„¼ãåŠ æ¸›ã¯ï¼Ÿ", a:"ãƒ¬ã‚¢å¯„ã‚Š", b:"ãƒŸãƒ‡ã‚£ã‚¢ãƒ ä»¥ä¸Š",
    wA:{Q:0.8,R:0.2}, wB:{M:0.8,L:0.2}},
  {id:7,  ctx:"ç„¼è‚‰ã®â€œåšã¿â€ã¯ï¼Ÿ", a:"è–„åˆ‡ã‚Šã§ã‚µãƒƒã¨ç„¼ã", b:"åšåˆ‡ã‚Šã§ã˜ã£ãã‚Šç„¼ã",
    wA:{Q:0.7,F:0.5}, wB:{M:0.7,S:0.5}},
  {id:8,  ctx:"å‘³ä»˜ã‘ã®â€œæœ€åˆã®ä¸€å£â€ã¯ï¼Ÿ", a:"å¡©ãƒ»ãƒ¬ãƒ¢ãƒ³", b:"ç‰¹è£½ãƒ€ãƒ¬",
    wA:{R:0.6,K:0.5}, wB:{L:0.6,C:0.5}},

  /* Tempoï¼ˆ4å•ï¼‰ */
  {id:9,  ctx:"ç„¼ããƒ†ãƒ³ãƒã¯ï¼Ÿ", a:"å¼·ç«ã§ãƒ†ãƒ³ãƒè‰¯ãå›ã™", b:"å¼±ã€œä¸­ç«ã§ã˜ã£ãã‚Š",
    wA:{F:1.0}, wB:{S:1.0}},
  {id:10, ctx:"æ³¨æ–‡ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ", a:"é£Ÿã¹ãŸã„ç‰©ã‚’éƒ½åº¦ãƒ†ãƒ³ãƒè‰¯ãè¿½åŠ ", b:"ã‚³ãƒ¼ã‚¹ã§ã‚†ã£ãã‚Šé€²è¡Œ",
    wA:{F:1.0,K:0.2}, wB:{S:1.0,C:0.2}},
  {id:11, ctx:"æ··ã‚“ã§ããŸã‚‰ï¼Ÿ", a:"åˆ¥ã®åº—ã¸ç§»å‹•ã™ã‚‹", b:"æ°—ã«å…¥ã‚Œã°è…°ã‚’æ®ãˆã‚‹",
    wA:{F:0.9}, wB:{S:0.9}},
  {id:12, ctx:"å½¹å‰²ã¯ï¼Ÿ", a:"ãƒ†ã‚­ãƒ‘ã‚­ä»•åˆ‡ã£ã¦å›ã™", b:"çš†ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ã‚‹",
    wA:{F:0.8,K:0.2}, wB:{S:0.8}},

  /* Keep vs Challengeï¼ˆ4å•ï¼‰ */
  {id:13, ctx:"æœ€åˆã«é ¼ã‚€ãªã‚‰ï¼Ÿ", a:"å¡©ã‚¿ãƒ³ãªã©â€œå®šç•ªâ€", b:"é™å®šãƒ»å‰µä½œãƒ¡ãƒ‹ãƒ¥ãƒ¼",
    wA:{K:1.0}, wB:{C:1.0}},
  {id:14, ctx:"ã‚·ã‚§ã‚¢æ³¨æ–‡ã®æ®µå–ã‚Šã¯ï¼Ÿ", a:"æœ€åˆã«ã¾ã¨ã‚ã¦æ®µå–ã‚Š", b:"æ§˜å­ã‚’è¦‹ãªãŒã‚‰è¿½åŠ ",
    wA:{K:0.9,F:0.4}, wB:{C:0.9,S:0.3}},
  {id:15, ctx:"ãƒ†ãƒ¼ãƒ–ãƒ«ã®é›°å›²æ°—ã¥ãã‚Šã¯ï¼Ÿ", a:"ãƒãƒŠãƒ¼é‡è¦–ã§è½ã¡ç€ã„ã¦", b:"è‡ªç”±ã«ãƒ¯ã‚¤ãƒ¯ã‚¤",
    wA:{K:0.8,S:0.2}, wB:{C:0.8,F:0.3}},
  {id:16, ctx:"å†™çœŸã‚‚æ’®ã‚‹å¤œãªã‚‰ï¼Ÿ", a:"å‘³ãŒæœ€å„ªå…ˆ", b:"â€œæ˜ ãˆâ€ã‚’å„ªå…ˆ",
    wA:{K:0.9}, wB:{C:0.9}},

  /* Hybridï¼ˆ4å•ï¼‰ */
  {id:17, ctx:"åˆã‚ã›æ–¹ã¯ï¼Ÿ", a:"ãƒ¯ã‚¤ãƒ³ç­‰ã§å˜å“ã‚’æ¥½ã—ã‚€", b:"ç™½ã”ã¯ã‚“ã§ãŒã£ã¤ã‚Š",
    wA:{R:0.6,K:0.3}, wB:{L:0.6,S:0.2}},
  {id:18, ctx:"ç· ã‚ã®ä¸€å“ã¯ï¼Ÿ", a:"ã‚¹ãƒ¼ãƒ—/å†·éººãªã©è»½ã‚", b:"ãƒ“ãƒ“ãƒ³ãƒ/ã‚¯ãƒƒãƒ‘ã§æº€è…¹ã¾ã§",
    wA:{F:0.4,R:0.3}, wB:{S:0.6,L:0.4}},
  {id:19, ctx:"åç‰©ã‚’1çš¿ã ã‘é¸ã¶ãªã‚‰ï¼Ÿ", a:"èµ¤èº«ã®åç‰©", b:"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç­‰â€œã‚³ã‚¯ç³»â€ã®åç‰©",
    wA:{R:1.0}, wB:{L:1.0}},
  {id:20, ctx:"2å›ç›®ã®ãƒ‡ãƒ¼ãƒˆãªã‚‰ï¼Ÿ", a:"è‚‰ãƒãƒ«ã§è½ã¡ç€ã„ã¦ä¼šè©±", b:"ç„¼è‚‰ã§ä¸€æ°—ã«è·é›¢ã‚’ç¸®ã‚ã‚‹",
    wA:{K:0.6,S:0.3,R:0.2}, wB:{C:0.7,F:0.4,L:0.2}},
];

/* ===== çŠ¶æ…‹ã¨UI ===== */
const PAGE_SIZE=5, TOTAL_PAGES=4;
let QUESTIONS=[], page=0, responses={}, answeredCount=0, pageStartAt=0;
const counts={R:0,L:0,F:0,S:0,K:0,C:0,Q:0,M:0};
const answers=[], rtimes=[];
const el=id=>document.getElementById(id);
const screenQuiz=el('screen-quiz'), screenResult=el('screen-result');

function showQuiz(){ screenQuiz.hidden=false; screenResult.hidden=true; }
function showResultScreen(){ screenQuiz.hidden=true; screenResult.hidden=false; }

function renderDots(qid){
  const tipsL=["å·¦ï¼šã¨ã¦ã‚‚è¿‘ã„","å·¦ï¼šã‹ãªã‚Šè¿‘ã„","å·¦ï¼šã‚„ã‚„è¿‘ã„"];
  const tipsR=["å³ï¼šã‚„ã‚„è¿‘ã„","å³ï¼šã‹ãªã‚Šè¿‘ã„","å³ï¼šã¨ã¦ã‚‚è¿‘ã„"];
  const valsL=[3,2,1], valsR=[-1,-2,-3];
  const cur=responses[qid]?.uiVal;
  const left=valsL.map((v,i)=>`<button class="dot ${i===0?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="L" data-val="${v}" title="${tipsL[i]}" aria-label="${tipsL[i]}"></button>`);
  const right=valsR.map((v,i)=>`<button class="dot ${i===2?'big':i===1?'':'small'} ${cur===v?'active':''}" data-side="R" data-val="${v}" title="${tipsR[i]}" aria-label="${tipsR[i]}"></button>`);
  return [...left, ...right];
}

/* é–‹å§‹ */
function start(){
  Object.keys(counts).forEach(k=>counts[k]=0);
  responses={}; answeredCount=0; page=0; answers.length=0; rtimes.length=0;
  QUESTIONS=[...BANK]; // é †ç•ªå›ºå®š
  showQuiz();
  renderPage();
}

/* ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒ¼ */
function renderPage(){
  el('page-now').textContent=page+1;
  el('q-answered').textContent=answeredCount;
  el('bar').style.width=((page)/TOTAL_PAGES*100)+'%';

  const startIdx=page*PAGE_SIZE;
  const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);

  const grid=el('qgrid'); grid.innerHTML='';
  slice.forEach((q)=>{
    const wrap=document.createElement('div'); wrap.className='qitem'; wrap.dataset.qid=q.id;
    wrap.innerHTML=`
      <div class="ctx">${q.ctx}</div>
      <div class="lr" aria-label="å·¦å³ã®æ¯”è¼ƒæ–‡">
        <div class="side"><b>${q.a}</b></div>
        <div class="side"><b>${q.b}</b></div>
      </div>
      <div class="scale" role="radiogroup" aria-label="6æ®µéšé¸æŠ">
        ${renderDots(q.id).join('')}
      </div>
    `;
    grid.appendChild(wrap);
  });

  setNextEnabled(slice.every(q=>responses[q.id]));

  grid.querySelectorAll('.dot').forEach(dot=>{
    dot.addEventListener('click', e=>{
      const qid = Number(e.currentTarget.closest('.qitem').dataset.qid);
      const uiVal = Number(e.currentTarget.dataset.val); // +3..-3
      selectDot(qid, uiVal, e.currentTarget);
    });
  });

  // 1..6 ã®ã‚­ãƒ¼å‰²å½“ï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®æœªå›ç­”ã«é †æ¬¡é©ç”¨ï¼‰
  window.onkeydown=(e)=>{
    const map={'1':3,'2':2,'3':1,'4':-1,'5':-2,'6':-3};
    if(!(e.key in map)) return;
    for(const q of slice){
      if(!responses[q.id]){
        const qwrap=grid.querySelector(`[data-qid="${q.id}"]`);
        const target=qwrap.querySelector(`.dot[data-val="${map[e.key]}"]`);
        target && target.click(); break;
      }
    }
  };

  pageStartAt=performance.now();
}

function selectDot(qid, uiVal, btn){
  responses[qid] = responses[qid] || {};
  const firstTime = (responses[qid].uiVal === undefined);
  responses[qid].uiVal = uiVal;
  if(firstTime){
    responses[qid].ts = performance.now() - pageStartAt;
    answeredCount++; el('q-answered').textContent = answeredCount;
  }
  const wrap=btn.closest('.qitem');
  wrap.querySelectorAll('.dot').forEach(d=>d.classList.remove('active'));
  wrap.querySelector(`.dot[data-val="${uiVal}"]`).classList.add('active');

  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  setNextEnabled(slice.every(q=>responses[q.id]));
}

function setNextEnabled(ok){ el('btn-next').classList.toggle('disabled', !ok); }

/* ãƒšãƒ¼ã‚¸ç¢ºå®šï¼šå¤šè»¸åŠ ç‚¹ */
function applyPage(){
  const startIdx=page*PAGE_SIZE; const slice=QUESTIONS.slice(startIdx, startIdx+PAGE_SIZE);
  for(const q of slice){
    const r=responses[q.id]; if(!r) continue;
    const abs=Math.abs(r.uiVal); const towardA=Math.sign(r.uiVal);
    const mag = abs>=3?1.0 : abs===2?0.7 : 0.4;  // å¼·åº¦ã‚¹ã‚±ãƒ¼ãƒ«
    const vec = (towardA>0) ? q.wA : q.wB;       // Aå´ or Bå´ é‡ã¿
    for(const k of Object.keys(vec)){
      counts[k] = (counts[k]||0) + (vec[k]||0)*mag;
    }
    answers.push({id:q.id,uiVal:r.uiVal,ms:r.ts,ctx:q.ctx});
    rtimes.push(r.ts);
  }
}

/* æ¬¡ãƒšãƒ¼ã‚¸ / çµæœã¸ */
document.getElementById('btn-next').addEventListener('click', ()=>{
  const btn = document.getElementById('btn-next');
  if(btn.classList.contains('disabled')) return;
  applyPage();
  if(page < TOTAL_PAGES-1){ page++; renderPage(); }
  else{ showResult(); }
});

/* ===== ã‚¿ã‚¤ãƒ—å®šç¾©ï¼ˆ12ç¨®ï¼šã‚·ãƒ³ã‚·ãƒ³â†’ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ï¼‰ ===== */
const OPP={R:"L",L:"R",F:"S",S:"F",K:"C",C:"K"};
const CODE_REPR={
  "R-F-K":"ãƒ’ãƒ¬","R-F-C":"ã‚¿ãƒ³","R-S-K":"ã‚¤ãƒãƒœ","R-S-C":"ãƒ©ãƒ³ãƒ—",
  "L-F-K":"ãƒªãƒ–ãƒ­ãƒ¼ã‚¹","L-F-C":"ã‚µãƒ¼ãƒ­ã‚¤ãƒ³","L-S-K":"ã‚¶ãƒ–ãƒˆãƒ³","L-S-C":"ã‚«ãƒ«ãƒ“"
};
const DESCRIPTIONS={
  "ãƒ’ãƒ¬":"ç„¡é§„ã®ãªã„ä¸Šå“ã•ã¨èŠ¯ã®å¼·ã•ã€‚ç´ æå‹è² ã§ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«å‘³ã‚ã†ã‚¿ã‚¤ãƒ—ã€‚",
  "ã‚¿ãƒ³":"ã•ã£ã±ã‚Šå¡©ã§ã‚­ãƒ¬è‰¯ãã€‚ãƒ†ãƒ³ãƒã®è‰¯ã•ã¨æ˜ã‚‹ã•ã§å ´ã‚’ã»ãã™ã€‚",
  "ã‚¤ãƒãƒœ":"èµ¤èº«ã‚’ä¸å¯§ã«ã€‚æ§ãˆã‚ã ãŒèŠ¯ã‚ã‚Šã€ä½™éŸ»ã‚’å¤§äº‹ã«ã™ã‚‹é€šå¥½ã¿ã€‚",
  "ãƒ©ãƒ³ãƒ—":"å®šç•ªã‚’ä¸€æ­©æ›´æ–°ã™ã‚‹å·¥å¤«ãŒå¥½ãã€‚é™ã‹ãªæƒ…ç†±ã®å®Ÿé¨“æ´¾ã€‚",
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":"ç‹é“ãƒªãƒƒãƒã€‚æ®µå–ã‚Šè‰¯ãçš†ã‚’å°ã‘ã‚‹é ¼ã‚Œã‚‹äººã€‚",
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":"è¯ã‚„ãã¨ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥ã€‚å†™çœŸæ˜ ãˆã‚„ç‰¹è£½ã‚½ãƒ¼ã‚¹ã«å¿ƒãŒèºã‚‹ã€‚",
  "ã‚¶ãƒ–ãƒˆãƒ³":"æ¿ƒåšã—ã£ã¨ã‚Šã€‚è¨€è‘‰ã‚’ä¸å¯§ã«é¸ã¶å¯©ç¾çœ¼ã‚¿ã‚¤ãƒ—ã€‚",
  "ã‚«ãƒ«ãƒ“":"ç”˜è¾›æ¿ƒåšã‚’æ„›ã™ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚ãƒ¯ã‚¤ãƒ¯ã‚¤ã«å¼·ã„ã€‚",
  "ãƒãƒ©ãƒŸ":"èµ¤èº«æ´¾ã®èºå‹•æ„Ÿã€‚å®Ÿåˆ©çš„ã§â€œã†ã¾ã„ãƒ»ãŸã®ã—ã„â€ã‚’å…±æœ‰ã—ãŸã„ã€‚",
  "ã‚«ã‚¤ãƒãƒŸ":"è»½ã‚„ã‹ãªã‚«ãƒ«ãƒ“ç³»ã€‚å¡©ã‚„ãƒ¬ãƒ¢ãƒ³ã§ã‚­ãƒ¬è‰¯ãä»•ä¸Šã’ãŸã„äººã«ã€‚",
  "ãƒŸã‚¹ã‚¸":"ç¹Šç´°ãªã‚µã‚·ã¨ã‚„ã•ã—ã„å£ã©ã‘ã€‚å°‘äººæ•°ã§ã˜ã£ãã‚Šã§æ˜ ãˆã‚‹ã€‚",
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":"é‡ã‚ˆã‚Šè³ªã€å®Œæˆåº¦é‡è¦–ã®å¸Œå°‘ã‚¿ã‚¤ãƒ—ã€‚å°‘äººæ•°ã§æ·±ãã€‚"
};
const RECS={
  "ãƒ’ãƒ¬":["ãƒ’ãƒ¬ã®åšåˆ‡ã‚Šãƒ¬ã‚¢","ã‚ã•ã³å¡©","èµ¤ãƒ¯ã‚¤ãƒ³åˆã‚ã›"],
  "ã‚¿ãƒ³":["ä¸Šã‚¿ãƒ³å¡©ãƒ¬ãƒ¢ãƒ³","ã­ãå¡©ã‚¿ãƒ³","ãƒã‚¤ãƒœãƒ¼ãƒ«åˆã‚ã›"],
  "ã‚¤ãƒãƒœ":["ã‚¤ãƒãƒœè–„åˆ‡ã‚Šã•ã£ã¨ç‚™ã‚Š","å±±ã‚ã•ã³","è»½ã„èµ¤"],
  "ãƒ©ãƒ³ãƒ—":["ãƒ©ãƒ³ãƒ—ã®ãƒ­ãƒ¼ã‚¹ãƒˆé¢¨","æŸšå­èƒ¡æ¤’","ã‚¯ãƒ©ãƒ•ãƒˆãƒ“ãƒ¼ãƒ«"],
  "ãƒªãƒ–ãƒ­ãƒ¼ã‚¹":["ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ã®ã‚µãƒƒã¨ç„¼ã","åµé»„ãƒ€ãƒ¬","èµ¤ãƒ¯ã‚¤ãƒ³"],
  "ã‚µãƒ¼ãƒ­ã‚¤ãƒ³":["ã‚µãƒ¼ãƒ­ã‚¤ãƒ³è–„åˆ‡ã‚Š","ã‚¬ãƒªãƒã‚¿é†¤æ²¹","æ¿ƒã„èµ¤"],
  "ã‚¶ãƒ–ãƒˆãƒ³":["ã‚¶ãƒ–ãƒˆãƒ³ç¶²ç„¼ã","å±±æ¤’å¡©","ãƒœãƒ‡ã‚£ã‚ã‚‹èµ¤"],
  "ã‚«ãƒ«ãƒ“":["ç‰¹è£½ãƒ€ãƒ¬ã®ã‚«ãƒ«ãƒ“","ç™½ã”ã¯ã‚“","ãƒ“ãƒ¼ãƒ«"],
  "ãƒãƒ©ãƒŸ":["ãƒãƒ©ãƒŸã‚¿ãƒ¬ç„¼ã","ã«ã‚“ã«ããƒãƒƒãƒ—","ãƒ¬ãƒ¢ãƒ³ã‚µãƒ¯ãƒ¼"],
  "ã‚«ã‚¤ãƒãƒŸ":["ã‚«ã‚¤ãƒãƒŸå¡©","ãƒ¬ãƒ¢ãƒ³","è»½ã‚ã®èµ¤"],
  "ãƒŸã‚¹ã‚¸":["ãƒŸã‚¹ã‚¸è–„åˆ‡ã‚Š","ãƒãƒ³é…¢ãŠã‚ã—","æ—¥æœ¬é…’"],
  "ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³":["åšåˆ‡ã‚Šãƒ¬ã‚¢","å¡©ï¼‹é»’èƒ¡æ¤’ã®ã¿","ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥/æ³¡"]
};

/* 12ã‚¿ã‚¤ãƒ—åŒ–ï¼šãƒ™ãƒ¼ã‚¹8ã‚¿ã‚¤ãƒ—ã« Texture ã§åˆ†å²ï¼ˆã‚·ãƒ³ã‚·ãƒ³â†’ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³ï¼‰ */
function pickSubtype(code,c){
  switch(code){
    case 'R-F-K': return 'ãƒ’ãƒ¬';
    case 'R-F-C': return (c.M>c.Q ? 'ãƒãƒ©ãƒŸ':'ã‚¿ãƒ³');
    case 'R-S-K': return (c.M>c.Q ? 'ãƒŸã‚¹ã‚¸':'ã‚¤ãƒãƒœ');
    case 'R-S-C': return 'ãƒ©ãƒ³ãƒ—';
    case 'L-F-K': return (c.M>c.Q ? 'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³':'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹');
    case 'L-F-C': return 'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³';
    case 'L-S-K': return 'ã‚¶ãƒ–ãƒˆãƒ³';
    case 'L-S-C': return (c.Q>c.M ? 'ã‚«ã‚¤ãƒãƒŸ':'ã‚«ãƒ«ãƒ“');
    default: return 'ãƒ’ãƒ¬';
  }
}

function parseCode(code){const [a,b,c]=code.split('-');return {RL:a,FS:b,KC:c};}
function allTypeCodes(){return Object.keys(CODE_REPR);}

/* ç›¸æ€§ï¼ˆ60%è£œå®Œ + 40%å…±æœ‰ï¼‰ */
function compatScore(myCode, otherCode){
  const me=parseCode(myCode), ot=parseCode(otherCode);
  let opp=0, same=0;
  if(ot.RL===OPP[me.RL]) opp++; else if(ot.RL===me.RL) same++;
  if(ot.FS===OPP[me.FS]) opp++; else if(ot.FS===me.FS) same++;
  if(ot.KC===OPP[me.KC]) opp++; else if(ot.KC===me.KC) same++;
  return 0.6*(opp/3) + 0.4*(same/3);
}
function topMatches(code, n=3){
  return allTypeCodes()
    .filter(c=>c!==code)
    .map(c=>({code:c, score:compatScore(code,c)}))
    .sort((a,b)=>b.score-a.score)
    .slice(0,n);
}

/* åˆ¤å®š */
function decide(A,B,AL,BL){ return (A>=B)?AL:BL; }
function computeResult(){
  const {R,L,F,S,K,C,Q,M} = counts;
  const RL = decide(R,L,'R','L');
  const FS = decide(F,S,'F','S');
  const KC = decide(K,C,'K','C');
  const code = `${RL}-${FS}-${KC}`;
  const name = pickSubtype(code, {Q,M});
  const tagTexture = (Q>=M)?'å™›ã¿å¿œãˆ':'ã¨ã‚ã‘';
  const tagFlavor  = (R>=L)?'å¡©å¯„ã‚Š':'ã‚¿ãƒ¬å¯„ã‚Š';
  const tagAfter   = (F>=S)?'ãƒ†ãƒ³ãƒé‡è¦–':'ã˜ã£ãã‚Šé‡è¦–';
  return {code,name,R,L,F,S,K,C,Q,M,tagTexture,tagFlavor,tagAfter};
}

/* çµæœè¡¨ç¤ºï¼ˆç›¸æ€§6å‰²ï¼ãŠã™ã™ã‚4å‰²ï¼‰ */
function showResult(){
  el('bar').style.width='100%';
  const r=computeResult();
  showResultScreen();

  // å·¦ã‚«ãƒ¼ãƒ‰
  document.getElementById('r-type-name').textContent=r.name;
  document.getElementById('r-type-code').textContent=r.code;
  document.getElementById('tag-texture').textContent=r.tagTexture;
  document.getElementById('tag-flavor').textContent=r.tagFlavor;
  document.getElementById('tag-after').textContent=r.tagAfter;
  document.getElementById('r-desc').textContent=DESCRIPTIONS[r.name]||'';

  const recUL = document.getElementById('r-recs');
  recUL.innerHTML = '';
  (RECS[r.name]||[]).slice(0,3).forEach(txt=>{
    const li=document.createElement('li'); li.textContent=txt; recUL.appendChild(li);
  });

  // å³ã‚«ãƒ¼ãƒ‰ï¼šç›¸æ€§ãƒˆãƒƒãƒ—3
  const tops = topMatches(r.code,3);
  const ol = document.getElementById('compat-list'); ol.innerHTML='';
  tops.forEach((t,i)=>{
    const li=document.createElement('li');
    const otherName = CODE_REPR[t.code] || t.code;
    const pct = Math.round(t.score*100);
    const me=parseCode(r.code), ot=parseCode(t.code);
    const bits=[];
    if(ot.RL===OPP[me.RL]) bits.push('èµ¤èº«/ã‚³ã‚¯ãŒè£œå®Œ'); else if(ot.RL===me.RL) bits.push('å‘³ã®æ–¹å‘æ€§ãŒä¸€è‡´');
    if(ot.FS===OPP[me.FS]) bits.push('ãƒ†ãƒ³ãƒãŒè£œå®Œ');    else if(ot.FS===me.FS) bits.push('é£Ÿäº‹é€Ÿåº¦ãŒåˆã†');
    if(ot.KC===OPP[me.KC]) bits.push('å®šç•ª/å‰µä½œã®ãƒãƒ©ãƒ³ã‚¹'); else if(ot.KC===me.KC) bits.push('ä¾¡å€¤è¦³ãŒè¿‘ã„');
    li.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px">
      <div><strong>${i+1}. ${otherName}</strong>ï¼ˆ${t.code}ï¼‰</div>
      <div class="mono" style="opacity:.85">${pct}%</div>
    </div>
    <div style="color:#cfd7e6;opacity:.9;margin-top:4px">ãƒ»${bits.join('ï¼')}</div>`;
    ol.appendChild(li);
  });
  document.getElementById('compat-notes').textContent = 'â€»ç›¸æ€§ã¯ã€Œè£œå®Œï¼ˆåå¯¾è»¸ï¼‰ã€6å‰²ï¼‹ã€Œå…±æœ‰ï¼ˆåŒã˜è»¸ï¼‰ã€4å‰²ã§ç®—å‡ºã€‚';

  // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  const payload={
    type:{baseCode:r.code,displayName:r.name},
    tags:{texture:r.tagTexture,flavor:r.tagFlavor,after:r.tagAfter},
    counts:{R:r.R,L:r.L,F:r.F,S:r.S,K:r.K,C:r.C,Q:r.Q,M:r.M},
    topMatches: tops,
    answers,
    generatedAt:new Date().toISOString()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.getElementById('btn-export'); a.href=url; a.download=`MEAT-BTI_${r.code}.json`;
}

/* Start / Retryï¼ˆå€‹åˆ¥ã«ãƒã‚¤ãƒ³ãƒ‰ï¼šã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ãªã—ã§ç¢ºå®Ÿç™ºç«ï¼‰ */
document.getElementById('btn-start').addEventListener('click', (e)=>{ e.preventDefault(); start(); window.scrollTo({top:screenQuiz.offsetTop-8,behavior:'smooth'}); });
document.getElementById('btn-start-2').addEventListener('click', (e)=>{ e.preventDefault(); start(); window.scrollTo({top:screenQuiz.offsetTop-8,behavior:'smooth'}); });
const retry=document.getElementById('btn-retry'); if(retry) retry.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'}); location.reload();});
</script>
</body>
</html>
