<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meat BTI 診断結果</title>
<meta name="theme-color" content="#0b0a0a">
<style>
  :root{
    --bg:#0b0a0a; --panel:#131723; --ink:#f7f7fb; --muted:#c5c9d3; --bd:#232a3a;
    --brand:#ffd966; --accent:#ff6b4a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em;line-height:1.65}
  a{color:inherit;text-decoration:none}

  .wrap{width:min(1040px,92vw);margin:0 auto}
  header{padding:14px 0;border-bottom:1px solid var(--bd);position:sticky;top:0;background:#0b0a0ad0;backdrop-filter:saturate(120%) blur(8px);z-index:10}
  h1{font-size:clamp(22px,5.4vw,34px);margin:0}
  .lead{color:var(--muted);margin:4px 0 0}

  .grid{display:grid;gap:18px;grid-template-columns:1fr}
  @media(min-width:920px){.grid{grid-template-columns:1fr 1fr}}

  .card{background:var(--panel);border:1px solid var(--bd);border-radius:16px;padding:16px}
  .h2{font-weight:900;font-size:clamp(18px,4.6vw,26px);margin:0 0 8px}
  .big{font-size:clamp(22px,5.4vw,32px);font-weight:900;margin:2px 0}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#161c2b;border:1px solid #2c3650;margin:2px 6px 0 0;font-size:12px;color:#e5e9f3}
  .imgbox{border:1px solid #2a3146;border-radius:14px;overflow:hidden;background:#0e1424}
  .imgbox img{width:100%;display:block;object-fit:cover;aspect-ratio:1/1}
  .desc{color:#e7ebf6;line-height:1.9;margin-top:8px}
  ul{margin:0 0 0 18px}
  .meta{color:var(--muted);font-size:12px;margin-top:10px}
  .btn{appearance:none;border:1px solid var(--bd);background:#151b2a;color:var(--ink);
       padding:12px 14px;border-radius:12px;font-weight:900;cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,var(--brand),#f7c84a);color:#2a1e0b;border:none}
  .row{display:flex;flex-wrap:wrap;gap:10px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Meat BTI 診断結果</h1>
    <p class="lead">あなたの“部位キャラ”と相性No.1を表示します。</p>
  </div>
</header>

<main class="wrap" id="app">
  <section id="warn" class="card" style="display:none">
    <p>診断データが見つかりませんでした。<br>
      <a class="btn primary" href="quiz.html">診断をはじめる</a></p>
  </section>

  <section id="result" class="grid" style="display:none">
    <article class="card">
      <div class="h2">あなたのタイプ</div>
      <div id="typeJp" class="big">—</div>
      <div id="code" class="pill">—</div>
      <div class="row" style="margin-top:6px">
        <span id="tagTexture" class="pill"></span>
        <span id="tagFlavor" class="pill"></span>
        <span id="tagAfter" class="pill"></span>
      </div>
      <p id="catch" class="desc"></p>
      <ul id="tips"></ul>
      <div class="meta" id="meta"></div>
    </article>

    <aside class="card">
      <div class="imgbox"><img id="charImg" alt=""></div>
      <div style="margin-top:10px">
        <div class="h2">相性 No.1</div>
        <div id="bestJp" class="big">—</div>
        <div id="bestCode" class="pill">—</div>
      </div>
      <div style="margin-top:10px" class="row">
        <a class="btn" href="../index1.html">LPに戻る</a>
        <a class="btn" href="quiz.html">もう一度診断</a>
      </div>
    </aside>
  </section>
</main>

<script>
(function(){
  const KEY = 'MEATBTI_V1';
  const store = sessionStorage.getItem(KEY);
  if(!store){
    document.getElementById('warn').style.display = 'block';
    return;
  }
  const data = JSON.parse(store||'{}');
  const answers = data.answers || {};
  const get = q => Number(answers[q] || 3); // 未定義は中立

  // --- 質問→軸マッピング ---
  // A側 = 左寄り（1〜2）、B側 = 右寄り（4〜5）、中立=3
  const AX = {
    RL: [1,2,3,4,16,13,14,19,20],     // A=R(赤身/軽快), B=L(霜降り/華やか)
    FS: [11,18],                      // A=F(テンポ),    B=S(ゆっくり)
    KC: [5,12,17,7],                  // A=K(定番),      B=C(変化・演出)
    TX: [6,15],                       // A=Q(歯切れ),    B=M(とろけ)
    FL: [8],                          // A=塩,           B=ソース
    AF: [10],                         // A=軽め,         B=しっかり
  };

  function sumAxis(keys, AisNeg=true){
    // val = answer-3 => -2..+2 （負= A寄り / 正= B寄り）
    return keys.reduce((s,q)=> s + (get(q)-3), 0);
  }

  const RLv = sumAxis(AX.RL); // <0 = R、>0 = L
  const FSv = sumAxis(AX.FS); // <0 = F、>0 = S
  const KCv = sumAxis(AX.KC); // <0 = K、>0 = C
  const TXv = sumAxis(AX.TX); // <0 = Q、>0 = M
  const FLv = sumAxis(AX.FL); // <0 = 塩、>0 = ソース
  const AFv = sumAxis(AX.AF); // <0 = 軽め、>0 = しっかり

  function pick(v, neg, pos){
    if(v<0) return neg;
    if(v>0) return pos;
    return Math.random()<0.5?neg:pos; // 同点はランダムでブレイク
  }

  const RL = pick(RLv,'R','L');
  const FS = pick(FSv,'F','S');
  const KC = pick(KCv,'K','C');
  const code = `${RL}-${FS}-${KC}`;

  // --- 8ベース → 12タイプ（サブタイプ条件） ---
  const BASE_TO_NAME = {
    'R-F-K':'ヒレ男爵',
    'R-F-C':'タン隊長',
    'R-S-K':'イチボママ',
    'R-S-C':'ランプ博士',
    'L-F-K':'リブロースボス',
    'L-F-C':'サーロイン王',
    'L-S-K':'美食家ザブトン',
    'L-S-C':'ギャルカルビ',
  };

  function refine(code){
    // TXv(食感) / FLv(味つけ) / AFv(ボリューム)
    if(code==='R-F-C'){
      // タン or ハラミ
      if(FLv>0 || AFv>0) return 'やり手の営業マンハラミ';
      return 'タン隊長';
    }
    if(code==='L-S-C'){
      // カルビ or カイノミ（軽やか）
      if(FLv<=0 || AFv<=0 || TXv<0) return 'カイノミ舞妓はん';
      return 'ギャルカルビ';
    }
    if(code==='R-S-K'){
      // イチボ or ミスジ（繊細サシ）
      if(TXv>0 || FLv>0) return '書道家ミスジ';
      return 'イチボママ';
    }
    if(code==='R-F-K'){
      // ヒレ or シャトーブリアン（質集中・軽やか）
      const strongLean = Math.abs(RLv) >= 4;
      if(TXv<0 && FLv<=0 && AFv<=0 && strongLean) return 'シャトーブリアン女王';
      return 'ヒレ男爵';
    }
    // その他はベース固定
    return BASE_TO_NAME[code] || 'ヒレ男爵';
  }

  const displayName = refine(code);

  // --- 相性 No.1（単一） ---
  const BEST = {
    'ヒレ男爵':'サーロイン王',
    'タン隊長':'リブロースボス',
    'イチボママ':'ギャルカルビ',
    'ランプ博士':'美食家ザブトン',
    'リブロースボス':'タン隊長',
    'サーロイン王':'ヒレ男爵',
    '美食家ザブトン':'ランプ博士',
    'ギャルカルビ':'イチボママ',
    'やり手の営業マンハラミ':'美食家ザブトン',
    'カイノミ舞妓はん':'リブロースボス',
    '書道家ミスジ':'サーロイン王',
    'シャトーブリアン女王':'タン隊長',
  };

  // --- キャッチ / Tips ---
  const COPY = {
    'ヒレ男爵':{
      catch:'静かな主役。無駄なく上品、芯の強さで魅せる赤身派。',
      tips:['最初は「名物の塩」で軸を示す','相手の好みを1つ拾って次の一皿へ','乾杯はハイボール/スパークリングで軽やかに'],
      img:'hire.png'
    },
    'タン隊長':{
      catch:'場をほぐすムードメーカー。テンポ良く明るく回す。',
      tips:['「タン塩→赤身」の黄金ルート提案','小皿シェアで会話を回す','写真はほどほど、コメントで盛り上げ'],
      img:'tan.png'
    },
    'イチボママ':{
      catch:'やさしく頼れる赤身の母性。控えめでも芯は強い。',
      tips:['似た好みで食べ比べを提案','ペースに合わせて火入れ調整','締めは軽めで余白を残す'],
      img:'ichibo.png'
    },
    'ランプ博士':{
      catch:'小さな冒険家。定番を少し更新する工夫が好き。',
      tips:['少量×多皿でミニ実験','創作系を一皿混ぜて話題作り','焼き担当で観察しつつ合図'],
      img:'ranpu.png'
    },
    'リブロースボス':{
      catch:'安心感のリーダー。王道リッチで満足度重視。',
      tips:['「名物→名物」で段取り良く','会計や席替えをスムーズに','写真少なめ、体験を濃く'],
      img:'riburo-su.png'
    },
    'サーロイン王':{
      catch:'華やぎの演出家。濃厚と映えで場を明るくする。',
      tips:['フランベなど演出皿をコール','乾杯の音頭でスタート','隣席とも軽く乾杯して輪を広げる'],
      img:'sa-roin.png'
    },
    '美食家ザブトン':{
      catch:'寡黙な審美家。しっとり濃厚、少人数でじっくり。',
      tips:['「少量高満足」で共感を得る','休ませ時間を大切に','深めの質問をひとつだけ'],
      img:'zabuton.png'
    },
    'ギャルカルビ':{
      catch:'ご褒美エンタメ。甘やかに濃厚、みんなを巻き込む。',
      tips:['序盤で「みんなの一口カルビ」','自分が撮ってシェアで牽引','満足派の声を拾ってリード'],
      img:'karubi.png'
    },
    'やり手の営業マンハラミ':{
      catch:'実利派スプリンター。躍動感ある赤身でテンポ勝負。',
      tips:['回転を上げて間を作らない','焼き台の管理役で活躍','飲み過ぎず笑顔キープ'],
      img:'harami.png'
    },
    'カイノミ舞妓はん':{
      catch:'軽やか派の橋渡し。カルビ系でもキレ良く上品。',
      tips:['「塩→ソース」でメリハリ','軽い締めで余白を残す','相手の得意トークを振る'],
      img:'kainomi.png'
    },
    '書道家ミスジ':{
      catch:'繊細なサシ。口どけ上品、所作と気配りが魅力。',
      tips:['火入れ控えめで温度と香りを共有','小声のツッコミで距離を縮める','甘めは量を絞って提案'],
      img:'misuji.png'
    },
    'シャトーブリアン女王':{
      catch:'特選の一点集中。量より質、静かに深く味わう。',
      tips:['「量より質」の提案で軸を見せる','静かな席を選ぶ','デザート前に次回の約束を軽く'],
      img:'shato-.png'
    },
  };

  // タグ表示（食感/味付/後味）
  const tagTexture = (TXv<0)?'食感：歯切れ派':'食感：とろけ派';
  const tagFlavor  = (FLv<0)?'味付：塩派':'味付：特製ソース派';
  const tagAfter   = (AFv<0)?'後味：軽め':'後味：しっかり';

  // 表示反映
  const typeJp = document.getElementById('typeJp');
  const codeEl = document.getElementById('code');
  const tagT = document.getElementById('tagTexture');
  const tagF = document.getElementById('tagFlavor');
  const tagA = document.getElementById('tagAfter');
  const catchEl = document.getElementById('catch');
  const tipsEl = document.getElementById('tips');
  const imgEl = document.getElementById('charImg');
  const bestJp = document.getElementById('bestJp');
  const bestCode = document.getElementById('bestCode');
  const meta = document.getElementById('meta');

  const copy = COPY[displayName] || COPY['ヒレ男爵'];
  typeJp.textContent = displayName;
  codeEl.textContent = code;
  tagT.textContent = tagTexture;
  tagF.textContent = tagFlavor;
  tagA.textContent = tagAfter;
  catchEl.textContent = copy.catch;
  tipsEl.innerHTML = copy.tips.map(t=>`<li>${t}</li>`).join('');
  imgEl.src = copy.img;
  imgEl.alt = displayName;

  const best = BEST[displayName];
  bestJp.textContent = best || '—';
  // 相手の3文字コード（代表）簡易表示
  const REV = {'R':'L','L':'R','F':'S','S':'F','K':'C','C':'K'};
  function bestCodeOf(name){
    // 代表 8タイプのみ推定
    const MAP = {
      'ヒレ男爵':'R-F-K','タン隊長':'R-F-C','イチボママ':'R-S-K','ランプ博士':'R-S-C',
      'リブロースボス':'L-F-K','サーロイン王':'L-F-C','美食家ザブトン':'L-S-K','ギャルカルビ':'L-S-C',
      'やり手の営業マンハラミ':'R-F-C','カイノミ舞妓はん':'L-S-C','書道家ミスジ':'R-S-K','シャトーブリアン女王':'R-F-K'
    };
    return MAP[name] || '—';
  }
  bestCode.textContent = best ? bestCodeOf(best) : '—';

  meta.textContent = `食感:${(TXv<0?'Q':'M')} / 味付:${(FLv<0?'塩':'ソース')} / 後味:${(AFv<0?'軽':'重')} ／ 回答日時：${new Date(data.finishedAt||Date.now()).toLocaleString()}`;

  document.getElementById('result').style.display = 'grid';
})();
</script>
</body>
</html>
