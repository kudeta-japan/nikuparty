<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meat BTI è¨ºæ–­ï¼ˆ5æ®µéšãƒ»è‡ªå‹•é€²è¡Œï¼‰</title>
<meta name="description" content="20å•ã‚’Aå¯„ã‚Šã€œBå¯„ã‚Šã®5æ®µéšã§å›ç­”ã€‚12ã‚¿ã‚¤ãƒ—ã¨ç›¸æ€§No.1ãƒ»è¦æ³¨æ„ã‚¿ã‚¤ãƒ—ã‚’è¡¨ç¤ºã€‚">
<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V39MNGQD5H"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date()); gtag('config', 'G-V39MNGQD5H');
</script>
<style>
  :root{--bg:#0b0d13;--panel:#111522;--ink:#f7faff;--muted:#b9c2d3;--bd:#1b2334;--cheese:#ffd966;--tomato:#ff6b4a;--ok:#35d19d;--shadow:0 14px 32px rgba(0,0,0,.35)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em;line-height:1.7}
  a{color:inherit;text-decoration:none}
  .wrap{min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
  header{position:sticky;top:0;background:rgba(17,21,34,.8);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--bd);z-index:10}
  .head-in{width:min(960px,92vw);margin:0 auto;height:56px;display:flex;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:30px;height:30px;border-radius:10px;background:conic-gradient(from 140deg,var(--cheese),var(--tomato));display:grid;place-items:center;color:#111;font-weight:900}
  .btn{appearance:none;border:1px solid var(--bd);background:#152037;color:var(--ink);padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer;transition:transform .06s ease}
  .btn.primary{background:linear-gradient(180deg,var(--tomato),#ff4e2f);color:#111;border:none}
  .main{width:min(820px,92vw);margin:0 auto;padding:16px 0}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
  .progress{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--bd)}
  .bar{height:8px;background:#121a2f;border:1px solid var(--bd);border-radius:999px;overflow:hidden;flex:1}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--cheese),var(--tomato))}
  .qwrap{padding:16px}
  .qhead{font-weight:900;margin:0 0 6px}
  .qtext{margin:0 0 10px;color:#dce6ff}
  .anchors{display:flex;justify-content:space-between;color:#9fb0cc;font-size:13px;margin:8px 2px 10px}
  .scale{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
  .cell{display:grid;place-items:center;border:1px solid #293653;background:#121a31;border-radius:12px;padding:14px;cursor:pointer;user-select:none}
  .cell[data-sel="1"]{outline:2px solid var(--cheese);border-color:#6b5722;background:#1b243b}
  .cell small{display:block;opacity:.8;font-size:12px;margin-top:4px}
  .qfoot{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0e1424;border:1px solid #2a3651;border-radius:6px;padding:2px 6px;font-size:12px;color:#9fb0cc}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#10172a;border:1px solid #26314b;font-size:12px;color:#cdd8ef}
  .result{display:grid;gap:16px}
  .r-hero{display:grid;grid-template-columns:1fr 1.2fr;gap:14px}
  @media(max-width:800px){.r-hero{grid-template-columns:1fr}}
  .r-img{aspect-ratio:1/1;background:#0b1222;border-radius:12px;overflow:hidden;border:1px solid #1f2a43}
  .r-img img{width:100%;height:100%;object-fit:cover}
  .rtype{font-size:clamp(22px,5vw,28px);font-weight:900;margin:0}
  .r-tags{margin-top:6px;display:flex;flex-wrap:wrap;gap:6px}
  .tag{padding:6px 10px;border:1px solid #2a385e;border-radius:999px;background:#111a31;font-size:12px}
  footer{color:#9fb0cc;font-size:12px;padding:14px;border-top:1px solid var(--bd);text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="head-in">
      <div class="brand"><div class="logo">ğŸ¥©</div><b>Meat BTI è¨ºæ–­</b></div>
      <a class="btn" href="index.html">â† å›³é‘‘ã«æˆ»ã‚‹</a>
    </div>
  </header>

  <main class="main">
    <div class="card" id="quizCard">
      <div class="progress">
        <div><b id="qIdx">1</b>/20</div>
        <div class="bar"><div id="bar"></div></div>
      </div>
      <div class="qwrap">
        <p class="qhead" id="qHead">è¨­å•</p>
        <p class="qtext" id="qText"></p>

        <div class="anchors"><span id="aLeft">A</span><span id="aRight">B</span></div>
        <div class="scale" id="scale">
          <!-- 5ã‚»ãƒ«ï¼ˆ-2,-1,0,+1,+2ï¼‰ -->
        </div>

        <div class="qfoot">
          <div class="pill">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ <span class="kbd">1</span>ã€œ<span class="kbd">5</span>ï¼ˆæŠ¼ã™ã¨è‡ªå‹•ã§æ¬¡ã¸ï¼‰</div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="prevBtn">æˆ»ã‚‹</button>
            <button class="btn primary" id="nextBtn" disabled>æ¬¡ã¸</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card" id="resultCard" hidden>
      <div class="qwrap result">
        <div class="r-hero">
          <div class="r-img"><img id="rImg" alt=""></div>
          <div>
            <h2 class="rtype" id="rType">â€”</h2>
            <div class="r-tags" id="rTags"></div>
            <p id="rOne" style="margin-top:8px;color:#dce6ff">â€”</p>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
              <button class="btn" id="retryBtn">ã‚‚ã†ä¸€åº¦</button>
              <button class="btn" id="saveBtn">çµæœã‚’ä¿å­˜(JSON)</button>
              <a class="btn primary" href="index.html">å›³é‘‘ã¸æˆ»ã‚‹</a>
            </div>
          </div>
        </div>
        <div style="margin-top:10px">
          <p><b>ç›¸æ€§No.1ï¼š</b><span id="bestMate">â€”</span></p>
          <p style="color:#ffd7b8"><b>è¦æ³¨æ„ï¼š</b><span id="caution">â€”</span></p>
        </div>
      </div>
    </div>
  </main>

  <footer>Â© <span id="y"></span> Meat BTI</footer>
</div>

<script>
  // === Axes (5) ===
  const AXES = ['rich','adv','tempo','social','texture'];

  // === Type definitions ===
  const TYPES = {
    'ãƒ’ãƒ¬ç”·çˆµ':           { c:{rich:-2, adv:-2, tempo:-2, social:-2, texture:-2}, one:'é™ã‹ãªä¸»å½¹ã€‚ç„¡é§„ãªãä¸Šå“ã€èŠ¯ã¯å¼·ã„ã€‚', best:'æ›¸é“å®¶ãƒŸã‚¹ã‚¸', caution:'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“' },
    'ã‚¿ãƒ³éšŠé•·':           { c:{rich:-1, adv:+1, tempo:+2, social:+1, texture:+2}, one:'åˆå›³ã¨æ®µå–ã‚Šã§å ´ã‚’å›ã™ãƒ ãƒ¼ãƒ‰ç‰½å¼•ã€‚', best:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹', caution:'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹' },
    'ã‚¤ãƒãƒœãƒãƒ':         { c:{rich:+1, adv:-1, tempo:-1, social:-1, texture:-1}, one:'é¢å€’è¦‹ã®è‰¯ã•ã¨å®‰å¿ƒæ„Ÿã€‚æ§ãˆã‚ã§ã‚‚é ¼ã‚Œã‚‹ã€‚', best:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ', caution:'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹' },
    'ãƒ©ãƒ³ãƒ—åšå£«':         { c:{rich:-1, adv:+2, tempo:+1, social: 0, texture:+1}, one:'å°ã•ãªå®Ÿé¨“ã§ä¼šè©±ã‚’åºƒã’ã‚‹è¦³å¯Ÿçœ¼ã€‚', best:'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“', caution:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹' },
    'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹':     { c:{rich:+2, adv:-1, tempo: 0, social:+1, texture:-1}, one:'ã©ã£ã—ã‚Šæº€è¶³åº¦ã€‚é ¼ã‚Œã‚‹çµ±ç‡åŠ›ã€‚', best:'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“', caution:'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“' },
    'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹':       { c:{rich:+2, adv:+1, tempo:+1, social:+2, texture: 0}, one:'è¯ã‚„ã‹ãªæ¼”å‡ºã§å ´ã‚’æ˜ã‚‹ãã™ã‚‹ç‹é“ã€‚', best:'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹', caution:'æ›¸é“å®¶ãƒŸã‚¹ã‚¸' },
    'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³':     { c:{rich:+2, adv:-2, tempo:-2, social:-1, texture:-1}, one:'ã—ã£ã¨ã‚Šæ¿ƒåšã€‚è¨€è‘‰ã‚‚æ‰€ä½œã‚‚ä¸å¯§ã€‚', best:'ã‚¿ãƒ³éšŠé•·', caution:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ' },
    'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“':       { c:{rich:+2, adv:+2, tempo:+2, social:+2, texture: 0}, one:'ã”è¤’ç¾æ„Ÿã§å ´ã‚’çˆ†ä¸Šã’ã™ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¡åŠ›ã€‚', best:'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹', caution:'ãƒ©ãƒ³ãƒ—åšå£«' },
    'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ': { c:{rich: 0, adv:+1, tempo:+2, social:+1, texture:+1}, one:'ãƒ†ãƒ³ãƒè‰¯ãå®Ÿå‹™ã‚‚ä¼šè©±ã‚‚å›ã™åˆ‡æ›¿ä¸Šæ‰‹ã€‚', best:'ã‚¤ãƒãƒœãƒãƒ', caution:'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³' },
    'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“':   { c:{rich:+1, adv: 0, tempo:+1, social: 0, texture:-1}, one:'è»½ã‚„ã‹ä¸Šå“ã€‚å ´ã®æ©‹æ¸¡ã—ãŒå¾—æ„ã€‚', best:'ãƒ©ãƒ³ãƒ—åšå£«', caution:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ' },
    'æ›¸é“å®¶ãƒŸã‚¹ã‚¸':       { c:{rich:+1, adv:-2, tempo:-2, social:-2, texture:-2}, one:'ç¹Šç´°ãªç¾æ„è­˜ã€‚é™ã‹ã«æ·±ãå‘ãåˆã†ã€‚', best:'ãƒ’ãƒ¬ç”·çˆµ', caution:'ã‚¤ãƒãƒœãƒãƒ' },
    'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹': { c:{rich:+1, adv:-1, tempo:-2, social:-1, texture:-2}, one:'é‡ã‚ˆã‚Šè³ªã®ä¸€ç‚¹é›†ä¸­ã€‚é™ã‹ãªæ ¼ä¸Šã€‚', best:'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³', caution:'ãƒ’ãƒ¬ç”·çˆµ' },
  };

  // === Character images ===
  const TYPE_IMAGE = {
    'ãƒ’ãƒ¬ç”·çˆµ':'hire.png',
    'ã‚¿ãƒ³éšŠé•·':'tan.png',
    'ã‚¤ãƒãƒœãƒãƒ':'ichibo.png',
    'ãƒ©ãƒ³ãƒ—åšå£«':'ranpu.png',
    'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹':'riburo-su.png',
    'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹':'sa-roin.png',
    'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³':'zabuton.png',
    'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“':'karubi.png',
    'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ':'harami.png',
    'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“':'kainomi.png',
    'æ›¸é“å®¶ãƒŸã‚¹ã‚¸':'misuji.png',
    'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹':'shato-.png',
  };

  // === 20 Questionsï¼ˆ5æ®µéšã€‚å·¦å³ã«A/Bã®ã‚¢ãƒ³ã‚«ãƒ¼è¡¨ç¤ºï¼‰ ===
  const Q = [
    {id:1,  axis:'rich',   head:'æœ€åˆã®ä¸€çš¿ã¯ï¼Ÿ',           text:'åŒã˜ä¾¡æ ¼ãªã‚‰ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ', A:'èµ¤èº«ã§è»½ã', B:'ã‚³ã‚¯ã®ã‚ã‚‹ãƒªãƒƒãƒ'},
    {id:2,  axis:'rich',   head:'ãƒ¡ã‚¤ãƒ³ã®ä¸€çš¿',             text:'æº€è¶³åº¦ã‚’å„ªå…ˆã™ã‚‹ãªã‚‰ï¼Ÿ',     A:'ãƒ’ãƒ¬ãƒ»ãƒ©ãƒ³ãƒ—ãªã©èµ¤èº«', B:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒ»ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ãªã©ã‚³ã‚¯'},
    {id:3,  axis:'rich',   head:'è„‚ã®é‡ã®å¥½ã¿',             text:'å¥½ããªæ–¹å‘æ€§ã«è¿‘ã„ã®ã¯ï¼Ÿ', A:'è„‚æ§ãˆã‚ã§ã‚­ãƒ¬', B:'è„‚ã®æ—¨ã¿ã‚’ã—ã£ã‹ã‚Š'},
    {id:4,  axis:'rich',   head:'ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿ',             text:'é‡ã¨é‡ã•ã®ãƒãƒ©ãƒ³ã‚¹ã¯ï¼Ÿ',     A:'è»½ã‚ãŒå¥½ã', B:'é‡åšã§ã‚‚OK'},

    {id:5,  axis:'adv',    head:'ã‚ªãƒ¼ãƒ€ãƒ¼æ–¹é‡',             text:'ã¯ã˜ã‚ã¦ã®ãŠåº—ã§',         A:'ç‹é“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸­å¿ƒ', B:'é™å®šãƒ»å‰µä½œã‚‚æ”»ã‚ã‚‹'},
    {id:6,  axis:'adv',    head:'æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼',               text:'æœªçŸ¥ã®ä¸€çš¿ãŒã‚ã£ãŸã‚‰',     A:'æ§˜å­è¦‹', B:'ã¾ãšè©¦ã™'},
    {id:7,  axis:'adv',    head:'å‘³ä»˜ã‘ã®é¸ã³æ–¹',           text:'åŸºæœ¬ã¯',                   A:'å®šç•ªã®å¡©ãƒ»ç‰¹è£½ã‚½ãƒ¼ã‚¹', B:'æ—¬ã®ã‚½ãƒ¼ã‚¹ã‚„ã‚¹ãƒ‘ã‚¤ã‚¹æ­“è¿'},
    {id:8,  axis:'adv',    head:'ç„¼ãæ–¹ã‚«ã‚¹ã‚¿ãƒ ',           text:'è‡ªåˆ†ã§èª¿æ•´ã™ã‚‹ã®ã¯',       A:'ã‚ã¾ã‚Šã—ãªã„', B:'ç©æ¥µçš„ã«ã‚„ã‚‹'},

    {id:9,  axis:'tempo',  head:'é£Ÿäº‹ã®ãƒ†ãƒ³ãƒ',             text:'ç†æƒ³ã®é€²è¡Œã¯ï¼Ÿ',           A:'ä¸€çš¿ãšã¤ã‚†ã£ãã‚Š', B:'ã‚µã‚¯ã‚µã‚¯è»½å¿«ã«'},
    {id:10, axis:'tempo',  head:'å¸­æ›¿ãˆã®é »åº¦',             text:'ä¼šã®ç››ã‚Šä¸Šã’ã¨ã—ã¦',       A:'ã»ã¨ã‚“ã©ã—ãªã„', B:'ãƒ†ãƒ³ãƒã‚ˆãè¡Œã†'},
    {id:11, axis:'tempo',  head:'BGMã¨é›°å›²æ°—',              text:'å¿ƒåœ°ã‚ˆã„ã®ã¯',             A:'è½ã¡ç€ã„ãŸé›°å›²æ°—', B:'è³‘ã‚„ã‹ãªé›°å›²æ°—'},
    {id:12, axis:'tempo',  head:'å†™çœŸãƒ»å‹•ç”»ã®æ’®å½±',         text:'é€²è¡Œã®ä¸­ã§',               A:'æœ€å°é™ã§OK', B:'ãƒ†ãƒ³ãƒè‰¯ãæ’®ã£ã¦å…±æœ‰'},

    {id:13, axis:'social', head:'äººæ•°ã®å¥½ã¿',               text:'å±…å¿ƒåœ°ãŒè‰¯ã„ã®ã¯',         A:'2ã€œ3äººã§ã˜ã£ãã‚Š', B:'å¤§äººæ•°ã§ãƒ¯ã‚¤ãƒ¯ã‚¤'},
    {id:14, axis:'social', head:'ä¹¾æ¯å¾Œã®å‹•ã',             text:'æœ€åˆã«ã‚„ã‚ŠãŒã¡ãªã®ã¯',     A:'å‘ã‹ã„ã®äººã¨æ·±ãè©±ã™', B:'ãƒ†ãƒ¼ãƒ–ãƒ«å…¨å“¡ã«å£°ã‚’ã‹ã‘ã‚‹'},
    {id:15, axis:'social', head:'è¨˜å¿µæ’®å½±',                 text:'å†™çœŸã‚’æ’®ã‚‹ãªã‚‰',           A:'å¿…è¦ãªäººã ã‘ã§', B:'å…¨å“¡ã§æ’®ã‚ŠãŸã„'},
    {id:16, axis:'social', head:'å¸­ã®é¸ã³æ–¹',               text:'è½ã¡ç€ãã®ã¯',             A:'éš…ã®å¸­ã§è½ã¡ç€ã', B:'ä¸­å¤®å¯„ã‚Šã§äº¤æµã—ã‚„ã™ã'},

    {id:17, axis:'texture',head:'é£Ÿæ„Ÿã®å¥½ã¿',               text:'ã©ã¡ã‚‰ãŒã‚ˆã‚Šå¥½ã¿ï¼Ÿ',       A:'å£ã©ã‘ãªã‚ã‚‰ã‹', B:'æ­¯ã”ãŸãˆã—ã£ã‹ã‚Š'},
    {id:18, axis:'texture',head:'ã‚«ãƒƒãƒˆåš',                 text:'è‚‰ã®åšã¿ã«é–¢ã—ã¦',         A:'è–„ã‚ã§è»½ã', B:'åšã‚ã§å™›ã¿ãŸã„'},
    {id:19, axis:'texture',head:'ç„¼ãåŠ æ¸›',                 text:'åŸºæœ¬ã®ç«å…¥ã‚Œã¯',           A:'ãƒ¬ã‚¢å¯„ã‚Šã§æŸ”ã‚‰ã‹ã', B:'ãƒŸãƒ‡ã‚£ã‚¢ãƒ ä»¥ä¸Šã§é£Ÿã¹å¿œãˆ'},
    {id:20, axis:'texture',head:'èª¿ç†ã®æ–¹å‘æ€§',             text:'ä»•ä¸ŠãŒã‚Šã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹',     A:'ä½æ¸©ã§ã—ã£ã¨ã‚Š', B:'ç‚­ç«é¦™ã§å™›ã¿ç· ã‚ã‚‹'},
  ];

  // === State ===
  let idx = 0; // 0..19
  // answers: {id, value} where value âˆˆ {-2,-1,0,1,2}
  let answers = [];

  const $ = (id)=>document.getElementById(id);
  $('y').textContent = new Date().getFullYear();

  const quizCard = $('quizCard');
  const resultCard = $('resultCard');

  $('prevBtn').onclick = ()=>{ if(idx>0){ idx--; renderQ(); } };
  $('nextBtn').onclick = ()=>{ if(idx < Q.length-1){ idx++; renderQ(); } else { showResult(); } };

  // ã‚­ãƒ¼æ“ä½œ 1..5
  window.addEventListener('keydown',(e)=>{
    if(!/^[1-5]$/.test(e.key)) return;
    choose( (+e.key)-3 ); // 1â†’-2, 2â†’-1, 3â†’0, 4â†’+1, 5â†’+2
  });

  // åˆæœŸæç”»
  renderQ();

  function renderQ(){
    const q = Q[idx];
    $('qIdx').textContent = (idx+1);
    $('bar').style.width = ((idx)/Q.length*100) + '%';
    $('qHead').textContent = q.head;
    $('qText').textContent = q.text;
    $('aLeft').textContent  = `Aï¼š${q.A}`;
    $('aRight').textContent = `Bï¼š${q.B}`;

    const holder = $('scale');
    holder.innerHTML = '';
    const prev = answers.find(a=>a.id===q.id)?.value; // -2..2

    const labels = [
      {v:-2, t:'Aã«ã¨ã¦ã‚‚è¿‘ã„'},
      {v:-1, t:'Aã«è¿‘ã„'},
      {v: 0, t:'ä¸­é–“'},
      {v:+1, t:'Bã«è¿‘ã„'},
      {v:+2, t:'Bã«ã¨ã¦ã‚‚è¿‘ã„'},
    ];

    labels.forEach(({v,t})=>{
      const div = document.createElement('div');
      div.className = 'cell';
      div.dataset.sel = (prev===v)?'1':'0';
      div.innerHTML = `<div style="font-weight:900">${mapKeyFromValue(v)}</div><small>${t}</small>`;
      div.onclick = ()=> choose(v);
      holder.appendChild(div);
    });

    $('prevBtn').disabled = (idx===0);
    $('nextBtn').disabled = (prev==null);
  }

  // v âˆˆ {-2,-1,0,1,2}
  function choose(v){
    const q = Q[idx];
    const i = answers.findIndex(a=>a.id===q.id);
    if(i>=0) answers[i].value = v; else answers.push({id:q.id, value:v});
    // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é¸æŠæ›´æ–°
    Array.from($('scale').children).forEach((c, i)=>{
      const vv = [-2,-1,0,1,2][i];
      c.dataset.sel = (vv===v)?'1':'0';
    });
    $('nextBtn').disabled = false;

    // è‡ªå‹•ã§æ¬¡ã¸
    setTimeout(()=>{
      if(idx < Q.length-1){ idx++; renderQ(); }
      else{ showResult(); }
    }, 160);
  }

  function mapKeyFromValue(v){
    // è¡¨ç¤ºç”¨ã®ã‚­ãƒ¼ï¼ˆ1..5ï¼‰
    return ({'-2':'1','-1':'2','0':'3','1':'4','2':'5'})[String(v)];
  }

  function diagnose(ans){
    // å„è»¸ã‚’åˆç®—â†’å¹³å‡ï¼ˆ-2..+2ï¼‰
    const sum = Object.fromEntries(AXES.map(a=>[a,0]));
    const cnt = Object.fromEntries(AXES.map(a=>[a,0]));
    for(const a of ans){
      const q = Q.find(x=>x.id===a.id); if(!q) continue;
      sum[q.axis]+=a.value; cnt[q.axis]+=1;
    }
    const vec = {};
    for(const ax of AXES){ vec[ax] = cnt[ax] ? (sum[ax]/cnt[ax]) : 0; }

    // 12ã‚¿ã‚¤ãƒ—ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆåº§æ¨™ã¯-2..+2ï¼‰ã¨ã®ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢
    let best=null, bestDist=Infinity;
    for(const [name, t] of Object.entries(TYPES)){
      const d = AXES.reduce((s,ax)=> s + Math.pow(vec[ax]-t.c[ax],2), 0);
      if(d<bestDist || (d===bestDist && name.localeCompare(best)<0)){ bestDist=d; best=name; }
    }
    return { name:best, vec, one:TYPES[best].one, bestMate:TYPES[best].best, caution:TYPES[best].caution };
  }

  function tagify(vec){
    const t=[];
    t.push( vec.rich<=-1 ? 'èµ¤èº«å¯„ã‚Š' : vec.rich>=1 ? 'ã‚³ã‚¯å¯„ã‚Š' : 'ä¸­åº¸');
    t.push( vec.adv <=-1 ? 'ç‹é“æ´¾'  : vec.adv >=1 ? 'å†’é™ºæ´¾'  : 'æ™‚ã¨å ´åˆ');
    t.push( vec.tempo<=-1 ? 'ã—ã£ã¨ã‚Š' : vec.tempo>=1 ? 'ã«ãã‚„ã‹' : 'ãƒãƒ©ãƒ³ã‚¹');
    t.push( vec.social<=-1 ? 'å°‘äººæ•°å¥½ã' : vec.social>=1 ? 'å¤§äººæ•°å¥½ã' : 'ã©ã¡ã‚‰ã§ã‚‚');
    t.push( vec.texture<=-1 ? 'å£ã©ã‘æ´¾' : vec.texture>=1 ? 'å™›ã¿ã”ãŸãˆæ´¾' : 'ã©ã¡ã‚‰ã‚‚OK');
    return t;
  }

  function showResult(){
    const r = diagnose(answers);
    quizCard.hidden = true;
    resultCard.hidden = false;

    $('rType').textContent = r.name;
    $('rOne').textContent  = r.one;
    $('bestMate').textContent = r.bestMate;
    $('caution').textContent  = r.caution;

    const img = TYPE_IMAGE[r.name] || '';
    const rImg = $('rImg'); rImg.src = img; rImg.alt = r.name;

    const holder = $('rTags'); holder.innerHTML='';
    tagify(r.vec).forEach(s=>{
      const span=document.createElement('span'); span.className='tag'; span.textContent=s; holder.appendChild(span);
    });

    $('retryBtn').onclick = ()=>{ idx=0; answers=[]; resultCard.hidden=true; quizCard.hidden=false; renderQ(); window.scrollTo({top:0,behavior:'smooth'}); };
    $('saveBtn').onclick = ()=>{
      const payload = { type:r.name, one:r.one, best:r.bestMate, caution:r.caution, vector:r.vec, answers, generatedAt:new Date().toISOString() };
      const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`MeatBTI_${r.name}.json`; a.click(); URL.revokeObjectURL(url);
    };
    window.scrollTo({top:0,behavior:'smooth'});
  }
</script>
</body>
</html>
