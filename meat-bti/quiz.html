<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meat BTI è¨ºæ–­ï¼ˆ20å•ãƒ»è³ªå•ç”»é¢ï¼‰</title>
<meta name="description" content="20å•ã§ã‚ãªãŸã®â€œè‚‰ã‚¿ã‚¤ãƒ—â€ã‚’è¨ºæ–­ã€‚12ã‚¿ã‚¤ãƒ—ã®ã‚­ãƒ£ãƒ©ã¨ç›¸æ€§No.1ãƒ»è¦æ³¨æ„ã‚¿ã‚¤ãƒ—ã‚’è¡¨ç¤ºã€‚">
<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V39MNGQD5H"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date()); gtag('config', 'G-V39MNGQD5H');
</script>
<style>
  :root{--bg:#0b0d13;--panel:#111522;--ink:#f7faff;--muted:#b9c2d3;--bd:#1b2334;--cheese:#ffd966;--tomato:#ff6b4a;--ok:#35d19d;--shadow:0 14px 32px rgba(0,0,0,.35)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;letter-spacing:.02em;line-height:1.7}
  a{color:inherit;text-decoration:none}
  .wrap{min-height:100dvh;display:grid;grid-template-rows:auto 1fr auto}
  header{position:sticky;top:0;background:rgba(17,21,34,.8);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--bd);z-index:10}
  .head-in{width:min(960px,92vw);margin:0 auto;height:56px;display:flex;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:30px;height:30px;border-radius:10px;background:conic-gradient(from 140deg,var(--cheese),var(--tomato));display:grid;place-items:center;color:#111;font-weight:900}
  .btn{appearance:none;border:1px solid var(--bd);background:#152037;color:var(--ink);padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer;transition:transform .06s ease}
  .btn.primary{background:linear-gradient(180deg,var(--tomato),#ff4e2f);color:#111;border:none}
  .main{width:min(820px,92vw);margin:0 auto;padding:16px 0}
  .card{background:var(--panel);border:1px solid var(--bd);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
  .progress{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--bd)}
  .bar{height:8px;background:#121a2f;border:1px solid var(--bd);border-radius:999px;overflow:hidden;flex:1}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--cheese),var(--tomato))}
  .qwrap{padding:16px}
  .qhead{font-weight:900;margin:0 0 6px}
  .qtext{margin:0 0 10px;color:#dce6ff}
  .choices{display:grid;gap:10px}
  .choice{display:flex;align-items:center;gap:10px;border:1px solid #293653;background:#121a31;border-radius:12px;padding:12px;cursor:pointer}
  .choice[data-sel="1"]{outline:2px solid var(--cheese);border-color:#6b5722;background:#1b243b}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#10172a;border:1px solid #26314b;font-size:12px;color:#cdd8ef}
  .qfoot{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0e1424;border:1px solid #2a3651;border-radius:6px;padding:2px 6px;font-size:12px;color:#9fb0cc}
  .result{display:grid;gap:16px}
  .r-hero{display:grid;grid-template-columns:1fr 1.2fr;gap:14px}
  @media(max-width:800px){.r-hero{grid-template-columns:1fr}}
  .r-img{aspect-ratio:1/1;background:#0b1222;border-radius:12px;overflow:hidden;border:1px solid #1f2a43}
  .r-img img{width:100%;height:100%;object-fit:cover}
  .rtype{font-size:clamp(22px,5vw,28px);font-weight:900;margin:0}
  .r-tags{margin-top:6px;display:flex;flex-wrap:wrap;gap:6px}
  .tag{padding:6px 10px;border:1px solid #2a385e;border-radius:999px;background:#111a31;font-size:12px}
  footer{color:#9fb0cc;font-size:12px;padding:14px;border-top:1px solid var(--bd);text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="head-in">
      <div class="brand"><div class="logo">ğŸ¥©</div><b>Meat BTI è¨ºæ–­</b></div>
      <a class="btn" href="index.html">â† å›³é‘‘ã«æˆ»ã‚‹</a>
    </div>
  </header>

  <main class="main">
    <div class="card" id="quizCard">
      <div class="progress">
        <div><b id="qIdx">1</b>/20</div>
        <div class="bar"><div id="bar"></div></div>
      </div>
      <div class="qwrap">
        <p class="qhead" id="qHead">è¨­å•</p>
        <p class="qtext" id="qText"></p>
        <div class="choices" id="choices"></div>
        <div class="qfoot">
          <div class="pill">A/Bã¯ <span class="kbd">1</span>/<span class="kbd">2</span>ã€A/B/Cã¯ <span class="kbd">1</span>/<span class="kbd">2</span>/<span class="kbd">3</span></div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="prevBtn">æˆ»ã‚‹</button>
            <button class="btn primary" id="nextBtn" disabled>æ¬¡ã¸</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card" id="resultCard" hidden>
      <div class="qwrap result">
        <div class="r-hero">
          <div class="r-img"><img id="rImg" alt=""></div>
          <div>
            <h2 class="rtype" id="rType">â€”</h2>
            <div class="r-tags" id="rTags"></div>
            <p id="rOne" style="margin-top:8px;color:#dce6ff">â€”</p>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
              <button class="btn" id="retryBtn">ã‚‚ã†ä¸€åº¦</button>
              <button class="btn" id="saveBtn">çµæœã‚’ä¿å­˜(JSON)</button>
              <a class="btn primary" href="index.html">å›³é‘‘ã¸æˆ»ã‚‹</a>
            </div>
          </div>
        </div>
        <div style="margin-top:10px">
          <p><b>ç›¸æ€§No.1ï¼š</b><span id="bestMate">â€”</span></p>
          <p style="color:#ffd7b8"><b>è¦æ³¨æ„ï¼š</b><span id="caution">â€”</span></p>
        </div>
      </div>
    </div>
  </main>

  <footer>Â© <span id="y"></span> Meat BTI</footer>
</div>

<script>
  // === Axes (5) ===
  const AXES = ['rich','adv','tempo','social','texture']; // +å´ï¼šæ¿ƒåš/å†’é™º/ã«ãã‚„ã‹/å¤§å‹¢/å™›ã¿ã”ãŸãˆ

  // === Type definitions ===
  const TYPES = {
    'ãƒ’ãƒ¬ç”·çˆµ':           { c:{rich:-2, adv:-2, tempo:-2, social:-2, texture:-2}, one:'é™ã‹ãªä¸»å½¹ã€‚ç„¡é§„ãªãä¸Šå“ã€èŠ¯ã¯å¼·ã„ã€‚', best:'æ›¸é“å®¶ãƒŸã‚¹ã‚¸', caution:'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“' },
    'ã‚¿ãƒ³éšŠé•·':           { c:{rich:-1, adv:+1, tempo:+2, social:+1, texture:+2}, one:'åˆå›³ã¨æ®µå–ã‚Šã§å ´ã‚’å›ã™ãƒ ãƒ¼ãƒ‰ç‰½å¼•ã€‚', best:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹', caution:'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹' },
    'ã‚¤ãƒãƒœãƒãƒ':         { c:{rich:+1, adv:-1, tempo:-1, social:-1, texture:-1}, one:'é¢å€’è¦‹ã®è‰¯ã•ã¨å®‰å¿ƒæ„Ÿã€‚æ§ãˆã‚ã§ã‚‚é ¼ã‚Œã‚‹ã€‚', best:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ', caution:'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹' },
    'ãƒ©ãƒ³ãƒ—åšå£«':         { c:{rich:-1, adv:+2, tempo:+1, social: 0, texture:+1}, one:'å°ã•ãªå®Ÿé¨“ã§ä¼šè©±ã‚’åºƒã’ã‚‹è¦³å¯Ÿçœ¼ã€‚', best:'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“', caution:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹' },
    'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹':     { c:{rich:+2, adv:-1, tempo: 0, social:+1, texture:-1}, one:'ã©ã£ã—ã‚Šæº€è¶³åº¦ã€‚é ¼ã‚Œã‚‹çµ±ç‡åŠ›ã€‚', best:'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“', caution:'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“' },
    'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹':       { c:{rich:+2, adv:+1, tempo:+1, social:+2, texture: 0}, one:'è¯ã‚„ã‹ãªæ¼”å‡ºã§å ´ã‚’æ˜ã‚‹ãã™ã‚‹ç‹é“ã€‚', best:'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹', caution:'æ›¸é“å®¶ãƒŸã‚¹ã‚¸' },
    'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³':     { c:{rich:+2, adv:-2, tempo:-2, social:-1, texture:-1}, one:'ã—ã£ã¨ã‚Šæ¿ƒåšã€‚è¨€è‘‰ã‚‚æ‰€ä½œã‚‚ä¸å¯§ã€‚', best:'ã‚¿ãƒ³éšŠé•·', caution:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ' },
    'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“':       { c:{rich:+2, adv:+2, tempo:+2, social:+2, texture: 0}, one:'ã”è¤’ç¾æ„Ÿã§å ´ã‚’çˆ†ä¸Šã’ã™ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¡åŠ›ã€‚', best:'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹', caution:'ãƒ©ãƒ³ãƒ—åšå£«' },
    'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ': { c:{rich: 0, adv:+1, tempo:+2, social:+1, texture:+1}, one:'ãƒ†ãƒ³ãƒè‰¯ãå®Ÿå‹™ã‚‚ä¼šè©±ã‚‚å›ã™åˆ‡æ›¿ä¸Šæ‰‹ã€‚', best:'ã‚¤ãƒãƒœãƒãƒ', caution:'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³' },
    'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“':   { c:{rich:+1, adv: 0, tempo:+1, social: 0, texture:-1}, one:'è»½ã‚„ã‹ä¸Šå“ã€‚å ´ã®æ©‹æ¸¡ã—ãŒå¾—æ„ã€‚', best:'ãƒ©ãƒ³ãƒ—åšå£«', caution:'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ' },
    'æ›¸é“å®¶ãƒŸã‚¹ã‚¸':       { c:{rich:+1, adv:-2, tempo:-2, social:-2, texture:-2}, one:'ç¹Šç´°ãªç¾æ„è­˜ã€‚é™ã‹ã«æ·±ãå‘ãåˆã†ã€‚', best:'ãƒ’ãƒ¬ç”·çˆµ', caution:'ã‚¤ãƒãƒœãƒãƒ' },
    'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹': { c:{rich:+1, adv:-1, tempo:-2, social:-1, texture:-2}, one:'é‡ã‚ˆã‚Šè³ªã®ä¸€ç‚¹é›†ä¸­ã€‚é™ã‹ãªæ ¼ä¸Šã€‚', best:'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³', caution:'ãƒ’ãƒ¬ç”·çˆµ' },
  };

  // === Character images ===
  const TYPE_IMAGE = {
    'ãƒ’ãƒ¬ç”·çˆµ':'hire.png',
    'ã‚¿ãƒ³éšŠé•·':'tan.png',
    'ã‚¤ãƒãƒœãƒãƒ':'ichibo.png',
    'ãƒ©ãƒ³ãƒ—åšå£«':'ranpu.png',
    'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒœã‚¹':'riburo-su.png',
    'ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ç‹':'sa-roin.png',
    'ç¾é£Ÿå®¶ã‚¶ãƒ–ãƒˆãƒ³':'zabuton.png',
    'ã‚®ãƒ£ãƒ«ã‚«ãƒ«ãƒ“':'karubi.png',
    'ã‚„ã‚Šæ‰‹ã®å–¶æ¥­ãƒãƒ³ãƒãƒ©ãƒŸ':'harami.png',
    'ã‚«ã‚¤ãƒãƒŸèˆå¦“ã¯ã‚“':'kainomi.png',
    'æ›¸é“å®¶ãƒŸã‚¹ã‚¸':'misuji.png',
    'ã‚·ãƒ£ãƒˆãƒ¼ãƒ–ãƒªã‚¢ãƒ³å¥³ç‹':'shato-.png',
  };

  // === 20 Questions (AB / ABC) ===
  const Q = [
    {id:1,  kind:'AB',  axis:'rich',   head:'æœ€åˆã®ä¸€çš¿ã¯ï¼Ÿ', text:'åŒã˜ä¾¡æ ¼ãªã‚‰ã©ã¡ã‚‰ã‚’é¸ã¶ï¼Ÿ', A:'èµ¤èº«ã§è»½ã', B:'ã‚³ã‚¯ã®ã‚ã‚‹ãƒªãƒƒãƒãªéƒ¨ä½'},
    {id:2,  kind:'AB',  axis:'rich',   head:'ãƒ¡ã‚¤ãƒ³ã®ä¸€çš¿', text:'æº€è¶³åº¦ã‚’å„ªå…ˆã™ã‚‹ãªã‚‰ï¼Ÿ', A:'ãƒ’ãƒ¬ãƒ»ãƒ©ãƒ³ãƒ—ãªã©èµ¤èº«', B:'ãƒªãƒ–ãƒ­ãƒ¼ã‚¹ãƒ»ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ãªã©ã‚³ã‚¯'},
    {id:3,  kind:'AB',  axis:'rich',   head:'è„‚ã®é‡ã®å¥½ã¿', text:'å¥½ããªæ–¹å‘æ€§ã«è¿‘ã„ã®ã¯ï¼Ÿ', A:'è„‚æ§ãˆã‚ã§ã‚­ãƒ¬é‡è¦–', B:'è„‚ã®æ—¨ã¿ã‚’ã—ã£ã‹ã‚Š'},
    {id:4,  kind:'ABC', axis:'rich',   head:'ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿ', text:'é‡ã¨é‡ã•ã®ãƒãƒ©ãƒ³ã‚¹ã¯ï¼Ÿ', A:'è»½ã‚ãŒå¥½ã', B:'ã©ã¡ã‚‰ã§ã‚‚', C:'é‡åšã§ã‚‚OK'},

    {id:5,  kind:'AB',  axis:'adv',    head:'ã‚ªãƒ¼ãƒ€ãƒ¼æ–¹é‡', text:'ã¯ã˜ã‚ã¦ã®ãŠåº—ã§', A:'ç‹é“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸­å¿ƒ', B:'é™å®šãƒ»å‰µä½œã‚‚æ”»ã‚ã‚‹'},
    {id:6,  kind:'ABC', axis:'adv',    head:'æ–°ãƒ¡ãƒ‹ãƒ¥ãƒ¼', text:'æœªçŸ¥ã®ä¸€çš¿ãŒã‚ã£ãŸã‚‰', A:'æ§˜å­è¦‹', B:'ã©ã¡ã‚‰ã§ã‚‚', C:'ã¾ãšè©¦ã™'},
    {id:7,  kind:'AB',  axis:'adv',    head:'å‘³ä»˜ã‘ã®é¸ã³æ–¹', text:'åŸºæœ¬ã¯', A:'å®šç•ªã®å¡©ãƒ»ç‰¹è£½ã‚½ãƒ¼ã‚¹', B:'æ—¬ã®ã‚½ãƒ¼ã‚¹ã‚„ã‚¹ãƒ‘ã‚¤ã‚¹ã‚‚æ­“è¿'},
    {id:8,  kind:'ABC', axis:'adv',    head:'ç„¼ãæ–¹ã‚«ã‚¹ã‚¿ãƒ ', text:'è‡ªåˆ†ã§èª¿æ•´ã™ã‚‹ã®ã¯', A:'ã‚ã¾ã‚Šã—ãªã„', B:'ã“ã ã‚ã‚‰ãªã„', C:'ç©æ¥µçš„ã«ã‚„ã‚‹'},

    {id:9,  kind:'AB',  axis:'tempo',  head:'é£Ÿäº‹ã®ãƒ†ãƒ³ãƒ', text:'ç†æƒ³ã®é€²è¡Œã¯ï¼Ÿ', A:'ä¸€çš¿ãšã¤ã‚†ã£ãã‚Š', B:'ã‚µã‚¯ã‚µã‚¯è»½å¿«ã«'},
    {id:10, kind:'ABC', axis:'tempo',  head:'å¸­æ›¿ãˆã®é »åº¦', text:'ä¼šã®ç››ã‚Šä¸Šã’ã¨ã—ã¦', A:'ã»ã¨ã‚“ã©ã—ãªã„', B:'å ´ã«åˆã‚ã›ã‚‹', C:'ãƒ†ãƒ³ãƒã‚ˆãè¡Œã†'},
    {id:11, kind:'AB',  axis:'tempo',  head:'BGMã¨é›°å›²æ°—', text:'å¿ƒåœ°ã‚ˆã„ã®ã¯', A:'è½ã¡ç€ã„ãŸé›°å›²æ°—', B:'è³‘ã‚„ã‹ãªé›°å›²æ°—'},
    {id:12, kind:'ABC', axis:'tempo',  head:'å†™çœŸãƒ»å‹•ç”»ã®æ’®å½±', text:'é€²è¡Œã®ä¸­ã§', A:'æœ€å°é™ã§OK', B:'ã©ã¡ã‚‰ã§ã‚‚', C:'ãƒ†ãƒ³ãƒè‰¯ãæ’®ã£ã¦å…±æœ‰'},

    {id:13, kind:'AB',  axis:'social', head:'äººæ•°ã®å¥½ã¿', text:'å±…å¿ƒåœ°ãŒè‰¯ã„ã®ã¯', A:'2ã€œ3äººã§ã˜ã£ãã‚Š', B:'å¤§äººæ•°ã§ãƒ¯ã‚¤ãƒ¯ã‚¤'},
    {id:14, kind:'AB',  axis:'social', head:'ä¹¾æ¯å¾Œã®å‹•ã', text:'æœ€åˆã«ã‚„ã‚ŠãŒã¡ãªã®ã¯', A:'å‘ã‹ã„ã®äººã¨æ·±ãè©±ã™', B:'ãƒ†ãƒ¼ãƒ–ãƒ«å…¨å“¡ã«å£°ã‚’ã‹ã‘ã‚‹'},
    {id:15, kind:'ABC', axis:'social', head:'è¨˜å¿µæ’®å½±', text:'å†™çœŸã‚’æ’®ã‚‹ãªã‚‰', A:'å¿…è¦ãªäººã ã‘ã§', B:'ã©ã¡ã‚‰ã§ã‚‚', C:'å…¨å“¡ã§æ’®ã‚ŠãŸã„'},
    {id:16, kind:'AB',  axis:'social', head:'å¸­ã®é¸ã³æ–¹', text:'è½ã¡ç€ãã®ã¯', A:'éš…ã®å¸­ã§è½ã¡ç€ã', B:'ä¸­å¤®å¯„ã‚Šã§äº¤æµã—ã‚„ã™ã'},

    {id:17, kind:'AB',  axis:'texture',head:'é£Ÿæ„Ÿã®å¥½ã¿', text:'ã©ã¡ã‚‰ãŒã‚ˆã‚Šå¥½ã¿ï¼Ÿ', A:'å£ã©ã‘ãªã‚ã‚‰ã‹', B:'æ­¯ã”ãŸãˆã—ã£ã‹ã‚Š'},
    {id:18, kind:'ABC', axis:'texture',head:'ã‚«ãƒƒãƒˆåš', text:'è‚‰ã®åšã¿ã«é–¢ã—ã¦', A:'è–„ã‚ã§è»½ã', B:'ã“ã ã‚ã‚‰ãªã„', C:'åšã‚ã§å™›ã¿ãŸã„'},
    {id:19, kind:'AB',  axis:'texture',head:'ç„¼ãåŠ æ¸›', text:'åŸºæœ¬ã®ç«å…¥ã‚Œã¯', A:'ãƒ¬ã‚¢å¯„ã‚Šã§æŸ”ã‚‰ã‹ã', B:'ãƒŸãƒ‡ã‚£ã‚¢ãƒ ä»¥ä¸Šã§é£Ÿã¹å¿œãˆ'},
    {id:20, kind:'ABC', axis:'texture',head:'èª¿ç†ã®æ–¹å‘æ€§', text:'ä»•ä¸ŠãŒã‚Šã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹', A:'ä½æ¸©ã§ã—ã£ã¨ã‚Š', B:'ã©ã¡ã‚‰ã§ã‚‚', C:'ç‚­ç«é¦™ã§å™›ã¿ç· ã‚ã‚‹'},
  ];

  // === State ===
  let idx = 0;
  let answers = []; // {id, choice:'A'|'B'|'C'}

  const $ = (id)=>document.getElementById(id);
  $('y').textContent = new Date().getFullYear();

  const quizCard = $('quizCard');
  const resultCard = $('resultCard');

  $('prevBtn').onclick = ()=>{ if(idx>0){ idx--; renderQ(); } };
  $('nextBtn').onclick = ()=>{ if(idx < Q.length-1){ idx++; renderQ(); } else { showResult(); } };

  window.addEventListener('keydown',(e)=>{
    const q = Q[idx]; if(!q) return;
    if(['1','2','3'].includes(e.key)){
      if(q.kind==='AB' && (e.key==='1'||e.key==='2')) selectChoice(q, e.key==='1'?'A':'B');
      if(q.kind==='ABC'){
        if(e.key==='1') selectChoice(q,'A');
        else if(e.key==='2') selectChoice(q,'B');
        else if(e.key==='3') selectChoice(q,'C');
      }
    }
  });

  // init
  renderQ();

  function renderQ(){
    const q = Q[idx];
    $('qIdx').textContent = (idx+1);
    $('bar').style.width = ((idx)/Q.length*100) + '%';
    $('qHead').textContent = q.head;
    $('qText').textContent = q.text;

    const holder = $('choices'); holder.innerHTML='';
    const prev = answers.find(a=>a.id===q.id)?.choice;

    const add = (label, text) => {
      const div = document.createElement('div');
      div.className = 'choice';
      div.dataset.sel = (prev===label)?'1':'0';
      div.setAttribute('role','button');
      div.innerHTML = `<span class="pill">${label}</span><span>${text}</span>`;
      div.onclick = ()=> selectChoice(q,label);
      holder.appendChild(div);
    };
    if(q.kind==='AB'){ add('A',q.A); add('B',q.B); }
    else { add('A',q.A); add('B',q.B); add('C',q.C); }

    $('prevBtn').disabled = (idx===0);
    $('nextBtn').disabled = (prev==null);
  }

  function selectChoice(q,label){
    const i = answers.findIndex(a=>a.id===q.id);
    if(i>=0) answers[i].choice = label; else answers.push({id:q.id, choice:label});
    Array.from($('choices').children).forEach((c, k)=>{
      const want = (q.kind==='AB'?(k===0?'A':'B'):(k===0?'A':k===1?'B':'C'));
      c.dataset.sel = (want===label)?'1':'0';
    });
    $('nextBtn').disabled = false;
  }

  function valueFrom(choice, kind){
    if(kind==='AB') return (choice==='A')? -1 : +1;
    if(kind==='ABC')return (choice==='A')? -1 : (choice==='B'?0:+1);
    return 0;
  }

  function diagnose(ans){
    const score = Object.fromEntries(AXES.map(a=>[a,0]));
    const cnt   = Object.fromEntries(AXES.map(a=>[a,0]));
    for(const a of ans){
      const q = Q.find(x=>x.id===a.id); if(!q) continue;
      const v = valueFrom(a.choice, q.kind);
      score[q.axis]+=v; cnt[q.axis]+=1;
    }
    for(const ax of AXES){ if(cnt[ax]) score[ax]/=cnt[ax]; }

    let best=null, bestDist=Infinity;
    for(const [name, t] of Object.entries(TYPES)){
      const d = AXES.reduce((s,ax)=> s + Math.pow(score[ax]-t.c[ax],2), 0);
      if(d<bestDist || (d===bestDist && name.localeCompare(best)<0)){ bestDist=d; best=name; }
    }
    return { name:best, vec:score, one:TYPES[best].one, bestMate:TYPES[best].best, caution:TYPES[best].caution };
  }

  function tagify(vec){
    const t=[];
    t.push( vec.rich<=-0.5 ? 'èµ¤èº«å¯„ã‚Š' : vec.rich>=0.5 ? 'ã‚³ã‚¯å¯„ã‚Š' : 'ä¸­åº¸');
    t.push( vec.adv <=-0.5 ? 'ç‹é“æ´¾'  : vec.adv >=0.5 ? 'å†’é™ºæ´¾'  : 'æ™‚ã¨å ´åˆ');
    t.push( vec.tempo<=-0.5 ? 'ã—ã£ã¨ã‚Š' : vec.tempo>=0.5 ? 'ã«ãã‚„ã‹' : 'ãƒãƒ©ãƒ³ã‚¹');
    t.push( vec.social<=-0.5 ? 'å°‘äººæ•°å¥½ã' : vec.social>=0.5 ? 'å¤§äººæ•°å¥½ã' : 'ã©ã¡ã‚‰ã§ã‚‚');
    t.push( vec.texture<=-0.5 ? 'å£ã©ã‘æ´¾' : vec.texture>=0.5 ? 'å™›ã¿ã”ãŸãˆæ´¾' : 'ã©ã¡ã‚‰ã‚‚OK');
    return t;
  }

  function showResult(){
    const r = diagnose(answers);
    // swap cards
    document.getElementById('quizCard').hidden = true;
    document.getElementById('resultCard').hidden = false;

    document.getElementById('rType').textContent = r.name;
    document.getElementById('rOne').textContent  = r.one;
    document.getElementById('bestMate').textContent = r.bestMate;
    document.getElementById('caution').textContent  = r.caution;

    const img = TYPE_IMAGE[r.name] || '';
    const rImg = document.getElementById('rImg');
    rImg.src = img; rImg.alt = r.name;

    const holder = document.getElementById('rTags'); holder.innerHTML='';
    tagify(r.vec).forEach(s=>{
      const span=document.createElement('span'); span.className='tag'; span.textContent=s; holder.appendChild(span);
    });

    document.getElementById('retryBtn').onclick = ()=>{ idx=0; answers=[]; document.getElementById('resultCard').hidden=true; document.getElementById('quizCard').hidden=false; renderQ(); window.scrollTo({top:0,behavior:'smooth'}); };
    document.getElementById('saveBtn').onclick = ()=>{
      const payload = { type:r.name, one:r.one, best:r.bestMate, caution:r.caution, vector:r.vec, answers, generatedAt:new Date().toISOString() };
      const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`MeatBTI_${r.name}.json`; a.click(); URL.revokeObjectURL(url);
    };
    window.scrollTo({top:0,behavior:'smooth'});
  }
</script>
</body>
</html>
